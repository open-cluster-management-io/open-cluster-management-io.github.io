<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://open-cluster-management.io/docs/><link rel=alternate type=application/rss+xml href=https://open-cluster-management.io/docs/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Documentation | Open Cluster Management</title>
<meta name=description content="Open Cluster Management official site"><meta property="og:url" content="https://open-cluster-management.io/docs/"><meta property="og:site_name" content="Open Cluster Management"><meta property="og:title" content="Documentation"><meta property="og:description" content="Open Cluster Management official site"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Documentation"><meta itemprop=description content="Open Cluster Management official site"><meta itemprop=dateModified content="2024-09-20T07:13:55+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Documentation"><meta name=twitter:description content="Open Cluster Management official site"><link rel=preload href=/scss/main.min.5b781ea478351b0ae6a4b76c09a1e12144a17c359d37b236b5f1b1970ed15522.css as=style><link href=/scss/main.min.5b781ea478351b0ae6a4b76c09a1e12144a17c359d37b236b5f1b1970ed15522.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 77.76 75.84"><defs><style>.cls-1{fill:none}.cls-2{fill:#fff}.cls-3{clip-path:url(#clip-path)}.cls-4{clip-path:url(#clip-path-2)}</style><clipPath id="clip-path" transform="translate(5.38 5.32)"><path class="cls-1" d="M67.11 39.69 61.34 14.61a4.48 4.48.0 00-2.42-3L35.55.44A4.52 4.52.0 0033.38.0a4.36 4.36.0 00-1.71.43L8.3 11.61a4.41 4.41.0 00-2.42 3L.11 39.7a4.37 4.37.0 00.61 3.39c.08.13.16.24.25.36L17.15 63.56a4.49 4.49.0 003.49 1.67H46.58a4.5 4.5.0 003.5-1.66L66.25 43.44A4.37 4.37.0 0067.11 39.69zM52.3 34.43a18.71 18.71.0 01-34.09 9.82c3.87-1.37 15.74-5.69 8.4-4.44A87.29 87.29.0 0116.1 41h-.42c-.57.0-1.13.0-1.67.0h-.37c-.54.0-1.07.0-1.58.0h-.31q-.77.0-1.47-.12c-2.78-.31-4.61-1.08-4.51-2.54.25-3.72 9.12-5.71 9.12-5.71a18.7 18.7.0 0134-9.82c-3.93 1.4-15.64 5.66-8.34 4.41a87.13 87.13.0 0110.5-1.16h.43 1.66.37q.82.0 1.59.0h.31c.51.0 1 .07 1.46.12 2.78.31 4.62 1.08 4.52 2.53C61.15 32.41 52.45 34.4 52.3 34.43z"/></clipPath><clipPath id="clip-path-2" transform="translate(5.38 5.32)"><rect class="cls-1" x="-5" y="-5" width="77.22" height="75.23"/></clipPath></defs><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path id="path3055" class="cls-2" d="M34.64 3.44a4.06 4.06.0 00-1.53.38l-20.91 10A4 4 0 0010 16.51L4.87 39a3.93 3.93.0 00.55 3 3.62 3.62.0 00.22.32l14.48 18a4 4 0 003.13 1.5H46.46a4 4 0 003.12-1.49l14.47-18A3.9 3.9.0 0064.82 39L59.66 16.5a4 4 0 00-2.17-2.69l-20.91-10A4 4 0 0034.64 3.44z" transform="translate(5.38 5.32)"/><g class="cls-3"><g class="cls-4"><image width="162" height="158" transform="scale(0.48)" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKIAAACeCAYAAACxStHNAAAACXBIWXMAABcRAAAXEQHKJvM/AAAgAElEQVR4Xu2d+bdlV3Hfv7XvEwSwERAk8YMJBGchWt0N9q+WAOP4RxuEmIRw/gwQHlgsEAgcey0njmfHsWMcIEBiTJzYjpN4QDKDA1i0ulsCJMeAY4QYncRmeHdXfqj6VtXe59z3XrdaUmvY3efeffa8qz6n9nDOPU9UVfGoO2f3qf/w9xAAgECEoeb5J9c9dj3To26nk0dBPJq7833/F18+8218+cw+RAQCAfxbxA5YKCCCf3hsD08+tsF3v/Qxh5T8qAMeBfFA96XT38Qd7zUARUbwQAB5LlIs5JjuKcc2ePKxDZ517d6B9T2S3aMgrrh7T38TZ9/z9QDQrF+brB8gJczOR0AJZw1/1rV7+MePArlwj4JY3L23fwOn3/M1fOn0Nx2mFuBVf8AWlq8B2AWiQATDOQR41rV7eOZLNge255HkHgURwBdv/3ucfvdXcC8BHMBrGMGrcDqY01B8GIiWzPzPfMkGz3xJO6SFD3/3iAbxnlN/h1Pv+hLuPf2NgK7FcNsGwETaYAEH2M4RRPi5lQsAgme+pOEZL37kAvmIBPG2d96DT77zXoiIgefwQRqaCEQ2A1wJ3jw8tyndCOJw7sBZHBJKYAh7xosbnnSl4NIr19v+cHWPKBD/4rf+Bre9856Eqwy/B4W1mAPWdCNwyyHcQRygRMShWEUAJQyACJ50peAf/fAjB8hHBIgff8fn8Ynf+pu0fgFac9AEAK3hlAYzqHk+gFfhDNgmKIExzs+BCqLAgxxI4Ok/LLj02Ws9e/i4hzWIH/vNz+Jj7/h8ATCH4YRwzSqOQDZpqNs3di4lXcI2AtocNoJ7AIgLIBFpAASQT3yYAvmwBPHP/+1f4mO/+VnYXG8cYsehl37OCc/FKs4QzoubXXCugShwDj2Pd6SAyLBLn/3wBPJhA+Jf/8VX8dHfuAv/+7avJ0hoaI3wrVm+Nat4AIAeFhbR4ZVVfxmaK5T+jRiGE0TL49Zw8CeIHoMnPhu49ErBd/3QLImHpnvIg/j5T3wZH/n1z+Cv/+KrBaSG5XwwrZ5IWS2XdLmCbg6LpV8M34sFjYx5VqDcZQ2PDGJ8ZBg9T/+hhz6QD1kQP/eJL+FD/+ZO/PUnvjpBJQWm0ZrtSpcWrkA3w8byWitg0b8EcoSwFeAYjjEM8DYczSKueZ7+Q3jIAvmQA/FzH78Xt/7aWXz+E18uUBXIQvErVvEgOEu+MY9gzsOwJrSAFkaIIT58D+AxPwJkRDiwtIqOYwVwsIiF0sk9FIF8yID42Y9/Ebf86u343Ce+NFo2FP8MHwS5YCE4k2U8ADTm2Z1WMFrAOU0Nc/gqnN5GABisImgtsWoVJUKwE0bgoQXkRQ/in/7Kbfjsx7+Iz3383gQiACyQiKARugGkNegKrFPcYvge8sznBbjVzfEKXXPAah5axSWI+V1AHD8OYrA4xXf9sODpFzmQFy2If/LLn8Cf/sptBYBU/mj1Zig2RfFrK+IRyPXhewJqkU8yL+a0FUoLG6zgKpx2Dri1k/qNySqO+O2GUcunuYt56+eiA/GPf+lj+ONf/vjK8DtDMQGxAlnmqSvmMR+wvoIey8nw3XuRte4K5ewfocQQDhi0E4gAkj8JODMkneIQdSrwxIvwbs1F84TmH/3in+OPful/htLs8lA7RGHiVoiqCVuUKrFzZdqSD+LhHYLm5aibCStHRPzU6+F1KeJpLY+EhVFAOoAG1Q67C92GuiXaXssRKPtBVgpo6mkInMKbI+x5IMiehdMV36rzrn/9TjsuvdLmkRfD/ewHHcT//gsfwR/94kchYlsopngJZQuh8nAVh0J7EXuDiAMaEFg6U6THsRzC4eUA8LqRpketfsKr6IA6cLwoRKADqBbeBWg8j/74haOKatLUiRMSB4UWIEEY2TWCORaDnRDqrhjF1+4EvnaHgfhgP2DxoIH4337hQ/gfv/ARADZ0AW5JaLUAQAtA0j14sj6W0IHosHvCGmFEDlEO4WsBalhBB8rqLBeBh6RFdUi9PkDRVdGCFqBDDcahfCTwntCuCfF2MA3zCBlG4RS6LGZwheGdrjbpa3cCX7tTcemzgWe8+MEB8gGdI9790c/iD3/+z/CXf/555EMEOX9C+G3udfBCoubfcT6Vl2WyPNaZ6Zab3jX/et3MA0i5pShjHsgBYew/IgwAct5IuJgGKKfujq7GqnGdPAp74ufSK4FnvHjOef+5BwTEuz76Wfzhz30Qd330cxMcgvpUi6CVOxe74BrBGiHN89xQLmkxLkwQ8I3pEOkOaEc5z43seSVd2yflvIaVcMDbZBACFcZAEfQkhMAA4iKupDgQwjGxAnjmS+QBAfJ+BfGuj/wV/uDn/sQArIpYQMjwokyPwwpo1QKJjFYsw5b5xq2dNViKf0pjcNY8vDU4AzXdrakWcmEpZex/yADDN0GUQpdMHsHR1DjDtha2VtIzXix45ktWIi6Qu99A/Pkf+Q185iN/lUImfFXwRTGgMmdrNwCzBGQs6wCoFvnW8nhbCuwLeBbtW9azvs8pJV6yvx6XFhxFFtUyWnh8LqBU82iJK/NMJpndgVYR4zAOAN9zow3dF9pdcBA/85G/xM+95teBUJDBNFuOXUBWGJYWah2cGYKh7AVMNd8KKCUOaOtzvgHGZTnNLS+koa1dECGXsdwKKAAQRvAbBNL98bHmUq2CGbAp04oVXKOCQU+6EvjeG3dWfF7ugoL4r274NXzmI//LBSnD93I4XoI2WIkDhskFTBGWAJliR2DG8g8or8JZ0qG0ebkJvtLmOR3GcBQgRytZZWeyFVTLOAJJF5YRS7CqUUwwl4UcBOBc6PfeKHjSc+bU5+faYQmO6n72hn+NT3/kbgCATsJQtTAFYPt/trUS/5TbL35pRhwiTr1cO++LvJam5zbOnF+71a06tkF7lufxVg79GnEodfRaL8tgnuKPdD3TdO0lP1bKcyCKP9riIuo13I+u3meM4SEL6iO+I7WdTaBFnpq5nH78JxVfuwMXxF0QEH/2hl/Fpz98N6CAbfx6J3XsaGxCD+HmTMip+NQGPG8tD3FOYSaMVaEE1qGAhfWSdydMkbaj963DU2HaDuc6xBFIO7p2rzuBizS9l3TjoQACTHZ5aLPHMR4F6CJdSzPncxkMomYp6joo4sZwGid3vz9C7pO7zyB++sN341MfuhvsAFxYUCrTW1zC3YcKC8MBCrIIhWUN5ywFWUfUi0wXh1tEeJ1+jnK+DuV8jPG0bnY4hN3h7Vv03qFdoZ2QEEDCZnWmn3LRsHoY+lLjq8W1uBSlhj8OTOcaEs44pCjHWHesw71fvQP4+NtL/Hm6+3xn5V+++pcBCHhbSqFl5jHOWqScD7MTVbuz4H5O1hV2bxliwrcSFXHbjVIT//Z7YUJJiQLoUG0+MRLPL+hqdz4U3dvVMN696d5igULiilXA5ncKKPz2IKx9Ig1+jwg2w4v7LyW/QKwJaB3orXkNdDV191JiogjVTm+6MgEkEkKZVLfGi5bM5TznkfSMmq3uq2eBu98PPOva1egjufsE4r+4/peG5qkLWJ000Q6VhnLny0ApAKkDY3IzkBQKqD2ooJ5Z/IGBav0MWBaulreUDcLLcOH94g6Rhrh/LEDeW+5QtRt8iRKx7BAA3aELTPzc0gG84PLc3Ii02G3AruB9dQtOARrcCj4MUcutTv1izXrYxvX0fjm6v9q7jKnQ6eAby3QR4+7fVjz5OYInn+fi5byH5k9/+C58+sN3JQcgIObSzIfhjyP+OVTqiWMQUJao2dOoA1Eey4jvAmmUp+pWJBpkKSJ9XymjLiY6bI65Lef+vWO4rmVpKadzPggFF0R1aJ/Ta4R39K45zEe+Wn8enH/23qfwjMcUppoymbSE0Y11VZ3f9dtz2qO787aIv/sz/xXEwi5au5pUMWwtKIB4+snv7ItbKzsV8MkZgVuDsHR8dErjnBbV0muWGw8keK2iXlYbw4Cw1EwuSGtoFhOoQ3MM3cW+Wb/MYomYpROoh8EtGK90xVbNCqNbXKPBtRYBsIE+8nu+sIIUiUtdGDDEIcMyuKbMGKGu2Ajmdh0sSqF/6dimr54FvnrH+VnF8wbxUx/+DADriCkFA4x0Nm8ETHTeWc8gzBiSdDiDkDKMQ2HDpg+lDFNAHCCFxtxItZuQhzIJHMwvjY1ha8u37eUpwYz5o08PhLNH+FxTIdoMSlVI28Dmt0zbTBYCNBbpfRZRNNmgiU1FGjZQZV+slmEIVW+pmFRNBgQpe2GiWxui7TI28VkOS7EGXT2f49Ix5itnbYg+V3deIP7uz/wB2GVVU8baM3MA8qpTk566BVwHxGcmrugUkg8RzEuhFKtqeTWsbrgyLzTwaNV8rgheHnWOWKygA8h2c44nKlARL6VBVKGiEG9L6wYXLaF4+wRqw6uYXAQGIsSa2SDeqgS+iaxf3AsgHUbJ2aSJ3sKjrxRRXIQOJtwCc0TKGuO8WuJIUZLe9R8V3/3Sc38B6XmC+PsAUggKuEVMgZCHwSopYMNw6TSKMCgYH2ZpMRWS1oUK8nTVqpriOgzYlsqKK6RDCRKtqyVArh4ZZk9gsw9UrbqFsTYJulj54pDbHZS6nm7LibgCXfZhD2GUQb8DaBsIrTkAUcVWUtaAxCASSHgXJAKTjJi2UBdi+cPiDjRRBusu7XKmy5rSfeWs4inHDi5rducFYqIE5BzP+ysOmLdXfQgkqAmYlxDzwFC1Z0T0l5bBAgvACmiUMw5BNlSKt0H92wCs88A0L3bOlqhuwdtsgEStALxcg5NWTmK4ho/GBr20DQAbpjmfBDpa20BgwzpX2oKtN8ks7wwaYRrCQPa85VLSRBz9EpbcxYeUJysYvjyXlR0/dUiBIZTkTvUBAvFTH/oMoD5fEVNR7iHCO5rNteaUmUiBilerhGQ9h1s/C/YrF1OcAqZ4kyh/QlCNam79eGMZH8MwXEv0M04wAuqKqNbQlacFMIFZUbNMZhkbvG3SINoA8fvMDpxKQ2N+aV61AuIDtMRlN8kU0VeSJkJrOebLZBYO5UU1wRIy4JekTkzImQAsP4QU7itnF0GHunMG8c4PfRq0iNY2SQCAAkF+GwwGUVowFzh49aoLlOTUoRmAOmheTt1DzDYYtAmjAgJrbSjLRRlzRUHuM7LB5XDFWeY53sBR3UJ8nmsPLDRvY4f2bk/jwCAUCNA2UIE/peNzS/G9TelosgdFBx+IsCHV2szhXOBN6C54QYwAogSR+YqMYOEmIivfLJ3lU6gX7l8MW3PRCIDzUEDw5TM70h/gzgPETzlQdm6/qjOLCFQIEkZTlnWQFgziHQyL5xLj4cIzIK0gq0kzbVhf+i3fOER7G8UET4NsQ7dz5XMyLnRUxOpEHuqFUcHqK+TUkQHY0NJyehpOV/gET992tNbRwQd1NwZl20BFoeJTBGloDqS6XES2iCeDFHHxIaydt1jE2+Rti76kZDiS0T4SUwrJ1ZT9A5HkhU+dscT8PNfh+fxAhPhwitEiiiNCfygaiO0FBxJIi+cR0eu6PQKO83SqqHMVK8og5LCEaE/CJqUoLY1luDUrOuWKoPVIgZvyGmhdEG0VqG6hsoHIJnJ2JYQbmxeqWSDddrRmwzkxkG4QdmkgHF3McnIUSsAcLsHCElrvLL8o7ALwTSbJXoJA2baTlatDbg1Z0KXkD3ZfPtPxlGNHXz2fE4h3fujTqNs1QIGt+Nns2qU8988YXhNc63gZdktJo9KV5IDCq1c11BVGS1hhBMvweqGIlTKsvHkIrkK3fBrWxyr12kVgtya3tkgpkIpsobrnUAhEgK4dre1B0KFtAxG7rWnpJfKq9OirWVCHUBX1uUkFHEa4tTI5cMfBtoFSH9YHmw7kAoy9zL7zTFEAXOhodIeBOrtzA/HP7gTgWLhmqUtBKttl5G01D4dCCCEEeIvIeCy0DLA6ZgSvmFsLh8tiFkrmW0CoLqhorG+2ULiacGvhk4oB+wKJcAPD/dKB7daLdPAAaFM/d0soW/S+j9b2oLoB71cLmllPsQdpt/3b9oBt27iFM2h40YrUB2sBWgZh/SKI+/6sX5qLzHcRRP3bZeiK9WoCrJgmBGka/YtsAD71vn08+2X3k0VUAMpJfhl3YzigXjXkBII1Q2hiUowAcQDSELLF1jSWCg5h3S7i8KyuDG4rpRRRIJz8QELnteUUgGVkAvVUtCRhk0V8HeRWKuQFmxuKKYeQEUZpewGOyAZNN2itRf328Ajnh6Z6ddkLGrrwB2PFig2wGoy0oCYvtt8MiyW3tNZmqV22squQLBS5N2xumeZwd04g/s5Pf8AFTKU5LFraTCkwTBV5V4MQerh4QgfP9OUkSQknKaV48/iZKurdBMZZFVIDC9JlQFcdgGSsEc2t6SJoz2NKEO+rwWhGvsSVNACgsvEws3gGZkcDrWQHZIsOwUYvgT2mZqCJ+G9ownIiQBQRt3jWTtsucgsJB8t3LZt/G8yWv/QMUbimP3WO0JuTMFzAKNnufN8+rnz50RA7Wip3HF7rBnS1fpT3bJUSFt+/i3AmRCUgAZvqHsoLsNgWjeIGMTn8OYx7Dk+oRfhhISNMPb62x/vi4aZEiaHa2ultomUBwN/qdGzR2h6gWwg22Mq3IWjY6CXgMMt8XTsEirSeDV3Ft4MEoKUL6CR/uAWFwhZVAoHEKl+gov4js9zYZ09MWAxPN2tEQvbASG11a2Hr7sggvv+nP+AwAVCvWrw5hDDCA1MAbs4ZtgrarGwPjbQ6lBflQgMolsKLIOaUkJIaA4Cima+UEGcQgA+iDqnM7Pm3D5fg/NG2XqAYoLI5mvW/c4hF3r2xfUMuVBw87CdoIIyCLlsHCZGWP9Li5rmdK4CGvL/v4HpL7eGMFuB1t76K7mA3F7eVM4xA1lJTPGWTIgIA3PGeb+PKl1+Co7gjg2iqU9jwmnPCBYwgcBaQsweGFWX7OUGBIudlqpAhbXotXUUm669ubkuG8XOUnJZPeit0HOb4zKH9V8DBSksJb3/ZxIZ4GS0a3rABX7OiMX9rnh5obS82ve3Oja+qY+Fhsjd01GW4dSA3AaOV72XKxsTb3Fb6XU6rs2G865SPws2UCeBGKSY4U4pzc0cG8bd/6v2IqzeGO+Rw5m3lBNn67VZH0ipaagXKeV6j2amlI4lackgJn1MhhmJrM5B7mUvB7nJ8qFZV3ULD+hLQuWXkkGC5vP5WZGaWNe6wiKBjH7R02miNNK0bOrS8ejkgFbtN2GQP0hS8aEW8DrEtmS4NGzHYAaAJnypXv8WYc0PKNPc1HVQVy+8Pk4RzCLk/WZ2bJgDAl05v8dTjh6+ejwxiWkNrPDmKKV5VEq+wNatohWUGnke0Rr5D3cjgAUkSQMJ4kKO1S3+OBuOw7HDynP6iGJGGHN4BgEOtAUVr2fp+pO9cyPR9tHYJcqiVyK+yse0glQFWAAGyyAbwoVqk/LSB7YDLRiWGejpaQptn2kUSjqqFoD6nmXHWfxHBvRcSxLN/dgdoprnaokWkaY65Y1gdDbBoFeHKSytl5wmHCWWEywGQAeUdTuLYlc6smkbqWiLbg/jEYBGZJh7yckAZZqMD81u4IMOoML5oyqCy7459SNugYWOK14Yugg3s/rLdbYFDuYHdBlT32/DLOB9cvVw4TsWpoouitQ14p6irqSiOwRI2azxF5d5xYDGdDslUce/pfRzDY3CYOxKId9x6FmHVQtjWOEKYbVRrTIzZGsP00BNV5NZKhGIOUS9cyjnnauA38jvzF8BqKolmYUCuVBzWzk7cR+tnvxMBwYQifs9S8gB254RP89S9NbGHGGEXtFsLAZruocsG+ad6zZrWvcfWNujS0RxEFT4cIbYabwae6caHWnvi1s8B2mF0l5k1Z4B1tISKQpw5h3CU+iBRAMC9t38bR3FHAvHMrWdSkOLw8UEBeJsITAyrRNfnfWp513Gj8HKuyNAx5eSWRa0FTaUI2LrBOZ1p0eAQmvUbhmTtDhmQP5hyQFm6AqrbqQq3kiLgI2FS0nTZx6Y9xhciHXyPj7Y9iAgaNujdRxCXpfqqvbUN1J/EySFZAW4XdSB+JyNcJRvc4J5itL97N1rxU5Nmxct1tRT45O49vY/Ljh+M2pFAPHvLGSRLAj42BGcutweQ1k+Buoe4tlquzspmEl5nM4hTjw8RwJhgKklGKxVo5kfG0Co6mLSQ45seNGCUyFOtYYKsUOSDEd53ydVz8wcn7Mnshg16GYLt+UWVDtVtDOfoGta1NTWIfG7Z+zbMXVpF+84h3KxfA1fKdAajmRW7MNJ26pQ2nSAXLPfefgFAPHvrGROoD4nUE3lRAucQSiTgZaSIx7lCwbw0iws4eVh8wdezrsGVYUSY6Q6yqSOMRCKHV1qwhNDPNS2j1gMJZacFZX/UfZ4OsM1nFyC4eu6yxaZdAuBb4ONhEMA2oQ1E+FM7qg0bAN1NnQBxI0ilOTgbQ6kDaOUeigqawOaKZEvs8cZZZnnbD8gtHj8XcTaEXbE8mTuAPMgdCuKZW8+4T60iwARjQV6xBjAcjk34RmYMu5GJYTN484EQwBizhIuTflMq04zpUpj81jLM5EQCc9vC2mlYt/w9sc/VAsIKZk1v33XeaNs3bDNXugLVfUA2Ng/0uSCaQn245p5ja3sQFfutiy8+OhTaOzZyid3EQuw+ouvWeqgGNGeAHQLpEr8urHJT0BISQCD2GS3B4PLpnow4/e6/x/FXPQ4HuUNBDCEKQQOGJ28AQNUuDAViBWwJAXgEFGnxspkSaenRDI80I5zWlpyvBJ4iodjIu2pB6znbzrLVm8Dewr4dVi5WbIjminoEsMeP8bcgwJQjAbUafFOaT7+4ILZq1q83l5XP/QxMcUu5B8pr0xyRzqF7D73to/U99OYQAv6KE8CGZY1BV+CYdTUYfZXM+9zDq1jYTrW2CgAVwHYIXGYxdB7dHQri+97+XlO8ul0TayKHasSckXZKTal+XzmXM9VpOVaiZ3dgPAFkQodxgHRK775qx5M7CrcCKQVQ9j/BQrWOq1DmqrrrNtqa7Wy2paO5aa3S0LRDm8aqWWWLJntoTaDY2q8EOi9ItTxtD8DW6MDW4BOgOazSWZ7NC21TyHGMqYpbPmkOHLz/JQ6SvGmVo5TzdLe/++9w4vrHY5c7FETedwwI2a4CIeeF416iJVYobCienSmhDvc1ZpFWit+FFn4AkNFCVghlkT99Gle2DUI5xY4USMe8Wr69j6jg2TcCTi1AmtK542CuoXXflPa7MQKDpekWHeoUbaAN9rvopmh2rfuK2PcFu1gaNbvXIWgi6MppoER7ze8LKnTAoRXZoHlu06lZyPzNNyDSBtEIFPw9kUt8clWOS3cgiO/7yfcAimGVTJ1afTmjAhzIGAoVMQMGXM3FqQG61sDl9WRd49DLf5loSl0hnKxiFZF6PBcs9iMq9mgNQg2/BoRWEi2egbctVnF8j2LXfa9cEPiLDXlxd0QFTdTmhX2LJpdAmtmtpo6/Gwf14dabYe1UuBn0OaAV5elywRL3SwJUsVA/z0GdfeTdG0LslUrWa3qpF7O5U+/6fzhx/ROwyx1iERXjillhv7kgjD78ivvFrxxeFWXew9ISWKtBRAyc2cJZLBIdjyvRAedsDRkf51FZlKRAjLbiASHY4btkKKcGcG2rAj7/6yswqnb0vh8LhuiLAnbLzn69x9t0aOq/a9mDNIKBAAx9CzSB+D1gm4v6/ek47zk3FEXTPajQgitiSNYO48jkZXud3dQYi5RxrqjoobNhFgMFBrkczR0I4nve9m5XppoBg4C/b8gHUb1i1h2WroBXC1XYcO7+bDzsjpKDldAIMJTAuHog/CN8I4QsMcqNiXftgoOgACjssJKlNwGmW0NOQ2JhMg3VDiGhhADa7QLncKyyhciet1n9JwSCrg3oW+t2E0gMvw29d5sz+r6iQtB9fmhW14TcIHFRcPYO1Zg/AnWYFgzguYExA+L9o84oChenIlQ3ignAPae+hStOrt/uO9wiKhJGmAJtmA2Kju4OylLDPZ0ByXi3evxXLSFKOghswg8WEunH6gkULy6DbH4oIuaQtFTao1xTdAMftcqhwpPSKvV9KAjh1uePCNla+23Ys73CjZXVO9C2bgX9x/puBHLNu7Uwn3t2dB++Bdq3kObW0S04we0KtLYBL6RcsPDcp12xSFEnLM8t3voqyu6LW9JRjgDwxdt3g9iww5255Xb3sWF+Rn/MiYqp11p5aMPyMK4CxktnbrN3iCexKo485fCI3Idrg2IZDthvji3NpnyXvF5nQC6CJuMPmerwH01Z60B8KyDWfRu2zVpu+z667hdLaatvhCw7gB7fVc5coc/v6rY0OR+lfqgbO+9Fh/YR5YY+e4QGhCyjlsPyKwtD/vHfF059E7vcTot4+pbboaBIFXb1eqQCfCA2hM0VNBvNQ5iPmT2qnGbBu77pn6xhWBNWIlFetYoGYqIdAEc7FLktwdeGtCxTe2TjrbZ4gZMPZ/B2NfjPM8Um+iIC/nZEfMUZ2Ma82puxsNoWY3O2AoJbLe0d2mw4VvW9QoWdM4343FEU/FlpWE8RNJ92qOtLaBkpj9jCUYzPJNpIAM+Vb9WwfpZehrvn/EA8BXjzqEITCIVl8IErTVFUNM1ZyxQAFy5CCKJUps7vGiJFyRWlMX0FtJXzAmCxZJFfFHZP1pRFZXuVNjTGyqqZLsTu36I1e50ImilL7EfwBrEEgFaPANogAegGAoXInpVbuuWS9jMd/KO161AB1KcWXbfYeD0GXy8Q2neHIh6N9fbxKRvCF/NHmLQU6nLiwlRcRm4N4d3z5obf3aAzrTGj2zk0n/7g7SEHXi3mamEKXhM1LlJQqREmGPPTjfAlCaZEDoe0dJZeUG+LDf8k89s0YIQz8oQ/f/PRmj3T18TfzBDDeKYHh3rxd9pA+N96Mj1Yp3QAACAASURBVLS3tinrs7Zvoj57a1hKIW2Uf6ZQA8TqBCZuAmFJ3SrG0Ut5BCmHUSq8/jMAchjOIdlgz7KiSn7Y+fTvk+/8W6y5VYt4OuaH7hTgSnd80saumSrAhSswelErqSg5iS8DiIDy0789LhSOcl4UHn/daWqfQUHnltyHLgWnF7nPxpmbQCFKi8hHsvIRLFq8sJLY+DBtZbamlgd+dyNAZTtbtK22eukOihuBqlMlWclkU66SPkguIMp6fRoF+IWA/IYPz5FvrfLiVi3iGR+Wx4POrwCGa4bTjZVXeApMwycBYticZoZJ8l+1bKClKRasWqHBGplF2rQ9xEuQ+N3saJ6mRbzYrbhiRe09h1keDwNRMq60LaxvpC8LKeQFtGskExk1AvBcAXXNROb8prWi7uLbw02dDGde6jk5UK+jljWnYVikcAt827/7OtbcqkVc7b+iEIb5BHktWMVxZbWVpMsAQAFphDXhFF6NUs6HY4ZrVDYc1rwErCxBAr+RBk7sU5E2P6yXhUqDbtXgUYXKBgKgtW4LB14AKg6TW0TOP5EWyrZ8WmmbIKYQJTxlRa2wNbKiE3jfJqfqWyvUjVs/8W+GF82zaI2ThM3alnqOlgkQd6akSjwbusoWdljE97ztXSDby4xUrPkxmNwiOEHErYgm0jEui5kVgFQQuMIs1ob/qsUTm8OB4SCYtHR17udWr23sh0qtzA/bnn97vGzAn3i2todN8TfZw6a538/D2pU6+b3ZXLKwprlVVA8DNOVRNCKz/BEX0hDk4eWMSS29WzIdNO7hqojJSVi89Twa1DJ5bUn6b1uZJ+5YNc9dWQPp3F21QgxJYMVTrIGdV1TMHQcL6ZZIAsvxXARc8dWLiHWFMJXlazwkYDGSh3Rb6Kpg2wFxi8d5oj09bfNBRYfIY7Dt+9bWbnc9bLVaZKzenmrF4f3zf3Uvc5CLg8duKZBbKco22E8+VbvnHyo2n/oaAG4pVZFW0AsXRJ20fsJm+K5JaUWWKzV83S1AfM/b3rWWbuFGNHeDmo3LNOuwlRBC5uGmFIATe1cNxuGL0NHCZJo6dFu5Xq9JEzE0xThjglRsC4ACu5erAWETV1aDK8u1AkS8wsAEAG0CqEB77a8WPXMF7m30PnB1Plp8gHKrRpGy2+1yON6ZQksRFcgCmEf653hJS8jBQwcYgXs++Q3ghieiuhWLSGXAy9nVKZm8eS6ogOxwg7yUQStZqJhSpoh9geBNAIogfhNSh2w/Z7lpRerqzoTZtIO3zuyWnAl30xKymNgofF9bobLn4VZm1y0UG7tJ4vX3qC0VJ0AOZWEJ/cKpFxb/DZYRg5+f4mVl2Ojb7QqkB0JNZ8zY3iSKdawwZlFfOPWNRQkLELmRPTZAVtsfQgHZ4Nky5dg5fkiUgukwYfvBsEGoJa1DFn7O/0ocXzqUw7OLKrqW7eNTK/B6GgR222qL4ffVDh8A2+9We1oGHT48C2juBPtQdP8hk8lD1b1R8eiNvhcYMVxs2b+lrACU8zxQvkc32ju3gIN5XEk7ZPIOxF22MV+1b/ec+iauOPnYiFuAePsHTw0FpJKmxsxt25mEnxSoC4oCY6xICI5pV/PNcyjmqUrxf7lXV+ZehDbqGh1tVANf+ZF3M4DN8Is4QKx7HUBXaNtD7J+JYH/7LUsqCFBjGNcOyDRXFH6xVS6DsOhlWsK+OJyDE5Yy9k6i/PwcXWnLLqdA3m06Fzfm+cKpb+wG8fQtp+aml+/JP5RLcGrulYYu2n9Yx3e0ZoK2QhhwEuRqLZFp+Ph9Kjvr6n0fdq9W7JAG3l0AJIfhptioy8JZELU6et/Hpqk/kmVpet+iwYZ1/q4la6VwHJ9oT+mHNAhy0ZKvFlm7wLwsyiL0s6KXg/Sw0Ks7t5TnhGRJfM8nvwnckFEjiB+83VKulOziKPJZSSc15crnolwXnOcjVIMwB+DcAkxpKWBaDbtbmsqKIbkuXhzE7Fc2TjYbjA+22p6iqtpeJ2w1uul+d7b1eHbUHtkqfeten/+2RLGx1atu8iHZ4MDKpqwIE4Boc1hGEUQ/S39zUSMljWBFpUdzsVhhCTajFvevKHVy62nmeeLCIqZjZTNAtVu7GlGUKv4hzFe+p6ueUIUC6lVc0q4BOcyZRLB4DGwAkQqdywNIhWqLR/zjMSztMf9DE3TZB/o2ctnTNVK+vcguDrCrzyEX9Rc0sfuYhuqQEfu5Cbj4e2eUvrPPITOXJDxPyHbIk+26EO5ANGV33BLE1ZTeKSprSFNg8dOErzTM97akZvYwll2LrVVJjbCMjGHq4RgsgsPJ8OFNWQDGIS0whIgbuG5Wyx5uFfvREhTo3hdBrJK7+vg8WEdro/3oyLZ/ugNoVtHfAuZ9sf2+MtEXIFbP1bK3luHDUO39rXDGBch+upxirkn5z4IWLIIAVNwYPQK4juMccts7v47n3XApgMVihaqQrEaWzUNJMUb6SWnHnG7YKjnEUWBlaZthIcC80qtATfjcf7Nz1OGNSmN5kQ8A7ZIqNq2h6xaNi42OWBuobq0pbtTEnssah2iHsneBbnSwhNXPi5zPGwLscrXWAlp5/iSUFr4N/eJoUGQiLrNS8sI5qJQv61xJuOq9Ly5AfM/buZFdwAv919qykUWN5WBnZlc7x/6m6tfTI7KZUBOeCtEoaMnygQyv8BVYsSinAVBAudGsEG1mxbhi7gA2Db3vx8KlNymW0L41frBuLevqVhW2Qd67YCMCe1e2AMjN7Xyukasg8Qvc2p2g2QXmicZ/Dm1opljKcVgOzcHVglEro+7G8Nm3niYvpnS3/bu/XbeIB1U+XlFITTPpisvUky8E4GEFBkS8e1HjIsMiL9tHQUdOwhUK8zjhfKr0LSwJjbAtJDpstWt3Rrxhug97xGsz7BcCbk8Jo24gum+b2B2Ih1TV/gyagW4raC/ZyoipA/uP6Pdg1b3dFk6rb5afssgLD/EZNQlKeMoHkWcsw8IpM4ByjrZ5O6PNR3QB4nuHW3tZ4dBoRtWT0vDhfNGQElbmhnO6ZHBZb40ZEjM82pbCYx0pVAdwAhYOLIdy+ytNCr9VYENp32YXuqJJh/3Uc+uWEbmNIwLpLeNirtjR0fOJH3T7UXysbDRGd0T7rE+p7NIP+ksYMYj5MC1oHEUe0XeXX5XprMJDInYll0VEBtz2zr/F8254YrWIa8V4x4V+pqFSp3wypqppAcpVEMPNlL3mGOeSLIPKCBEWlwsYE3RDbuPIdIyPiYUyPR/TWP8U6HZXpTfzi2ywEQWa2jyxK1SaLSD6BtIU4u8xbFCg2a/yBLD5pi9IOE/srYHvUlRokSutJKVq/ZfSx7ioarvRxie+i/5qvuznPFospWtFeDiLXRC21H6GL/019R4AvPft757SzRntPARUGiDlsySClHw13Nw4DK25FIRMCTWC0yOZw+sJkKW2xZVU8/hFwZdizkACgLQttl0h2PiDDEBvG2xULFy4eLCht/mT2fxdsr2Zdet/acz2EXnHpmv3+9rWG415IM9pKcW7lsOwlPaOe6WbHfunk599pkQ8nDoeVttFCQvdVidjyjGZTD7BF059E8/FvGoOiBZBmK8QhrKu7E7JxHxT1mFx7ycZJss0q461MmE5r22pOcQ+qiJCmRBgASH74xZE7bVwsSZRRZM9qMBW1d3PsYWKooMvaM/WdfANsRbSvN7eJayhtT0vuNxbJDyUa21/trnF1g7742loPZl+HrKjlcxDGVTNVLm6nCVD5zRSYgaNOCP8Zd8e4L9RERmyrzsZCq7fi22ZOdkQtat8wBTAA+V76mTMM2u+4oYrea2+oiCI939Oq0O61jb2wz6Ps7yKJg1bv7XX2p79Lr4p0O0nTo1v//eneOKODez2oT0swemIoPZFob4x7m2JIVSRQ3O1jgnVGEe8PH/IpzjKoFyEaXHF64d/uxbjY8yXaSNRSTu6e059M0EclByunM+NrvGhxKWL+6lD9ATNHA0syiOaoraRZ+c6WlIKqeReVlsBru1Yl0DWYrEi8TgEbJ8SiPddtz2bA8oG9kCqva1VPYf9GGvrbeczjhpAcnyuGFJ23OReDJO0dCggFn+GG4Q5GsgQZ2XWcI9jvyFAjfNz8Xyg+Jk+eCGw63wAgntOfctAXFcBiU611sqX5S7zZweWaaMsL2geisMSCADVUl+2VqYcTqrlVkCEoOYwVxtOtUc5pbiEj05KAiqVe30bs4AK26LxYRoNiNeB+MMR9toPQf5Y3Z+gVoX6sM1aBpkUj4jkNeXAWPhkGd0/3l1hHK2nRJmDP2SSIEmNqwAIdSHMUqNGxRZX9bdnrxaZUxK0HSUc6kqDJlbsXB00/5ZdNVXboFNRtuoUWhJhqQkfYcxMBulc2XwRROAiYAwU/hOBKodpH475VDZ8xQ1x6ygJqLfdFi8a0Gb5s5Os14VGKAgXgAWIBmqCNy5CSlidGxO84gcPYWvmOGR+EOBsN51M5wCwd/qW02OiwDk7nZXVQlh9bdwQsnRSPSWFIu/ihd/qPdBV60ar6VbRBzxTtJifwNkwR7A0K442LSicXAJvLRWIOGR8ENaVa2U1ZEsRQBJAK8Mexo0LC2MrVvVCX7VsSH3V4bn+xnu0ojVMsjyrdKgrLeVYD0p8xmFoby1ndIJPvuv/jPuIspJ5cJMwsqGjW1iYCKhNKWCgWLvwJERZnvkTOgdCNOLBeDCvW16p8M3Oa6gXxE63lt+gE6grJ2xfZIm36JbFAvzeNF/5EbhKvVhQFJ71MdzKplWTKNvg2uQFUcJYRkI4DdGlDAzhXjyWLi0hSoK53UOG4dRB3AXhrkJqnPjnAeoTuK4rVPymYg2S+jPF+uIgQrf7b+mpg6QHtSTq14DSD38ci+9+HN0sk1S6hgIaxFfCAvHv5lH2ptce+Xt02+axFsa5YoSHf5J1VToUdWUcQ231QzCvnuGALq3jCCUWebzu4k9LCCRIE4QSH4MzXTiIuyDMvKx4mWql7EMdRV8toRarFZaLFlH9x+sODLc8ImwolyAj5qDj60QMFogY5FDwBZUAPLzV5k7QFifAcF14e6yeBr+5DMgGULvLZ3NGK6l76fD0ih79UVAvvHRCI6EwATgTQALUIAJwm2aEMOeOA4jlHAsI2xTPdszpko5sHb9GSGTyPe3kY9COX3NiER2FSfEv0tRzr1pkkQKA68+vcNU4r048yKIJSIFMM5TvEVSCpjz4RLX7qXJlafzXDWjwHYPTgT6kNmSyvnWXCol/K4sGO/zH9i1/gC/CV5BkurYSVuPiR/lRFtPWcvnqFLalliPL8zgyDOzTbBEDwpRBQEhWM4QSKmfmrjj5WOxddc1xjG6EcOmqwJdpeP3mdTw6C9dhHpdWxFMoyuLF4zg8i9sQLWFQqG+lVMsaFtWHQgHtDZcu3VtkWxx89dp4kUx+t6KrTgCoKREAbAVsSgPE4tDAP/1hWcT7TshNelW2IZeQqIfPwyB1EsClrpgmh2IEmAQtgUsrWMvOOnkwmIAi00Vb6dZoSBdzRH5LnO4okKeqUelatCXRWhRDM6WIQ1eHagcvIMpJu4XbhrbjaFZWbJ9OoYAP5bbprYDP2wCBopuw1eGEIAHE4BfxWoO5bEPAqKUvmTDCQmnxiJiYV8VEZzefXZYEnJeKubHUEUZqKABEBa0AVdpCeDONlDLqOfOi5OWUJcuxdrh/1TjJeAosRQW/LF/x+lcB8PT5kd+8YqZKqZrdjpZndFohgrpOCY3HUdEx/HaA86sYimntckjlsL18s/889Jp/GOa9fj6MwDiUoTras9ozOgcClNi6sschcB6OOazWt5Gt/IKvtUWcIN8OAZnqQU1Th2yC5uGlfQkhw9iztJzDsA0AwvCUQfzzOOY7+ervMIt41dXHvRBkQYNvdkvuD3ZrKiNwhitDYpejpMpX7qbF5CLG0rigaEW1LErQY2WrEAepWkBrh0iHwi0iy4qmZIPiQtHpYlp1HIZNabbQAtIi+rBszXKlzmXN+tA8WxgIBYdlOABw2dThmflmq8i4odxq+QSlLil1zI6huwlhDF/ubiByniiZsYK5LG6iZaebMJvmdYaQ+6U8Lk/gyvwxFC9+j0Lpd/Wo3c1t2mB3MuylvBbXgACzrrNh3VAtqSXa7a32UImoEcYZQ4FtvVgR8fpiuJIVcR5TEoUr/CC5Mp7DIxDbQ9Hy5XzP2iNjHABaQutZpp/nldUfJAjrYxo26HAAZ3f5CQMxevXy178yIiuEtaNZ/npFXNn62Y40oBqBOOhVxEoYCazWcA656BFu75fhb4Tzbfs90tXD/rxE/VNlvcStDeXW2h5tSAgtHAuruKK4UCwhICASUNiWiw+faJ6eYQIOhZZ+k/BMZWS5JXzwb6Y0GXcghIKAbcybfUk25EjHyVd/h6VWXtYArn/KK7wKlkW+a6MQfmucYFyhURBT5zk3mY54b+GwzVDmRf4OwXw/Yc6dpKSZ51GxvdE2yHcVisfldsmw0TtYCeun/a8CpuPF4hdVTBM8bhi68+KI3cMQu1+8AXbVQL2wgQqEDO1J/UT4pB8LEoyb3NN31aOXsSh3Lr+GsY41w65L0/SDNz95aREB4OU3vrIW6Z9ST2vIkG52uhDiWiIfworSTD+jVaxV2KKGaXNxsVyQ1DLLH2TUTB8LGozhkW41vEc4lBaxszYsxG0addCB2Gh24Ie7IoP1knJB8aIlFPVi5p7hQRd6LSfLFvB7jks4B0sXaVqERSzzRZ/pYd4iA7G5ISEEpie0X37jK3D21jM4c8uZia8Zvupm/BWxCViGsmF7gkOZADFHVN9aQff8BlHnn3r1S8ZmexJXUO/79kg+fDHiV2T83REg54tiPVE2GwDsb8B7e60fIlzYWOq85afx5TGlj3R5MVlDGG4A5bzQFilUUsplVuY4K4yypCSA4yDUE/vRSjjrScAsXfoJOYRlArxTc1Dd6/5dztJwSKYbLCIAvOEDb8RV11zlWbyxpSHmPZfKNb+1QOhzK1ofi+PWS7VCbhvXrBK49UILR6u3HcI647q9Fq73Hunsrz9toT3njsPdFvRFmTb/7AVC9XZUCMdPAC7KUfmjgotVKv9QjoQIQ1ioaZoCofhzuiQlXZZZFzRS2jPUP9UdbR9aOv8b3clXPwGXn7hkCFuACAAvu/EVQ/b0rwFYrQFDinIYonamg8JqjowjtBU0Kt3+5ZDJ4TUg6v4ewsXCYzv4Y8HS8+/jLdNl+uFCUg7H2ZfBCnqf2MmQh0dRZTlUSR5FnYNKCZDMYYSJ0NWyS5lxXufQ88G0DnFtQwA8hXmLLVj8wHiUflxx4jGrfy53WKxUd/bWM7jpxTcBMoJYrwirg3ONIgB2xjJjsVCBTOfpX95vLQuZtoFA0NrelJYLnXkxM6fJcISSxrY1bw8CCpS0IdkDnF98FcJ1EWfaQ5wMdcqgXABIQNIfcIYOSriM2zbMlxOeZbms0SOG8EW8O518l5+4BD/wlidhza1aRAA4dvVVeNmNL19rxuTc8oUlQ1FEnGTaGGo1LQ7vcsCt3XRu3yV9bL3MlmuXBWQ9tIT7Ft+5iNnGee+0jtvRqvZan7c/2lSsdZpHHAwhQBjmf0OMXzQ8hqF0uJgsbVxYyIttsWBhPWHRPD1rruWyLbUdq61eAzOQBiDn/4fDX/a6l+HsrWdw9tazi7ioVpEPKMCEn34Lt4m/Lx38Lfy8gxAAx50SzxHP4/mCBZ4OzX8lZ7VYqWVhoiY+K11Ka+B/KUrR4A+HSssLJhYsiHoAF7yWb7CzYreJYemtO+JnDt+BEE5O4iNaLEWVEVfSARJWS2q7IGn1ioVkiQQQyLg60mV6IB/OGOsNb7gpQNMjAF70lksX88LqdlpEup/4nTfg2NVXTaEHNUjzs1jHajEG60HADrVq6osOOx/ngLM/Fyjj0bGwdGXDu6ab55i5wLEDYRm56HLreCiE7LM7AWhlamBuaHsiQcBU4ZHBn9MeS+O5K4yeDtWiBqTM7+WWf96AzLeeIo7qOXH9cnEyu0NBBMwyAkD0bNVpKIGAaQidsHl4Udror1BlHAoYiKF7OfR27T7cZnzeRdlCfYXMv5FsixtfOcdQTfAyf+41Jrjd/VBFTCeQ7d0lH1rq/Bplmmr1ODGgQuE+vKJAVxcqoyVsI6wQxDAec2NCyLpyWK9HhQ+HHtmry09eguPXPw6HuZ2LldmdvfUs3nrtW/1MsrqQafNT79jcwQgr8xnOV2QUDtwff+SmCG1x56QsUCjkJnvlqRTOjzaIJ0vEyw7LYHWwTGtyi/LYH7Y3nYWFREamUJVCIUd+GeNreuv/GEY5jn7Kdyl383vqaHfRy5Q//aWOUn86lju6NYouP7GH779p/Hsqu9yRLCIAHLv6GK573XUHpNCUNnLYrVbRwjpoHUeraGljSESP/b20cLSakyXs3a0cLd1+WsO+zf1DTUvIvyA/7jlyv7EuZEpdsddYrePW+0krntYcIQNzK/orboawArUGIf1LCO2iYQpZjd8FIWPYJqtahqO2rbZRJkKPv+rxOKo7MogAcN1rr8Oxq6/CWJ05zgwNqCHQGdUJOhvW4HCmwrWEM1cOe+NBKEagDM5921OMed9yKK/DP4fX7sNwnY9WUOO89KUPF0m58DxNuULNyap31REo+1yDcNeiZG2otuzCc/F0ASHB8hqi7noc7Ajki256Ii47ceBaeHBHHpqre+u1N+OOW8/CJeGuCAiIjuUVhCKsOr8RxPzGBdJiWCxDMmzYzKGW54J5uK7DscQQXsqLsvN3I3UoHqcMo6IY5up0ESwVmdahgiNxhgCKrsqNOSjflE2UhZTtuqXzcqRN5cnU/lJftNnOs67qZPQ6PQmR4vtv+k5cdvzoEALnaBHprnvtS1dCdfymJdAaZh9pUex7tIg+JIcF3NrQG0NhWqdYZMTCZLSWc5kxVEfcNqymDcUri5md1pTt0UVYjAyTdcxhesVKrrkBQgZV0A+CUJCP+3s8LyaWEsVWCAUl1E+lHEOS0i5zl5245JwhBHB+FhGwxcvN175tuECyA/ZZO5eCgnUIgrQ8KSwuIMyaAXFPFOILDFowz++WLC3bJsoJi1esa33UrFpReyTMlSRTHWyrCDBZzdq/DJsVi6GPJgdSEFjAgsZ0TMG2eWEY5Fbj529YuxblDPFsJ9uc7V26tTBD6LLje3jhm8eHGY7qzssiAly8vHS6sOsJ54LpH+ZNg1XpYUEUNj80azVam843t+rSYnG7RSe/dm69rFs1Lm667ufCiHX07ZR2vRxUywjNPg2WTwc5jKMF0yyVTGAjpgAUh6Rf5m9Zg3muh3ngF1SmydL4b6h5yH++EAL3AUQAeOlrX4pjVx9bhNf5AghXAGjhOfQWZZaweSi2uO0CjgGovj9CGOHbAlwFKhcZdb8xh+9xGB/r9IVSwLV8QAND39dkpP7/sKE6gRsBozVzKCa+ZtxqhBC0IZEM3/Vzl2PsC9+8+/bdUdx9AhEAfuz9P4pj31dhpOWrwk5LwHlVpFZCWcBcALgSXo+6yRwAcjO6I1fVBmOutkfAKoxc2bP85X1tBbBFfQrH7r5UCMdHxUIGIQvKK4SBc3croJDKnUO3J5ssHz+m0B1O4njhm59wXvPC6u5bbncvfe21OHut34+Oto9iFqScRehXCPh7ZMR7Z+yvNFUhmF8VEMmfQMX9Z1Xw3dUdFs8rrMPKFbEHUZsAXezvn1haK0fV3j3TUa/ODTrsNSDCUGngu2us9fzry1Q8YL/Oo+LtPnQ8KwzvTXhKP9f0vhI2WEE4OtVazpkWVUg5/HxRz652yXDtXHZ87z5DCOD8Fyuzs8XLzX62Jj37SKXlGWBDDQVKYcZiZAgT1C2auuWyfD0H78zIFJePldkdFyt3+eiYl99YT7Yn7srUdrofwGq6TO/9kXkbpcZN3zvzY4irbZrzIaxhllHzhx9rEC51etnxPbzgTUfftD7I3eehme7Y1cfw0tddV+zgdCiHqxyeOcTN93EXc7F4eHVeMPiWi26XB7dhVh+UZRpuevNOTJ/KyTnm2DbNNmBl6sB/81yxTENMTJTPwU6m73Q6goYELT5lzrcsZac7AEIAFwxC4AKCCNj+4rGrnwPOgJY4JpChFCqowGcpe8BBP0pYLkIcyD6CVo/FAwylLgLHfNkWwuZ5h0VQzVPaF/NBBGRLGBld0g4SmuBklgULk+WKNHIIaiP4siSVEYNHpuMFb7pvi5PZXVAQAeDH3//jOHb1c/xsDcW0GpiA7AHAEoRhMaNbaN8vYFSo9ssqmeG8rzxbvf0hb/1eXTHXlf1sIT0WbCcMwgFGl8kIW8ZUl9s8jsKQaB22QGYHiYzfvUc4JAzvnPIFb3oCLju+wYV0FxxEwO5Jo1g+HgaTq0K3xC8UGkokHLSAZWhOmCpQDlDfBoQEaAzniplD8hLkoZ7hqextyeNHWEI+n2hhIJAO7eK1dlogVAzpl24KlQMAAoDVMg5zgegh6Wxe+NQLDCFwP4F47Opj+PHf+Ym47nWwAlUJW1NOHKbIrvOcrAyrmIdXndLwfFuODkWdN1r59XZeDrlbcN6p8HbEwQuoPrBB4DRhJJBh7YuFG/KgyINiOQSkYinvq5P42F1evQwuO76H51/AeWF19wuIgMH4stddB3aSysrDlDPM/0CIdJzzFShjrjaAymG1Pgo2Wc3eQWtXrdfa/mD1Y7pQupqlJGL1Alr0EYSvh5+hCKCKNXSdR75w5wPe2vxxdMtS2YD1+u4vCIH7EUQAuO51L8Ox7zsWCg3BV0HTQgzKK1BWCAdLuE3IwpI5lLwz0vehfUxvL2hKeBUJqC6O7VRnAjz6dTUugU+gK3gBrgkCBDUIiTjGp1vCOrvD4jS9O9PQpxd8cTK7+xVEAPiJD7wBV119DBTy4p8rKgQ7WKByQEOxtHjz71y4klbtw2sk0AAACDVJREFUZUV90EFLOs0Nh+9xUbNYwAR8U1ujT3CdlgsuwoM4/1/Op8/Rt+4Oi193c/lLQF/wpifcL/PC6u53EAHguhtfnv1SmAJiSNMlIFDEvEzHbZtIE4uSchBCuOWLud4Ia4Dax/AR7NESZt2a33WxAh2OoV9xXlFJ6MJSHrpYWEONeQ9xRQE7Rt5Vd6HunBzmHhAQr7r6KrzhA280+JCKMTOQR1oXKtjSD5vYtD6uaFpBWklFj1UygYqVNLr/bMDvPUddlnZbnvTucIsboFjZI2i0IfWi4lHzqv/XUmdKAeUbWkOcmAOGaHNSPnckWY3wcjXrqp+XHd/c70My3QMCImAwvuzGlyOu4DKM5b9qcUYoc7g0a1etVVi0OvebD2S6XXNCqA4WtC/K0+l7gkq5VWNhcAWzfgJprlyIPK8QLmCa805xINaJ9zJ+Diu+/Aj3gjed/2Nd5+oeMBABe+3dsauvAoe1UAYcykHBs7JXwjHGcaU8AMwhPixhzVMsqebCZHzUTBf17GoXNPuxAKKAGQoP5VeECpj+vcCK+WgpF9BaoIJ1LuOW/rG+F9yHZwvPxz2gIALAG//Tm3HVNcehRWk5RwJSUSN4+XvmDAvrVkHhsDxY03nBUcsidOVCWIDHNhAVS5OwabYPfehvlDv/m8JQgSlWMqAbDsZm3G4gS3CRsw4ZmN/OX/jmc//NyX11DziIAPCKG/ma5BTuoKB6oJfwhKcXgObVs2pdNXMRwxp6KD4uAq8HQ1wvaQywumBhHNbaPAPPcqETSzp81Uj1HOGGpGvEDQWvJJlzKkYYzfdALU5m96CAeNU1J/DG370JFTwQKBCWhCKAYFwFgNYLCUyG+cp41ZpWSMa4XBgVQAP4CbQV2CaEzLErc5qAwUGJNH5SyjJ5lAJX3Fi+f2tp0VCmFhgVl53YwwvffLQfxF9o96CACADHrzmBV7z+elBY/FfBC8UvrNi4lTOsqgMOL8MhwxpAw6FRRif0yuHXnIVOYcOFlP4R7A4CPUASF5ejUCHRCtrSvwjRerLLZV4tCVXt13ff/+ZLd+S7/92DBiIAvPL1r8ZV15xwJeZ2TSjKFV/hi9tlazChzve4Crbzzny1/BnOwIL17AY354RVrfws5RRnnBHaIQZjwOi35BNhpC/grUiPadTTRUxAnnmPv/L+u313FPeggggAb/rPN+Oq558wcQVES0i4aRwQUvhaoSICFtYJ9wCRnacVTWjCssHVo4gwjTrNpRVkvgoywYiSMl+2fIxLSrB0OnxX4NZTs4YaO4UFmIoX3fRkXHbI27rub/eggwgAr3r9DQ4EkMoZhWhgFNgCoDEs4Zit1mTRJpiNv1IOFMDWQzxtvUDKv1CwZprRDztHBWpqM0r80JYiA6UkIiTyaHyU7xIx5mI9iuOvesKDDiFwkYB4/PkncdN/eTtmCVJRBppBRXAwxKUyLc/SAg4WFl5eAMvyEl7+Ig9KtVGBWZ9qxuS3DiGlJ3E+u4phWvUaO/kJbpxm2VFjkUdmZx4Lv/zEY3D8+gd2v3CXuyhABIDjz38uXvWjrzERqaaRoIr4VSBMQY9Krihk2KSQEj4AGhZqmgoQyrneotwoD1p8WuJQLgrWky3JPsx90vSWFIvAIQ/7XNvsadT+9NiL3vIUXCzuogERAF71Yz+CE9c8F0tFYAibYbT/BDhvpYW1DBXkUB0wwPNahsEiVfholWMuybaUNgVcyryI/JjAy8cbSj8V6S/nGp9TfJxr+KCZY0g6wXji+u/ExeQuKhAB4Kbf++c48fznQqd/oyNEFGsflFhBqdYsYagA9ZWw/OZ0YFC211FBxhg7hY9+1rXet+pWYqeAYLv2uSQeraGF/cBbnzr81aeLwV10IALAq37sn5mnyHSpNELX41wHwRMrxnWEShST4jStHsOL9RoAVcViXqlZ2xKdg0CDV5X1RYu0lJS0le+Dy10DXFVx8von4vITj13J8eC6ixLEE89/Lt7yez+FAKLIdLi2qSCtAFQFEByWQVx65o/iAwHUIX09zViTsh5Up4xB5s46ZldT14tgThs91VpebQsW+ZnuipOPxYlXPzh3Tg5zFyWIAHDi+c/DW37/p/3MFL3U36C+ZbxWL8sgaHUxogk1MxYYKzyh8LBiQyX+tWjokEQx5x/r2JlziJ7ay/5lI7IdClx+8rH4p2+9HBeru2hBBGYYgYSBSpj+CPhOZwoaUApF7bKmQ1LSQ88i7WztaplZL2E56FnsWq4Op7vaGQPDEJtprjj5WPzgW6/AxewuahCBhPHE85+3Gj8qdJctWv5MfN0SjtgkpJoxwYaVpwxk/pgK5DemOpbD+C43/1jeT9iGxRDOujL85A1Pwg/e/DRc7O6CvYTpgXDvvvkdePdb3+H68cfjywuJ7PUZ+TKk8Q8fLt+/HS9dij88vhcvZsqXMdW/7+dhbQ/1D5vPL28a/4D59E7v1sC33q7+YcZ42ZOU87Ff6y9d4sVm/itOPg7Pu+EpuOLkPzhIpBeNe0iBCAC3f/CTePfN78DpD34SCAUgFCTCt29V6EYYE8QCJGEMsMr3/IcmpzRz/KLsIawN56htRI13GKeLa3nheRqXxdNOPh5Pe+7j8NwbLp7N6qO4hxyI1f37m38Lt9/ySZz+4KlJMcWi7AAgrdVs2dzyFbgGUBf+vUOgW1rMeizCJotYoRvDHD6P/57XPBVPe+7jccXJw//K08XoHtIgVnf6llM4/cFTDiIwKwsL6zIqdfl3SWYrxPhMiwp81DeGsd4al3UuLdoctuwPSp+A73nNZXg4uP8PnhQ6ywH7XicAAAAASUVORK5CYII="/></g></g></g></g></svg></span><span class=navbar-brand__name>Open Cluster Management</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=/docs/><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/community/><span>Community</span></a></li><li class=nav-item><a class=nav-link href=/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/open-cluster-management-io/ocm target=_blank rel=noopener><i class="fab fa-github"></i><span>GitHub</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Releases</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://open-cluster-management.io>main</a></li><li><a class=dropdown-item href=https://v0-16.open-cluster-management.io>v0.16</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.5240367ca69fafe579b22b0f25f014ae.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/>Return to the regular view of this page</a>.</p></div><h1 class=title>Documentation</h1><ul><li>1: <a href=#pg-dd948255948d6b59b32c471abcb62997>Concepts</a></li><ul><li>1.1: <a href=#pg-50d925a344acf61d73d7b57e419faceb>Architecture</a></li><li>1.2: <a href=#pg-e99e7598858e3f869e59b4fa40e48ade>Cluster Inventory</a></li><ul><li>1.2.1: <a href=#pg-45706397951528a43ed1ce909dcd3453>ClusterClaim</a></li><li>1.2.2: <a href=#pg-a4287677022eb991b642209756dce447>ManagedCluster</a></li><li>1.2.3: <a href=#pg-17a73833b0076bd82dfeebcd02d321cb>ManagedClusterSet</a></li></ul><li>1.3: <a href=#pg-cb13d5a1d38f7b860f1d3976a220a03d>Work Distribution</a></li><ul><li>1.3.1: <a href=#pg-7ef8fd862e148bd9ba8c10d1a9915a8c>ManifestWork</a></li><li>1.3.2: <a href=#pg-b4402ea2915b78dbda7c88fa11132bd9>ManifestWorkReplicaSet</a></li></ul><li>1.4: <a href=#pg-dae5d69537fee30ac5da188ebdb9dc77>Content Placement</a></li><ul><li>1.4.1: <a href=#pg-4b7a58ca36f84688e0a1acb2ba0f42ec>Placement</a></li></ul><li>1.5: <a href=#pg-bae1486ef9ae185ca5360239b8ddfd39>Add-On Extensibility</a></li><ul><li>1.5.1: <a href=#pg-6b1c6790b84f69cffc0ab556de446740>Add-ons</a></li></ul></ul><li>2: <a href=#pg-17b09a9dc5200475d8a306f18e63a0f9>Getting Started</a></li><ul><li>2.1: <a href=#pg-9c8aeb3889d27b5da94e53dfe10de789>Quick Start</a></li><ul></ul><li>2.2: <a href=#pg-69689d7a4bef48f2bfb91e81453e6440>Installation</a></li><ul><li>2.2.1: <a href=#pg-3043db4487f0965239fd594f3ff03106>Start the control plane</a></li><li>2.2.2: <a href=#pg-116c2f796e286852a470675bf6ad59f9>Register a cluster</a></li><li>2.2.3: <a href=#pg-92c3b566bd4f842f869dcf67ba435f85>Add-on management</a></li><li>2.2.4: <a href=#pg-7e27bc67bf62c6bdcbb5b0caba98c014>Running on EKS</a></li></ul><li>2.3: <a href=#pg-6c1c67ed27dff6fc6cc426a3e6d5dceb>Add-ons and Integrations</a></li><ul><li>2.3.1: <a href=#pg-8318b29c9ea3dd68aa88f43f034ac44b>Policy</a></li><ul><li>2.3.1.1: <a href=#pg-aed3efe34586a9ea2226e76575cece60>Policy framework</a></li><li>2.3.1.2: <a href=#pg-7e101cfc3aaf8c0c92e0bff06cd8ef3e>Policy API concepts</a></li><li>2.3.1.3: <a href=#pg-e58634300ebdc6b417c2d11c29bffedd>Configuration Policy</a></li><li>2.3.1.4: <a href=#pg-da965a88320ed64c7db3afc8a1398f1e>Open Policy Agent Gatekeeper</a></li></ul><li>2.3.2: <a href=#pg-fbfe1d4ee41edbd2d79ba19791790925>Application lifecycle management</a></li><li>2.3.3: <a href=#pg-aa34d12e6f79e33b7aa948ed49652fe7>Cluster proxy</a></li><li>2.3.4: <a href=#pg-2d647ed2ebf02e492abdea9b64b40daa>Managed service account</a></li><li>2.3.5: <a href=#pg-949d98148d7196555245f5c95fcd12f6>Multicluster Control Plane</a></li></ul><li>2.4: <a href=#pg-ac9e6b6253635a1b0fe0e29e77c03c30>Administration</a></li><ul><li>2.4.1: <a href=#pg-ce917bf3d0aa58a23ffbcbbe7c87d60a>Monitoring OCM using Prometheus-Operator</a></li><li>2.4.2: <a href=#pg-b97b0aab0f47bdbbe6372a145a008ddf>Upgrading your OCM environment</a></li></ul></ul><li>3: <a href=#pg-65c66889c5026ec4086a556e64c09171>Developer Guides</a></li><ul><li>3.1: <a href=#pg-f12d911ccbae76575b9c0ec1c1b3680f>Add-on Developer Guide</a></li><li>3.2: <a href=#pg-8c3c7a28d5e041bf3f73af1a9f21e1b5>VScode Extension</a></li></ul><li>4: <a href=#pg-ed5e4e2a5768b77b50e8f92bb406319b>User Scenarios</a></li><ul><li>4.1: <a href=#pg-8e6e715e5d3149e708a441d8cda80620>Deploy Kubernetes resources to the managed clusters</a></li><li>4.2: <a href=#pg-f5520207f2d731962bdb209ff35b9606>Distribute workload with placement selected managed clusters</a></li><li>4.3: <a href=#pg-338e3de74358e29e5f426fed18dbbcd1>Extend the multicluster scheduling capabilities with placement</a></li><li>4.4: <a href=#pg-f272b8ffa037ea1ad801d9800b171b46>Extending managed clusters with custom attributes</a></li><li>4.5: <a href=#pg-6e0533c701ce88469bf1155ab6c497f9>Integration with Argo CD</a></li><li>4.6: <a href=#pg-86a38af7c2840a716dc25acad93066d1>Manage a cluster with multiple hubs</a></li><li>4.7: <a href=#pg-a248b9543af6136123ff241bf476fea3>Migrate workload with placement</a></li><li>4.8: <a href=#pg-7ca5dd580066fc69d90bf611a2fff868>Pushing Kubernetes API requests to the managed clusters</a></li><li>4.9: <a href=#pg-8272cdbbbcfeb7d32da1f7122d8d74fa>Register a cluster to hub through proxy server</a></li></ul><li>5: <a href=#pg-99a93ef9534d11fef4be3e4b3b1a6381>Contribute</a></li><ul></ul><li>6: <a href=#pg-584d4c2f4c3fdde3fc9cbf0f0c15cfcf>Releases</a></li><ul></ul><li>7: <a href=#pg-8bddc47793f55bfae90416ca0f1667ea>Roadmap</a></li><li>8: <a href=#pg-4588103fb9a692533044ee756a5f863f>FAQ</a></li><ul></ul><li>9: <a href=#pg-0e10aa79b66ebaf60284768f9c0d59cf>Security</a></li><ul></ul></ul><div class=content></div></div><div class=td-content><h1 id=pg-dd948255948d6b59b32c471abcb62997>1 - Concepts</h1></div><div class=td-content><h1 id=pg-50d925a344acf61d73d7b57e419faceb>1.1 - Architecture</h1><p>This page is an overview of open cluster management.</p><h2 id=overview>Overview</h2><p><strong>Open Cluster Management</strong> (OCM) is a powerful, modular, extensible platform
for Kubernetes multi-cluster orchestration. Learning from the past failing
lesson of building Kubernetes federation systems in the Kubernetes community,
in OCM we will be jumping out of the legacy centric, imperative architecture of
<a href=https://github.com/kubernetes-sigs/kubefed>Kubefed v2</a> and embracing the
&ldquo;hub-agent&rdquo; architecture which is identical to the original pattern of
&ldquo;hub-kubelet&rdquo; from Kubernetes. Hence, intuitively in OCM our multi-cluster
control plane is modeled as a &ldquo;Hub&rdquo; and on the other hand each of the clusters
being managed by the &ldquo;Hub&rdquo; will be a &ldquo;Klusterlet&rdquo; which is obviously inspired
from the original name of &ldquo;kubelet&rdquo;. Here&rsquo;s a more detailed clarification of
the two models we will be frequently using throughout the world of OCM:</p><ul><li><p><strong>Hub Cluster</strong>: Indicating the cluster that runs the multi-cluster control
plane of OCM. Generally the hub cluster is supposed to be a light-weight
Kubernetes cluster hosting merely a few fundamental controllers and services.</p></li><li><p><strong>Klusterlet</strong>: Indicating the clusters that being managed by the hub
cluster. Klusterlet might also be called &ldquo;managed cluster&rdquo; or &ldquo;spoke cluster&rdquo;. The
klusterlet is supposed to actively <strong>pulling</strong> the latest prescriptions from
the hub cluster and consistently reconciles the physical Kubernetes cluster
to the expected state.</p></li></ul><h3 id=hub-spoke-architecture>&ldquo;Hub-spoke&rdquo; architecture</h3><p>Benefiting from the merit of <a href=https://en.wikipedia.org/wiki/Spoke%E2%80%93hub_distribution_paradigm>&ldquo;hub-spoke&rdquo;</a> architecture, in abstraction we
are de-coupling most of the multi-cluster operations generally into
(1) computation/decision and (2) execution, and the actual execution against
the target cluster will be completely off-loaded into the managed cluster. The
hub cluster won&rsquo;t directly request against the real clusters, instead it
just persists its prescriptions declaratively for each cluster, and the
klusterlet will be actively pulling the prescriptions from the hub and doing
the execution. Hence, the burden of the hub cluster will be greatly relieved
because the hub cluster doesn&rsquo;t need to either deal with flooding events from
the managed clusters or be buried in sending requests against the clusters.
Imagine in a world where there&rsquo;s no kubelet in Kubernetes and its control plane
is directly operating the container daemons, it will be extremely hard for a
centric controller to manage a cluster of 5k+ nodes. Likewise, that&rsquo;s how OCM
trying to breach the bottleneck of scalability, by dividing and offloading the
execution into separated agents. So it&rsquo;s always feasible for a hub cluster to
accept and manage thousand-ish clusters.</p><p>Each klusterlet will be working independently and autonomously, so they have
a weak dependency to the availability of the hub cluster. If the hub goes down
(e.g. during maintenance or network partition) the klusterlet or other OCM
agents working in the managed cluster are supposed to keep actively managing
the hosting cluster until it re-connects. Additionally if the hub cluster and
the managed clusters are owned by different admins, it will be easier for the
admin of the managed cluster to police the prescriptions from the hub control
plane because the klusterlet is running as a &ldquo;white-box&rdquo; as a pod instance in
the managed cluster. Upon any accident, the klusterlet admin can quickly cut
off the connection with the hub cluster without shutting the whole multi-cluster
control plane down.</p><div style=text-align:center;padding:20px><img src=https://github.com/open-cluster-management-io/OCM/raw/main/assets/ocm-arch.png alt="Architecture diagram" style="margin:0 auto;width:50%"></div><p>The &ldquo;hub-agent&rdquo; architecture also minimized the requirements in the network
for registering a new cluster to the hub. Any cluster that can reach the
endpoint of the hub cluster will be able to be managed, even a random KinD
sandbox cluster on your laptop. That is because the prescriptions are
effectively <strong>pulled</strong> from the hub instead of <strong>pushing</strong>. In addition to
that, OCM also provides a <a href=https://open-cluster-management.io/docs/concepts/add-on-extensibility/addon/>addon</a>
named <a href=https://open-cluster-management.io/docs/getting-started/integration/cluster-proxy/>&ldquo;cluster-proxy&rdquo;</a>
which automatically manages a reverse proxy tunnel for proactive access to the
managed clusters by leveraging on the Kubernetes&rsquo; subproject <a href=https://kubernetes.io/docs/tasks/extend-kubernetes/setup-konnectivity/>konnectivity</a>.</p><h3 id=modularity-and-extensibility>Modularity and extensibility</h3><p>Not only OCM will bring you a fluent user-experience of managing a number of
clusters on ease, but also it will be equally friendly to further customization
or second-time development. Every functionality working in OCM is expected to
be freely-pluggable by modularizing the atomic capability into separated
building blocks, except for the mandatory core module named <a href=https://github.com/open-cluster-management-io/ocm/tree/main/cmd/registration>registration</a>
which is responsible for controlling the lifecycle of a managed controller
and exporting the elementary <code>ManagedCluster</code> model.</p><p>Another good example surfacing our modularity will be the <a href=https://open-cluster-management.io/docs/concepts/content-placement/placement/>placement</a>,
a standalone module focusing at dynamically selecting the proper list of
the managed clusters from the user&rsquo;s prescription. You can build any advanced
multi-cluster orchestration on the top of placement, e.g. multi-cluster
workload re-balancing, multi-cluster helm charts replication, etc. On the
other hand if you&rsquo;re not satisfied by the current capacities from our placement
module, you can quickly opt-out and replace it with your customized ones, and
reach out to our community so that we can converge in the future if possible.</p><hr><h2 id=concepts>Concepts</h2><h3 id=cluster-registering-double-opt-in-handshaking>Cluster registering: &ldquo;double opt-in handshaking&rdquo;</h3><p>Practically the hub cluster and the managed cluster can be owned/maintained
by different admins, so in OCM we clearly separated the roles and make the
cluster registration require approval from the both sides defending from unwelcome
requests. In terms of terminating the registration, the hub admin can kick
out a registered cluster by denying the rotation of hub cluster&rsquo;s certificate,
on the other hand from the perspective of a managed cluster&rsquo;s admin, he can
either brutally deleting the agent instances or revoking the granted RBAC
permissions for the agents. Note that the hub controller will be automatically
preparing environment for the newly registered cluster and cleaning up neatly
upon kicking a managed cluster.</p><div style=text-align:center;padding:20px><img src=/double-optin-registration.png alt="Double opt-in handshaking" style="margin:0 auto;width:60%"></div><h3 id=cluster-registration-security-model>Cluster registration security model</h3><div style=text-align:center;padding:20px><img src=/security-model.png alt="Security model" style="margin:0 auto;width:60%"></div><p>The worker cluster admin can list and read any managed cluster’s CSR,
but those CSR cannot be used to impersonate due to the fact that CSR only
contains the certificate. The client authentication requires both the key and certificate.
The key is stored in each managed cluster, and it will not be transmitted across the network.</p><p>The worker cluster admin cannot approve his or her own cluster registration by default.
Two separate RBAC rules are needed to approve a cluster registration.
The permission to approve the CSR and the permission to accept the managed cluster.
Only the cluster admin on hub has both permissions and can accept the cluster registration request.
The second accept permission is gated by a webhook.</p><h3 id=cluster-namespace>Cluster namespace</h3><p>Kubernetes has a native soft multi-tenancy isolation in the granularity of
its namespace resources, so in OCM, for each of the managed cluster we will
be provisioning a dedicated namespace for the managed cluster and grants
sufficient RBAC permissions so that the klusterlet can persist some data
in the hub cluster. This dedicated namespace is the &ldquo;cluster namespace&rdquo; which
is majorly for saving the prescriptions from the hub. e.g. we can create
<code>ManifestWork</code> in a cluster namespace in order to deploy some resources towards
the corresponding cluster. Meanwhile, the cluster namespace can also be used
to save the uploaded stats from the klusterlet e.g. the healthiness of an
addon, etc.</p><h3 id=addons>Addons</h3><p>Addon is a general concept for the optional, pluggable customization built over
the extensibility from OCM. It can be a controller in the hub cluster, or just
a customized agent in the managed cluster, or even the both collaborating
in peers. The addons are expected to implement the <code>ClusterManagementAddon</code> or
<code>ManagedClusterAddOn</code> API of which a detailed elaboration can be found <a href=https://open-cluster-management.io/docs/concepts/add-on-extensibility/addon/>here</a>.</p><hr><h2 id=building-blocks>Building blocks</h2><p>The following is a list of commonly-used modules/subprojects that you might
be interested in the journey of OCM:</p><h3 id=registration>Registration</h3><p>The core module of OCM manages the lifecycle of the managed clusters. The
registration controller in the hub cluster can be intuitively compared to a
broker that represents and manages the hub cluster in terms of cluster
registration, while the registration agent working in the managed cluster
is another broker that represents the managed cluster. After a successful
registration, the registration controller and agent will also be consistently
probing each other&rsquo;s healthiness. i.e. the cluster heartbeats.</p><h3 id=work>Work</h3><p>The module for dispatching resources from the hub cluster to the managed
clusters, which can be easily done by writing a <code>ManifestWork</code> resource into
a cluster namespace. See more details about the API <a href=https://open-cluster-management.io/docs/concepts/work-distribution/manifestwork/>here</a>.</p><h3 id=placement>Placement</h3><p>Building custom advanced topology across the clusters by either grouping
clusters via the labels or the cluster-claims. The placement module is
completely decoupled from the execution, the output from placement will
be merely a list of names of the matched clusters in the <code>PlacementDecision</code>
API, so the consumer controller of the decision output can reactively
discovery the topology or availability change from the managed clusters by
simply list-watching the decision API.</p><h3 id=application-lifecycle>Application lifecycle</h3><p>The <em>application lifecycle</em> defines the processes that are used to manage
application resources on your managed clusters. A multi-cluster application
uses a Kubernetes specification, but with additional automation of the
deployment and lifecycle management of resources to individual clusters. A
multi-cluster application allows you to deploy resources on multiple clusters,
while maintaining easy-to-reconcile service routes, as well as full control
of Kubernetes resource updates for all aspects of the application.</p><h3 id=governance-and-risk>Governance and risk</h3><p><em>Governance and risk</em> is the term used to define the processes that are used
to manage security and compliance from the hub cluster. Ensure the security
of your cluster with the extensible policy framework. After you configure a hub
cluster and a managed cluster, you can create, modify and delete policies on
the hub and apply policies to the managed clusters.</p><h3 id=registration-operator>Registration operator</h3><p>Automating the installation and upgrading of a few built-in modules in OCM. You
can either deploy the operator standalone or delegate the registration operator
to the operator lifecycle framework.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e99e7598858e3f869e59b4fa40e48ade>1.2 - Cluster Inventory</h1></div><div class=td-content><h1 id=pg-45706397951528a43ed1ce909dcd3453>1.2.1 - ClusterClaim</h1><h2 id=what-is-clusterclaim>What is ClusterClaim?</h2><p><code>ClusterClaim</code> is a cluster-scoped API available to users on a managed cluster.
The <code>ClusterClaim</code> objects are collected from the managed cluster and saved into
the status of the corresponding <code>ManagedCluster</code> object on the hub.</p><h2 id=usage>Usage</h2><p><code>ClusterCaim</code> is used to specify additional properties of the managed cluster like
the clusterID, version, vendor and cloud provider. We defined some reserved <code>ClusterClaims</code>
like <code>id.k8s.io</code> which is a unique identifier for the managed cluster.</p><p>In addition to the reserved <code>ClusterClaims</code>, users can also customize 20 <code>ClusterClaims</code> by default.
The maximum count of customized <code>ClusterClaims</code> can be configured via the flag
<code>max-custom-cluster-claims</code> of registration agent on the managed cluster.</p><p>The <code>ClusterClaim</code> with the label <code>open-cluster-management.io/spoke-only</code> will not be synced
to the status of <code>ManagedCluster</code>.</p><h2 id=example>Example</h2><p>Here is a <code>ClusterClaim</code> example specifying a <code>id.k8s.io</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterClaim</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id.k8s.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>myCluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>After applying the <code>ClusterClaim</code> above to any managed cluster, the value of the <code>ClusterClaim</code>
is reflected in the <code>ManagedCluster</code> on the hub cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedCluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterClaims</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id.k8s.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>myCluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-a4287677022eb991b642209756dce447>1.2.2 - ManagedCluster</h1><h2 id=what-is-managedcluster>What is ManagedCluster?</h2><p><code>ManagedCluster</code> is a cluster scoped API in the hub cluster representing the
registered or pending-for-acceptance Kubernetes clusters in OCM. The
<a href=https://open-cluster-management.io/docs/getting-started/installation/register-a-cluster/>klusterlet agent</a>
working in the managed cluster is expected to actively maintain/refresh the
status of the corresponding <code>ManagedCluster</code> resource on the hub cluster.
On the other hand, removing the <code>ManagedCluster</code> from the hub cluster indicates
the cluster is denied/exiled from the hub cluster. The following is the
introduction of how the cluster registration lifecycle works under the hood:</p><h3 id=cluster-registration-and-acceptance>Cluster registration and acceptance</h3><h4 id=bootstrapping-registration>Bootstrapping registration</h4><p>Firstly, the cluster registration process should be initiated by the
registration agent which requires a bootstrap kubeconfig e.g.:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Secret</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>bootstrap-hub-kubeconfig</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Opaque</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>kubeconfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>&lt;base64-encoded kubeconfig&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>A minimal RBAC permission required for the subject in the bootstrap kubeconfig
will be:</p><ul><li><code>CertificateSigningRequest</code>&rsquo;s &ldquo;get&rdquo;, &ldquo;list&rdquo;, &ldquo;watch&rdquo;, &ldquo;create&rdquo;, &ldquo;update&rdquo;.</li><li><code>ManagedCluster</code>&rsquo;s &ldquo;get&rdquo;, &ldquo;list&rdquo;, &ldquo;create&rdquo;, &ldquo;update&rdquo;</li></ul><p>Note that ideally the bootstrap kubeconfig is supposed to live shortly
(hour-ish) after signed by the hub cluster so that it won&rsquo;t be abused by
unwelcome clients.</p><p>Last but not least, you can always live an easier life by leveraging OCM&rsquo;s
command-line tool <code>clusteradm</code> to manage the whole registration process.</p><h4 id=approving-registration>Approving registration</h4><p>When we&rsquo;re registering a new cluster into OCM, the registration agent will be
starting by creating an unaccepted <code>ManagedCluster</code> into the hub cluster along
with a temporary <a href=https://kubernetes.io/docs/reference/access-authn-authz/certificate-signing-requests/>CertificateSigningRequest (CSR)</a>
resource. The cluster will be accepted by the hub control plane, if the
following requirements is meet:</p><ul><li>The CSR is approved and signed by any certificate provider setting filling
<code>.status.certificate</code> with legit X.509 certificates.</li><li>The <code>ManagedCluster</code> resource is approved by setting <code>.spec.hubAcceptsClient</code>
to true in the spec.</li></ul><p>Note that the cluster approval process above can be done by one-line:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>$ clusteradm accept --clusters &lt;cluster name&gt;
</span></span></code></pre></div><p>Upon the approval, the registration agent will observe the signed certificate
and persist them as a local secret named &ldquo;hub-kubeconfig-secret&rdquo; (by default
in the &ldquo;open-cluster-management-agent&rdquo; namespace) which will be mounted to the
other fundamental components of klusterlet such as the <a href=https://open-cluster-management.io/docs/concepts/work-distribution/manifestwork/>work</a>
agent. In a word, if you can find your &ldquo;hub-kubeconfig-secret&rdquo; successfully
present in your managed cluster, the cluster registration is all set!</p><p>Overall the registration process in OCM is called <code>double opt-in</code> mechanism,
which means that a successful cluster registration requires both sides of
approval and commitment from the hub cluster and the managed cluster. This
will be especially useful when the hub cluster and managed clusters are
operated by different admins or teams. In OCM, we assume the clusters are
mutually untrusted in the beginning then set up the connection between them
gracefully with permission and validity under control.</p><p>Note that the functionality mentioned above are all managed by OCM&rsquo;s
<a href=https://github.com/open-cluster-management-io/ocm/tree/main/cmd/registration>registration</a>
sub-project, which is the &ldquo;root dependency&rdquo; in the OCM world. It includes
an agent in the managed cluster to register to the hub and a controller in
the hub cluster to coordinate with the agent.</p><h3 id=cluster-heartbeats-and-status>Cluster heartbeats and status</h3><p>By default, the registration will be reporting and refreshing its healthiness
state to the hub cluster on a one-minute basis, and that interval can be easily
overridden by setting <code>.spec.leaseDurationSeconds</code> on the <code>ManagedCluster</code>.</p><p>In addition to that, a few commonly-used information will also be reflected
in the status of the <code>ManagedCluster</code>, e.g.:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kubernetes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1.20.11</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>allocatable</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>cpu</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>11700m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>ephemeral-storage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;342068531454&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>hugepages-1Gi</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>hugepages-2Mi</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>17474228Ki</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>pods</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;192&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>capacity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>cpu</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;12&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>ephemeral-storage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>371168112Ki</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>hugepages-1Gi</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>hugepages-2Mi</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>23777972Ki</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>pods</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;192&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=cluster-taints-and-tolerations>Cluster taints and tolerations</h3><p>To support filtering unhealthy/not-reporting clusters and keep workloads from
being placed in unhealthy or unreachable clusters, we introduce the similar
concept of taint/toleration in Kubernetes. It also allows user to add a
customized taint to deselect a cluster from placement. This is useful when the
user wants to set a cluster to maintenance mode and evict workload from this
cluster.</p><p>In OCM, Taints and Tolerations work together to allow users to control the
selection of managed clusters more flexibly.</p><h4 id=taints-of-managedclusters>Taints of ManagedClusters</h4><p>Taints are properties of ManagedClusters, they allow a Placement to repel a set
of ManagedClusters. A Taint includes the following fields:</p><ul><li><strong>Key</strong> (required). The taint key applied to a cluster. e.g. bar or
foo.example.com/bar.</li><li><strong>Value</strong> (optional). The taint value corresponding to the taint key.</li><li><strong>Effect</strong> (required). The Effect of the taint on Placements that do not
tolerate the taint. Valid effects are<ul><li><code>NoSelect</code>. It means Placements are not allowed to select a cluster unless
they tolerate this taint. The cluster will be removed from the placement
decision if it has already been selected by the Placement.</li><li><code>PreferNoSelect</code>. It means the scheduler tries not to select the cluster,
rather than prohibiting Placements from selecting the cluster entirely.
(This is not implemented yet, currently clusters with effect <code>PreferNoSelect</code>
will always be selected.)</li><li><code>NoSelectIfNew</code>. It means Placements are not allowed to select the cluster
unless: 1) they tolerate the taint; 2) they have already had the cluster in
their cluster decisions;</li></ul></li><li><strong>TimeAdded</strong> (required). The time at which the taint was added. It is set
automatically and the user should not to set/update its value.</li></ul><p><strong>Builtin taints to reflect the status of ManagedClusters</strong></p><p>There are two builtin taints, which will be automatically added to
ManagedClusters, according to their conditions.</p><ul><li><code>cluster.open-cluster-management.io/unavailable</code>. The taint is added to a
ManagedCluster when it is not available. To be specific, the cluster has a
condition &lsquo;ManagedClusterConditionAvailable&rsquo; with status of &lsquo;False&rsquo;. The taint
has the effect <code>NoSelect</code> and an empty value. Example,<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedCluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>hubAcceptsClient</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>taints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span>- <span style=color:#204a87;font-weight:700>effect</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NoSelect</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/unavailable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>timeAdded</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;2022-02-21T08:11:54Z&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li><li><code>cluster.open-cluster-management.io/unreachable</code>. The taint is added to a
ManagedCluster when it is not reachable. To be specific,<ul><li><ol><li>The cluster has no condition &lsquo;ManagedClusterConditionAvailable&rsquo;;</li></ol></li><li><ol start=2><li>Or the status of condition &lsquo;ManagedClusterConditionAvailable&rsquo; is
&lsquo;Unknown&rsquo;;
The taint has the effect <code>NoSelect</code> and an empty value. Example,</li></ol></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedCluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>hubAcceptsClient</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>taints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>effect</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NoSelect</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/unreachable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>timeAdded</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;2022-02-21T08:11:06Z&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li></ul><h4 id=tolerations-of-placements>Tolerations of Placements</h4><p>Tolerations are applied to Placements, and allow Placements to select
ManagedClusters with matching taints. Refer to <a href=/docs/concepts/content-placement/placement/#taintstolerations>Placement
Taints/Tolerations</a> to see how it is used for
cluster selection.</p><h3 id=cluster-removal>Cluster removal</h3><p>A previously registered cluster can opt-out cutting off the connection from
either hub cluster or managed cluster. This is helpful for tackling emergency
problems in your OCM environment, e.g.:</p><ul><li>When the hub cluster is overloaded, under emergency</li><li>When the managed cluster is intended to detach from OCM</li><li>When the hub cluster is found sending wrong orders to the managed cluster</li><li>When the managed cluster is spamming requests to the hub cluster</li></ul><h4 id=unregister-from-hub-cluster>Unregister from hub cluster</h4><p>A recommended way to unregister a managed cluster will flip the
<code>.spec.hubAcceptsClient</code> bit back to <code>false</code>, which will be triggering the hub
control plane to offload the managed cluster from effective management.
Meanwhile, a permanent way to kick a managed cluster from the hub control plane
is simply deleting its <code>ManagedCluster</code> resource.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl delete managedcluster &lt;cluster name&gt;
</span></span></code></pre></div><p>This is also revoking the previously-granted RBAC permission for the managed
cluster instantly in the background. If we hope to defer the rejection to
the next time when the klusterlet agent is renewing its certificate, as a
minimal operation we can remove the following RBAC rules from the cluster&rsquo;s
effective cluster role resource:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ClusterRole: open-cluster-management:managedcluster:&lt;cluster name&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Removing the following RBAC rule to stop the certificate rotation.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>register.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>managedclusters/clientcertificates</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>renew</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=unregister-from-the-managed-cluster>Unregister from the managed cluster</h4><p>The admin of the managed cluster can disable the prescriptions from hub cluster
by scaling the OCM klusterlet agents to <code>0</code>. Or just permanently deleting the
agent components from the managed cluster.</p><h2 id=managed-clusters-certificate-rotation>Managed Cluster&rsquo;s certificate rotation</h2><p>The certificates used by the agents from the managed cluster to talk to
the hub control plane will be periodically rotated with an ephemeral and random
identity. The following picture shows the automated certificate rotation works.</p><div style=text-align:center;padding:20px><img src=/registration-process.png alt="Registration Process" style="margin:0 auto;width:80%"></div><h2 id=whats-next>What&rsquo;s next?</h2><p>Furthermore, we can do advanced cluster matching/selecting within a
<a href=/docs/concepts/cluster-inventory/managedclusterset/>managedclusterset</a> using the <a href=/docs/concepts/content-placement/placement/>placement</a>
module.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-17a73833b0076bd82dfeebcd02d321cb>1.2.3 - ManagedClusterSet</h1><p><strong>API-CHANGE NOTE</strong>:</p><p>The <code>ManagedClusterSet</code> and <code>ManagedClusterSetBinding</code> API v1beta1 version will no longer be served in OCM v0.12.0.</p><ul><li>Migrate manifests and API clients to use the <code>ManagedClusterSet</code> and <code>ManagedClusterSetBinding</code> API v1beta2 version, available since OCM v0.9.0.</li><li>All existing persisted objects are accessible via the new API.</li><li>Notable changes:<ul><li>The default cluster selector type will be <code>ExclusiveClusterSetLabel</code> in v1beta2, and type <code>LegacyClusterSetLabel</code> in v1beta1 is removed.</li></ul></li></ul><h2 id=what-is-managedclusterset>What is ManagedClusterSet?</h2><p><code>ManagedClusterSet</code> is a cluster-scoped API in the hub cluster for grouping a
few managed clusters into a &ldquo;set&rdquo; so that hub admin can operate these clusters
altogether in a higher level. The concept is inspired by the <a href=https://github.com/kubernetes/enhancements/tree/master/keps/sig-multicluster/1645-multi-cluster-services-api#terminology>enhancement</a>
from the Kubernetes SIG-Multicluster. Member clusters in the set are supposed
to have common/similar attributes e.g. purpose of use, deployed regions, etc.</p><p><code>ManagedClusterSetBinding</code> is a namespace-scoped API in the hub cluster to project
a <code>ManagedClusterSet</code> into a certain namespace. Each <code>ManagedClusterSet</code> can be
managed/administrated by different hub admins, and their RBAC permissions can
also be isolated by binding the <code>ManagedClusterSet</code> to a &ldquo;workspace namespace&rdquo; in
the hub cluster via <code>ManagedClusterSetBinding</code>.</p><p>Note that <code>ManagedClusterSet</code> and &ldquo;workspace namespace&rdquo; has an <strong>M*N</strong>
relationship:</p><ul><li>Bind multiple cluster sets to one workspace namespace indicates that the admin
of that namespace can operate the member clusters from both sets.</li><li>Bind one cluster set to multiple workspace namespace indicates that the
cluster set can be operated from all the bound namespaces at the same time.</li></ul><p>The cluster set admin can flexibly operate the member clusters in the workspace
namespace using <a href=/docs/concepts/content-placement/placement/>Placement</a> API, etc.</p><p>The following picture shows the hierarchies of how the cluster set works:</p><div style=text-align:center;padding:20px><img src=/clusterset-explain.png alt=Clusterset style="margin:0 auto;width:90%"></div><h2 id=operates-managedclusterset-using-clusteradm>Operates ManagedClusterSet using clusteradm</h2><h3 id=creating-a-managedclusterset>Creating a ManagedClusterSet</h3><p>Running the following command to create an example cluster set:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm create clusterset example-clusterset
</span></span><span style=display:flex><span>$ clusteradm get clustersets
</span></span><span style=display:flex><span>&lt;ManagedClusterSet&gt;
</span></span><span style=display:flex><span>└── &lt;default&gt;
</span></span><span style=display:flex><span>│   ├── &lt;BoundNamespace&gt;
</span></span><span style=display:flex><span>│   ├── &lt;Status&gt; No ManagedCluster selected
</span></span><span style=display:flex><span>└── &lt;example-clusterset&gt;
</span></span><span style=display:flex><span>│   ├── &lt;BoundNamespace&gt;
</span></span><span style=display:flex><span>│   ├── &lt;Status&gt; No ManagedCluster selected
</span></span><span style=display:flex><span>└── &lt;global&gt;
</span></span><span style=display:flex><span>    └── &lt;BoundNamespace&gt;
</span></span><span style=display:flex><span>    └── &lt;Status&gt; <span style=color:#0000cf;font-weight:700>1</span> ManagedClusters selected
</span></span></code></pre></div><p>The newly created cluster set will be empty by default, so we can move on adding
member clusters to the set.</p><h3 id=adding-a-managedcluster-to-a-managedclusterset>Adding a ManagedCluster to a ManagedClusterSet</h3><p>Running the following command to add a cluster to the set:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm clusterset <span style=color:#204a87>set</span> example-clusterset --clusters managed1
</span></span><span style=display:flex><span>$ clusteradm get clustersets
</span></span><span style=display:flex><span>&lt;ManagedClusterSet&gt;
</span></span><span style=display:flex><span>└── &lt;default&gt;
</span></span><span style=display:flex><span>│   ├── &lt;BoundNamespace&gt;
</span></span><span style=display:flex><span>│   ├── &lt;Status&gt; No ManagedCluster selected
</span></span><span style=display:flex><span>└── &lt;example-clusterset&gt;
</span></span><span style=display:flex><span>│   ├── &lt;BoundNamespace&gt;
</span></span><span style=display:flex><span>│   ├── &lt;Status&gt; <span style=color:#0000cf;font-weight:700>1</span> ManagedClusters selected
</span></span><span style=display:flex><span>└── &lt;global&gt;
</span></span><span style=display:flex><span>    └── &lt;BoundNamespace&gt;
</span></span><span style=display:flex><span>    └── &lt;Status&gt; <span style=color:#0000cf;font-weight:700>1</span> ManagedClusters selected
</span></span></code></pre></div><p>Note that adding a cluster to a cluster set will require the admin to have
&ldquo;managedclustersets/join&rdquo; access in the hub cluster.</p><p>Now the cluster set contains 1 valid cluster, and in order to operate that
cluster set we are supposed to bind it to an existing namespace to make it a
&ldquo;workspace namespace&rdquo;.</p><h3 id=binding-the-managedclusterset-to-a-workspace-namespace>Binding the ManagedClusterSet to a workspace namespace</h3><p>Running the following command to bind the cluster set to a namespace. Note that
the namespace <strong>SHALL NOT</strong> be an existing &ldquo;cluster namespace&rdquo; (i.e. the
namespace has the same name of a registered managed cluster).</p><p>Note that binding a cluster set to a namespace means that granting access from
that namespace to its member clusters. And the bind process requires
&ldquo;managedclustersets/bind&rdquo; access in the hub cluster which is clarified below.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm clusterset <span style=color:#204a87>bind</span> example-clusterset --namespace default
</span></span><span style=display:flex><span>$ clusteradm get clustersets
</span></span><span style=display:flex><span>&lt;ManagedClusterSet&gt;
</span></span><span style=display:flex><span>└── &lt;default&gt;
</span></span><span style=display:flex><span>│   ├── &lt;BoundNamespace&gt;
</span></span><span style=display:flex><span>│   ├── &lt;Status&gt; No ManagedCluster selected
</span></span><span style=display:flex><span>└── &lt;example-clusterset&gt;
</span></span><span style=display:flex><span>│   ├── &lt;Status&gt; <span style=color:#0000cf;font-weight:700>1</span> ManagedClusters selected
</span></span><span style=display:flex><span>│   ├── &lt;BoundNamespace&gt; default
</span></span><span style=display:flex><span>└── &lt;global&gt;
</span></span><span style=display:flex><span>    └── &lt;BoundNamespace&gt;
</span></span><span style=display:flex><span>    └── &lt;Status&gt; <span style=color:#0000cf;font-weight:700>1</span> ManagedClusters selected
</span></span></code></pre></div><p>So far we successfully created a new cluster set containing 1 cluster and bind
it a &ldquo;workspace namespace&rdquo;.</p><h2 id=a-glance-at-the-managedclusterset-api>A glance at the &ldquo;ManagedClusterSet&rdquo; API</h2><p>The <code>ManagedClusterSet</code> is a vanilla Kubernetes custom resource which can be
checked by the command <code>kubectl get managedclusterset &lt;cluster set name> -o yaml</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterSet</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-clusterset</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>selectorType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ExclusiveClusterSetLabel</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2022-02-21T09:24:38Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusters selected</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClustersSelected</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterSetEmpty</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterSet</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-openshift-clusterset</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>vendor</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OpenShift</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>selectorType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LabelSelector</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2022-06-20T08:23:28Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusters selected</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClustersSelected</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterSetEmpty</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>ManagedClusterSetBinding</code> can also be checked by the command
<code>kubectl get managedclustersetbinding &lt;cluster set name> -n &lt;workspace-namespace> -oyaml</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterSetBinding</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-clusterset</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterSet</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-clusterset</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2022-12-19T09:55:10Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterSetBound</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Bound</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=clusterset-rbac-permission-control>Clusterset RBAC permission control</h3><h4 id=adding-member-cluster-to-a-clusterset>Adding member cluster to a clusterset</h4><p>Adding a new member cluster to a clusterset requires RBAC permission of
updating the managed cluster and <code>managedclustersets/join</code> subresource. We can
manually apply the following clusterrole to allow a hub user to manipulate
that clusterset:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>cluster.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>managedclusters</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>update</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>cluster.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>managedclustersets/join</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>create</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=binding-a-clusterset-to-a-namespace>Binding a clusterset to a namespace</h4><p>The &ldquo;binding&rdquo; process of a cluster set is policed by a validating webhook that
checks whether the requester has sufficient RBAC access to the
<code>managedclustersets/bind</code> subresource. We can also manually apply the following
clusterrole to grant a hub user the permission to bind cluster sets:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>cluster.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>managedclustersets/bind</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>create</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=default-managedclusterset>Default ManagedClusterSet</h2><p>For easier management, we introduce a ManagedClusterSet called <code>default</code>.
A <code>default</code> ManagedClusterSet will be automatically created initially. Any clusters not specifying a ManagedClusterSet will be added into the <code>default</code>.
The user can move the cluster from the default clusterset to another clusterset using the command:</p><pre tabindex=0><code>clusteradm clusterset set target-clusterset --clusters cluster-name
</code></pre><p><code>default</code> clusterset is an alpha feature that can be disabled by disabling the feature gate in registration controller as:
<a href=https://github.com/open-cluster-management-io/ocm/commit/55bc274d795ad0befc71f05aecd08810a4abfba1#diff-1026afceb1a224783dbf517bc281e71c1640636f5f001338f8185a0b4398b3d9R51><code>- "--feature-gates=DefaultClusterSet=false"</code></a></p><h2 id=global-managedclusterset>Global ManagedClusterSet</h2><p>For easier management, we also introduce a ManagedClusterSet called <code>global</code>.
A <code>global</code> ManagedClusterSet will be automatically created initially. The <code>global</code> ManagedClusterSet include all ManagedClusters.</p><p><code>global</code> clusterset is an alpha feature that can be disabled by disabling the feature gate in registration controller as:
<a href=https://github.com/open-cluster-management-io/ocm/commit/55bc274d795ad0befc71f05aecd08810a4abfba1#diff-1026afceb1a224783dbf517bc281e71c1640636f5f001338f8185a0b4398b3d9R51><code>- "--feature-gates=DefaultClusterSet=false"</code></a></p><p><code>global</code> ManagedClusterSet detail:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterSet</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>global</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>selectorType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LabelSelector</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2022-06-20T08:23:28Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusters selected</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClustersSelected</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterSetEmpty</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-cb13d5a1d38f7b860f1d3976a220a03d>1.3 - Work Distribution</h1></div><div class=td-content><h1 id=pg-7ef8fd862e148bd9ba8c10d1a9915a8c>1.3.1 - ManifestWork</h1><h2 id=what-is-manifestwork>What is <code>ManifestWork</code></h2><p><code>ManifestWork</code> is used to define a group of Kubernetes resources on the hub to be applied to the managed cluster. In the open-cluster-management project, a <code>ManifestWork</code> resource must be created in the cluster namespace. A work agent implemented in <a href=https://github.com/open-cluster-management-io/ocm/tree/main/cmd/work>work</a> project is run on the managed cluster and monitors the <code>ManifestWork</code> resource in the cluster namespace on the hub cluster.</p><p>An example of <code>ManifestWork</code> to deploy a deployment to the managed cluster is shown in the following example.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>&lt;target managed cluster&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-work-demo</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>quay.io/asmacdo/busybox</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>command</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;sh&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;-c&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;echo &#34;Hello, Kubernetes!&#34; &amp;&amp; sleep 3600&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=status-tracking>Status tracking</h2><p>Work agent will track all the resources defined in <code>ManifestWork</code> and update its status. There are two types of status in manifestwork. The <code>resourceStatus</code> tracks the status of each manifest in the <code>ManifestWork</code> and <code>conditions</code> reflects the overall status of the <code>ManifestWork</code>. Work agent currently checks whether a resource is <code>Available</code>, meaning the resource exists on the managed cluster, and <code>Applied</code> means the resource defined in <code>ManifestWork</code> has been applied to the managed cluster.</p><p>Here is an example.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2021-06-15T02:26:02Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Apply manifest work complete</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AppliedManifestWorkComplete</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Applied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2021-06-15T02:26:02Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>All resources are available</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourcesAvailable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Available</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceStatus</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2021-06-15T02:26:02Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Apply manifest complete</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AppliedManifestComplete</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Applied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2021-06-15T02:26:02Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Resource is available</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceAvailable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Available</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resourceMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>ordinal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deployments</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=fine-grained-field-values-tracking>Fine-grained field values tracking</h3><p>Optionally, we can let the work agent aggregate and report certain fields from
the distributed resources to the hub clusters by setting <code>FeedbackRule</code> for
the <code>ManifestWork</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>manifestConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>resourceIdentifier</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deployments</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>feedbackRules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>WellKnownStatus</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JSONPaths</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>jsonPaths</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>isAvailable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;.status.conditions[?(@.type==&#34;Available&#34;)].status&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The feedback rules prescribe the work agent to periodically get the latest
states of the resources, and scrape merely those expected fields from them,
which is helpful for trimming the payload size of the status. Note that the
collected feedback values on the <code>ManifestWork</code> will not be updated unless
the latest value is changed/different from the previous recorded value.
Currently, it supports two kinds of <code>FeedbackRule</code>:</p><ul><li><code>WellKnownStatus</code>: Using the pre-built template of feedback values for those
well-known kubernetes resources.</li><li><code>JSONPaths</code>: A valid <a href=https://kubernetes.io/docs/reference/kubectl/jsonpath/>Kubernetes JSON-Path</a>
that selects a scalar field from the resource. Currently supported types are
<strong>Integer</strong>, <strong>String</strong>, <strong>Boolean</strong> and <strong>JsonRaw</strong>. <strong>JsonRaw</strong> returns only when you have enabled
the RawFeedbackJsonString feature gate on the agent. The agent will return the whole structure as a
JSON string.</li></ul><p>The default feedback value scraping interval is 30 second, and we can override
it by setting <code>--status-sync-interval</code> on your work agent. Too short period can
cause excessive burden to the control plane of the managed cluster, so generally
a recommended lower bound for the interval is 5 second.</p><p>In the end, the scraped values from feedback rules will be shown in the status:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceStatus</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>resourceMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>statusFeedback</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>values</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>fieldValue</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>integer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Integer</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ReadyReplicas</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>fieldValue</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>integer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Integer</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Replicas</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>fieldValue</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>integer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Integer</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AvailableReplicas</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>fieldValue</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>isAvailable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=garbage-collection>Garbage collection</h2><p>To ensure the resources applied by <code>ManifestWork</code> are reliably recorded, the work agent creates an <code>AppliedManifestWork</code> on the managed cluster for each <code>ManifestWork</code> as an anchor for resources relating to <code>ManifestWork</code>. When <code>ManifestWork</code> is deleted, work agent runs a <code>Foreground deletion</code>, that <code>ManifestWork</code> will stay in deleting state until all its related resources has been fully cleaned in the managed cluster.</p><h3 id=delete-options>Delete options</h3><p>User can explicitly choose not to garbage collect the applied resources when a <code>ManifestWork</code> is deleted. The user should specify the <code>deleteOption</code> in the <code>ManifestWork</code>. By default, <code>deleteOption</code> is set as <code>Foreground</code>
which means the applied resources on the spoke will be deleted with the removal of <code>ManifestWork</code>. User can set it to
<code>Orphan</code> so the applied resources will not be deleted. Here is an example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>deleteOption</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>propagationPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Orphan</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Alternatively, user can also specify a certain resource defined in the <code>ManifestWork</code> to be orphaned by setting the
<code>deleteOption</code> to be <code>SelectivelyOrphan</code>. Here is an example with <code>SelectivelyOrphan</code> specified. It ensures the removal of deployment resource specified in the <code>ManifestWork</code> while the service resource is kept.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>selective-delete-work</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>deleteOption</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>propagationPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SelectivelyOrphan</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>selectivelyOrphans</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>orphaningRules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>services</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=resource-race-and-adoption>Resource Race and Adoption</h2><p>It is possible to create two <code>ManifestWorks</code> for the same cluster with the same resource defined.
For example, the user can create two <code>Manifestworks</code> on cluster1, and both <code>Manifestworks</code> have the
deployment resource <code>hello</code> in default namespace. If the content of the resource is different, the
two <code>ManifestWorks</code> will fight, and it is desired since each <code>ManifestWork</code> is treated as equal and
each <code>ManifestWork</code> is declaring the ownership of the resource. If there is another controller on
the managed cluster that tries to manipulate the resource applied by a <code>ManifestWork</code>, this
controller will also fight with work agent.</p><p>When one of the <code>ManifestWork</code> is deleted, the applied resource will not be removed no matter
<code>DeleteOption</code> is set or not. The remaining <code>ManifestWork</code> will still keep the ownership of the resource.</p><p>To resolve such conflict, user can choose a different update strategy to alleviate the resource conflict.</p><ul><li><code>CreateOnly</code>: with this strategy, the work-agent will only ensure creation of the certain manifest if the
resource does not exist. work-agent will not update the resource, hence the ownership of the whole resource
can be taken over by another <code>ManifestWork</code> or controller.</li><li><code>ServerSideApply</code>: with this strategy, the work-agent will run server side apply for the certain manifest. The
default field manager is <code>work-agent</code>, and can be customized. If another <code>ManifestWork</code> or controller takes the
ownership of a certain field in the manifest, the original <code>ManifestWork</code> will report conflict. User can prune
the original <code>ManifestWork</code> so only field that it will own maintains.</li><li><code>ReadOnly</code>: with this strategy, the work-agent will not apply manifests onto the cluster, but it still can read
resource fields and return results when feedback rules are defined. Only metadata of the manifest is required to
be defined in the spec of the <code>ManifestWork</code> with this strategy.</li></ul><p>An example of using <code>ServerSideApply</code> strategy as following:</p><ol><li>User creates a <code>ManifestWork</code> with <code>ServerSideApply</code> specified:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>&lt;target managed cluster&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-work-demo</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>manifestConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>resourceIdentifier</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deployments</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>updateStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServerSideApply</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ol start=2><li>User creates another <code>ManifestWork</code> with <code>ServerSideApply</code> but with different field manager.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>&lt;target managed cluster&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-work-replica-patch</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>manifestConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>resourceIdentifier</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deployments</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>updateStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServerSideApply</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>serverSideApply</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>force</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>fieldManager</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work-agent-another</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The second <code>ManifestWork</code> only defines <code>replicas</code> in the manifest, so it takes the ownership of <code>replicas</code>. If the
first <code>ManifestWork</code> is updated to add <code>replicas</code> field with different value, it will get conflict condition and
manifest will not be updated by it.</p><p>Instead of create the second <code>ManifestWork</code>, user can also set HPA for this deployment. HPA will also take the ownership
of <code>replicas</code>, and the update of <code>replicas</code> field in the first <code>ManifestWork</code> will return conflict condition.</p><h2 id=ignore-fields-in-server-side-apply>Ignore fields in Server Side Apply</h2><p>To avoid work-agent returning conflict error, when using ServerSideApply as the update strategy, users can specify certain
fields to be ignored, such that when work agent is applying the resource to the <code>ManagedCluster</code>, the change on the
specified fields will not be updated onto the resource.</p><p>It is useful when other actors on the <code>ManagedCluster</code> is updating the same field on the resources
that the <code>ManifestWork</code> is owning. One example as below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>&lt;target managed cluster&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-work-demo</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>manifestConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>resourceIdentifier</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>configmaps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>some-configmap</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>updateStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServerSideApply</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>force</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>serverSideApply</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>ignoreFields</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>condition</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OnSpokePresent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>jsonPaths</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#000>.data</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>It indicates that when the configmap is applied on the <code>ManagedCluster</code>, any additional change
on the data field will be ignored by the work agent, no matter the change comes from another
actor on the <code>ManagedCluster</code>, or from this or another <code>ManifestWork</code>. It applies as long as the
configmap exists on the <code>ManagedCluster</code>.</p><p>Alternatively, user can also set the condition field in the above example to <code>OnSpokeChange</code>, which
indicates that the change of the data field will not be ignored if it comes from this <code>ManifestWork</code>
However, change from other actors on the <code>ManagedCluster</code> will be ignored.</p><h2 id=permission-setting-for-work-agent>Permission setting for work agent</h2><p>All workload manifests are applied to the managed cluster by the work agent, and by default the work agent has the
following permission for the managed cluster:</p><ul><li>clusterRole <code>admin</code>(instead of the <code>cluster-admin</code>) to apply kubernetes common resources</li><li>managing <code>customresourcedefinitions</code>, but can not manage a specific custom resource instance</li><li>managing <code>clusterrolebindings</code>, <code>rolebindings</code>, <code>clusterroles</code>, <code>roles</code>, including the <code>bind</code> and <code>escalate</code>
permission, this is why we can grant work-agent service account extra permissions using ManifestWork</li></ul><p>So if the workload manifests to be applied on the managed cluster exceeds the above permission, for example some
Customer Resource instances, there will be an error <code>... is forbidden: User "system:serviceaccount:open-cluster-management-agent:klusterlet-work-sa" cannot get resource ...</code>
reflected on the ManifestWork status.</p><p>To prevent this, the service account <code>klusterlet-work-sa</code> used by the work-agent needs to be given the corresponding
permissions. There are several ways:</p><ul><li>add permission on the managed cluster directly, we can<ul><li>aggregate the new clusterRole for your to-be-applied resources to the existing <code>admin</code> clusterRole</li><li>OR create role/clusterRole roleBinding/clusterRoleBinding for the <code>klusterlet-work-sa</code> service account</li></ul></li><li>add permission on the hub cluster by another ManifestWork, the ManifestWork includes<ul><li>an clusterRole with label <code>"open-cluster-management.io/aggregate-to-work": "true"</code> for your to-be-applied
resources, the rules defined in the clusterRole will be aggregated to the work agent(OCM version >= v0.12.0)</li><li>OR role/clusterRole roleBinding/clusterRoleBinding for the <code>klusterlet-work-sa</code> service account</li></ul></li></ul><p>Below is an example use ManifestWork to give <code>klusterlet-work-sa</code> permission for resource <code>machines.cluster.x-k8s.io</code></p><ul><li>Option 1: Use aggregated clusterRole</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>permission-set</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management:klusterlet-work:my-role</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>open-cluster-management.io/aggregate-to-work</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># with this label, the clusterRole will be selected to aggregate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># Allow agent to managed machines</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;cluster.x-k8s.io&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;machines&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;get&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;list&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;watch&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;create&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;update&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;patch&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;delete&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>Option 2: Use clusterRole and clusterRoleBinding</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>permission-set</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management:klusterlet-work:my-role</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># Allow agent to managed machines</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;cluster.x-k8s.io&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;machines&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;get&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;list&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;watch&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;create&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;update&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;patch&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;delete&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRoleBinding</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management:klusterlet-work:my-binding</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>roleRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>apiGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management:klusterlet-work:my-role</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>subjects</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>klusterlet-work-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=treating-defaultingimmutable-fields-in-api>Treating defaulting/immutable fields in API</h2><p>The kube-apiserver sets the defaulting/immutable fields for some APIs if the user does not set them. And it may fail to
deploy these APIs using <code>ManifestWork</code>. Because in the reconcile loop, the work agent will try to update the immutable
or default field after comparing the desired manifest in the <code>ManifestWork</code> and existing resource in the cluster, and
the update will fail or not take effect.</p><p>Let&rsquo;s use Job as an example. The kube-apiserver will set a default selector and label on the Pod of Job if the user does
not set <code>spec.Selector</code> in the Job. The fields are immutable, so the <code>ManifestWork</code> will report <code>AppliedManifestFailed</code>
when we apply a Job without <code>spec.Selector</code> using <code>ManifestWork</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>exmaple-job</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>batch/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Job</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perl:5.34.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>command</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;perl&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#4e9a06>&#34;-Mbignum=bpi&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;-wle&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;print bpi(2000)&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>restartPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Never</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>backoffLimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>There are 2 options to fix this issue.</p><ol><li>Specify the fields manually if they are configurable. For example, set <code>spec.manualSelector=true</code> and your own labels
in the <code>spec.selector</code> of the Job, and set the same labels for the containers.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>exmaple-job-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>batch/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Job</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>manualSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>job</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>job</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perl:5.34.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>command</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;perl&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#4e9a06>&#34;-Mbignum=bpi&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;-wle&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;print bpi(2000)&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>restartPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Never</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>backoffLimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ol start=2><li>Set the <a href=/docs/concepts/work-distribution/manifestwork/#resource-race-and-adoption>updateStrategy ServerSideApply</a> in the <code>ManifestWork</code> for the API.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>exmaple-job</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>manifestConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>resourceIdentifier</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>batch</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>updateStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServerSideApply</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>batch/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Job</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perl:5.34.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>command</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;perl&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#4e9a06>&#34;-Mbignum=bpi&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;-wle&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;print bpi(2000)&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>restartPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Never</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>backoffLimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=dynamic-identity-authorization>Dynamic identity authorization</h2><p>All manifests in <code>ManifestWork</code> are applied by the work-agent using the mounted service account to raise requests
against the managed cluster by default. And the work agent has very high permission to access the managed cluster which
means that any hub user with write access to the <code>ManifestWork</code> resources will be able to dispatch any resources that
the work-agent can manipulate to the managed cluster.</p><p>The executor subject feature(introduced in release <code>0.9.0</code>) provides a way to clarify the owner identity(executor) of the <code>ManifestWork</code> before it
takes effect so that we can explicitly check whether the executor has sufficient permission in the managed cluster.</p><p>The following example clarifies the owner &ldquo;executor1&rdquo; of the <code>ManifestWork</code>, so before the work-agent applies the
&ldquo;default/test&rdquo; <code>ConfigMap</code> to the managed cluster, it will first check whether the <code>ServiceAccount</code> &ldquo;default/executor&rdquo;
has the permission to apply this <code>ConfigMap</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-manifestwork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>executor</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>subject</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>serviceAccount</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>executor1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>a</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>b</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ConfigMap</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Not any hub user can specify any executor at will. Hub users can only use the executor for which they have an
<code>execute-as</code>(virtual verb) permission. For example, hub users bound to the following Role can use the &ldquo;executor1&rdquo;
<code>ServiceAccount</code> in the &ldquo;default&rdquo; namespace on the managed cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Role</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1-executor1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>work.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>manifestworks</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>execute-as</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceNames</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>system:serviceaccount:default:executor1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>For backward compatibility, if the executor is absent, the work agent will keep using the mounted service account to
apply resources. But using the executor is encouraged, so we have a feature gate <code>NilExecutorValidating</code> to control
whether any hub user is allowed to not set the executor. It is disabled by default, we can use the following
configuration to the <code>ClusterManager</code> to enable it. When it is enabled, not setting executor will be regarded as using
the &ldquo;/klusterlet-work-sa&rdquo; (namespace is empty, name is klusterlet-work-sa) virtual service account on the managed
cluster for permission verification, which means only hub users with &ldquo;execute-as&rdquo; permissions on the
&ldquo;system:serviceaccount::klusterlet-work-sa&rdquo; <code>ManifestWork</code> are allowed not to set the executor.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workConfiguration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>featureGates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>feature</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NilExecutorValidating</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Enable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Work-agent uses the SubjectAccessReview API to check whether an executor has permission to the manifest resources, which
will cause a large number of SAR requests to the managed cluster API-server, so we provided a new feature gate
<code>ExecutorValidatingCaches</code>(in release <code>0.10.0</code>) to cache the result of the executor&rsquo;s permission to the manifest
resource, it is only works when the managed cluster uses
<a href=https://kubernetes.io/docs/reference/access-authn-authz/authorization/#authorization-modules>RBAC mode authorization</a>,
and is disabled by default as well, but can be enabled by using the following configuration for <code>Klusterlet</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workConfiguration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>featureGates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>feature</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ExecutorValidatingCaches</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Enable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Enhancement proposal: <a href=https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/34-work-executor-group>Work Executor Group</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-b4402ea2915b78dbda7c88fa11132bd9>1.3.2 - ManifestWorkReplicaSet</h1><h2 id=what-is-manifestworkreplicaset>What is <code>ManifestWorkReplicaSet</code></h2><p><code>ManifestWorkReplicaSet</code> is an aggregator API that uses <a href=https://github.com/open-cluster-management-io/open-cluster-management-io.github.io/blob/main/content/en/concepts/manifestwork.md>Manifestwork</a> and <a href=https://github.com/open-cluster-management-io/open-cluster-management-io.github.io/blob/main/content/en/concepts/placement.md>Placement</a> to create manifestwork for the placement-selected clusters.</p><p>View an example of <code>ManifestWorkReplicaSet</code> to deploy a CronJob and Namespace for a group of clusters selected by placements.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWorkReplicaSet</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>mwrset-cronjob</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ocm-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placementRefs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-rollout-all</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Name of a created Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>rolloutType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>All</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-rollout-progressive</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Name of a created Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>rolloutType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>progressive</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>minSuccessTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>5m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>progressDeadline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>maxFailures</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000>%</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;prod-canary-west&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;prod-canary-east&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-rollout-progressive-per-group</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Name of a created Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>rolloutType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ProgressivePerGroup</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>progressivePerGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>progressDeadline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>maxFailures</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>manifestWorkTemplate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>deleteOption</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>propagationPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SelectivelyOrphan</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>selectivelyOrphans</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>orphaningRules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ocm-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>manifestConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>feedbackRules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>jsonPaths</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>lastScheduleTime</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>.status.lastScheduleTime</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>lastSuccessfulTime</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>.status.lastSuccessfulTime</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JSONPaths</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resourceIdentifier</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>batch</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sync-cronjob</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ocm-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cronjobs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ocm-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CronJob</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>batch/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sync-cronjob</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ocm-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>schedule</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;* * * * *&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>concurrencyPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Allow</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>suspend</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>jobTemplate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>backoffLimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;quay.io/prometheus/busybox:latest&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span><span style=color:#204a87;font-weight:700>args</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                          </span>- <span style=color:#000>/bin/sh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                          </span>- <span style=color:#4e9a06>&#39;-c&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                          </span>- <span style=color:#000>date; echo Hello from the Kubernetes cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <strong>PlacementRefs</strong> uses the Rollout Strategy <a href=https://github.com/open-cluster-management-io/api/blob/main/cluster/v1alpha1/types_rolloutstrategy.go>API</a> to apply the manifestWork to the selected clusters.
In the example above; the placementRefs refers to three placements; placement-rollout-all, placement-rollout-progressive and placement-rollout-progressive-per-group. For more info regards the rollout strategies check the Rollout Strategy section at the <a href=https://github.com/open-cluster-management-io/open-cluster-management-io.github.io/blob/main/content/en/concepts/placement.md>placement</a> document.
<strong>Note:</strong> The placement reference must be in the same namespace as the manifestWorkReplicaSet.</p><h2 id=status-tracking>Status tracking</h2><p>The ManifestWorkReplicaSet example above refers to three placements each one will have its placementSummary in ManifestWorkReplicaSet status. The PlacementSummary shows the number of manifestWorks applied to the placement&rsquo;s clusters based on the placementRef&rsquo;s rolloutStrategy and total number of clusters.
The manifestWorkReplicaSet Summary aggregate the placementSummaries showing the total number of applied manifestWorks to all clusters.</p><p>The manifestWorkReplicaSet has three status conditions;</p><ol><li><strong>PlacementVerified</strong> verify the placementRefs status; not exist or empty cluster selection.</li><li><strong>PlacementRolledOut</strong> verify the rollout strategy status; progressing or complete.</li><li><strong>ManifestWorkApplied</strong> verify the created manifestWork status; applied, progressing, degraded or available.</li></ol><p>The manifestWorkReplicaSet determine the ManifestWorkApplied condition status based on the resource state (applied or available) of each manifestWork.</p><p>Here is an example.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWorkReplicaSet</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>mwrset-cronjob</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ocm-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placementRefs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-rollout-all</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-rollout-progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-rollout-progressive-per-group</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>manifestWorkTemplate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;2023-04-27T02:30:54Z&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AsExpected</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;True&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PlacementVerified</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;2023-04-27T02:30:54Z&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressing</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;False&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PlacementRolledOut</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;2023-04-27T02:30:54Z&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AsExpected</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;True&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestworkApplied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>placementSummary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-rollout-all</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>availableDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>(10 / 10 clusters applied)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>applied</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>available</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>progressing</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>degraded</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>total</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-rollout-progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>availableDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>(20 / 30 clusters applied)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>applied</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>available</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>progressing</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>degraded</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>total</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-rollout-progressive-per-group</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>availableDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>(15 / 20 clusters applied)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>applied</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>available</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>progressing</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>degraded</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>total</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>applied</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>45</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>available</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>45</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>progressing</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>degraded</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>total</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>45</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=release-and-enable-feature>Release and Enable Feature</h2><p>ManifestWorkReplicaSet is in alpha release and it is not enabled by default. In order to enable the ManifestWorkReplicaSet feature, it has to be enabled in the cluster-manager instance in the hub. Use the following command to edit the cluster-manager CR (custom resource) in the hub cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ oc edit ClusterManager cluster-manager
</span></span></code></pre></div><p>Add the workConfiguration field to the cluster-manager CR as below and save.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManager</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster-manager</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workConfiguration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>featureGates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>feature</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWorkReplicaSet</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Enable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In order to assure the ManifestWorkReplicaSet has been enabled successfully check the cluster-manager using the command below</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ oc get ClusterManager cluster-manager -o yml
</span></span></code></pre></div><p>You should find under the status->generation the cluster-manager-work-controller deployment has been added as below</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManager</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster-manager</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>generations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>lastGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster-manager-work-webhook</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-hub</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deployments</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>lastGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster-manager-work-controller</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-hub</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deployments</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-dae5d69537fee30ac5da188ebdb9dc77>1.4 - Content Placement</h1></div><div class=td-content><h1 id=pg-4b7a58ca36f84688e0a1acb2ba0f42ec>1.4.1 - Placement</h1><p><strong>CHANGE NOTE</strong>:</p><ul><li><p>The <code>Placement</code> and <code>PlacementDecision</code> API v1alpha1 version will no longer be served in OCM v0.9.0.</p><ul><li>Migrate manifests and API clients to use the <code>Placement</code> and <code>PlacementDecision</code> API v1beta1 version, available since OCM v0.7.0.</li><li>All existing persisted objects are accessible via the new API.</li><li>Notable changes:<ul><li>The field <code>spec.prioritizerPolicy.configurations.name</code> in <code>Placement</code> API v1alpha1 is removed and replaced by
<code>spec.prioritizerPolicy.configurations.scoreCoordinate.builtIn</code> in v1beta1.</li></ul></li></ul></li><li><p>Clusters in terminating state will not be selected by placements from OCM v0.14.0.</p></li></ul><h2 id=overall>Overall</h2><p><code>Placement</code> concept is used to dynamically select a set of <a href=/docs/concepts/cluster-inventory/managedcluster/>managedClusters</a>
in one or multiple <a href=/docs/concepts/cluster-inventory/managedclusterset/>ManagedClusterSet</a> so that higher level
users can either replicate Kubernetes resources to the member clusters or run
their advanced workload i.e. <strong>multi-cluster scheduling</strong>.</p><p>The &ldquo;input&rdquo; and &ldquo;output&rdquo; of the scheduling process are decoupled into two
separated Kubernetes API <code>Placement</code> and <code>PlacementDecision</code>. As is shown in
the following picture, we prescribe the scheduling policy in the spec of
<code>Placement</code> API and the placement controller in the hub will help us to
dynamically select a slice of managed clusters from the given cluster sets.
The selected clusters will be listed in <code>PlacementDecision</code>.</p><div style=text-align:center;padding:20px><img src=/placement-explain.png alt=Placement style="margin:0 auto;width:60%"></div><p>Following the architecture of Kubernetes&rsquo; original scheduling framework, the
multi-cluster scheduling is logically divided into two phases internally:</p><ul><li><strong>Predicate</strong>: Hard requirements for the selected clusters.</li><li><strong>Prioritize</strong>: Rank the clusters by the soft requirements and select a subset
among them.</li></ul><h2 id=select-clusters-in-managedclusterset>Select clusters in ManagedClusterSet</h2><p>By following <a href=/docs/concepts/cluster-inventory/managedclusterset/>the previous section</a> about
<code>ManagedClusterSet</code>, now we&rsquo;re supposed to have one or multiple valid cluster
sets in the hub clusters. Then we can move on and create a placement in the
&ldquo;workspace namespace&rdquo; by specifying <code>predicates</code> and <code>prioritizers</code> in the
<code>Placement</code> API to define our own multi-cluster scheduling policy.</p><p><strong>Notes</strong>:</p><ul><li>Clusters in terminating state will not be selected by placements.</li></ul><h3 id=predicates>Predicates</h3><p>In the <code>predicates</code> section, you can select clusters by labels, <a href=/docs/concepts/cluster-inventory/clusterclaim/>clusterClaims</a>, or CEL expressions.</p><h4 id=label-or-clusterclaim-selection>Label or ClusterClaim Selection</h4><p>For instance, you can select 3 clusters with label <code>purpose=test</code> and
clusterClaim <code>platform.open-cluster-management.io=aws</code> as seen in the following
examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ns1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterSets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>prod</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>predicates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>requiredClusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>purpose</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>claimSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>matchExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>platform.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>In</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>values</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#000>aws</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Note that the distinction between label-selecting and claim-selecting is
elaborated in <a href=https://open-cluster-management.io/docs/scenarios/extending-managed-clusters/>this page</a>
about how to extend attributes for the managed clusters.</p><h4 id=cel-expression-selection>CEL Expression Selection</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ns1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterSets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>prod</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>predicates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>requiredClusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>celSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>celExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># Select clusters by Kubernetes version listed in managedCluster.Status.version.kubernetes.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#000>managedCluster.status.version.kubernetes == &#34;v1.31.0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># Select clusters by info stored in clusterClaims.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#000>managedCluster.status.clusterClaims.exists(c, c.name == &#34;kubeversion.open-cluster-management.io&#34; &amp;&amp; c.value == &#34;v1.31.0&#34;)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># Use CEL Standard macros and Standard functions on the managedCluster fields.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#000>managedCluster.metadata.labels[&#34;version&#34;].matches(&#39;^1\\.(30|31)\\.\\d+$&#39;)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># Use Kubernetes semver library functions isLessThan and isGreaterThan to select clusters by version comparison. </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#000>semver(managedCluster.metadata.labels[&#34;version&#34;]).isGreaterThan(semver(&#34;1.30.0&#34;)) </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># Use OCM customized function scores to select clusters by AddonPlacementScore.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#000>managedCluster.scores(&#34;resource-usage-score&#34;).filter(s, s.name == &#39;memNodeAvailable&#39;).all(e, e.value &gt; 0)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The CEL expressions provide more flexible and powerful selection capabilities with <a href=https://github.com/open-cluster-management-io/sdk-go/blob/main/pkg/cel/common/values.go>built-in libraries</a>. For more detailed usage of CEL expressions, refer to:</p><ul><li><a href=https://kubernetes.io/docs/reference/using-api/cel/>Kubernetes CEL Documentation</a></li><li><a href=https://github.com/open-cluster-management-io/sdk-go/tree/main/pkg/cel/library>OCM CEL Library</a></li></ul><h4 id=taintstolerations>Taints/Tolerations</h4><p>To support filtering unhealthy/not-reporting clusters and keep workloads from
being placed in unhealthy or unreachable clusters, we introduce the similar
concept of taint/toleration in Kubernetes. It also allows user to add a
customized taint to deselect a cluster from placement. This is useful when the
user wants to set a cluster to maintenance mode and evict workload from this
cluster.</p><p>In OCM, Taints and Tolerations work together to allow users to control the
selection of managed clusters more flexibly.</p><p><a href=/docs/concepts/cluster-inventory/managedcluster/#cluster-taints-and-tolerations>Taints</a> are properties of
ManagedClusters, they allow a Placement to repel a set of ManagedClusters in
predicates stage.</p><p>Tolerations are applied to Placements, and allow Placements to select
ManagedClusters with matching taints.</p><p>The following example shows how to tolerate clusters with taints.</p><ul><li><p>Tolerate clusters with taint</p><p>Suppose your managed cluster has taint added as below.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedCluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>hubAcceptsClient</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>taints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>effect</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NoSelect</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gpu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>timeAdded</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;2022-02-21T08:11:06Z&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>By default, the placement won&rsquo;t select this cluster unless you define tolerations.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ns1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>tolerations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gpu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Equal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>With the above tolerations defined, cluster1 could be selected by placement
because of the <code>key: gpu</code> and <code>value: "true"</code> match.</p></li><li><p>Tolerate clusters with taint for a period of time</p><p><code>TolerationSeconds</code> represents the period of time the toleration tolerates the
taint. It could be used for the case like, when a managed cluster gets offline,
users can make applications deployed on this cluster to be transferred to
another available managed cluster after a tolerated time.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedCluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>hubAcceptsClient</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>taints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>effect</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NoSelect</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/unreachable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>timeAdded</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;2022-02-21T08:11:06Z&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>If define a placement with <code>TolerationSeconds</code> as below, then the workload will
be transferred to another available managed cluster after 5 minutes.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ns1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>tolerations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/unreachable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exists</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>tolerationSeconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>300</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li></ul><p>In <code>tolerations</code> section, it includes the
following fields:</p><ul><li><strong>Key</strong> (optional). Key is the taint key that the toleration applies to.</li><li><strong>Value</strong> (optional). Value is the taint value the toleration matches to.</li><li><strong>Operator</strong> (optional). Operator represents a key&rsquo;s relationship to the
value. Valid operators are <code>Exists</code> and <code>Equal</code>. Defaults to <code>Equal</code>. A
toleration &ldquo;matches&rdquo; a taint if the keys are the same and the effects are the
same, and the operator is:<ul><li><code>Equal</code>. The operator is Equal and the values are equal.</li><li><code>Exists</code>. Exists is equivalent to wildcard for value, so that a placement
can tolerate all taints of a particular category.</li></ul></li><li><strong>Effect</strong> (optional). Effect indicates the taint effect to match. Empty means
match all taint effects. When specified, allowed values are <code>NoSelect</code>,
<code>PreferNoSelect</code> and <code>NoSelectIfNew</code>. (<code>PreferNoSelect</code> is not implemented yet,
currently clusters with effect <code>PreferNoSelect</code> will always be selected.)</li><li><strong>TolerationSeconds</strong> (optional). TolerationSeconds represents the period of
time the toleration (which must be of effect <code>NoSelect</code>/<code>PreferNoSelect</code>,
otherwise this field is ignored) tolerates the taint. The default value is nil,
which indicates it tolerates the taint forever. The start time of counting the
TolerationSeconds should be the <code>TimeAdded</code> in Taint, not the cluster scheduled
time or <code>TolerationSeconds</code> added time.</li></ul><h3 id=prioritizers>Prioritizers</h3><h4 id=score-based-prioritizer>Score-based prioritizer</h4><p>In <code>prioritizerPolicy</code> section, you can define the policy of prioritizers.</p><p>The following example shows how to select clusters with prioritizers.</p><ul><li><p>Select a cluster with the largest allocatable memory.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ns1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>prioritizerPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>configurations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>scoreCoordinate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>builtIn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceAllocatableMemory</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The prioritizer policy has default mode additive and default prioritizers <code>Steady</code> and <code>Balance</code>.</p><p>In the above example, the prioritizers actually come into effect are <code>Steady</code>, <code>Balance</code> and <code>ResourceAllocatableMemory</code>.</p><p>And the end of this section has more description about the prioritizer policy mode and default prioritizers.</p></li><li><p>Select a cluster with the largest allocatable CPU and memory, and make placement sensitive to resource changes.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ns1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>prioritizerPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>configurations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>scoreCoordinate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>builtIn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceAllocatableCPU</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>scoreCoordinate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>builtIn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceAllocatableMemory</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The prioritizer policy has default mode additive and default prioritizers <code>Steady</code> and <code>Balance</code>, and their default
weight is 1.</p><p>In the above example, the prioritizers actually come into effect are <code>Steady</code> with weight 1, <code>Balance</code> with weight 1,
<code>ResourceAllocatableCPU</code> with weight 2 and <code>ResourceAllocatableMemory</code> with weight 2. The cluster score will be a
combination of the 4 prioritizers score. Since <code>ResourceAllocatableCPU</code> and <code>ResourceAllocatableMemory</code> have higher
weight, they will be weighted more in the results, and make placement sensitive to resource changes.</p><p>And the end of this section has more description about the prioritizer weight and how the final score is calculated.</p></li><li><p>Select two clusters with the largest addon score CPU ratio, and pin the placement decisions.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ns1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>prioritizerPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exact</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>configurations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>scoreCoordinate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>builtIn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Steady</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>scoreCoordinate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>addOn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>resourceName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>scoreName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cpuratio</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In the above example, explicitly define the mode as exact. The prioritizers actually come into effect are <code>Steady</code> with
weight 3 and addon score cpuratio with weight 1. Go into the <a href=/docs/concepts/content-placement/placement/#extensible-scheduling>Extensible scheduling</a> section
to learn more about addon score.</p></li></ul><p>In <code>prioritizerPolicy</code> section, it includes the following fields:</p><ul><li><code>mode</code> is either <code>Exact</code>, <code>Additive</code> or <code>""</code>, where <code>""</code> is <code>Additive</code> by default.<ul><li>In <code>Additive</code> mode, any prioritizer not explicitly enumerated is enabled
in its default <code>Configurations</code>, in which <code>Steady</code> and <code>Balance</code> prioritizers have
the weight of 1 while other prioritizers have the weight of 0. <code>Additive</code>
doesn&rsquo;t require configuring all prioritizers. The default <code>Configurations</code> may
change in the future, and additional prioritization will happen.</li><li>In <code>Exact</code> mode, any prioritizer not explicitly enumerated is weighted as
zero. <code>Exact</code> requires knowing the full set of prioritizers you want, but
avoids behavior changes between releases.</li></ul></li><li><code>configurations</code> represents the configuration of prioritizers.<ul><li><code>scoreCoordinate</code> represents the configuration of the prioritizer and
score source.<ul><li><code>type</code> defines the type of the prioritizer score.
Type is either <code>BuiltIn</code>, <code>AddOn</code> or &ldquo;&rdquo;, where "" is <code>BuiltIn</code> by default.
When the type is <code>BuiltIn</code>, a <code>BuiltIn</code> prioritizer name must be specified.
When the type is <code>AddOn</code>, need to configure the score source in <code>AddOn</code>.<ul><li><code>builtIn</code> defines the name of a <code>BuiltIn</code> prioritizer. Below are the
valid <code>BuiltIn</code> prioritizer names.<ul><li><code>Balance</code>: balance the decisions among the clusters.</li><li><code>Steady</code>: ensure the existing decision is stabilized.</li><li><code>ResourceAllocatableCPU</code>: sort clusters based on the allocatable CPU.</li><li><code>ResourceAllocatableMemory</code>: sort clusters based on the allocatable memory.</li></ul></li><li><code>addOn</code> defines the resource name and score name.
<code>AddOnPlacementScore</code> is introduced to describe addon scores, go into
the <a href=/docs/concepts/content-placement/placement/#extensible-scheduling>Extensible scheduling</a> section to learn
more about it.<ul><li><code>resourceName</code> defines the resource name of the
<code>AddOnPlacementScore</code>. The placement prioritizer selects
<code>AddOnPlacementScore</code> CR by this name.</li><li><code>scoreName</code> defines the score name inside <code>AddOnPlacementScore</code>.
<code>AddOnPlacementScore</code> contains a list of score name and score value,
<code>scoreName</code> specifies the score to be used by the prioritizer.</li></ul></li></ul></li></ul></li><li><code>weight</code> defines the weight of the prioritizer. The value must be ranged in
[-10,10].
Each prioritizer will calculate an integer score of a cluster in the range
of [-100, 100]. The final score of a cluster will be sum(weight *
prioritizer_score).
A higher weight indicates that the prioritizer weights more in the cluster
selection, while 0 weight indicates that the prioritizer is disabled. A
negative weight indicates wanting to select the last ones.</li></ul></li></ul><h4 id=extensible-scheduling>Extensible scheduling</h4><p>In placement resource based scheduling, in some cases the prioritizer needs
extra data (more than the default value provided by ManagedCluster) to calculate
the score of the managed cluster. For example, schedule the clusters based on
cpu or memory usage data of the clusters fetched from a monitoring system.</p><p>So we provide a new API <code>AddOnPlacementScore</code> to support a more extensible way
to schedule based on customized scores.</p><ul><li>As a user, as mentioned in the above section, can specify the score in
placement yaml to select clusters.</li><li>As a score provider, a 3rd party controller could run on either hub or managed
cluster, to maintain the lifecycle of <code>AddOnPlacementScore</code> and update score
into it.</li></ul><p><a href=https://open-cluster-management.io/docs/scenarios/extend-multicluster-scheduling-capabilities/>Extend the multi-cluster scheduling capabilities with placement</a>
introduces how to implement a customized score provider.</p><p>Refer to the
<a href=https://github.com/open-cluster-management-io/enhancements/blob/main/enhancements/sig-architecture/32-extensiblescheduling/32-extensiblescheduling.md>enhancements</a>
to learn more.</p><h2 id=placementdecisions>PlacementDecisions</h2><p>A slice of <code>PlacementDecision</code> will be created by placement controller in the
same namespace, each with a label of
<code>cluster.open-cluster-management.io/placement={placement name}</code>.
<code>PlacementDecision</code> contains the results of the cluster selection as seen in the
following examples.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PlacementDecision</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>cluster.open-cluster-management.io/placement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement1-decision-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>decisions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>status.decisions</code> lists the top N clusters with the highest score and ordered
by names. The <code>status.decisions</code> changes over time, the scheduling result update
based on what endpoints exist.</p><p>The scheduling result in the <code>PlacementDecision</code> API is designed to
be paginated with its page index as the name&rsquo;s suffix to avoid &ldquo;too large
object&rdquo; issue from the underlying Kubernetes API framework.</p><p><code>PlacementDecision</code> can be consumed by another operand to decide how the
workload should be placed in multiple clusters.</p><h3 id=decision-strategy>Decision strategy</h3><p>The <code>decisionStrategy</code> section of <code>Placement</code> can be used to divide the created
<code>PlacementDecision</code> into groups and define the number of clusters per decision group.</p><p>Assume an environment has 310 clusters, 10 of which have the label prod-canary-west
and 10 have the label prod-canary-east. The following example demonstrates how to group
the clusters with the labels prod-canary-west and prod-canary-east into 2 groups, and
group the remaining clusters into groups with a maximum of 150 clusters each.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterSets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>global</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>decisionStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>groupStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>clustersPerDecisionGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>150</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>decisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod-canary-west</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>groupClusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>matchExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod-canary-west</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exists</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod-canary-east</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>groupClusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>matchExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod-canary-east</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exists</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>decisionStrategy</code> section includes the following fields:</p><ul><li><code>decisionGroups</code>: Represents a list of predefined groups to put decision results.
Decision groups will be constructed based on the <code>decisionGroups</code> field at first.
The clusters not included in the <code>decisionGroups</code> will be divided to other decision
groups afterwards. Each decision group should not have the number of clusters
larger than the <code>clustersPerDecisionGroup</code>.<ul><li><code>groupName</code>: Represents the name to be added as the value of label key <code>cluster.open-cluster-management.io/decision-group-name</code>
of created <code>PlacementDecisions</code>.</li><li><code>groupClusterSelector</code>: Defines the label selector to select clusters subset by label.</li></ul></li><li><code>clustersPerDecisionGroup</code>: A specific number or percentage of the total selected
clusters. The specific number will divide the placementDecisions to decisionGroups,
the max number of clusters in each group equal to that specific number.</li></ul><p>With this decision strategy defined, the placement status will list the group result,
including the decision group name and index, the cluster count, and the corresponding
<code>PlacementDecision</code> names.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>decisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>clusterCount</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisionGroupIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisionGroupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod-canary-west</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>placement1-decision-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>clusterCount</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisionGroupIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisionGroupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod-canary-east</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>placement1-decision-2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>clusterCount</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>150</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisionGroupIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisionGroupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>placement1-decision-3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>placement1-decision-4</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>clusterCount</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>140</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisionGroupIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisionGroupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>placement1-decision-5</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>placement1-decision-6</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>numberOfSelectedClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>310</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>PlacementDecision</code> will have labels <code>cluster.open-cluster-management.io/decision-group-name</code>
and <code>cluster.open-cluster-management.io/decision-group-index</code> to indicate which group name
and group index it belongs to.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PlacementDecision</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>cluster.open-cluster-management.io/placement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>cluster.open-cluster-management.io/decision-group-index</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>cluster.open-cluster-management.io/decision-group-name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod-canary-west</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement1-decision-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=rollout-strategy>Rollout Strategy</h3><p>Rollout Strategy <a href=https://github.com/open-cluster-management-io/api/blob/main/cluster/v1alpha1/types_rolloutstrategy.go>API</a> facilitate the use of placement decision strategy with OCM workload applier APIs such as Policy, <a href=/docs/concepts/add-on-extensibility/addon/#rollout-strategy>Addon</a> and <a href=/docs/concepts/work-distribution/manifestworkreplicaset/>ManifestWorkReplicaSet</a> to apply workloads.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-example</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>progressive</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;prod-canary-west&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;prod-canary-east&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>maxConcurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#000>%</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>minSuccessTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>5m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>progressDeadline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>maxFailures</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The Rollout Strategy API provides three rollout types;</p><ol><li><strong>All</strong>: means apply the workload to all clusters in the decision groups at once.</li><li><strong>Progressive</strong>: means apply the workload to the selected clusters progressively per cluster. The workload will not be applied to the next cluster unless one of the current applied clusters reach the successful state and haven&rsquo;t breached the MaxFailures configuration.</li><li><strong>ProgressivePerGroup</strong>: means apply the workload to decisionGroup clusters progressively per group. The workload will not be applied to the next decisionGroup unless all clusters in the current group reach the successful state and haven&rsquo;t breached the MaxFailures configuration.</li></ol><p>The RollOut Strategy API also provides rollOut config to fine-tune the workload apply progress based on the use-case requirements;</p><ol><li><strong>MinSuccessTime</strong>: defined in seconds/minutes/hours for how long workload applier controller will wait from the beginning of the rollout to proceed with the next rollout, assuming a successful state had been reached and MaxFailures hasn&rsquo;t been breached. Default is 0 meaning the workload applier proceeds immediately after a successful state is reached.</li><li><strong>ProgressDeadline</strong>: defined in seconds/minutes/hours for how long workload applier controller will wait until the workload reaches a successful state in the spoke cluster.
If the workload does not reach a successful state after ProgressDeadline, the controller will stop waiting and workload will be treated as &ldquo;timeout&rdquo; and be counted into MaxFailures. Once the MaxFailures is breached, the rollout will stop. Default value is &ldquo;None&rdquo;, meaning the workload applier will wait for a successful state indefinitely.</li><li><strong>MaxFailures</strong>: defined as the maximum percentage of or number of clusters that can fail in order to proceed with the rollout. Fail means the cluster has a failed status or timeout status (does not reach successful status after ProgressDeadline). Once the MaxFailures is breached, the rollout will stop. Default is 0 means that no failures are tolerated.</li><li><strong>MaxConcurrency</strong>: is the max number of clusters to deploy workload concurrently. The MaxConcurrency can be defined only in case rollout type is progressive.</li><li><strong>MandatoryDecisionGroups</strong>: is a list of decision groups to apply the workload first. If mandatoryDecisionGroups not defined the decision group index is considered to apply the workload in groups by order. The MandatoryDecisionGroups can be defined only in case rollout type is progressive or progressivePerGroup.</li></ol><h2 id=troubleshooting>Troubleshooting</h2><p>If no <code>PlacementDecision</code> generated after you creating <code>Placement</code>, you can run below commands to troubleshoot.</p><h3 id=check-the-placement-conditions>Check the <code>Placement</code> conditions</h3><p>For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl describe placement &lt;placement-name&gt;
</span></span><span style=display:flex><span>Name:         demo-placement
</span></span><span style=display:flex><span>Namespace:    default
</span></span><span style=display:flex><span>Labels:       &lt;none&gt;
</span></span><span style=display:flex><span>Annotations:  &lt;none&gt;
</span></span><span style=display:flex><span>API Version:  cluster.open-cluster-management.io/v1beta1
</span></span><span style=display:flex><span>Kind:         Placement
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Status:
</span></span><span style=display:flex><span>  Conditions:
</span></span><span style=display:flex><span>    Last Transition Time:       2022-09-30T07:39:45Z
</span></span><span style=display:flex><span>    Message:                    Placement configurations check pass
</span></span><span style=display:flex><span>    Reason:                     Succeedconfigured
</span></span><span style=display:flex><span>    Status:                     False
</span></span><span style=display:flex><span>    Type:                       PlacementMisconfigured
</span></span><span style=display:flex><span>    Last Transition Time:       2022-09-30T07:39:45Z
</span></span><span style=display:flex><span>    Message:                    No valid ManagedClusterSetBindings found in placement namespace
</span></span><span style=display:flex><span>    Reason:                     NoManagedClusterSetBindings
</span></span><span style=display:flex><span>    Status:                     False
</span></span><span style=display:flex><span>    Type:                       PlacementSatisfied
</span></span><span style=display:flex><span>  Number Of Selected Clusters:  <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>The Placement has 2 types of condition, <code>PlacementMisconfigured</code> and <code>PlacementSatisfied</code>.</p><ul><li>If the condition <code>PlacementMisconfigured</code> is true, means your placement has configuration errors, the message tells you more details about the failure.</li><li>If the condition <code>PlacementSatisfied</code> is false, means no <code>ManagedCluster</code> satisfy this placement, the message tells you more details about the failure.
In this example, it is because no <code>ManagedClusterSetBindings</code> found in placement namespace.</li></ul><h3 id=check-the-placement-events>Check the <code>Placement</code> events</h3><p>For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl describe placement &lt;placement-name&gt;
</span></span><span style=display:flex><span>Name:         demo-placement
</span></span><span style=display:flex><span>Namespace:    default
</span></span><span style=display:flex><span>Labels:       &lt;none&gt;
</span></span><span style=display:flex><span>Annotations:  &lt;none&gt;
</span></span><span style=display:flex><span>API Version:  cluster.open-cluster-management.io/v1beta1
</span></span><span style=display:flex><span>Kind:         Placement
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Events:
</span></span><span style=display:flex><span>  Type    Reason          Age   From                 Message
</span></span><span style=display:flex><span>  ----    ------          ----  ----                 -------
</span></span><span style=display:flex><span>  Normal  DecisionCreate  2m10s   placementController  Decision demo-placement-decision-1 is created with placement demo-placement in namespace default
</span></span><span style=display:flex><span>  Normal  DecisionUpdate  2m10s   placementController  Decision demo-placement-decision-1 is updated with placement demo-placement in namespace default
</span></span><span style=display:flex><span>  Normal  ScoreUpdate     2m10s   placementController  cluster1:0 cluster2:100 cluster3:200
</span></span><span style=display:flex><span>  Normal  DecisionUpdate  3s      placementController  Decision demo-placement-decision-1 is updated with placement demo-placement in namespace default
</span></span><span style=display:flex><span>  Normal  ScoreUpdate     3s      placementController  cluster1:200 cluster2:145 cluster3:189 cluster4:200
</span></span></code></pre></div><p>The placement controller will give a score to each filtered <code>ManagedCluster</code> and generate an event for it. When the cluster score
changes, a new event will generate. You can check the score of each cluster in the <code>Placment</code> events, to know why some clusters with lower score are not selected.</p><h3 id=debug>Debug</h3><p>If you want to know more defails of how clusters are selected in each step, can following below step to access the debug endpoint.</p><p>Create clusterrole &ldquo;debugger&rdquo; to access debug path and bind this to anonymous user.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create clusterrole <span style=color:#4e9a06>&#34;debugger&#34;</span> --verb<span style=color:#ce5c00;font-weight:700>=</span>get --non-resource-url<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/debug/*&#34;</span>
</span></span><span style=display:flex><span>kubectl create clusterrolebinding debugger --clusterrole<span style=color:#ce5c00;font-weight:700>=</span>debugger --user<span style=color:#ce5c00;font-weight:700>=</span>system:anonymous
</span></span></code></pre></div><p>Export placement 8443 port to local.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl port-forward -n open-cluster-management-hub deploy/cluster-manager-placement-controller 8443:8443
</span></span></code></pre></div><p>Curl below url to debug one specific placement.</p><pre tabindex=0><code>curl -k  https://127.0.0.1:8443/debug/placements/&lt;namespace&gt;/&lt;name&gt;
</code></pre><p>For example, the environment has a <code>Placement</code> named placement1 in default namespace, which selects 2 <code>ManagedClusters</code>, the output would be like:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl -k  https://127.0.0.1:8443/debug/placements/default/placement1
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;filteredPiplieResults&#34;</span>:<span style=color:#ce5c00;font-weight:700>[{</span><span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;Predicate&#34;</span>,<span style=color:#4e9a06>&#34;filteredClusters&#34;</span>:<span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;cluster1&#34;</span>,<span style=color:#4e9a06>&#34;cluster2&#34;</span><span style=color:#ce5c00;font-weight:700>]}</span>,<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;Predicate,TaintToleration&#34;</span>,<span style=color:#4e9a06>&#34;filteredClusters&#34;</span>:<span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;cluster1&#34;</span>,<span style=color:#4e9a06>&#34;cluster2&#34;</span><span style=color:#ce5c00;font-weight:700>]}]</span>,<span style=color:#4e9a06>&#34;prioritizeResults&#34;</span>:<span style=color:#ce5c00;font-weight:700>[{</span><span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;Balance&#34;</span>,<span style=color:#4e9a06>&#34;weight&#34;</span>:1,<span style=color:#4e9a06>&#34;scores&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;cluster1&#34;</span>:100,<span style=color:#4e9a06>&#34;cluster2&#34;</span>:100<span style=color:#ce5c00;font-weight:700>}}</span>,<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;Steady&#34;</span>,<span style=color:#4e9a06>&#34;weight&#34;</span>:1,<span style=color:#4e9a06>&#34;scores&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;cluster1&#34;</span>:100,<span style=color:#4e9a06>&#34;cluster2&#34;</span>:100<span style=color:#ce5c00;font-weight:700>}}]}</span>
</span></span></code></pre></div><h2 id=future-work>Future work</h2><p>In addition to selecting cluster by predicates, we are still working on other
advanced features including</p><ul><li><a href=https://github.com/open-cluster-management-io/community/issues/49>Various workload spread
policies</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-bae1486ef9ae185ca5360239b8ddfd39>1.5 - Add-On Extensibility</h1><p>All available Add-Ons are listed in the <a href=https://open-cluster-management.io/docs/getting-started/integration/>Add-ons and Integrations</a> section.</p></div><div class=td-content><h1 id=pg-6b1c6790b84f69cffc0ab556de446740>1.5.1 - Add-ons</h1><h2 id=what-is-an-add-on>What is an add-on?</h2><p>Open-cluster-management has a built-in mechanism named <a href=https://github.com/open-cluster-management-io/addon-framework>addon-framework</a>
to help developers to develop an extension based on the foundation components
for the purpose of working with multiple clusters in custom cases. A typical
addon should consist of two kinds of components:</p><ul><li><p><strong>Addon Agent</strong>: A kubernetes controller <em>in the managed cluster</em> that manages
the managed cluster for the hub admins. A typical addon agent is expected to
be working by subscribing the prescriptions (e.g. in forms of CustomResources)
from the hub cluster and then consistently reconcile the state of the managed
cluster like an ordinary kubernetes operator does.</p></li><li><p><strong>Addon Manager</strong>: A kubernetes controller <em>in the hub cluster</em> that applies
manifests to the managed clusters via the <a href=https://open-cluster-management.io/docs/concepts/work-distribution/manifestwork/>ManifestWork</a>
api. In addition to resource dispatching, the manager can optionally manage
the lifecycle of CSRs for the addon agents or even the RBAC permission bond
to the CSRs&rsquo; requesting identity.</p></li></ul><p>In general, if a management tool working inside the managed cluster needs to
discriminate configuration for each managed cluster, it will be helpful to model
its implementation as a working addon agent. The configurations for each agent
are supposed to be persisted in the hub cluster, so the hub admin will be able
to prescribe the agent to do its job in a declarative way. In abstraction, via
the addon we will be decoupling a multi-cluster control plane into (1) strategy
dispatching and (2) execution. The addon manager doesn&rsquo;t actually apply any
changes directly to the managed cluster, instead it just places its prescription
to a dedicated namespace allocated for the accepted managed cluster. Then the
addon agent pulls the prescriptions consistently and does the execution.</p><p>In addition to dispatching configurations before the agents, the addon manager
will be automatically doing some fiddly preparation before the agent bootstraps,
such as:</p><ul><li>CSR applying, approving and signing.</li><li>Injecting and managing client credentials used by agents to access the hub
cluster.</li><li>The RBAC permission for the agents both in the hub cluster or the managed
cluster.</li><li>Installing strategy.</li></ul><h2 id=architecture>Architecture</h2><p>The following architecture graph shows how the coordination between addon manager
and addon agent works.</p><div style=text-align:center;padding:20px><img src=/addon-architecture.png alt="Addon Architecture" style="margin:0 auto;width:80%"></div><h2 id=add-on-lifecycle-management>Add-on lifecycle management</h2><p>Add-on lifecycle management refers to how to enable and disable an add-on on a managed cluster, how to set the add-on installation strategy and rollout strategy.</p><p>Please refer to the <a href=https://open-cluster-management.io/docs/getting-started/installation/addon-management/>Add-on management</a> for more details.</p><h3 id=install-strategy>Install strategy</h3><p>InstallStrategy represents that related ManagedClusterAddOns should be installed on certain clusters.</p><h3 id=rollout-strategy>Rollout strategy</h3><p>With the rollout strategy defined in the <code>ClusterManagementAddOn</code> API, users can
control the upgrade behavior of the addon when there are changes in the configurations.</p><h2 id=add-on-configurations>Add-on configurations</h2><p>Add-on configurations allow users to customize the behavior of add-ons across managed clusters. They include default configurations applicable to all clusters, specific configurations defined per install strategy for groups of clusters, and individual configurations for each managed cluster. This flexibility ensures that each cluster can be tailored to meet its unique requirements while maintaining a consistent management framework.</p><p>Please refer to the <a href=https://open-cluster-management.io/docs/getting-started/installation/addon-management/>Add-on management</a> for more details.</p><h2 id=examples>Examples</h2><p>All available Add-Ons are listed in the <a href=https://open-cluster-management.io/docs/getting-started/integration/>Add-ons and Integrations</a> section.</p><p>The <a href=https://github.com/open-cluster-management-io/addon-contrib/tree/main>addon-contrib</a> repository hosts a collection of Open Cluster Management (OCM) addons for staging and testing Proof of Concept (PoC) purposes.</p><h2 id=add-on-development>Add-on Development</h2><p><a href=https://github.com/open-cluster-management-io/addon-framework>Add-on framework</a>
provides a library for developers to develop an add-ons in open-cluster-management
more easily.</p><p>Please refer to the <a href=https://open-cluster-management.io/docs/developer-guides/addon/>add-on development guide</a> for more details.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-17b09a9dc5200475d8a306f18e63a0f9>2 - Getting Started</h1></div><div class=td-content><h1 id=pg-9c8aeb3889d27b5da94e53dfe10de789>2.1 - Quick Start</h1><h2 id=prerequisites>Prerequisites</h2><ul><li>Ensure <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl>kubectl</a> and <a href=https://kubectl.docs.kubernetes.io/installation/kustomize/>kustomize</a> are installed.</li><li>Ensure <a href=https://kind.sigs.k8s.io/>kind</a>(greater than <code>v0.9.0+</code>, or the latest version is preferred) is installed.</li></ul><h2 id=install-clusteradm-cli-tool>Install clusteradm CLI tool</h2><p>Run the following command to download and install the latest <code>clusteradm</code> command-line tool:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -L https://raw.githubusercontent.com/open-cluster-management-io/clusteradm/main/install.sh <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><h2 id=setup-hub-and-managed-cluster>Setup hub and managed cluster</h2><p>Run the following command to quickly setup a hub cluster and 2 managed clusters by kind.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -L https://raw.githubusercontent.com/open-cluster-management-io/OCM/main/solutions/setup-dev-environment/local-up.sh <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><p>If you want to setup OCM in a production environment or on a different kubernetes distribution, please refer to the <a href=https://open-cluster-management.io/docs/getting-started/installation/start-the-control-plane/>Start the control plane</a> and <a href=https://open-cluster-management.io/docs/getting-started/installation/register-a-cluster/>Register a cluster</a> guides.</p><h2 id=what-is-next>What is next</h2><p>Now you have the OCM control plane with 2 managed clusters connected! Let&rsquo;s start your OCM journey.</p><ul><li><a href=https://open-cluster-management.io/docs/scenarios/deploy-kubernetes-resources/>Deploy kubernetes resources onto a managed cluster</a></li><li><a href=https://open-cluster-management.io/docs/scenarios/pushing-kube-api-requests/>Visit kubernetes apiserver of managedcluster from cluster-proxy</a></li><li>Visit <a href=https://open-cluster-management.io/docs/getting-started/integration/>integration</a> to check if any certain OCM addon will meet your use cases.<ul><li><a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/policy-framework/>Deploy Policies onto a managed cluster</a></li></ul></li><li><a href=https://open-cluster-management.io/docs/developer-guides/vscode-extension/>Use the OCM VScode Extension to easily generate OCM related Kubernetes resources and track your cluster</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-69689d7a4bef48f2bfb91e81453e6440>2.2 - Installation</h1><p>Install the core control plane that includes cluster registration and manifests distribution on the hub cluster.</p><p>Install the klusterlet agent on the managed cluster so that it can be registered and managed by the hub cluster.</p></div><div class=td-content><h1 id=pg-3043db4487f0965239fd594f3ff03106>2.2.1 - Start the control plane</h1><h2 id=prerequisite>Prerequisite</h2><ul><li>The hub cluster should be <code>v1.19+</code>.
(To run on hub cluster version between [<code>v1.16</code>, <code>v1.18</code>],
please manually enable feature gate &ldquo;V1beta1CSRAPICompatibility&rdquo;).</li><li>Currently the bootstrap process relies on client authentication via CSR. Therefore, if your Kubernetes distributions (like <a href=https://github.com/aws/containers-roadmap/issues/1856>EKS</a>) don&rsquo;t support it, you can:<ul><li>follow <a href=https://open-cluster-management.io/docs/getting-started/installation/running-on-eks/>this</a> article to run OCM natively on EKS</li><li>or choose the <a href=https://github.com/open-cluster-management-io/multicluster-controlplane>multicluster-controlplane</a> as the hub controlplane</li></ul></li><li>Ensure <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl>kubectl</a> and <a href=https://kubectl.docs.kubernetes.io/installation/kustomize/>kustomize</a> are installed.</li></ul><h3 id=network-requirements>Network requirements</h3><p>Configure your network settings for the hub cluster to allow the following connections.</p><table><thead><tr><th>Direction</th><th>Endpoint</th><th>Protocol</th><th>Purpose</th><th>Used by</th></tr></thead><tbody><tr><td>Inbound</td><td>https://{hub-api-server-url}:{port}</td><td>TCP</td><td>Kubernetes API server of the hub cluster</td><td>OCM agents, including the add-on agents, running on the managed clusters</td></tr></tbody></table><h2 id=install-clusteradm-cli-tool>Install clusteradm CLI tool</h2><p>It&rsquo;s recommended to run the following command to download and install <strong>the
latest release</strong> of the <code>clusteradm</code> command-line tool:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -L https://raw.githubusercontent.com/open-cluster-management-io/clusteradm/main/install.sh <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><p>You can also install <strong>the latest development version</strong> (main branch) by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Installing clusteradm to $GOPATH/bin/</span>
</span></span><span style=display:flex><span><span style=color:#000>GO111MODULE</span><span style=color:#ce5c00;font-weight:700>=</span>off go get -u open-cluster-management.io/clusteradm/...
</span></span></code></pre></div><h2 id=bootstrap-a-cluster-manager>Bootstrap a cluster manager</h2><p>Before actually installing the OCM components into your clusters, export
the following environment variables in your terminal before running our
command-line tool <code>clusteradm</code> so that it can correctly discriminate the
hub cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The context name of the clusters in your kubeconfig</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;your hub cluster context&gt;
</span></span></code></pre></div><p>Call <code>clusteradm init</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span> <span style=color:#8f5902;font-style:italic># By default, it installs the latest release of the OCM components.</span>
</span></span><span style=display:flex><span> <span style=color:#8f5902;font-style:italic># Use e.g. &#34;--bundle-version=latest&#34; to install latest development builds.</span>
</span></span><span style=display:flex><span> <span style=color:#8f5902;font-style:italic># NOTE: For hub cluster version between v1.16 to v1.19 use the parameter: --use-bootstrap-token</span>
</span></span><span style=display:flex><span> clusteradm init --wait --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div><p>The <code>clusteradm init</code> command installs the
<a href=https://github.com/open-cluster-management-io/ocm/tree/main/cmd/registration-operator>registration-operator</a>
on the hub cluster, which is responsible for consistently installing
and upgrading a few core components for the OCM environment.</p><p>After the <code>init</code> command completes, a generated command is output on the console to
register your managed clusters. An example of the generated command is shown below.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm join <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --hub-token &lt;your token data&gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --hub-apiserver &lt;your hub kube-apiserver endpoint&gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --wait <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --cluster-name &lt;cluster_name&gt;
</span></span></code></pre></div><p>It&rsquo;s recommended to save the command somewhere secure for future use. If it&rsquo;s lost, you can use
<code>clusteradm get token</code> to get the generated command again.</p><h2 id=check-out-the-running-instances-of-the-control-plane>Check out the running instances of the control plane</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl -n open-cluster-management get pod --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>NAME                               READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>cluster-manager-695d945d4d-5dn8k   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          19d
</span></span></code></pre></div><p>Additionally, to check out the instances of OCM&rsquo;s hub control plane, run
the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl -n open-cluster-management-hub get pod --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>NAME                               READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>cluster-manager-placement-controller-857f8f7654-x7sfz      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          19d
</span></span><span style=display:flex><span>cluster-manager-registration-controller-85b6bd784f-jbg8s   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          19d
</span></span><span style=display:flex><span>cluster-manager-registration-webhook-59c9b89499-n7m2x      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          19d
</span></span><span style=display:flex><span>cluster-manager-work-webhook-59cf7dc855-shq5p              1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          19d
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>The overall installation information is visible on the <code>clustermanager</code> custom resource:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get clustermanager cluster-manager -o yaml --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div><h2 id=uninstall-the-ocm-from-the-control-plane>Uninstall the OCM from the control plane</h2><p>Before uninstalling the OCM components from your clusters, please detach the
managed cluster from the control plane.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm clean --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div><p>Check the instances of OCM&rsquo;s hub control plane are removed.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl -n open-cluster-management-hub get pod --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>No resources found in open-cluster-management-hub namespace.
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl -n open-cluster-management get pod --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>No resources found in open-cluster-management namespace.
</span></span></code></pre></div><p>Check the <code>clustermanager</code> resource is removed from the control plane.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get clustermanager --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>error: the server doesn<span style=color:#a40000>&#39;</span>t have a resource <span style=color:#204a87>type</span> <span style=color:#4e9a06>&#34;clustermanager&#34;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-116c2f796e286852a470675bf6ad59f9>2.2.2 - Register a cluster</h1><p>After the cluster manager is installed on the hub cluster, you need to install the klusterlet agent on another cluster so that it can be registered and managed by the hub cluster.</p><h2 id=prerequisite>Prerequisite</h2><ul><li>The managed clusters should be <code>v1.11+</code>.</li><li>Ensure <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl>kubectl</a> and <a href=https://kubectl.docs.kubernetes.io/installation/kustomize/>kustomize</a> are installed.</li></ul><h3 id=network-requirements>Network requirements</h3><p>Configure your network settings for the managed clusters to allow the following connections.</p><table><thead><tr><th>Direction</th><th>Endpoint</th><th>Protocol</th><th>Purpose</th><th>Used by</th></tr></thead><tbody><tr><td>Outbound</td><td>https://{hub-api-server-url}:{port}</td><td>TCP</td><td>Kubernetes API server of the hub cluster</td><td>OCM agents, including the add-on agents, running on the managed clusters</td></tr></tbody></table><p>To use a proxy, please make sure the proxy server is well configured to allow the above connections and the proxy server is reachable for the managed clusters. See <a href=https://open-cluster-management.io/scenarios/register-cluster-through-proxy/>Register a cluster to hub through proxy server</a> for more details.</p><h2 id=install-clusteradm-cli-tool>Install clusteradm CLI tool</h2><p>It&rsquo;s recommended to run the following command to download and install <strong>the
latest release</strong> of the <code>clusteradm</code> command-line tool:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -L https://raw.githubusercontent.com/open-cluster-management-io/clusteradm/main/install.sh <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><p>You can also install <strong>the latest development version</strong> (main branch) by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Installing clusteradm to $GOPATH/bin/</span>
</span></span><span style=display:flex><span><span style=color:#000>GO111MODULE</span><span style=color:#ce5c00;font-weight:700>=</span>off go get -u open-cluster-management.io/clusteradm/...
</span></span></code></pre></div><h2 id=bootstrap-a-klusterlet>Bootstrap a klusterlet</h2><p>Before actually installing the OCM components into your clusters, export
the following environment variables in your terminal before running our
command-line tool <code>clusteradm</code> so that it can correctly discriminate the managed cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The context name of the clusters in your kubeconfig</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;your hub cluster context&gt;
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>CTX_MANAGED_CLUSTER</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;your managed cluster context&gt;
</span></span></code></pre></div><p>Copy the previously generated command &ndash; <code>clusteradm join</code>, and add the arguments respectively based
on the different distribution.</p><p><strong>NOTE</strong>: If there is no configmap <code>kube-root-ca.crt</code> in kube-public namespace of the hub cluster,
the flag &ndash;ca-file should be set to provide a valid hub ca file to help set
up the external client.</p><ul class="nav nav-tabs" id=tabs-0 role=tablist><li class=nav-item><button class="nav-link active" id=tabs-00-00-tab data-bs-toggle=tab data-bs-target=#tabs-00-00 role=tab data-td-tp-persist=kind aria-controls=tabs-00-00 aria-selected=true>
kind</button></li><li class=nav-item><button class=nav-link id=tabs-00-01-tab data-bs-toggle=tab data-bs-target=#tabs-00-01 role=tab data-td-tp-persist="k3s, openshift 4.x" aria-controls=tabs-00-01 aria-selected=false>
k3s, openshift 4.X</button></li></ul><div class=tab-content id=tabs-0-content><div class="tab-body tab-pane fade show active" id=tabs-00-00 role=tabpanel aria-labelled-by=tabs-00-00-tab tabindex=0><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8f5902;font-style:italic># NOTE: For KinD clusters use the parameter: --force-internal-endpoint-lookup</span>
</span></span><span style=display:flex><span>clusteradm join <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --hub-token &lt;your token data&gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --hub-apiserver &lt;your hub cluster endpoint&gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --wait <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --cluster-name <span style=color:#4e9a06>&#34;cluster1&#34;</span> <span style=color:#4e9a06>\ </span>   <span style=color:#8f5902;font-style:italic># Or other arbitrary unique name</span>
</span></span><span style=display:flex><span>    --force-internal-endpoint-lookup <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_MANAGED_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div></div><div class="tab-body tab-pane fade" id=tabs-00-01 role=tabpanel aria-labelled-by=tabs-00-01-tab tabindex=0><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm join <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --hub-token &lt;your token data&gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --hub-apiserver &lt;your hub cluster endpoint&gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --wait <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --cluster-name <span style=color:#4e9a06>&#34;cluster1&#34;</span> <span style=color:#4e9a06>\ </span>  <span style=color:#8f5902;font-style:italic># Or other arbitrary unique name</span>
</span></span><span style=display:flex><span>    --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_MANAGED_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div></div></div><h3 id=bootstrap-a-klusterlet-in-hosted-modeoptional>Bootstrap a klusterlet in hosted mode(Optional)</h3><p>Using the above command, the klusterlet components(registration-agent and work-agent) will be deployed on the managed
cluster, it is mandatory to expose the hub cluster to the managed cluster. We provide an option for running the
klusterlet components outside the managed cluster, for example, on the hub cluster(hosted mode).</p><p>The hosted mode deploying is till in experimental stage, consider to use it only when:</p><ul><li>want to reduce the footprints of the managed cluster.</li><li>do not want to expose the hub cluster to the managed cluster directly</li></ul><p>In hosted mode, the cluster where the klusterlet is running is called the hosting cluster. Running the following command
to the hosting cluster to register the managed cluster to the hub.</p><ul class="nav nav-tabs" id=tabs-1 role=tablist><li class=nav-item><button class="nav-link active" id=tabs-01-00-tab data-bs-toggle=tab data-bs-target=#tabs-01-00 role=tab data-td-tp-persist=kind aria-controls=tabs-01-00 aria-selected=true>
kind</button></li><li class=nav-item><button class=nav-link id=tabs-01-01-tab data-bs-toggle=tab data-bs-target=#tabs-01-01 role=tab data-td-tp-persist="k3s, openshift 4.x" aria-controls=tabs-01-01 aria-selected=false>
k3s, openshift 4.X</button></li></ul><div class=tab-content id=tabs-1-content><div class="tab-body tab-pane fade show active" id=tabs-01-00 role=tabpanel aria-labelled-by=tabs-01-00-tab tabindex=1><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8f5902;font-style:italic># NOTE for KinD clusters:</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#  1. hub is KinD, use the parameter: --force-internal-endpoint-lookup</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#  2. managed is Kind, --managed-cluster-kubeconfig should be internal: `kind get kubeconfig --name managed --internal`</span>
</span></span><span style=display:flex><span>clusteradm join <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --hub-token &lt;your token data&gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --hub-apiserver &lt;your hub cluster endpoint&gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --wait <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --cluster-name <span style=color:#4e9a06>&#34;cluster1&#34;</span> <span style=color:#4e9a06>\ </span>   <span style=color:#8f5902;font-style:italic># Or other arbitrary unique name</span>
</span></span><span style=display:flex><span>    --mode hosted <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --managed-cluster-kubeconfig &lt;your managed cluster kubeconfig&gt; <span style=color:#4e9a06>\ </span>   <span style=color:#8f5902;font-style:italic># Should be an internal kubeconfig</span>
</span></span><span style=display:flex><span>    --force-internal-endpoint-lookup <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --context &lt;your hosting cluster context&gt;
</span></span></code></pre></div></div><div class="tab-body tab-pane fade" id=tabs-01-01 role=tabpanel aria-labelled-by=tabs-01-01-tab tabindex=1><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm join <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --hub-token &lt;your token data&gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --hub-apiserver &lt;your hub cluster endpoint&gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --wait <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --cluster-name <span style=color:#4e9a06>&#34;cluster1&#34;</span> <span style=color:#4e9a06>\ </span>   <span style=color:#8f5902;font-style:italic># Or other arbitrary unique name</span>
</span></span><span style=display:flex><span>    --mode hosted <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --managed-cluster-kubeconfig &lt;your managed cluster kubeconfig&gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --context &lt;your hosting cluster context&gt;
</span></span></code></pre></div></div></div><h3 id=bootstrap-a-klusterlet-in-singleton-mode>Bootstrap a klusterlet in singleton mode</h3><p>To reduce the footprint of agent in the managed cluster, singleton mode is introduced since <code>v0.12.0</code>.
In the singleton mode, the work and registration agent will be run as a single pod in the managed
cluster.</p><p><strong>Note:</strong> to run klusterlet in singleton mode, you must have a clusteradm version equal or higher than
<code>v0.12.0</code></p><ul class="nav nav-tabs" id=tabs-2 role=tablist><li class=nav-item><button class="nav-link active" id=tabs-02-00-tab data-bs-toggle=tab data-bs-target=#tabs-02-00 role=tab data-td-tp-persist=kind aria-controls=tabs-02-00 aria-selected=true>
kind</button></li><li class=nav-item><button class=nav-link id=tabs-02-01-tab data-bs-toggle=tab data-bs-target=#tabs-02-01 role=tab data-td-tp-persist="k3s, openshift 4.x" aria-controls=tabs-02-01 aria-selected=false>
k3s, openshift 4.X</button></li></ul><div class=tab-content id=tabs-2-content><div class="tab-body tab-pane fade show active" id=tabs-02-00 role=tabpanel aria-labelled-by=tabs-02-00-tab tabindex=2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8f5902;font-style:italic># NOTE: For KinD clusters use the parameter: --force-internal-endpoint-lookup</span>
</span></span><span style=display:flex><span>clusteradm join <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --hub-token &lt;your token data&gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --hub-apiserver &lt;your hub cluster endpoint&gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --wait <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --cluster-name <span style=color:#4e9a06>&#34;cluster1&#34;</span> <span style=color:#4e9a06>\ </span>   <span style=color:#8f5902;font-style:italic># Or other arbitrary unique name</span>
</span></span><span style=display:flex><span>    --singleton <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --force-internal-endpoint-lookup <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_MANAGED_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div></div><div class="tab-body tab-pane fade" id=tabs-02-01 role=tabpanel aria-labelled-by=tabs-02-01-tab tabindex=2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm join <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --hub-token &lt;your token data&gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --hub-apiserver &lt;your hub cluster endpoint&gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --wait <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --cluster-name <span style=color:#4e9a06>&#34;cluster1&#34;</span> <span style=color:#4e9a06>\ </span>  <span style=color:#8f5902;font-style:italic># Or other arbitrary unique name</span>
</span></span><span style=display:flex><span>    --singleton <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_MANAGED_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div></div></div><h2 id=accept-the-join-request-and-verify>Accept the join request and verify</h2><p>After the OCM agent is running on your managed cluster, it will be sending a &ldquo;handshake&rdquo; to your
hub cluster and waiting for an approval from the hub cluster admin. In this section, we will walk
through accepting the registration requests from the perspective of an OCM&rsquo;s hub admin.</p><ol><li><p>Wait for the creation of the CSR object which will be created by your managed
clusters&rsquo; OCM agents on the hub cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl get csr -w --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span> <span style=color:#000;font-weight:700>|</span> grep cluster1  <span style=color:#8f5902;font-style:italic># or the previously chosen cluster name</span>
</span></span></code></pre></div><p>An example of a pending CSR request is shown below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>cluster1-tqcjj   33s   kubernetes.io/kube-apiserver-client   system:serviceaccount:open-cluster-management:cluster-bootstrap   Pending
</span></span></code></pre></div></li><li><p>Accept the join request using the <code>clusteradm</code> tool:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>clusteradm accept --clusters cluster1 --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div><p>After running the <code>accept</code> command, the CSR from your managed cluster
named &ldquo;cluster1&rdquo; will be approved. Additionally, it will instruct
the OCM hub control plane to setup related objects (such as a namespace
named &ldquo;cluster1&rdquo; in the hub cluster) and RBAC permissions automatically.</p></li><li><p>Verify the installation of the OCM agents on your managed cluster by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl -n open-cluster-management-agent get pod --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_MANAGED_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>NAME                                             READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>klusterlet-registration-agent-598fd79988-jxx7n   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          19d
</span></span><span style=display:flex><span>klusterlet-work-agent-7d47f4b5c5-dnkqw           1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          19d
</span></span></code></pre></div></li><li><p>Verify that the <code>cluster1</code> <code>ManagedCluster</code> object was created successfully by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl get managedcluster --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div><p>Then you should get a result that resembles the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>NAME       HUB ACCEPTED   MANAGED CLUSTER URLS      JOINED   AVAILABLE   AGE
</span></span><span style=display:flex><span>cluster1   <span style=color:#204a87>true</span>           &lt;your endpoint&gt;           True     True        5m23s
</span></span></code></pre></div></li></ol><p>If the managed cluster status is not true, refer to <a href=/docs/getting-started/installation/register-a-cluster/#troubleshooting>Troubleshooting</a> to debug on your cluster.</p><h2 id=apply-a-manifestwork>Apply a Manifestwork</h2><p>After the managed cluster is registered, test that you can deploy a pod to the managed cluster from the hub cluster. Create a <code>manifest-work.yaml</code> as shown in this example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>mw-01</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${MANAGED_CLUSTER_NAME}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Pod</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>busybox</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>command</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;sh&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;-c&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;echo &#34;Hello, Kubernetes!&#34; &amp;&amp; sleep 3600&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>restartPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OnFailure</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Apply the yaml file to the hub cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl apply -f manifest-work.yaml --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div><p>Verify that the <code>manifestwork</code> resource was applied to the hub.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl -n <span style=color:#4e9a06>${</span><span style=color:#000>MANAGED_CLUSTER_NAME</span><span style=color:#4e9a06>}</span> get manifestwork/mw-01 --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span> -o yaml
</span></span></code></pre></div><p>Check on the managed cluster and see the <em>hello</em> Pod has been deployed from the hub cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>$ kubectl -n default get pod --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_MANAGED_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>NAME    READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>hello   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          108s
</span></span></code></pre></div><h3 id=troubleshooting>Troubleshooting</h3><ul><li><p><strong>If the managed cluster status is not true.</strong></p><p>For example, the result below is shown when checking managedcluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>$ kubectl get managedcluster --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>NAME                   HUB ACCEPTED   MANAGED CLUSTER URLS   JOINED   AVAILABLE   AGE
</span></span><span style=display:flex><span><span style=color:#4e9a06>${</span><span style=color:#000>MANAGED_CLUSTER_NAME</span><span style=color:#4e9a06>}</span> <span style=color:#204a87>true</span>           https://localhost               Unknown     46m
</span></span></code></pre></div><p>There are many reasons for this problem. You can use the commands below to get more debug info. If the provided info doesn&rsquo;t help, please log an issue to us.</p><p>On the hub cluster, check the managedcluster status.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl get managedcluster <span style=color:#4e9a06>${</span><span style=color:#000>MANAGED_CLUSTER_NAME</span><span style=color:#4e9a06>}</span> --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span> -o yaml
</span></span></code></pre></div><p>On the hub cluster, check the lease status.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl get lease -n <span style=color:#4e9a06>${</span><span style=color:#000>MANAGED_CLUSTER_NAME</span><span style=color:#4e9a06>}</span> --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div><p>On the managed cluster, check the klusterlet status.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl get klusterlet -o yaml --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_MANAGED_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div></li></ul><h2 id=detach-the-cluster-from-hub>Detach the cluster from hub</h2><p>Remove the resources generated when registering with the hub cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>clusteradm unjoin --cluster-name <span style=color:#4e9a06>&#34;cluster1&#34;</span> --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_MANAGED_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div><p>Check the installation of the OCM agent is removed from the managed cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl -n open-cluster-management-agent get pod --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_MANAGED_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>No resources found in open-cluster-management-agent namespace.
</span></span></code></pre></div><p>Check the klusterlet is removed from the managed cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl get klusterlet --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_MANAGED_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>error: the server doesn<span style=color:#a40000>&#39;</span>t have a resource <span style=color:#204a87>type</span> <span style=color:#4e9a06>&#34;klusterlet
</span></span></span></code></pre></div><h3 id=resource-cleanup-when-the-managed-cluster-is-deleted>Resource cleanup when the managed cluster is deleted</h3><p>When a user deletes the managedCluster resource, all associated resources within the cluster namespace must also be removed. This includes managedClusterAddons, manifestWorks, and the roleBindings for the klusterlet agent. Resource cleanup follows a specific sequence to prevent resources from being stuck in a terminating state:</p><ol><li>managedClusterAddons are deleted first.</li><li>manifestWorks are removed subsequently after all managedClusterAddons are deleted.</li><li>For the same resource as managedClusterAddon or manifestWork, custom deletion ordering can be defined using the <code>open-cluster-management.io/cleanup-priority</code> annotation:<ul><li>Priority values range from 0 to 100 (lower values execute first).</li></ul></li></ol><p>The <code>open-cluster-management.io/cleanup-priority</code> annotation controls deletion order when resource instances have dependencies. For example:</p><p>A manifestWork that applies a CRD and operator should be deleted after a manifestWork that creates a CR instance, allowing the operator to perform cleanup after the CR is removed.</p><p>The <code>ResourceCleanup</code> featureGate for cluster registration on the Hub cluster enables automatic cleanup of managedClusterAddons and manifestWorks within the cluster namespace after cluster unjoining.</p><p><strong>Version Compatibility:</strong></p><ul><li>The <code>ResourceCleanup</code> featureGate was introdueced in OCM v0.13.0, and was <strong>disabled by default</strong> in OCM v0.16.0 and earlier versions. To activate it, need to modify the clusterManager CR configuration:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>registrationConfiguration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>featureGates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>feature</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceCleanup</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Enable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>Starting with OCM v0.17.0, the <code>ResourceCleanup</code> featureGate has been upgraded from Alpha to Beta status and is <strong>enabled by default</strong>.</li></ul><p><strong>Disabling the Feature:</strong>
To deactivate this functionality, update the clusterManager CR on the hub cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>registrationConfiguration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>featureGates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>feature</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceCleanup</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Disable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-92c3b566bd4f842f869dcf67ba435f85>2.2.3 - Add-on management</h1><h2 id=add-on-enablement>Add-on enablement</h2><p>From a user&rsquo;s perspective, to install the addon to the hub cluster the hub admin
should register a globally-unique <code>ClusterManagementAddon</code> resource as a singleton
placeholder in the hub cluster. For instance, the <a href=https://github.com/open-cluster-management-io/addon-framework/tree/main/examples/helloworld>helloworld</a>
add-on can be registered to the hub cluster by creating:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addOnMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=enable-the-add-on-manually>Enable the add-on manually</h3><p>The addon manager running on the hub is taking responsibility of configuring the
installation of addon agents for each managed cluster. When a user wants to enable
the add-on for a certain managed cluster, the user should create a
<code>ManagedClusterAddOn</code> resource on the cluster namespace. The name of the
<code>ManagedClusterAddOn</code> should be the same name of the corresponding
<code>ClusterManagementAddon</code>. For instance, the following example enables <code>helloworld</code>
add-on in &ldquo;cluster1&rdquo;:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installNamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=enable-the-add-on-automatically>Enable the add-on automatically</h3><p>If the addon is developed with <a href=https://open-cluster-management.io/docs/developer-guides/addon/#automatic-installation>automatic installation</a>,
which support <a href=https://open-cluster-management.io/docs/concepts/add-on-extensibility/addon/#auto-install-by-cluster-discovery>auto-install by cluster discovery</a>,
then the <code>ManagedClusterAddOn</code> will be created for all managed cluster namespaces
automatically, or be created for the selected managed cluster namespaces automatically.</p><h3 id=enable-the-add-on-by-install-strategy>Enable the add-on by install strategy</h3><p>If the addon is developed following the guidelines mentioned in <a href=https://open-cluster-management.io/docs/developer-guides/addon/#managing-the-add-on-agent-lifecycle-by-addon-manager>managing the add-on agent lifecycle by addon-manager</a>,
the user can define an <code>installStrategy</code> in the <code>ClusterManagementAddOn</code>
to specify on which clusters the <code>ManagedClusterAddOn</code> should be enabled. Details see <a href=/docs/getting-started/installation/addon-management/#install-strategy>install strategy</a>.</p><h3 id=add-on-healthiness>Add-on healthiness</h3><p>The healthiness of the addon instances are visible when we list the addons via
kubectl:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get managedclusteraddon -A
</span></span><span style=display:flex><span>NAMESPACE   NAME                     AVAILABLE   DEGRADED   PROGRESSING
</span></span><span style=display:flex><span>&lt;cluster&gt;   &lt;addon&gt;                  True
</span></span></code></pre></div><p>The addon agent are expected to report its healthiness periodically as long as it&rsquo;s
running. Also the versioning of the addon agent can be reflected in the resources
optionally so that we can control the upgrading the agents progressively.</p><h3 id=clean-the-add-ons>Clean the add-ons</h3><p>Last but not least, a neat uninstallation of the addon is also supported by simply
deleting the corresponding <code>ClusterManagementAddon</code> resource from the hub cluster
which is the &ldquo;root&rdquo; of the whole addon. The OCM platform will automatically sanitize
the hub cluster for you after the uninstalling by removing all the components either
in the hub cluster or in the manage clusters.</p><h2 id=add-on-lifecycle-management>Add-on lifecycle management</h2><h3 id=install-strategy>Install strategy</h3><p><code>InstallStrategy</code> represents that related <code>ManagedClusterAddOns</code> should be installed
on certain clusters. For example, the following example enables the <code>helloworld</code>
add-on on clusters with the aws label.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addOnMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-aws</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-aws</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>predicates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>requiredClusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>claimSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>matchExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>platform.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>In</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>values</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#000>aws</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=rollout-strategy>Rollout strategy</h3><p>With the rollout strategy defined in the <code>ClusterManagementAddOn</code> API, users can
control the upgrade behavior of the addon when there are changes in the
<a href=/docs/getting-started/installation/addon-management/#add-on-configurations>configurations</a>.</p><p>For example, if the add-on user updates the &ldquo;deploy-config&rdquo; and wants to apply
the change to the add-ons to a &ldquo;canary&rdquo; <a href=https://open-cluster-management.io/docs/concepts/content-placement/placement/#decision-strategy>decision group</a> first. If all the add-on upgrade successfully, then upgrade the rest of clusters progressively per cluster
at a rate of 25%. The rollout strategy can be defined as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addOnMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-aws</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>progressive</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;prod-canary-west&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;prod-canary-east&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>maxConcurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#000>%</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>minSuccessTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>5m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>progressDeadline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>maxFailures</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In the above example with type <code>Progressive</code>, once user updates the &ldquo;deploy-config&rdquo;, controller
will rollout on the clusters in <code>mandatoryDecisionGroups</code> first, then rollout on the other
clusters with the rate defined in <code>maxConcurrency</code>.</p><ul><li><code>minSuccessTime</code> is a &ldquo;soak&rdquo; time, means the controller will wait for 5 minutes when a cluster
reach a successful state and <code>maxFailures</code> isn&rsquo;t breached. If, after this 5 minutes interval, the
workload status remains successful, the rollout progresses to the next.</li><li><code>progressDeadline</code> means the controller will wait for a maximum of 10 minutes for the workload to
reach a successful state. If, the workload fails to achieve success within 10 minutes, the controller
stops waiting, marking the workload as &ldquo;timeout,&rdquo; and includes it in the count of <code>maxFailures</code>.</li><li><code>maxFailures</code> means the controller can tolerate update to 2 clusters with failed status,
once <code>maxFailures</code> is breached, the rollout will stop.</li></ul><p>Currently add-on supports 3 types of <a href=https://github.com/open-cluster-management-io/api/blob/main/cluster/v1alpha1/types_rolloutstrategy.go>rolloutStrategy</a>,
they are <code>All</code>, <code>Progressive</code> and <code>ProgressivePerGroup</code>, for more info regards the rollout strategies
check the <a href=https://open-cluster-management.io/docs/concepts/content-placement/placement/#rollout-strategy>Rollout Strategy</a> document.</p><h2 id=add-on-configurations>Add-on configurations</h2><h3 id=default-configurations>Default configurations</h3><p>In <code>ClusterManagementAddOn</code>, <code>spec.supportedConfigs</code> is a list of configuration
types supported by the add-on. <code>defaultConfig</code> represents the namespace and name of
the default add-on configuration. In scenarios where all add-ons have the same
configuration. Only one configuration of the same group and resource can be specified
in the <code>defaultConfig</code>.</p><p>In the example below, add-ons on all the clusters will use &ldquo;default-deploy-config&rdquo; and &ldquo;default-example-config&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addOnMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>defaultConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default-deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>defaultConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default-example-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>exampleconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=configurations-per-install-strategy>Configurations per install strategy</h3><p>In <code>ClusterManagementAddOn</code>, <code>spec.installStrategy.placements[].configs</code> lists the
configuration of <code>ManagedClusterAddon</code> during installation for a group of clusters.
For the need to use multiple configurations with the same group and resource can be defined
in this field since OCM v0.15.0. It will override the <a href=/docs/getting-started/installation/addon-management/#default-configurations>Default configurations</a>
on certain clusters by group and resource.</p><p>In the example below, add-ons on clusters selected by <code>Placement</code> placement-aws will
use &ldquo;deploy-config&rdquo;, &ldquo;example-config-1&rdquo; and &ldquo;example-config-2&rdquo;, while all the other add-ons
will still use &ldquo;default-deploy-config&rdquo; and &ldquo;default-example-config&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addOnMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>defaultConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default-deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-aws</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>exampleconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-config-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>exampleconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-config-2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=configurations-per-cluster>Configurations per cluster</h3><p>In <code>ManagedClusterAddOn</code>, <code>spec.configs</code> is a list of add-on configurations.
In scenarios where the current add-on has its own configurations. It also supports
defining multiple configurations with the same group and resource since OCM v0.15.0.
It will override the <a href=/docs/getting-started/installation/addon-management/#default-configurations>Default configurations</a> and
<a href=/docs/getting-started/installation/addon-management/#configurations-per-install-strategy>Configurations per install strategy</a> defined
in <code>ClusterManagementAddOn</code> by group and resource.</p><p>In the below example, add-on on cluster1 will use &ldquo;cluster1-deploy-config&rdquo; and &ldquo;cluster1-example-config&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1-deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>exampleconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1-example-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=supported-configurations>Supported configurations</h3><p>Supported configurations is a list of configuration types that are allowed to override
the add-on configurations defined in ClusterManagementAddOn spec. They are listed in the
<code>ManagedClusterAddon</code> <code>status.supportedConfigs</code>, for example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>exampleconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=effective-configurations>Effective configurations</h3><p>As the above described, there are 3 places to define the add-on configurations,
they have an override order and eventually only one takes effect. The final effective
configurations are listed in the <code>ManagedClusterAddOn</code> <code>status.configReferences</code>.</p><ul><li><code>desiredConfig</code> record the desired config and it&rsquo;s spec hash.</li><li><code>lastAppliedConfig</code> record the config when the corresponding ManifestWork is
applied successfully.</li></ul><p>For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>configReferences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>desiredConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1-deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>specHash</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dcf88f5b11bd191ed2f886675f967684da8b5bcbe6902458f672277d469e2044</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>lastAppliedConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1-deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>specHash</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dcf88f5b11bd191ed2f886675f967684da8b5bcbe6902458f672277d469e2044</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>lastObservedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1-deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-7e27bc67bf62c6bdcbb5b0caba98c014>2.2.4 - Running on EKS</h1><p>Use this solution to use AWS EKS cluster as a hub. This solution uses AWS IAM roles for authentication,
hence only Managed Clusters running on EKS will be able to use this solution.</p><p>Refer <a href=https://github.com/open-cluster-management-io/ocm/tree/main/solutions/joining-hub-and-spoke-with-aws-auth>this</a>
article for detailed registration instructions.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6c1c67ed27dff6fc6cc426a3e6d5dceb>2.3 - Add-ons and Integrations</h1><p>Enhance the open-cluster-management core control plane with optional add-ons and integrations.</p></div><div class=td-content><h1 id=pg-8318b29c9ea3dd68aa88f43f034ac44b>2.3.1 - Policy</h1><p>The Policy Add-on enables auditing and enforcement of configuration across clusters managed by OCM, enhancing security,
easing maintenance burdens, and increasing consistency across the clusters for your compliance and reliability
requirements.</p><p>View the following sections to learn more about the Policy Add-on:</p><ul><li><h3 id=policy-frameworkhahahugoshortcode81s0hbhb><a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/policy-framework/>Policy framework</a></h3><p>Learn about the architecture of the Policy Add-on that delivers policies defined on the hub cluster to the managed
clusters and how to install and enable the add-on for your OCM clusters.</p></li><li><h3 id=policy-api-conceptshahahugoshortcode81s1hbhb><a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/policy/>Policy API concepts</a></h3><p>Learn about the APIs that the Policy Add-on uses and how the APIs are related to one another to deliver policies to
the clusters managed by OCM.</p></li><li><h3 id=supported-managed-cluster-policy-engines>Supported managed cluster policy engines</h3><ul><li><h4 id=configuration-policyhahahugoshortcode81s2hbhb><a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/configuration-policy/>Configuration policy</a></h4><p>The <code>ConfigurationPolicy</code> is provided by OCM and defines Kubernetes manifests to compare with objects that currently
exist on the cluster. The action that the <code>ConfigurationPolicy</code> will take is determined by its <code>complianceType</code>.
Compliance types include <code>musthave</code>, <code>mustnothave</code>, and <code>mustonlyhave</code>. <code>musthave</code> means the object should have the
listed keys and values as a subset of the larger object. <code>mustnothave</code> means an object matching the listed keys and
values should not exist. <code>mustonlyhave</code> ensures objects only exist with the keys and values exactly as defined.</p></li><li><h4 id=open-policy-agent-gatekeeperhahahugoshortcode81s3hbhb><a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/gatekeeper/>Open Policy Agent Gatekeeper</a></h4><p>Gatekeeper is a validating webhook with auditing capabilities that can enforce custom resource definition-based
policies that are run with the Open Policy Agent (OPA). Gatekeeper <code>ConstraintTemplates</code> and constraints can be
provided in an OCM <code>Policy</code> to sync to managed clusters that have Gatekeeper installed on them.</p></li></ul></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-aed3efe34586a9ea2226e76575cece60>2.3.1.1 - Policy framework</h1><p>The policy framework provides governance capabilities to OCM managed Kubernetes clusters. Policies provide visibility
and drive remediation for various security and configuration aspects to help IT administrators meet their requirements.</p><h2 id=api-concepts>API Concepts</h2><p>View the <a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/policy/>Policy API</a> page for additional details about the Policy API managed by the Policy Framework
components, including:</p><ul><li><a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/policy/#policy><code>Policy</code></a></li><li><a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/policy/#policyset><code>PolicySet</code></a></li><li><a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/policy/#placementbinding><code>PlacementBinding</code></a></li></ul><h2 id=architecture>Architecture</h2><div style=text-align:center;padding:20px><img src=/policy-framework-architecture-diagram.png alt="Policy framework architecture" style="margin:0 auto;width:80%"></div><p>The governance policy framework distributes policies to managed clusters and collects results to send back to the hub
cluster.</p><ul><li><a href=https://github.com/open-cluster-management-io/governance-policy-propagator>Policy propagator</a></li><li><a href=https://github.com/open-cluster-management-io/governance-policy-framework-addon>Policy framework addon</a></li></ul><h2 id=prerequisite>Prerequisite</h2><p>You must meet the following prerequisites to install the policy framework:</p><ul><li><p>Ensure <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl><code>kubectl</code></a> and
<a href=https://kubectl.docs.kubernetes.io/installation/kustomize/><code>kustomize</code></a> are installed.</p></li><li><p>Ensure the <code>open-cluster-management</code> <em>cluster manager</em> is installed. See
<a href=https://open-cluster-management.io/docs/getting-started/installation/start-the-control-plane/>Start the control plane</a> for more information.</p></li><li><p>Ensure the <code>open-cluster-management</code> <em>klusterlet</em> is installed. See
<a href=https://open-cluster-management.io/docs/getting-started/installation/register-a-cluster/>Register a cluster</a> for more information.</p></li><li><p>If you are using <code>PlacementRules</code> with your policies, ensure the <code>open-cluster-management</code> <em>application</em> is installed
. See <a href=https://open-cluster-management.io/docs/getting-started/integration/app-lifecycle/>Application management</a> for more information. If you are using the
default <code>Placement</code> API, you can skip the Application management installation, but you do need to install the
<code>PlacementRule</code> CRD with this command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl apply -f https://raw.githubusercontent.com/open-cluster-management-io/multicloud-operators-subscription/main/deploy/hub-common/apps.open-cluster-management.io_placementrules_crd.yaml
</span></span></code></pre></div></li></ul><h2 id=install-the-governance-policy-framework-hub-components>Install the governance-policy-framework hub components</h2><h3 id=install-via-clusteradm-cli>Install via Clusteradm CLI</h3><p>Ensure <code>clusteradm</code> CLI is installed and is at least v0.3.0. Download and extract the
<a href=https://github.com/open-cluster-management-io/clusteradm/releases/latest>clusteradm binary</a>. For more details see the
<a href=https://github.com/open-cluster-management-io/clusteradm/blob/main/README.md#quick-start>clusteradm GitHub page</a>.</p><ol><li><p>Deploy the policy framework controllers to the hub cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The context name of the clusters in your kubeconfig</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># If the clusters are created by KinD, then the context name will the follow the pattern &#34;kind-&lt;cluster name&gt;&#34;.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;your hub cluster context&gt;           <span style=color:#8f5902;font-style:italic># export CTX_HUB_CLUSTER=kind-hub</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>CTX_MANAGED_CLUSTER</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;your managed cluster context&gt;   <span style=color:#8f5902;font-style:italic># export CTX_MANAGED_CLUSTER=kind-cluster1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Set the deployment namespace</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>HUB_NAMESPACE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;open-cluster-management&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Deploy the policy framework hub controllers</span>
</span></span><span style=display:flex><span>clusteradm install hub-addon --names governance-policy-framework --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div></li><li><p>Ensure the pods are running on the hub with the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>$ kubectl get pods -n <span style=color:#4e9a06>${</span><span style=color:#000>HUB_NAMESPACE</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>NAME                                                       READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>governance-policy-addon-controller-bc78cbcb4-529c2         1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          94s
</span></span><span style=display:flex><span>governance-policy-propagator-8c77f7f5f-kthvh               1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          94s
</span></span></code></pre></div><ul><li>See more about the governance-policy-framework components:<ul><li><a href=https://github.com/open-cluster-management-io/governance-policy-propagator>policy-propagator</a></li><li><a href=https://github.com/open-cluster-management-io/governance-policy-addon-controller>policy-addon-controller</a></li></ul></li></ul></li></ol><h2 id=deploy-the-synchronization-components-to-the-managed-clusters>Deploy the synchronization components to the managed cluster(s)</h2><h3 id=deploy-via-clusteradm-cli>Deploy via Clusteradm CLI</h3><ol><li><p>To deploy the synchronization components to a self-managed hub cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>clusteradm addon <span style=color:#204a87>enable</span> --names governance-policy-framework --clusters &lt;managed_hub_cluster_name&gt; --annotate addon.open-cluster-management.io/on-multicluster-hub<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div><p>To deploy the synchronization components to a managed cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>clusteradm addon <span style=color:#204a87>enable</span> --names governance-policy-framework --clusters &lt;cluster_name&gt; --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div></li><li><p>Verify that the
<a href=https://github.com/open-cluster-management-io/governance-policy-framework-addon>governance-policy-framework-addon controller</a>
pod is running on the managed cluster with the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>$ kubectl get pods -n open-cluster-management-agent-addon
</span></span><span style=display:flex><span>NAME                                                     READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>governance-policy-framework-addon-57579b7c-652zj         1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          87s
</span></span></code></pre></div></li></ol><h2 id=what-is-next>What is next</h2><p>Install the <a href=/docs/getting-started/integration/policy-controllers/>policy controllers</a> to the managed clusters.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7e101cfc3aaf8c0c92e0bff06cd8ef3e>2.3.1.2 - Policy API concepts</h1><h2 id=overview>Overview</h2><p>The policy framework has the following API concepts:</p><ul><li><a href=/docs/getting-started/integration/policy-controllers/policy/#managed-cluster-policy-controllers><em>Policy Templates</em></a> are the policies that perform a desired check or action on a managed cluster. For
example,
<a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/#install-the-configuration-policy-controller>ConfigurationPolicy</a>
objects are embedded in <code>Policy</code> objects under the <code>policy-templates</code> array.</li><li>A <a href=/docs/getting-started/integration/policy-controllers/policy/#policy><code>Policy</code></a> is a grouping mechanism for <em>Policy Templates</em> and is the smallest deployable unit on the hub
cluster. Embedded <em>Policy Templates</em> are distributed to applicable managed clusters and acted upon by the appropriate
<a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/>policy controller</a>.</li><li>A <a href=/docs/getting-started/integration/policy-controllers/policy/#policyset><code>PolicySet</code></a> is a grouping mechanism of <code>Policy</code> objects. Compliance of all grouped <code>Policy</code> objects is
summarized in the <code>PolicySet</code>. A <code>PolicySet</code> is a deployable unit and its distribution is controlled by a
<a href=https://open-cluster-management.io/docs/concepts/content-placement/placement/>Placement</a>.</li><li>A <a href=/docs/getting-started/integration/policy-controllers/policy/#placementbinding><code>PlacementBinding</code></a> binds a <a href=https://open-cluster-management.io/docs/concepts/content-placement/placement/>Placement</a> to a <code>Policy</code> or <code>PolicySet</code>.</li></ul><p><strong>Additional resources:</strong></p><ul><li>View the following resources to learn more about the Policy Addon:<ul><li>Video: <a href="https://www.youtube.com/watch?v=ZZH654t5YpI">Open Cluster Management - Configuring Your Kubernetes Fleet With the Policy Addon</a></li><li>Slides: <a href=/kubecon-na-2022-ocm-multicluster-app-and-config-management.pdf>KubeCon NA 2022 - OCM Multicluster App & Config Management</a></li></ul></li></ul><h2 id=policy>Policy</h2><p>A <code>Policy</code> is a grouping mechanism for <em>Policy Templates</em> and is the smallest deployable unit on the hub cluster.
Embedded <em>Policy Templates</em> are distributed to applicable managed clusters and acted upon by the appropriate
<a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/>policy controller</a>. The compliance state and status of a <code>Policy</code>
represents all embedded <em>Policy Templates</em> in the <code>Policy</code>. The distribution of <code>Policy</code> objects is controlled by a
<a href=https://open-cluster-management.io/docs/concepts/content-placement/placement/>Placement</a>.</p><p>View a simple example of a <code>Policy</code> that embeds a <code>ConfigurationPolicy</code> policy template to manage a namespace called
&ldquo;prod&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>policy.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>policy-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>policies</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>policy.open-cluster-management.io/standards</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NIST SP 800-53</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>policy.open-cluster-management.io/categories</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CM Configuration Management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>policy.open-cluster-management.io/controls</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CM-2 Baseline Configuration</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>remediationAction</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>enforce</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>disabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy-templates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>objectDefinition</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>policy.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ConfigurationPolicy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>policy-namespace-example</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>remediationAction</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inform</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>severity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>low</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>object-templates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>complianceType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>musthave</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>objectDefinition</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># must have namespace &#39;prod&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>annotations</code> are standard annotations for informational purposes and can be used by user interfaces, custom report
scripts, or components that integrate with OCM.</p><p>The optional <code>spec.remediationAction</code> field dictates whether the policy controller should <code>inform</code> or <code>enforce</code> when
violations are found and overrides the <code>remediationAction</code> field on each policy template. When set to <code>inform</code>, the
<code>Policy</code> will become noncompliant if the underlying policy templates detect that the desired state is not met. When set
to <code>enforce</code>, the policy controller applies the desired state when necessary and feasible.</p><p>The <code>policy-templates</code> array contains an array of <a href=/docs/getting-started/integration/policy-controllers/policy/#managed-cluster-policy-controllers><em>Policy Templates</em></a>. Here a
single <code>ConfigurationPolicy</code> called <code>policy-namespace-example</code> defines a <code>Namespace</code> manifest to compare with objects on
the cluster. It has the <code>remediationAction</code> set to <code>inform</code> but it is overridden by the optional global
<code>spec.remediationAction</code>. The <code>severity</code> is for informational purposes similar to the <code>annotations</code>.</p><p>Inside of the embedded <code>ConfigurationPolicy</code>, the <code>object-templates</code> section describes the <code>prod</code> <code>Namespace</code> object
that the <code>ConfigurationPolicy</code> applies to. The action that the <code>ConfigurationPolicy</code> will take is determined by the
<code>complianceType</code>. In this case, it is set to <code>musthave</code> which means the <code>prod</code> <code>Namespace</code> object will be created if it
doesn&rsquo;t exist. Other compliance types include <code>mustnothave</code> and <code>mustonlyhave</code>. <code>mustnothave</code> would delete the <code>prod</code>
<code>Namespace</code> object. <code>mustonlyhave</code> would ensure the <code>prod</code> <code>Namespace</code> object only exists with the fields defined in the
<code>ConfigurationPolicy</code>. See the
<a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/configuration-policy/><code>ConfigurationPolicy</code> page</a> for more information
or see the <a href=/docs/getting-started/integration/policy-controllers/policy/#templating-in-configuration-policies>templating in configuration policies</a> topic for advanced templating
use cases with <code>ConfigurationPolicy</code>.</p><p>When the <code>Policy</code> is bound to a <a href=https://open-cluster-management.io/docs/concepts/content-placement/placement/><code>Placement</code></a> using a <a href=/docs/getting-started/integration/policy-controllers/policy/#placementbinding><code>PlacementBinding</code></a>, the
<code>Policy</code> status will report on each cluster that matches the bound <code>Placement</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>compliant</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Compliant</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>placement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-hub-cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>placementBinding</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>binding-policy-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>clustername</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>local-cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>clusternamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>local-cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>compliant</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Compliant</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>To fully explore the <code>Policy</code> API, run the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get crd policies.policy.open-cluster-management.io -o yaml
</span></span></code></pre></div><p>To fully explore the <code>ConfigurationPolicy</code> API, run the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get crd configurationpolicies.policy.open-cluster-management.io -o yaml
</span></span></code></pre></div><h2 id=placementbinding>PlacementBinding</h2><p>A <code>PlacementBinding</code> binds a <a href=https://open-cluster-management.io/docs/concepts/content-placement/placement/>Placement</a> to a <a href=/docs/getting-started/integration/policy-controllers/policy/#policy><code>Policy</code></a> or <a href=/docs/getting-started/integration/policy-controllers/policy/#policyset><code>PolicySet</code></a>.</p><p>Below is an example of a <code>PlacementBinding</code> that binds the <code>policy-namespace</code> <code>Policy</code> to the <code>placement-hub-cluster</code>
<code>Placement</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>policy.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PlacementBinding</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>binding-policy-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>policies</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>placementRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>apiGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-hub-cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>subjects</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>policy.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>policy-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Once the <code>Policy</code> is bound, it will be distributed to and acted upon by the managed clusters that match the <code>Placement</code>.</p><h2 id=policyset>PolicySet</h2><p>A <code>PolicySet</code> is a grouping mechanism of <a href=/docs/getting-started/integration/policy-controllers/policy/#policy><code>Policy</code></a> objects. Compliance of all grouped <code>Policy</code> objects is
summarized in the <code>PolicySet</code>. A <code>PolicySet</code> is a deployable unit and its distribution is controlled by a
<a href=https://open-cluster-management.io/docs/concepts/content-placement/placement/>Placement</a> when bound through a <a href=/docs/getting-started/integration/policy-controllers/policy/#placementbinding><code>PlacementBinding</code></a>.</p><p>This enables a workflow where subject matter experts write <code>Policy</code> objects and then an IT administrator creates a
<code>PolicySet</code> that groups the previously written <code>Policy</code> objects and binds the <code>PolicySet</code> to a <code>Placement</code> that deploys
the <code>PolicySet</code>.</p><p>An example of a <code>PolicySet</code> is shown below.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>policy.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PolicySet</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ocm-hardening</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>policies</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Apply standard best practices for hardening your Open Cluster Management installation.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policies</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>policy-check-backups</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>policy-managedclusteraddon-available</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>policy-subscriptions</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=managed-cluster-policy-controllers>Managed cluster policy controllers</h2><p>The <a href=/docs/getting-started/integration/policy-controllers/policy/#policy><code>Policy</code></a> on the hub delivers the policies defined in <code>spec.policy-templates</code> to the managed clusters via
the policy framework controllers. Once on the managed cluster, these <em>Policy Templates</em> are acted upon by the associated
controller on the managed cluster. The policy framework supports delivering the <em>Policy Template</em> kinds listed here:</p><ul><li><p>Configuration policy</p><p>The <code>ConfigurationPolicy</code> is provided by OCM and defines Kubernetes manifests to compare with objects that currently
exist on the cluster. The action that the <code>ConfigurationPolicy</code> will take is determined by its <code>complianceType</code>.
Compliance types include <code>musthave</code>, <code>mustnothave</code>, and <code>mustonlyhave</code>. <code>musthave</code> means the object should have the
listed keys and values as a subset of the larger object. <code>mustnothave</code> means an object matching the listed keys and
values should not exist. <code>mustonlyhave</code> ensures objects only exist with the keys and values exactly as defined. See
the page on <a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/configuration-policy/>Configuration Policy</a> for more
information.</p></li><li><p>Open Policy Agent Gatekeeper</p><p>Gatekeeper is a validating webhook with auditing capabilities that can enforce custom resource definition-based
policies that are run with the Open Policy Agent (OPA). Gatekeeper <code>ConstraintTemplates</code> and constraints can be
provided in an OCM <code>Policy</code> to sync to managed clusters that have Gatekeeper installed on them. See the page on
<a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/gatekeeper/>Gatekeeper integration</a> for more information.</p></li></ul><h2 id=templating-in-configuration-policies>Templating in configuration policies</h2><p>Configuration policies support the inclusion of Golang text templates in the object definitions. These templates are
resolved at runtime either on the hub cluster or the target managed cluster using configurations related to that
cluster. This gives you the ability to define configuration policies with dynamic content and to inform or enforce
Kubernetes resources that are customized to the target cluster.</p><p>The template syntax must follow the Golang template language specification, and the resource definition generated from
the resolved template must be a valid YAML. (See the
<a href=https://golang.org/pkg/text/template/>Golang documentation about package templates</a> for more information.) Any errors
in template validation appear as policy violations. When you use a custom template function, the values are replaced at
runtime.</p><p>Template functions, such as resource-specific and generic <code>lookup</code> template functions, are available for referencing
Kubernetes resources on the hub cluster (using the <code>{{hub ... hub}}</code> delimiters), or managed cluster (using the
<code>{{ ... }}</code> delimiters). See the <a href=/docs/getting-started/integration/policy-controllers/policy/#hub-cluster-templates>Hub cluster templates section</a> for more details. The
resource-specific functions are used for convenience and makes content of the resources more accessible. If you use the
generic function, <code>lookup</code>, which is more advanced, it is best to be familiar with the YAML structure of the resource
that is being looked up. In addition to these functions, utility functions like <code>base64encode</code>, <code>base64decode</code>,
<code>indent</code>, <code>autoindent</code>, <code>toInt</code>, and <code>toBool</code> are also available.</p><p>To conform templates with YAML syntax, templates must be set in the policy resource as strings using quotes or a block
character (<code>|</code> or <code>></code>). This causes the resolved template value to also be a string. To override this, consider using
<code>toInt</code> or <code>toBool</code> as the final function in the template to initiate further processing that forces the value to be
interpreted as an integer or boolean respectively.</p><p>To bypass template processing you can either:</p><ul><li>Override a single template by wrapping the template in additional braces. For example, the template
<code>{{ template content }}</code> would become <code>{{ '{{ template content }}' }}</code>.</li><li>Override all templates in a <code>ConfigurationPolicy</code> by adding the
<code>policy.open-cluster-management.io/disable-templates: "true"</code> annotation in the <code>ConfigurationPolicy</code> section of your
<code>Policy</code>. Template processing will be bypassed for that <code>ConfigurationPolicy</code>.</li></ul><h3 id=hub-cluster-templating-in-configuration-policies>Hub cluster templating in configuration policies</h3><p>Hub cluster templates are used to define configuration policies that are dynamically customized to the target cluster.
This reduces the need to create separate policies for each target cluster or hardcode configuration values in the policy
definitions.</p><p>Hub cluster templates are based on Golang text template specifications, and the <code>{{hub … hub}}</code> delimiter indicates a
hub cluster template in a configuration policy.</p><p>A configuration policy definition can contain both hub cluster and managed cluster templates. Hub cluster templates are
processed first on the hub cluster, then the policy definition with resolved hub cluster templates is propagated to the
target clusters. On the managed cluster, the Configuration Policy controller processes any managed cluster templates in
the policy definition and then enforces or verifies the fully resolved object definition.</p><p>In OCM versions 0.9.x and older, policies are processed on the hub cluster only upon creation or after an update.
Therefore, hub cluster templates are only resolved to the data in the referenced resources upon policy creation or
update. Any changes to the referenced resources are not automatically synced to the policies.</p><p>A special annotation, <code>policy.open-cluster-management.io/trigger-update</code> can be used to indicate changes to the data
referenced by the templates. Any change to the special annotation value initiates template processing, and the latest
contents of the referenced resource are read and updated in the policy definition that is the propagator for processing
on managed clusters. A typical way to use this annotation is to increment the value by one each time.</p><h3 id=templating-value-encryption>Templating value encryption</h3><p>The encryption algorithm uses AES-CBC with 256-bit keys. Each encryption key is unique per managed cluster and is
automatically rotated every 30 days. This ensures that your decrypted value is never stored in the policy on the managed
cluster.</p><p>To force an immediate encryption key rotation, delete the <code>policy.open-cluster-management.io/last-rotated</code> annotation on
the <code>policy-encryption-key</code> Secret in the managed cluster namespace on the hub cluster. Policies are then reprocessed to
use the new encryption key.</p><h3 id=templating-functions>Templating functions</h3><table><thead><tr><th>Function</th><th>Description</th><th>Sample</th></tr></thead><tbody><tr><td><code>fromSecret</code></td><td>Returns the value of the given data key in the secret.</td><td><code>PASSWORD: '{{ fromSecret "default" "localsecret" "PASSWORD" }}'</code></td></tr><tr><td><code>fromConfigmap</code></td><td>Returns the value of the given data key in the ConfigMap.</td><td><code>log-file: '{{ fromConfigMap "default" "logs-config" "log-file" }}'</code></td></tr><tr><td><code>fromClusterClaim</code></td><td>Returns the value of <code>spec.value</code> in the <code>ClusterClaim</code> resource.</td><td><code>platform: '{{ fromClusterClaim "platform.open-cluster-management.io" }}'</code></td></tr><tr><td><code>lookup</code></td><td>Returns the Kubernetes resource as a JSON compatible map. Note that if the requested resource does not exist, an empty map is returned.</td><td><code>metrics-url: |</code><br><code>http://{{ (lookup "v1" "Service" "default" "metrics").spec.clusterIP }}:8080</code></td></tr><tr><td><code>base64enc</code></td><td>Returns a <code>base64</code> encoded value of the input string.</td><td><code>USER_NAME: '{{ fromConfigMap "default" "myconfigmap" "admin-user" | base64enc }}'</code></td></tr><tr><td><code>base64dec</code></td><td>Returns a <code>base64</code> decoded value of the input string.</td><td><code>app-name: |</code><br><code>"{{ ( lookup "v1" "Secret" "testns" "mytestsecret") .data.appname ) | base64dec }}"</code></td></tr><tr><td><code>indent</code></td><td>Returns the input string indented by the given number of spaces.</td><td><code>Ca-cert: |</code><br><code>{{ ( index ( lookup "v1" "Secret" "default" "mycert-tls" ).data "ca.pem" ) | base64dec | indent 4 }}</code></td></tr><tr><td><code>autoindent</code></td><td>Acts like the <code>indent</code> function but automatically determines the number of leading spaces needed based on the number of spaces before the template.</td><td><code>Ca-cert: |</code><br><code>{{ ( index ( lookup "v1" "Secret" "default" "mycert-tls" ).data "ca.pem" ) | base64dec | autoindent }}</code></td></tr><tr><td><code>toInt</code></td><td>Returns the integer value of the string and ensures that the value is interpreted as an integer in the YAML.</td><td><code>vlanid: |</code><br><code>{{ (fromConfigMap "site-config" "site1" "vlan") | toInt }}</code></td></tr><tr><td><code>toBool</code></td><td>Returns the boolean value of the input string and ensures that the value is interpreted as a boolean in the YAML.</td><td><code>enabled: |</code><br><code>{{ (fromConfigMap "site-config" "site1" "enabled") | toBool }}</code></td></tr><tr><td><code>protect</code></td><td>Encrypts the input string. It is decrypted when the policy is evaluated. On the replicated policy in the managed cluster namespace, the resulting value resembles the following: <code>$ocm_encrypted:&lt;encrypted-value></code></td><td><code>enabled: |</code><br><code>{{hub "(lookup "route.openshift.io/v1" "Route" "openshift-authentication" "oauth-openshift").spec.host | protect hub}}</code></td></tr></tbody></table><p>Additionally, OCM supports the following template functions that are included from the <code>sprig</code> open source project:</p><ul><li><code>cat</code></li><li><code>contains</code></li><li><code>default</code></li><li><code>empty</code></li><li><code>fromJson</code></li><li><code>hasPrefix</code></li><li><code>hasSuffix</code></li><li><code>join</code></li><li><code>list</code></li><li><code>lower</code></li><li><code>mustFromJson</code></li><li><code>quote</code></li><li><code>replace</code></li><li><code>semver</code></li><li><code>semverCompare</code></li><li><code>split</code></li><li><code>splitn</code></li><li><code>ternary</code></li><li><code>trim</code></li><li><code>until</code></li><li><code>untilStep</code></li><li><code>upper</code></li></ul><p>See the <a href=https://masterminds.github.io/sprig>Sprig documentation</a> for more details.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e58634300ebdc6b417c2d11c29bffedd>2.3.1.3 - Configuration Policy</h1><p>The <code>ConfigurationPolicy</code> defines Kubernetes manifests to compare with objects that currently exist on the cluster. The
Configuration policy controller is provided by Open Cluster Management and runs on managed clusters.</p><p>View the <a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/policy/#managed-cluster-policy-controllers>Policy API concepts</a> page to learn more
about the <code>ConfigurationPolicy</code> API.</p><h2 id=prerequisites>Prerequisites</h2><p>You must meet the following prerequisites to install the configuration policy controller:</p><ul><li><p>Ensure <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl><code>kubectl</code></a> and
<a href=https://kubectl.docs.kubernetes.io/installation/kustomize/><code>kustomize</code></a> are installed.</p></li><li><p>Ensure <a href=https://golang.org/doc/install>Golang</a> is installed, if you are planning to install from the source.</p></li><li><p>Ensure the <code>open-cluster-management</code> <em>policy framework</em> is installed. See
<a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/policy-framework/>Policy Framework</a> for more information.</p></li></ul><h2 id=installing-the-configuration-policy-controller>Installing the configuration policy controller</h2><h3 id=deploy-via-clusteradm-cli>Deploy via Clusteradm CLI</h3><p>Ensure <code>clusteradm</code> CLI is installed and is newer than v0.3.0. Download and extract the
<a href=https://github.com/open-cluster-management-io/clusteradm/releases/latest>clusteradm binary</a>. For more details see the
<a href=https://github.com/open-cluster-management-io/clusteradm/blob/main/README.md#quick-start>clusteradm GitHub page</a>.</p><ol><li><p>Deploy the configuration policy controller to the managed clusters (this command is the same for a self-managed hub):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Deploy the configuration policy controller</span>
</span></span><span style=display:flex><span>clusteradm addon <span style=color:#204a87>enable</span> addon --names config-policy-controller --clusters &lt;cluster_name&gt; --context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div></li><li><p>Ensure the pod is running on the managed cluster with the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>$ kubectl get pods -n open-cluster-management-agent-addon
</span></span><span style=display:flex><span>NAME                                               READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>config-policy-controller-7f8fb64d8c-pmfx4          1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          44s
</span></span></code></pre></div></li></ol><h2 id=sample-configuration-policy>Sample configuration policy</h2><p>After a successful deployment, test the policy framework and configuration policy controller with a sample policy.</p><p>For more information on how to use a <code>ConfigurationPolicy</code>, read the
<a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/policy-framework/#policy><code>Policy</code> API concept section</a>.</p><ol><li><p>Run the following command to create a policy on the hub that uses <code>Placement</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Configure kubectl to point to the hub cluster</span>
</span></span><span style=display:flex><span>kubectl config use-context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_HUB_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Apply the example policy and placement</span>
</span></span><span style=display:flex><span>kubectl apply -n default -f https://raw.githubusercontent.com/open-cluster-management-io/policy-collection/main/community/CM-Configuration-Management/policy-pod-placement.yaml
</span></span></code></pre></div></li><li><p>Update the <code>Placement</code> to distribute the policy to the managed cluster with the following command (this
<code>clusterSelector</code> will deploy the policy to all managed clusters):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl patch -n default placement.cluster.open-cluster-management.io/placement-policy-pod --type<span style=color:#ce5c00;font-weight:700>=</span>merge -p <span style=color:#4e9a06>&#34;{\&#34;spec\&#34;:{\&#34;predicates\&#34;:[{\&#34;requiredClusterSelector\&#34;:{\&#34;labelSelector\&#34;:{\&#34;matchExpressions\&#34;:[]}}}]}}&#34;</span>
</span></span></code></pre></div></li><li><p>Make sure the <code>default</code> namespace has a <code>ManagedClusterSetBinding</code> for a <code>ManagedClusterSet</code> with at least one
managed cluster resource in the <code>ManagedClusterSet</code>. See
<a href=https://open-cluster-management.io/docs/concepts/cluster-inventory/managedclusterset/#bind-managedclusterset-to-a-namespace>Bind ManagedClusterSet to a namespace</a> for more
information on this.</p></li><li><p>To confirm that the managed cluster is selected by the <code>Placement</code>, run the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>$ kubectl get -n default placementdecision.cluster.open-cluster-management.io/placement-policy-pod-decision-1 -o yaml
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>status:
</span></span><span style=display:flex><span>  decisions:
</span></span><span style=display:flex><span>  - clusterName: &lt;managed cluster name&gt;
</span></span><span style=display:flex><span>    reason: <span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div></li><li><p>Enforce the policy to make the configuration policy automatically correct any misconfigurations on the managed
cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>$ kubectl patch -n default policy.policy.open-cluster-management.io/policy-pod --type<span style=color:#ce5c00;font-weight:700>=</span>merge -p <span style=color:#4e9a06>&#34;{\&#34;spec\&#34;:{\&#34;remediationAction\&#34;: \&#34;enforce\&#34;}}&#34;</span>
</span></span><span style=display:flex><span>policy.policy.open-cluster-management.io/policy-pod patched
</span></span></code></pre></div></li><li><p>After a few seconds, your policy is propagated to the managed cluster. To confirm, run the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>$ kubectl config use-context <span style=color:#4e9a06>${</span><span style=color:#000>CTX_MANAGED_CLUSTER</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>$ kubectl get policy -A
</span></span><span style=display:flex><span>NAMESPACE   NAME                 REMEDIATION ACTION   COMPLIANCE STATE   AGE
</span></span><span style=display:flex><span>cluster1    default.policy-pod   enforce              Compliant          4m32s
</span></span></code></pre></div></li><li><p>The missing pod is created by the policy on the managed cluster. To confirm, run the following command on the managed
cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>$ kubectl get pod -n default
</span></span><span style=display:flex><span>NAME               READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>sample-nginx-pod   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          23s
</span></span></code></pre></div></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-da965a88320ed64c7db3afc8a1398f1e>2.3.1.4 - Open Policy Agent Gatekeeper</h1><p><a href=https://open-policy-agent.github.io/gatekeeper/website/>Gatekeeper</a> is a validating webhook with auditing capabilities
that can enforce custom resource definition-based policies that are run with the Open Policy Agent (OPA). Gatekeeper
constraints can be used to evaluate Kubernetes resource compliance. You can leverage OPA as the policy engine, and use
Rego as the policy language.</p><h2 id=installing-gatekeeper>Installing Gatekeeper</h2><p>See the <a href=https://open-policy-agent.github.io/gatekeeper/website/docs/install>Gatekeeper documentation</a> to install the
desired version of Gatekeeper to the managed cluster.</p><h2 id=sample-gatekeeper-policy>Sample Gatekeeper policy</h2><p>Gatekeeper policies are written using constraint templates and constraints. View the following YAML examples that use
Gatekeeper constraints in an OCM <code>Policy</code>:</p><ul><li><p><code>ConstraintTemplates</code> and constraints: Use the Gatekeeper integration feature by using OCM policies for multicluster
distribution of Gatekeeper constraints and Gatekeeper audit results aggregation on the hub cluster. The following
example defines a Gatekeeper <code>ConstraintTemplate</code> and constraint (<code>K8sRequiredLabels</code>) to ensure the &ldquo;gatekeeper&rdquo;
label is set on all namespaces:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>policy.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>require-gatekeeper-labels-on-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>remediationAction</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inform</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># (1)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>disabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy-templates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>objectDefinition</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>templates.gatekeeper.sh/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ConstraintTemplate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>k8srequiredlabels</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>crd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>names</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>K8sRequiredLabels</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>validation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>openAPIV3Schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>properties</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>array</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>items</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>string</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>targets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>target</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>admission.k8s.gatekeeper.sh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                package k8srequiredlabels
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                violation[{&#34;msg&#34;: msg, &#34;details&#34;: {&#34;missing_labels&#34;: missing}}] {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                  provided := {label | input.review.object.metadata.labels[label]}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                  required := {label | label := input.parameters.labels[_]}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                  missing := required - provided
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                  count(missing) &gt; 0
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                  msg := sprintf(&#34;you must provide labels: %v&#34;, [missing])
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                }</span><span style=color:#f8f8f8;text-decoration:underline>                
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>objectDefinition</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>constraints.gatekeeper.sh/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>K8sRequiredLabels</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ns-must-have-gk</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>enforcementAction</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dryrun</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>match</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>kinds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>kinds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;Namespace&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;gatekeeper&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ol><li>Since the remediationAction is set to &ldquo;inform&rdquo;, the <code>enforcementAction</code> field of the Gatekeeper constraint is
overridden to &ldquo;warn&rdquo;. This means that Gatekeeper detects and warns you about creating or updating a namespace that
is missing the &ldquo;gatekeeper&rdquo; label. If the policy <code>remediationAction</code> is set to &ldquo;enforce&rdquo;, the Gatekeeper constraint
<code>enforcementAction</code> field is overridden to &ldquo;deny&rdquo;. In this context, this configuration prevents any user from
creating or updating a namespace that is missing the gatekeeper label.</li></ol><p>With the previous policy, you might receive the following policy status message:</p><blockquote><p>warn - you must provide labels: {&ldquo;gatekeeper&rdquo;} (on Namespace default); warn - you must provide labels:
{&ldquo;gatekeeper&rdquo;} (on Namespace gatekeeper-system).</p></blockquote><p>Once a policy containing Gatekeeper constraints or <code>ConstraintTemplates</code> is deleted, the constraints and
<code>ConstraintTemplates</code> are also deleted from the managed cluster.</p><p><strong>Notes:</strong></p><ul><li>The Gatekeeper audit functionality runs every minute by default. Audit results are sent back to the hub cluster to
be viewed in the OCM policy status of the managed cluster.</li></ul></li><li><p>Auditing Gatekeeper events: The following example uses an OCM
<a href=getting-started/integration/configuration-policy>configuration policy</a> within an OCM policy to check for Kubernetes
API requests denied by the Gatekeeper admission webhook:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>policy.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>policy-gatekeeper-admission</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>remediationAction</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inform</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>disabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy-templates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>objectDefinition</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>policy.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ConfigurationPolicy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>policy-gatekeeper-admission</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>remediationAction</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inform</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># will be overridden by remediationAction in parent policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>severity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>low</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>object-templates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>complianceType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>mustnothave</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>objectDefinition</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Event</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gatekeeper-system</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># set it to the actual namespace where gatekeeper is running if different</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>constraint_action</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deny</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>constraint_kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>K8sRequiredLabels</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>constraint_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ns-must-have-gk</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>event_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>violation</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-fbfe1d4ee41edbd2d79ba19791790925>2.3.2 - Application lifecycle management</h1><p>After the setup of Open Cluster Management (OCM) hub and managed clusters,
you could install the OCM built-in application management add-on.
The OCM application management add-on leverages the
<a href=https://argo-cd.readthedocs.io/>Argo CD</a>
to provide declarative GitOps based application lifecycle management across multiple Kubernetes clusters.</p><h2 id=architecture>Architecture</h2><p>Traditional Argo CD resource delivery primarily uses a push model,
where resources are deployed from a centralized Argo CD instance to remote or managed clusters.</p><div style=text-align:center;padding:20px><img src=https://github.com/open-cluster-management-io/argocd-pull-integration/raw/main/assets/push.png alt="Argo CD Push Model" style="margin:0 auto;width:80%"></div><p>With the OCM Argo CD add-on, users can leverage a pull based resource delivery model,
where managed clusters pull and apply application configurations.</p><div style=text-align:center;padding:20px><img src=https://github.com/open-cluster-management-io/argocd-pull-integration/raw/main/assets/pull.png alt="Argo CD Pull Model" style="margin:0 auto;width:80%"></div><p>For more details, visit the
<a href=https://github.com/open-cluster-management-io/argocd-pull-integration>Argo CD Pull Integration GitHub page</a>.</p><h2 id=prerequisite>Prerequisite</h2><p>You must meet the following prerequisites to install the application lifecycle management add-on:</p><ul><li><p>Ensure <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl>kubectl</a> are installed.</p></li><li><p>Ensure the OCM <em>cluster manager</em> is installed. See <a href=https://open-cluster-management.io/docs/getting-started/installation/start-the-control-plane/>Start the control plane</a> for more information.</p></li><li><p>Ensure the OCM <em>klusterlet</em> is installed. See <a href=https://open-cluster-management.io/docs/getting-started/installation/register-a-cluster/>Register a cluster</a> for more information.</p></li><li><p>Ensure <code>clusteradm</code> CLI tool is installed. Download and extract the <a href=https://github.com/open-cluster-management-io/clusteradm/releases/latest>clusteradm binary</a>. For more details see the <a href=https://github.com/open-cluster-management-io/clusteradm/blob/main/README.md#quick-start>clusteradm GitHub page</a>.</p></li></ul><h2 id=installation>Installation</h2><p>Install Argo CD on the Hub cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create namespace argocd
</span></span><span style=display:flex><span>kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
</span></span></code></pre></div><p>See <a href=https://argo-cd.readthedocs.io/en/stable/getting_started/>Argo CD website</a> for more details.</p><p>Install the OCM Argo CD add-on on the Hub cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm install hub-addon --names argocd
</span></span></code></pre></div><p>If your hub controller starts successfully, you should see:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n argocd get deploy argocd-pull-integration
</span></span><span style=display:flex><span>NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>argocd-pull-integration   1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           55s
</span></span></code></pre></div><p>Enable the add-on for your choice of Managed clusters:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm addon <span style=color:#204a87>enable</span> --names argocd --clusters cluster1,cluster2
</span></span></code></pre></div><p>Replace <code>cluster1</code> and <code>cluster2</code> with your Managed cluster names.</p><p>If your add-on starts successfully, you should see:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n cluster1 get managedclusteraddon argocd
</span></span><span style=display:flex><span>NAME     AVAILABLE   DEGRADED   PROGRESSING
</span></span><span style=display:flex><span>argocd   True                   False
</span></span></code></pre></div><p>On the Hub cluster, apply the example <code>guestbook-app-set</code> manifest:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://raw.githubusercontent.com/open-cluster-management-io/ocm/refs/heads/main/solutions/deploy-argocd-apps-pull/example/guestbook-app-set.yaml
</span></span></code></pre></div><p><strong>Note:</strong> The Application template inside the ApplicationSet must contain the following content:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>labels:
</span></span><span style=display:flex><span>  apps.open-cluster-management.io/pull-to-ocm-managed-cluster: <span style=color:#4e9a06>&#39;true&#39;</span>
</span></span><span style=display:flex><span>annotations:
</span></span><span style=display:flex><span>  argocd.argoproj.io/skip-reconcile: <span style=color:#4e9a06>&#39;true&#39;</span>
</span></span><span style=display:flex><span>  apps.open-cluster-management.io/ocm-managed-cluster: <span style=color:#4e9a06>&#39;{{name}}&#39;</span>
</span></span></code></pre></div><p>The label allows the pull model controller to select the Application for processing.</p><p>The <code>skip-reconcile</code> annotation is to prevent the Application from reconciling on the Hub cluster.</p><p>The <code>ocm-managed-cluster</code> annotation is for the ApplicationSet to generate multiple Application based on each cluster generator targets.</p><p>When this guestbook ApplicationSet reconciles, it will generate an Application for the registered Managed clusters. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n argocd get appset
</span></span><span style=display:flex><span>NAME            AGE
</span></span><span style=display:flex><span>guestbook-app   84s
</span></span><span style=display:flex><span>$ kubectl -n argocd get app
</span></span><span style=display:flex><span>NAME                     SYNC STATUS   HEALTH STATUS
</span></span><span style=display:flex><span>cluster1-guestbook-app
</span></span><span style=display:flex><span>cluster2-guestbook-app
</span></span></code></pre></div><p>On the Hub cluster, the pull controller will wrap the Application with a ManifestWork. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n cluster1 get manifestwork
</span></span><span style=display:flex><span>NAME                          AGE
</span></span><span style=display:flex><span>cluster1-guestbook-app-d0e5   2m41s
</span></span></code></pre></div><p>On a Managed cluster, you should see that the Application is pulled down successfully. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n argocd get app
</span></span><span style=display:flex><span>NAME                     SYNC STATUS   HEALTH STATUS
</span></span><span style=display:flex><span>cluster1-guestbook-app   Synced        Healthy
</span></span><span style=display:flex><span>$ kubectl -n guestbook get deploy
</span></span><span style=display:flex><span>NAME           READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>guestbook-ui   1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           7m36s
</span></span></code></pre></div><p>On the Hub cluster, the status controller will sync the dormant Application with the ManifestWork status feedback. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n argocd get app
</span></span><span style=display:flex><span>NAME                     SYNC STATUS   HEALTH STATUS
</span></span><span style=display:flex><span>cluster1-guestbook-app   Synced        Healthy
</span></span><span style=display:flex><span>cluster2-guestbook-app   Synced        Healthy
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-aa34d12e6f79e33b7aa948ed49652fe7>2.3.3 - Cluster proxy</h1><p><a href=https://github.com/open-cluster-management-io/cluster-proxy>Cluster proxy</a>
is an OCM addon providing L4 network connectivity from hub cluster to
the managed clusters without <strong>any additional requirement</strong> to the managed
cluster&rsquo;s network infrastructure by leveraging the Kubernetes official SIG
sub-project <a href=https://github.com/kubernetes-sigs/apiserver-network-proxy>apiserver-network-proxy</a>.</p><h2 id=background>Background</h2><p>The original architecture of OCM allows a cluster from anywhere to be
registered and managed by OCM&rsquo;s control plane (i.e. the hub cluster)
as long as a <a href=https://open-cluster-management.io/docs/getting-started/installation/register-a-cluster/>klusterlet agent</a>
can reach hub cluster&rsquo;s endpoint. So the minimal requirement for the
managed cluster&rsquo;s network infrastructure in OCM is &ldquo;klusterlet -> hub&rdquo;
connectivity. However, there are still some cases where the components
in the hub cluster hope to proactively dail/request the services in the
managed clusters which will need the &ldquo;hub -> klusterlet&rdquo; connectivity on
the other hand. In addition to that, the cases can be even more complex
when each of the managed clusters are not in the same network.</p><p>Cluster proxy is aiming at seamlessly delivering the outbound L4 requests
to the services in the managed cluster&rsquo;s network without any assumptions
upon the infrastructure as long as the clusters are successfully registered.
Basically the connectivity provided by cluster proxy is working over the
secured reserve proxy tunnels established by the apiserver-network-proxy.</p><h3 id=about-apiserver-network-proxy>About apiserver-network-proxy</h3><p>Apiserver-network-proxy is the underlying technique of a Kubernetes'
feature called <a href=https://kubernetes.io/docs/tasks/extend-kubernetes/setup-konnectivity/>konnectivity egress-selector</a>
which is majorly for setting up a TCP-level proxy for kube-apiserver
to get access to the node/cluster network. Here are a few terms we need
to clarify before we elaborate on how the cluster proxy resolve multi-cluster
control plane network connectivity for us:</p><ul><li><strong>Proxy Tunnel</strong>: A Grpc long connection that multiplexes and transmits
TCP-level traffic from the proxy servers to the proxy agents. Note that
there will be only one tunnel instance between each pair of server and
agent.</li><li><strong>Proxy Server</strong>: An mTLS Grpc server opened for establishing tunnels
which is the traffic ingress of proxy tunnel.</li><li><strong>Proxy Agent</strong>: A mTLS Grpc agent that maintains the tunnel between the
server and is also the egress of the proxy tunnel.</li><li><strong>Konnectivity Client</strong>: The SDK library for talking through the tunnel.
Applicable to any Golang client of which the <code>Dialer</code> is overridable.
Note that for non-golang clients, the proxy server also supports
HTTP-Connect based proxying as alternative.</li></ul><h2 id=architecture>Architecture</h2><p>Cluster proxy runs inside OCM&rsquo;s hub cluster as an addon manager which is
developed based on the <a href=https://open-cluster-management.io/docs/concepts/add-on-extensibility/addon/>Addon-Framework</a>.
The addon manager of cluster proxy will be responsible for:</p><ol><li>Managing the installation of proxy servers in the hub cluster.</li><li>Managing the installation of proxy agents in the managed cluster.</li><li>Collecting healthiness and the other stats consistently in the hub cluster.</li></ol><p>The following picture shows the overall architecture of cluster proxy:</p><div style=text-align:center;padding:20px><img src=/cluster-proxy-architecture.png alt="Cluster proxy architecture" style="margin:0 auto;width:60%"></div><p>Note that the green lines in the picture above is the active proxy tunnels
between proxy servers and agents, and HA setup is natively supported by
apiserver-network-proxy both for the servers and the agents. The orange
dash line started by the konnectivity client is the path of how the traffic
flows from the hub cluster to arbitrary managed clusters. Meanwhile the core
components including registration and work will help us manage the lifecycle
of all the components distributed in the multiple managed clusters, so the
hub admin won&rsquo;t need to directly operate the managed clusters to install
or configure the proxy agents no more.</p><h2 id=prerequisite>Prerequisite</h2><p>You must meet the following prerequisites to install the cluster-proxy:</p><ul><li><p>Ensure your <code>open-cluster-management</code> release is greater than <code>v0.5.0</code>.</p></li><li><p>Ensure <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl><code>kubectl</code></a> is installed.</p></li><li><p>Ensure <a href=https://helm.sh/docs/intro/install/><code>helm</code></a> is installed.</p></li></ul><h2 id=installation>Installation</h2><p>To install the cluster proxy addon to the OCM control plane, run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ helm repo add ocm https://open-cluster-management.io/helm-charts
</span></span><span style=display:flex><span>$ helm repo update
</span></span><span style=display:flex><span>$ helm search repo ocm
</span></span><span style=display:flex><span>NAME                              	CHART VERSION	APP VERSION	DESCRIPTION
</span></span><span style=display:flex><span>ocm/cluster-proxy                 	v0.1.1       	1.0.0      	A Helm chart <span style=color:#204a87;font-weight:700>for</span> Cluster-Proxy
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Then run the following helm command to install the cluster-proxy addon:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ helm install -n open-cluster-management-addon --create-namespace <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    cluster-proxy ocm/cluster-proxy
</span></span></code></pre></div><p><strong>Note:</strong> If you&rsquo;re using a non-Kind cluster, for example, an Openshift cluster,
you need to configure the <code>ManagedProxyConfiguration</code> by setting <code>proxyServer.entrypointAddress</code>
in the <code>values.yaml</code> to the address of the proxy server.</p><p>To do this at install time, you can run the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ helm install -n open-cluster-management-addon --create-namespace <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    cluster-proxy ocm/cluster-proxy <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#4e9a06>&#34;proxyServer.entrypointAddress=&lt;address of the proxy server&gt;&#34;</span>
</span></span></code></pre></div><p>After the installation, you can check the deployment status of the cluster-proxy
addon by running the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n open-cluster-management-addon get deploy
</span></span><span style=display:flex><span>NAME                                   READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>cluster-proxy                          3/3     <span style=color:#0000cf;font-weight:700>3</span>            <span style=color:#0000cf;font-weight:700>3</span>           24h
</span></span><span style=display:flex><span>cluster-proxy-addon-manager            1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           24h
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Then the addon manager of cluster-proxy will be created into the hub cluster
in the form of a deployment named <code>cluster-proxy-addon-manager</code>. As is also
shown above, the proxy servers will also be created as deployment resource
called <code>cluster-proxy</code>.</p><p>By default, the addon manager will be automatically discovering the addition
or removal the managed clusters and installs the proxy agents into them on
the fly. To check out the healthiness status of the proxy agents, we can run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$  kubectl get managedclusteraddon -A
</span></span><span style=display:flex><span>NAMESPACE     NAME                     AVAILABLE   DEGRADED   PROGRESSING
</span></span><span style=display:flex><span>&lt;cluster#1&gt;   cluster-proxy            True
</span></span><span style=display:flex><span>&lt;cluster#2&gt;   cluster-proxy            True
</span></span></code></pre></div><p>The proxy agent distributed in the managed cluster will be periodically
renewing the lease lock of the addon instance.</p><h2 id=usage>Usage</h2><h3 id=command-line-tools>Command-line tools</h3><p>Using the <a href=https://open-cluster-management.io/getting-started/quick-start/#install-clusteradm-cli-tool>clusteradm</a>
to check the status of the cluster-proxy addon:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm proxy health
</span></span><span style=display:flex><span>CLUSTER NAME    INSTALLED    AVAILABLE    PROBED HEALTH    LATENCY
</span></span><span style=display:flex><span>&lt;cluster#1&gt;     True         True         True             67.595144ms
</span></span><span style=display:flex><span>&lt;cluster#2&gt;     True         True         True             85.418368ms
</span></span></code></pre></div><h3 id=example-code>Example code</h3><p>An <a href=https://github.com/open-cluster-management-io/cluster-proxy/blob/main/examples/test-client/main.go>example client</a>
in the cluster proxy repo shows us how to dynamically talk to the kube-apiserver
of a managed cluster from the hub cluster by simply prescribing the name of
the target cluster. Here&rsquo;s also a TL;DR code snippet:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 1. instantiate a dialing tunnel instance.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// NOTE: recommended to be a singleton in your golang program.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>tunnel</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>konnectivity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>CreateSingleUseGrpcTunnel</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>TODO</span><span style=color:#000;font-weight:700>(),</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>your</span> <span style=color:#000>proxy</span> <span style=color:#000>server</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>&gt;,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>grpc</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithTransportCredentials</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>grpccredentials</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTLS</span><span style=color:#000;font-weight:700>(&lt;</span><span style=color:#000>your</span> <span style=color:#000>proxy</span> <span style=color:#000>server</span> <span style=color:#000>TLS</span> <span style=color:#000>config</span><span style=color:#000;font-weight:700>&gt;)),</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>panic</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 2. Overriding the Dialer to tunnel. Dialer is a common abstraction
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// in Golang SDK.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>cfg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dial</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>tunnel</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>DialContext</span>
</span></span></code></pre></div><p>Another example will be <a href=https://github.com/oam-dev/cluster-gateway/blob/063b60e959ba607f0108c8b4cb99963f82f504b5/pkg/apis/cluster/v1alpha1/transport.go#L50-L58>cluster-gateway</a>
which is an aggregated apiserver optionally working over cluster-proxy for
routing traffic to the managed clusters dynamically in HTTPs protocol.</p><p>Note that by default the client credential for konnectivity client will be
persisted as secrets resources under the namespace where the addon-manager
is running. With that being said, to mount the secret to the systems in the
other namespaces, the users are expected to copy the secret on their own
manually.</p><h2 id=more-insights>More insights</h2><h3 id=troubleshooting>Troubleshooting</h3><p>The installation of proxy servers and agents are prescribed by the custom
resource called &ldquo;managedproxyconfiguration&rdquo;. We can check it out by the
following commands:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get managedproxyconfiguration cluster-proxy -o yaml
</span></span><span style=display:flex><span>apiVersion: proxy.open-cluster-management.io/v1alpha1
</span></span><span style=display:flex><span>kind: ManagedProxyConfiguration
</span></span><span style=display:flex><span>metadata: ...
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  proxyAgent:
</span></span><span style=display:flex><span>    image: &lt;expected image of the proxy agents&gt;
</span></span><span style=display:flex><span>    replicas: &lt;expected replicas of proxy agents&gt;
</span></span><span style=display:flex><span>  proxyServer:
</span></span><span style=display:flex><span>    entrypoint:
</span></span><span style=display:flex><span>      loadBalancerService:
</span></span><span style=display:flex><span>        name: proxy-agent-entrypoint
</span></span><span style=display:flex><span>      type: LoadBalancerService <span style=color:#8f5902;font-style:italic># Or &#34;Hostname&#34; to set a fixed address</span>
</span></span><span style=display:flex><span>                                <span style=color:#8f5902;font-style:italic># for establishing proxy tunnels.</span>
</span></span><span style=display:flex><span>    image: &lt;expected image of the proxy servers&gt;
</span></span><span style=display:flex><span>    inClusterServiceName: proxy-entrypoint
</span></span><span style=display:flex><span>    namespace: &lt;target namespace to install proxy server&gt;
</span></span><span style=display:flex><span>    replicas: &lt;expected replicas of proxy servers&gt;
</span></span><span style=display:flex><span>  authentication: <span style=color:#8f5902;font-style:italic># Customize authentication between proxy server/agent</span>
</span></span><span style=display:flex><span>status:
</span></span><span style=display:flex><span>  conditions: ...
</span></span></code></pre></div><h3 id=related-materials>Related materials</h3><p>See the original <a href=https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/14-addon-cluster-proxy>design proposal</a>
for reference.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-2d647ed2ebf02e492abdea9b64b40daa>2.3.4 - Managed service account</h1><p><a href=https://github.com/open-cluster-management-io/managed-serviceaccount>Managed Service Account</a>
is an OCM addon enabling a hub cluster admin to manage <a href=https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/>service account</a>
across multiple clusters on ease. By controlling the creation and removal of
the service account, the addon agent will project and rotate the corresponding
token back to the hub cluster which is very useful for the Kube API client from
the hub cluster to request against the managed clusters.</p><h2 id=background>Background</h2><p>Normally there are two major approaches for a Kube API client to authenticate
and access a Kubernetes cluster:</p><ul><li>Valid X.509 certificate-key pair</li><li>Service account bearer token</li></ul><p>The service account token will be automatically persisted as a secret
resource inside the hosting Kubernetes clusters upon creation, which is commonly
used for the <a href=https://github.com/kubernetes/client-go/tree/master/examples/in-cluster-client-configuration>&ldquo;in-cluster&rdquo;</a>
client. However, in terms of OCM, the hub cluster is completely an external
system to the managed clusters, so we will need a local agent in each managed
cluster to reflect the tokens consistently to the hub cluster so that the
Kube API client from hub cluster can &ldquo;push&rdquo; the requests directly against the
managed cluster. By delegating the multi-cluster service account management to
this addon, we can:</p><ul><li>Project the service account token from the managed clusters to the hub cluster
with custom API audience.</li><li>Rotate the service account tokens dynamically.</li><li>Homogenize the client identities so that we can easily write a static RBAC
policy that applies to multiple managed clusters.</li></ul><h2 id=prerequisite>Prerequisite</h2><p>You must meet the following prerequisites to install the managed service
account:</p><ul><li><p>Ensure your <code>open-cluster-management</code> release is greater than <code>v0.5.0</code>.</p></li><li><p>Ensure <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl><code>kubectl</code></a> is installed.</p></li><li><p>Ensure <a href=https://helm.sh/docs/intro/install/><code>helm</code></a> is installed.</p></li></ul><h2 id=installation>Installation</h2><p>To install the managed service account addon to the OCM control plane, run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ helm repo add ocm https://open-cluster-management.io/helm-charts
</span></span><span style=display:flex><span>$ helm repo update
</span></span><span style=display:flex><span>$ helm search repo ocm
</span></span><span style=display:flex><span>NAME                              	CHART VERSION	APP VERSION	DESCRIPTION
</span></span><span style=display:flex><span>ocm/managed-serviceaccount          &lt;...&gt;           1.0.0       A Helm chart <span style=color:#204a87;font-weight:700>for</span> Managed ServiceAccount Addon
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Then run the following helm command to continue the installation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ helm install -n open-cluster-management-addon --create-namespace <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    managed-serviceaccount  ocm/managed-serviceaccount
</span></span><span style=display:flex><span>$ kubectl -n open-cluster-management-addon get pod
</span></span><span style=display:flex><span>NAME                                                    READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>managed-serviceaccount-addon-manager-5m9c95b7d8-xsb94   1/1     Running   <span style=color:#0000cf;font-weight:700>1</span>          4d4h
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>By default, the addon manager will be automatically discovering the addition or
removal the managed clusters and installs the managed serviceaccount agents into
them on the fly. To check out the healthiness status of the managed serviceaccount
agents, we can run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get managedclusteraddon -A
</span></span><span style=display:flex><span>NAMESPACE         NAME                     AVAILABLE   DEGRADED   PROGRESSING
</span></span><span style=display:flex><span>&lt;cluster name&gt;    managed-serviceaccount   True
</span></span></code></pre></div><h2 id=usage>Usage</h2><p>To exercise the new <code>ManagedServiceAccount</code> API introduced by this addon, we
can start by applying the following sample resource:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ <span style=color:#204a87>export</span> <span style=color:#000>CLUSTER_NAME</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;cluster name&gt;
</span></span><span style=display:flex><span>$ kubectl create -f - <span style=color:#4e9a06>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: authentication.open-cluster-management.io/v1alpha1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ManagedServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: my-sample
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: ${CLUSTER_NAME}
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  rotation: {}
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>Then the addon agent in each of the managed cluster is responsible for
executing and refreshing the status of the <code>ManagedServiceAccount</code>, e.g.:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl describe ManagedServiceAccount -n cluster1
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>  status:
</span></span><span style=display:flex><span>    conditions:
</span></span><span style=display:flex><span>    - lastTransitionTime: <span style=color:#4e9a06>&#34;2021-12-09T09:08:15Z&#34;</span>
</span></span><span style=display:flex><span>      message: <span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span>      reason: TokenReported
</span></span><span style=display:flex><span>      status: <span style=color:#4e9a06>&#34;True&#34;</span>
</span></span><span style=display:flex><span>      type: TokenReported
</span></span><span style=display:flex><span>    - lastTransitionTime: <span style=color:#4e9a06>&#34;2021-12-09T09:08:15Z&#34;</span>
</span></span><span style=display:flex><span>      message: <span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span>      reason: SecretCreated
</span></span><span style=display:flex><span>      status: <span style=color:#4e9a06>&#34;True&#34;</span>
</span></span><span style=display:flex><span>      type: SecretCreated
</span></span><span style=display:flex><span>    expirationTimestamp: <span style=color:#4e9a06>&#34;2022-12-04T09:08:15Z&#34;</span>
</span></span><span style=display:flex><span>    tokenSecretRef:
</span></span><span style=display:flex><span>      lastRefreshTimestamp: <span style=color:#4e9a06>&#34;2021-12-09T09:08:15Z&#34;</span>
</span></span><span style=display:flex><span>      name: my-sample
</span></span></code></pre></div><p>The service account will be created in the managed cluster (assume the name is <code>cluster1</code>):</p><pre tabindex=0><code>$ kubectl get sa my-sample -n open-cluster-management-managed-serviceaccount --context kind-cluster1
NAME        SECRETS   AGE
my-sample   1         9m57s
</code></pre><p>The corresponding secret will also be created in the hub cluster, which is
visible via:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n &lt;your cluster&gt; get secret my-sample
</span></span><span style=display:flex><span>NAME        TYPE     DATA   AGE
</span></span><span style=display:flex><span>my-sample   Opaque   <span style=color:#0000cf;font-weight:700>2</span>      2m23s
</span></span></code></pre></div><h2 id=related-materials>Related materials</h2><p>Repo: <a href=https://github.com/open-cluster-management-io/managed-serviceaccount>https://github.com/open-cluster-management-io/managed-serviceaccount</a></p><p>See the design proposal at: <a href=https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/19-projected-serviceaccount-token>https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/19-projected-serviceaccount-token</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-949d98148d7196555245f5c95fcd12f6>2.3.5 - Multicluster Control Plane</h1><h2 id=what-is-multicluster-control-plane>What is <code>Multicluster Control Plane</code></h2><p>The multicluster control plane is a lightweight Open Cluster Manager (OCM) control plane that is easy to install and has a small footprint. It can be running anywhere with or without a Kubernetes environment to serve the OCM control plane capabilities.</p><h2 id=why-use-multicluster-control-plane>Why use <code>Multicluster Control Plane</code></h2><ol><li><p>Some Kubernetes environments do not have CSR (e.g., EKS) so that the standard OCM control plane cannot be installed. The multicluster control plane can be able to install in these environments and expose the OCM control plane API via loadbalancer.</p></li><li><p>Some users may want to run multiple OCM control planes to isolate the data. The typical case is that the user wants to run one OCM control plane for production and another OCM control plane for development. The multicluster control plane is able to be installed in different namespaces in a single cluster. Each multicluster control plane is running independently and serving the OCM control plane capabilities.</p></li><li><p>Some users may want to run the OCM control plane without a Kubernetes environment. The multicluster control plane can run in a standalone mode, for example, running in a VM. Expose the control plane API to the outside so the managed clusters can register to it.</p></li></ol><h2 id=how-to-use-multicluster-control-plane>How to use <code>Multicluster Control Plane</code></h2><h3 id=start-the-standalone-multicluster-control-plane>Start the standalone multicluster control plane</h3><p>You need build <code>multicluster-controlplane</code> in your local host. Follow the below steps to build the binary and start the multicluster control plane.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>git clone https://github.com/open-cluster-management-io/multicluster-controlplane.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> multicluster-controlplane
</span></span><span style=display:flex><span>make run
</span></span></code></pre></div><p>Once the control plane is running, you can access the control plane by using <code>kubectl --kubeconfig=./_output/controlplane/.ocm/cert/kube-aggregator.kubeconfig</code>.</p><p>You can customize the control plane configurations by creating a config file and using the environment variable <code>CONFIG_DIR</code> to specify your config file directory. Please check the <a href=https://github.com/open-cluster-management-io/multicluster-controlplane#run-controlplane-as-a-local-binary>repository documentation</a> for details.</p><h3 id=install-via-clusteradm>Install via clusteradm</h3><h4 id=install-clusteradm-cli-tool>Install clusteradm CLI tool</h4><p>It&rsquo;s recommended to run the following command to download and install <strong>the
latest release</strong> of the <code>clusteradm</code> command-line tool:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -L https://raw.githubusercontent.com/open-cluster-management-io/clusteradm/main/install.sh <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><h4 id=install-multicluster-control-plane>Install multicluster control plane</h4><p>You can use <code>clusteradm init</code> to deploy the multicluster control plane in your Kubernetes environment.</p><ol><li>Set the environment variable KUBECONFIG to your cluster kubeconfig path. For instance, create a new KinD cluster and deploy multicluster control plane in it.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/kind-controlplane.kubeconfig
</span></span><span style=display:flex><span>kind create cluster --name multicluster-controlplane
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>mc_cp_node_ip</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl get nodes -o<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.items[0].status.addresses[?(@.type==&#34;InternalIP&#34;)].address}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><ol start=2><li>Run following command to deploy a control plane</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>clusteradm init --singleton<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> --set route.enabled<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span> --set nodeport.enabled<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> --set nodeport.port<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>30443</span> --set apiserver.externalHostname<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$mc_cp_node_ip</span> --set apiserver.externalPort<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>30443</span> --singleton-name multicluster-controlplane
</span></span></code></pre></div><p>Refer to the <a href=https://github.com/open-cluster-management-io/multicluster-controlplane#use-helm-to-deploy-controlplane-in-a-cluster>repository documentation</a> for how to customize the control plane configurations.</p><ol start=3><li>Get the control plane kubeconfig by running the following command:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl -n multicluster-controlplane get secrets multicluster-controlplane-kubeconfig -ojsonpath<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.data.kubeconfig}&#39;</span> <span style=color:#000;font-weight:700>|</span> base64 -d &gt; /tmp/multicluster-controlplane.kubeconfig
</span></span></code></pre></div><h3 id=join-a-cluster-to-the-multicluster-control-plane>Join a cluster to the multicluster control plane</h3><p>You can use <code>clusteradm</code> to join a cluster. For instance, take the KinD cluster as an example, run the following command to join the cluster to the control plane:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kind create cluster --name cluster1 --kubeconfig /tmp/kind-cluster1.kubeconfig
</span></span><span style=display:flex><span>clusteradm --kubeconfig<span style=color:#ce5c00;font-weight:700>=</span>/tmp/multicluster-controlplane.kubeconfig get token --use-bootstrap-token
</span></span><span style=display:flex><span>clusteradm --singleton<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> --kubeconfig /tmp/kind-cluster1.kubeconfig join --hub-token &lt;controlplane token&gt; --hub-apiserver https://<span style=color:#000>$mc_cp_node_ip</span>:30443/ --cluster-name cluster1
</span></span><span style=display:flex><span>clusteradm --kubeconfig<span style=color:#ce5c00;font-weight:700>=</span>/tmp/multicluster-controlplane.kubeconfig accept --clusters cluster1
</span></span></code></pre></div><h3 id=verify-the-cluster-join>Verify the cluster join</h3><p>Run this command to verify the cluster join:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl --kubeconfig<span style=color:#ce5c00;font-weight:700>=</span>/tmp/multicluster-controlplane.kubeconfig get managedcluster
</span></span><span style=display:flex><span>NAME       HUB ACCEPTED   MANAGED CLUSTER URLS                  JOINED   AVAILABLE   AGE
</span></span><span style=display:flex><span>cluster1   <span style=color:#204a87>true</span>           https://cluster1-control-plane:6443   True     True        5m25s
</span></span></code></pre></div><p>You should see the managedcluster joins to the multicluster control plane. Congratulations!</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ac9e6b6253635a1b0fe0e29e77c03c30>2.4 - Administration</h1><p>A few general guide about operating the open-cluster-management&rsquo;s control plane
and the managed clusters.</p></div><div class=td-content><h1 id=pg-ce917bf3d0aa58a23ffbcbbe7c87d60a>2.4.1 - Monitoring OCM using Prometheus-Operator</h1><p>In this page, we provide a way to monitor your OCM environment using Prometheus-Operator.</p><h2 id=before-you-get-started>Before you get started</h2><p>You must have a OCM environment setuped. You can also follow our recommended <a href=https://open-cluster-management.io/docs/getting-started/quick-start/>quick start guide</a> to set up a playgroud OCM environment.</p><p>And then please <a href=https://prometheus-operator.dev/docs/prologue/quick-start/>install the Prometheus-Operator</a> in your hub cluster. You can also run the following commands copied from the official doc:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>git clone https://github.com/prometheus-operator/kube-prometheus.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> kube-prometheus
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Create the namespace and CRDs, and then wait for them to be availble before creating the remaining resources</span>
</span></span><span style=display:flex><span>kubectl create -f manifests/setup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Wait until the &#34;servicemonitors&#34; CRD is created. The message &#34;No resources found&#34; means success in this context.</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>until</span> kubectl get servicemonitors --all-namespaces <span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>do</span> date<span style=color:#000;font-weight:700>;</span> sleep 1<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl create -f manifests/
</span></span></code></pre></div><h2 id=monitoring-the-control-plane-resource-usage>Monitoring the control-plane resource usage.</h2><p>You can use <code>kubectl proxy</code> to open prometheus UI in your browser on <a href=http://localhost:9090/>localhost:9090</a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl --namespace monitoring port-forward svc/prometheus-k8s <span style=color:#0000cf;font-weight:700>9090</span>
</span></span></code></pre></div><p>The following queries are to monitor the control-plane pods&rsquo; cpu usage, memory usage and apirequestcount for critical CRs:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>rate<span style=color:#ce5c00;font-weight:700>(</span>container_cpu_usage_seconds_total<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#000>namespace</span><span style=color:#ce5c00;font-weight:700>=</span>~<span style=color:#4e9a06>&#34;open-cluster-management.*&#34;</span><span style=color:#ce5c00;font-weight:700>}[</span>3m<span style=color:#ce5c00;font-weight:700>])</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>container_memory_working_set_bytes<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#000>namespace</span><span style=color:#ce5c00;font-weight:700>=</span>~<span style=color:#4e9a06>&#34;open-cluster-management.*&#34;</span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>rate<span style=color:#ce5c00;font-weight:700>(</span>apiserver_request_total<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#000>resource</span><span style=color:#ce5c00;font-weight:700>=</span>~<span style=color:#4e9a06>&#34;managedclusters|managedclusteraddons|managedclustersetbindings|managedclustersets|addonplacementscores|placementdecisions|placements|manifestworks|manifestworkreplicasets&#34;</span><span style=color:#ce5c00;font-weight:700>}[</span>1m<span style=color:#ce5c00;font-weight:700>])</span>
</span></span></code></pre></div><h2 id=visualized-with-grafana>Visualized with Grafana</h2><p>We provide a intial grafana dashboard for you to visualize the metrics. But you can also customize your own dashboard.</p><p>First, use the following command to proxy grafana service:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl --namespace monitoring port-forward svc/grafana <span style=color:#0000cf;font-weight:700>3000</span>
</span></span></code></pre></div><p>Next, open the grafana UI in your browser on <a href=http://localhost:3000/login>localhost:3000</a>.</p><p>Click the &ldquo;Import Dashboard&rdquo; and run the following command to copy a sample dashboard and paste it to the grafana:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl https://raw.githubusercontent.com/open-cluster-management-io/open-cluster-management-io.github.io/main/content/en/getting-started/administration/assets/grafana-sample.json <span style=color:#000;font-weight:700>|</span> pbcopy
</span></span></code></pre></div><p>Then, you will get a sample grafana dashboard that you can fine-tune further:</p><p><img alt=grafana src=/sample-grafana.png></p></div><div class=td-content style=page-break-before:always><h1 id=pg-b97b0aab0f47bdbbe6372a145a008ddf>2.4.2 - Upgrading your OCM environment</h1><p>This page provides the suggested steps to upgrade your OCM environment
including both the hub cluster and the managed clusters. Overall the major
steps you should follow are:</p><ul><li>Read the release notes to confirm the latest OCM release version. <em>(Note that
some add-ons&rsquo; version might be different from OCM&rsquo;s overall release version.)</em></li><li>Upgrade your command line tools <code>clusteradm</code></li></ul><h2 id=before-you-begin>Before you begin</h2><p>You must have an existing OCM environment and there&rsquo;s supposed to be
registration-operator running in your clusters. The registration-operators
is supposed to be installed if you&rsquo;re previously following our recommended
<a href=https://open-cluster-management.io/docs/getting-started/quick-start/>quick start guide</a>
to set up your OCM. The operator is responsible for helping you upgrade the
other components on ease.</p><h2 id=upgrade-command-line-tool>Upgrade command-line tool</h2><p>In order to retrieve the latest version of OCM&rsquo;s command-line tool <code>clusteradm</code>,
run the following one-liner command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ curl -L https://raw.githubusercontent.com/open-cluster-management-io/clusteradm/main/install.sh <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><p>Then you&rsquo;re supposed to see the following outputs:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Getting the latest clusteradm CLI...
</span></span><span style=display:flex><span>Your system is darwin_amd64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>clusteradm CLI is detected:
</span></span><span style=display:flex><span>Reinstalling clusteradm CLI - /usr/local/bin/clusteradm...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Installing v0.1.0 OCM clusteradm CLI...
</span></span><span style=display:flex><span>Downloading https://github.com/open-cluster-management-io/clusteradm/releases/download/v0.1.0/clusteradm_darwin_amd64.tar.gz ...
</span></span><span style=display:flex><span>clusteradm installed into /usr/local/bin successfully.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To get started with clusteradm, please visit https://open-cluster-management.io/getting-started/
</span></span></code></pre></div><p>Also, your can confirm the installed cli version by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm version
</span></span><span style=display:flex><span>client		    version	:v0.1.0
</span></span><span style=display:flex><span>server release	version	: ...
</span></span></code></pre></div><h2 id=upgrade-ocm-components-via-command-line-tool>Upgrade OCM Components via Command-line tool</h2><h3 id=hub-cluster>Hub Cluster</h3><p>For example, to upgrade OCM components in the hub cluster, run the following
command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm upgrade clustermanager --bundle-version<span style=color:#ce5c00;font-weight:700>=</span>0.7.0
</span></span></code></pre></div><p>Then <code>clusteradm</code> will make sure everything in the hub cluster is upgraded to
the expected version. To check the latest status after the upgrade, continue to
run the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm get hub-info
</span></span></code></pre></div><h3 id=managed-clusters>Managed Clusters</h3><p>To upgrade the OCM components in the managed clusters, switch the client context
e.g. overriding <code>KUBECONFIG</code> environment variable, then simply run the following
command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm upgrade klusterlet --bundle-version<span style=color:#ce5c00;font-weight:700>=</span>0.7.0
</span></span></code></pre></div><p>To check the status after the upgrade, continue running this command against the
managed cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm get klusterlet-info
</span></span></code></pre></div><h2 id=upgrade-ocm-components-via-manual-edit>Upgrade OCM Components via Manual Edit</h2><h3 id=hub-cluster-1>Hub Cluster</h3><h4 id=upgrading-the-registration-operator>Upgrading the registration-operator</h4><p>Navigate into the namespace where you installed registration-operator (named
&ldquo;open-cluster-management&rdquo; by default) and edit the image version of its
deployment resource:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n open-cluster-management edit deployment cluster-manager
</span></span></code></pre></div><p>Then update the image tag version to your target release version, which is
exactly the OCM&rsquo;s overall release version.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span><span style=color:#a40000>--- image: quay.io/open-cluster-management/registration-operator:&lt;old release&gt;
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#00a000>+++ image: quay.io/open-cluster-management/registration-operator:&lt;new release&gt;
</span></span></span></code></pre></div><h4 id=upgrading-the-core-components>Upgrading the core components</h4><p>After the upgrading of registration-operator is done, it&rsquo;s about time to surge
the working modules of OCM. Go on and edit the <code>clustermanager</code> custom resource
to prescribe the registration-operator to perform the automated upgrading:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl edit clustermanager cluster-manager
</span></span></code></pre></div><p>In the content of <code>clustermanager</code> resource, you&rsquo;re supposed to see a few
images listed in its spec:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operator.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManager</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>registrationImagePullSpec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>quay.io/open-cluster-management/registration:&lt;target release&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workImagePullSpec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>quay.io/open-cluster-management/work:&lt;target release&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># NOTE: Placement release versioning differs from the OCM root version, please refer to the release note.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placementImagePullSpec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>quay.io/open-cluster-management/placement:&lt;target release&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Replacing the old release version to the latest and commit the changes will
trigger the process of background upgrading. Note that the status of upgrade
can be actively tracked via the status of <code>clustermanager</code>, so if anything goes
wrong during the upgrade it should also be reflected in that status.</p><h3 id=managed-clusters-1>Managed Clusters</h3><h4 id=upgrading-the-registration-operator-1>Upgrading the registration-operator</h4><p>Similar to the process of upgrading hub&rsquo;s registration-operator, the only
difference you&rsquo;re supposed to notice when upgrading the managed cluster is
the name of deployment. Note that before running the following command, you
are expected to switch the context to access the managed clusters not the hub.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n open-cluster-management edit deployment klusterlet
</span></span></code></pre></div><p>Then repeatedly, update the image tag version to your target release version
and commit the changes will upgrade the registration-operator.</p><h4 id=upgrading-the-agent-components>Upgrading the agent components</h4><p>After the registration-operator is upgraded, move on and edit the corresponding
<code>klusterlet</code> custom resource to trigger the upgrading process in your managed
cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl edit klusterlet klusterlet
</span></span></code></pre></div><p>In the spec of <code>klusterlet</code>, what is expected to be updated is also its image
list:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operator.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Klusterlet</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>registrationImagePullSpec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>quay.io/open-cluster-management/registration:&lt;target release&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workImagePullSpec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>quay.io/open-cluster-management/work:&lt;target release&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>After committing the updates, actively checking the status of the <code>klusterlet</code>
to confirm whether everything is correctly upgraded. And repeat the above steps
to each of the managed clusters to perform a cluster-wise progressive upgrade.</p><h4 id=confirm-the-upgrade>Confirm the upgrade</h4><p>Getting the overall status of the managed cluster will help you to detect the
availability in case any of the managed clusters are running into failure:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get managedclusters
</span></span></code></pre></div><p>And the upgrading is all set if all the steps above is succeeded.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-65c66889c5026ec4086a556e64c09171>3 - Developer Guides</h1></div><div class=td-content><h1 id=pg-f12d911ccbae76575b9c0ec1c1b3680f>3.1 - Add-on Developer Guide</h1><p>This page is a developer guide about how to build an OCM add-on using addon-framework.</p><h2 id=supported-version>Supported version</h2><p>The OCM v1.0.0 requires addon-framework v0.9.3 and above versions.</p><p>And notice there&rsquo;s breaking changes in <a href=/docs/developer-guides/addon/#automatic-installation>automatic installation</a> in addon-framework version v0.10.0.</p><h2 id=overview>Overview</h2><p>Add-on is an extension which can work with multiple clusters based on the foundation components in open-cluster-management.
Add-ons are Open Cluster Management-based extensions that can be used to work with multiple clusters.
Add-ons can support different configurations for different managed clusters, and can also be used to read data from the hub cluster.
For example, you might use the <a href=https://github.com/open-cluster-management-io/managed-serviceaccount>managed-serviceaccount</a> add-on to collect the tokens from managed cluster back to the hub cluster,
use the <a href=https://github.com/open-cluster-management-io/cluster-proxy>cluster-proxy </a>addon to establish a reverse proxy tunnels from the managed cluster to the hub cluster, etc.</p><p>A typical add-on should consist of two kinds of components:</p><p><strong>Add-on agent:</strong> The components running in the managed clusters which can be any kubernetes resources, for example
it might be a container with permissions to access the hub cluster, an Operator, or an instance of Operator, etc.</p><p><strong>Add-on manager:</strong> A kubernetes controller in the hub cluster that generates and applies the add-on agent manifests to the managed clusters
via the ManifestWork API. The manager also can optionally manage the lifecycle of add-on.</p><p>There are 2 API resources for add-on in the OCM hub cluster:</p><p><strong>ClusterManagementAddOn:</strong> This is a cluster-scoped resource which allows the user to discover which add-on is available
for the cluster manager and also provides metadata information about the add-on such as display name and description information.
The name of the <code>ClusterManagementAddOn</code> resource will be used for the namespace-scoped <code>ManagedClusterAddOn</code> resource.</p><p><strong>ManagedClusterAddOn:</strong> This is a namespace-scoped resource which is used to trigger the add-on agent to be installed
on the managed cluster, and should be created in the <code>ManagedCluster</code> namespace of the hub cluster.
<code>ManagedClusterAddOn</code> also holds the current state of an add-on.</p><p>There is a library named <a href=https://github.com/open-cluster-management-io/addon-framework>addon-framework</a> which provides
some simple user interfaces for developers to build their add-on managers easily.</p><p>We have some available add-ons in the OCM community:</p><ul><li><a href=https://github.com/open-cluster-management-io/cluster-proxy>cluster-proxy</a></li><li><a href=https://github.com/open-cluster-management-io/managed-serviceaccount>managed-serviceaccount</a></li><li><a href=https://github.com/open-cluster-management-io/argocd-pull-integration>argocd-pull-integration</a></li><li><a href=https://github.com/open-cluster-management-io/governance-policy-addon-controller>config-policy-controller</a></li><li><a href=https://github.com/open-cluster-management-io/governance-policy-addon-controller>governance-policy-framework</a></li></ul><h2 id=write-your-first-add-on>Write your first add-on</h2><p>Let&rsquo;s implement a simple add-on manager using addon-framework, which deploys a busybox deployment in the managed cluster.
You can find the example in <a href=https://github.com/open-cluster-management-io/addon-framework/tree/4172c567862306031ac0405f82eb4f7b4d74b30a/cmd/example/busybox>here</a>.</p><h3 id=implement-the-addon-manager>Implement the addon manager</h3><p>First, create your Go project, and the project should contain a <code>main.go</code> file and a folder <code>manifests</code>. The folder name
can be customized, the example uses <code>manifests</code> as the folder name. <code>main.go</code> contains the Go code of the addon manager.
<code>manifests</code> contains the addon agent&rsquo;s manifest files to be deployed on the managed cluster.</p><p>The <code>main.go</code> file is like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;context&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;embed&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;os&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>restclient</span> <span style=color:#4e9a06>&#34;k8s.io/client-go/rest&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;k8s.io/klog/v2&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;open-cluster-management.io/addon-framework/pkg/addonfactory&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;open-cluster-management.io/addon-framework/pkg/addonmanager&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//go:embed manifests
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>FS</span> <span style=color:#000>embed</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FS</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>  <span style=color:#000>addonName</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;busybox-addon&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>kubeConfig</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>restclient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>InClusterConfig</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>     <span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Exit</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>addonMgr</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>addonmanager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>New</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>kubeConfig</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>     <span style=color:#000>klog</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Errorf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;unable to setup addon manager: %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>     <span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Exit</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>agentAddon</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewAgentAddonFactory</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>FS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;manifests&#34;</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>BuildTemplateAgentAddon</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>     <span style=color:#000>klog</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Errorf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;failed to build agent addon %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>     <span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Exit</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>addonMgr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddAgent</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>agentAddon</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>     <span style=color:#000>klog</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Errorf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;failed to add addon agent: %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>     <span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Exit</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>ctx</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Background</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>go</span> <span style=color:#000>addonMgr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Start</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Done</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>You need to define an <code>embed.FS</code> to embed the files in <code>manifests</code> folder.</p><p>And then you need to build an <code>agentAddon</code> using the <code>agentAddonFactory</code>, and tell the <code>agentAddonFactory</code> the name of
the add-on and the agent manifests.</p><p>Finally, you just add the <code>agentAddon</code> to the <code>addonManager</code> and start the <code>addonManager</code>.</p><p>With above code, the addon manager is implemented. Next is to implement the addon agent part. In this example, the add-on agent
manifest to be deployed on managed cluster is a busybox deployment.</p><p>Create file <code>deployment.yaml</code> in <code>manifests</code> folder, the <code>deployment.yaml</code> is like this:</p><pre tabindex=0><code>kind: Deployment
apiVersion: apps/v1
metadata:
 name: busybox
 namespace: open-cluster-management-agent-addon
spec:
 replicas: 1
 selector:
   matchLabels:
     addon: busybox
 template:
   metadata:
     labels:
       addon: busybox
   spec:
     containers:
       - name: busybox
         image: busybox
         imagePullPolicy: IfNotPresent
         args:
           - &#34;sleep&#34;
           - &#34;3600&#34;
</code></pre><p>Then you can follow next section to <a href=/docs/developer-guides/addon/##deploy-the-add-on-manager-on-your-hub-cluster>deploy the add-on manager on your hub cluster</a>. The add-on manager will watch the <code>ManagedClusterAddOn</code>, and deploy the add-on agent manifests to the targeted managed cluster via <code>ManifestWork</code>.</p><h3 id=deploy-the-add-on-manager-on-your-hub-cluster>Deploy the add-on manager on your hub cluster</h3><p>Now you can build your add-on manager as an image and deploy it on the hub cluster.</p><p>Following below steps to build the image for the <a href=https://github.com/open-cluster-management-io/addon-framework/tree/4172c567862306031ac0405f82eb4f7b4d74b30a/cmd/example/busybox>example</a>.
This image contains several example addon managers, including the busybox example.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/open-cluster-management-io/addon-framework.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> addon-framework
</span></span><span style=display:flex><span>make images
</span></span></code></pre></div><p>In addition to the deployment definition, there are also some additional resources to be deployed on the hub cluster. An example of the deployment manifests for the add-on manager is <a href=https://github.com/open-cluster-management-io/addon-framework/tree/main/examples/deploy/addon/busybox>here</a>.
Following below steps to deploy the add-on manager.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make deploy-busybox
</span></span></code></pre></div><p>With the add-on manager deployed, you can see the <code>busybox-addon-controller</code> running in namespace <code>open-cluster-management</code> on the hub cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc get pods -n open-cluster-management
</span></span><span style=display:flex><span>NAME                                       READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>busybox-addon-controller-d977665d5-x28qc   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          27m
</span></span></code></pre></div><h4 id=rbac-of-the-addon-manager>RBAC of the addon manager</h4><p>There are some minimum required permissions for the addon manager controller to run on the hub cluster. It needs to:</p><ol><li><em>get/list/watch/update</em> the <code>ManagedCluster</code>.</li><li><em>get/list/watch/create/update/patch/delete</em> the <code>ManagedClusterAddOn</code> and <code>ManifestWork</code>.</li><li><em>get/list/watch</em> the <code>ClusterManagementAddOn</code>.</li></ol><h4 id=clustermanagementaddon>ClusterManagementAddOn</h4><p>From a user’s perspective, to install the addon to the hub cluster the hub admin should register a globally-unique
<code>ClusterManagementAddOn</code> resource as a singleton placeholder in the hub cluster. For instance, the <a href=https://github.com/open-cluster-management-io/addon-framework/blob/main/examples/deploy/addon/busybox/resources/busybox_clustermanagementaddon.yaml><code>ClusterManagementAddOn</code></a>
for the busybox-addon:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>busybox-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>addOnMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Busybox Addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;busybox-addon is an example addon to deploy busybox pod on the managed cluster&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=enable-the-add-on-for-a-managed-cluster>Enable the add-on for a managed cluster.</h3><p>Now your addon-manager is running on the hub cluster.
To deploy the busybox add-on agent to a certain managed cluster, you need to create a <code>ManagedClusterAddOn</code> in the
managed cluster namespace of hub cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>busybox-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>installNamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>You can set any existing namespace in the managed cluster as the <code>installNamespace</code> here, and the add-on manager will
deploy the add-on agent manifests in this namespace of the managed cluster.</p><blockquote><p>Note: <code>open-cluster-management-agent-addon</code> is our default namespace to install the add-on agent manifests in the managed cluster.</p></blockquote><p>You can also use the <code>clusteradm</code> command to enable the busybox-addon for the managed cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ clusteradm addon <span style=color:#204a87>enable</span> --names busybox-addon --namespace open-cluster-management-agent-addon --clusters cluster1
</span></span></code></pre></div><p>After enabling the add-on for the managed cluster, you can find a <code>ManifestWork</code> named <code>addon-busybox-addon-deploy</code> is
deploying on the managed cluster namespace of the hub cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get manifestworks.work.open-cluster-management.io -n cluster1
</span></span><span style=display:flex><span>NAME                         AGE
</span></span><span style=display:flex><span>addon-busybox-addon-deploy   2m
</span></span></code></pre></div><p>And the busybox deployment is deployed on the managed cluster too.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get deployment -n open-cluster-management-agent-addon
</span></span><span style=display:flex><span>NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>busybox                   1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           2m
</span></span></code></pre></div><h3 id=disable-the-add-on-for-a-managed-cluster>Disable the add-on for a managed cluster</h3><p>You can delete the <code>ManagedClusterAddOn</code> CR in the managed cluster namespace of the hub cluster to disable the add-on for
the managed cluster.The created <code>ManifestWork</code> will be deleted and the add-on agent manifests will be removed from the
managed cluster too.</p><p>You also can use the <code>clusteradm</code> command to disable the add-on for a managed cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ clusteradm addon disable --names busybox-addon --clusters cluster1
</span></span></code></pre></div><p>You can also use the <code>clusteradm</code> command to disable the add-ons for all managed clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ clusteradm addon disable --names busybox-addon --all-clusters <span style=color:#204a87>true</span>
</span></span></code></pre></div><p>If you delete the <code>ClusterManagementAddOn</code> on the hub cluster, the <code>ManagedClusterAddOn</code> CRs in all managed cluster
namespaces will be deleted too.</p><h3 id=whats-the-next>What’s the next</h3><p>However, this add-on just ensures a pod to run on the managed cluster, and you cannot see the status of the addon,
and there are not any functionality to manage the clusters. The addon-framework also provides other configurations
for add-on developers.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get managedclusteraddons.addon.open-cluster-management.io -n cluster1
</span></span><span style=display:flex><span>NAME                AVAILABLE   DEGRADED   PROGRESSING
</span></span><span style=display:flex><span>busybox-addon      Unknown
</span></span></code></pre></div><p>Next, you need to configure the addon.</p><h2 id=add-on-agent-configurations>Add-on agent configurations</h2><h3 id=monitor-addon-healthiness>Monitor addon healthiness</h3><p>In the busybox example above, we found the <code>AVAILABLE</code> status of the <code>ManagedClusterAddOn</code> is always <code>Unknown</code>.</p><p>That’s because the add-on manager did not monitor the status of the add-on agent from the hub cluster.</p><p>We support 3 kinds of health prober types to monitor the healthiness of add-on agents.</p><ol><li><p><strong>Lease</strong></p><p>The add-on agent maintains a <code>Lease</code> in its installation namespace with its status, the <a href=https://open-cluster-management.io/concepts/architecture/#registration>registration agent</a> will
check this <code>Lease</code> to maintain the <code>AVAILABLE</code> status of the <code>ManagedClusterAddOn</code>.</p><p>The addon-framework provides a <a href=https://github.com/open-cluster-management-io/addon-framework/blob/main/pkg/lease/lease_controller.go#L24>leaseUpdater</a> interface which can make it easier.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>leaseUpdater</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>lease</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewLeaseUpdater</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>spokeKubeClient</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>installNamespace</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>go</span> <span style=color:#000>leaseUpdater</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Start</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Background</span><span style=color:#000;font-weight:700>())</span>
</span></span></code></pre></div><p><code>Lease</code> is the default prober type for add-on, there is nothing to configure for the add-on manager.</p></li><li><p><strong>Work</strong></p><p><code>Work</code> health prober indicates the healthiness of the add-on is equal to the overall dispatching status of the
corresponding ManifestWork resources. It&rsquo;s applicable to those add-ons that don&rsquo;t have a container agent
in the managed clusters or don&rsquo;t expect to add <code>Lease</code> for the agent container.
The add-on manager will check if the work is <code>Available</code> on the managed clusters.
In addition, the user can define a <code>HealthCheck</code> prober function to check more detailed status based on status
feedback from the <code>ManifestWork</code>.</p><p>It is required to define a <code>HealthProber</code> instance first. Here is an example to check if the <code>availableReplicas</code> of
add-on agent deployment is more than 1. If yes, it will set the <code>AVAILABLE</code> status of <code>ManagedClusterAddOn</code> to <code>true</code>.
Otherwise, the <code>AVAILABLE</code> status of <code>ManagedClusterAddOn</code> will be false.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>healthProber</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>utils</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewDeploymentProber</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>types</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NamespacedName</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>Name</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;workprober-addon-agent&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Namespace</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;open-cluster-management-agent-addon&#34;</span><span style=color:#000;font-weight:700>})</span>
</span></span></code></pre></div><p>And then you can configure the <code>HealthProber</code> to the agentAddon.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>agentAddon</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewAgentAddonFactory</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>FS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;manifests&#34;</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithAgentHealthProber</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>healthProber</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>BuildTemplateAgentAddon</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div></li><li><p><strong>DeploymentAvailability</strong></p><p><code>DeploymentAvailability</code> health prober indicates the healthiness of the add-on is connected to the availability of
the corresponding agent deployment resources on the managed cluster. It&rsquo;s applicable to those add-ons that running
<code>Deployment</code> type workload on the managed cluster. The add-on manager will check if the <code>readyReplicas</code> of the
add-on agent deployment is more than 1 to set the addon Status.</p><p>Set the type of <code>healthProber</code> to <code>DeploymentAvailability</code> to enable this prober.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>healthProber</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HealthProber</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Type</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HealthProberTypeDeploymentAvailability</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></li><li><p><strong>WorkloadAvailability</strong></p><p><code>WorkloadAvailability</code> health prober indicates the healthiness of the add-on is connected to the availability of
the corresponding agent workload resources(only <code>Deployment</code> and <code>DaemonSet</code> are supported for now) on the managed
cluster. It&rsquo;s applicable to those add-ons that running <code>Deployment</code> and/or <code>DeamonSet</code> workloads on the managed
cluster. The add-on manager will check if <code>readyReplicas > 1</code> for each <code>Deployment</code> and
<code>NumberReady == DesiredNumberScheduled</code> for each <code>DaemonSet</code> of the add-on agent to set the addon Status.</p><p>Set the type of <code>healthProber</code> to <code>WorkloadAvailability</code> to enable this prober.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>healthProber</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HealthProber</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Type</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HealthProberTypeWorkloadAvailability</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></li><li><p><strong>None</strong></p><p>If you want to check and maintain the <code>AVAILABLE</code> status of <code>ManagedClusterAddOn</code> by yourself, set the type of
<code>healthProber</code> to <code>None</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>healthProber</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HealthProber</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Type</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HealthProberTypeNone</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></li></ol><h3 id=automatic-installation>Automatic installation</h3><p>NOTE:</p><ul><li>The automatic installation is no longer supported since addon-framework v0.10.0. Please use the <code>InstallStrategy</code> in
<a href=/docs/developer-guides/addon/#managing-the-add-on-agent-lifecycle-by-addon-manager>Managing the add-on agent lifecycle by addon-manager</a> section
instead.</li><li>The automatic installation is still avaliable in addon-framework version v0.9.3, which is also the
minimal supported addon-framework version in OCM v1.0.0. Using the previous version will have install conficts.</li></ul><p>In the busybox add-on example, you need to create a <code>ManagedClusterAddOn</code> CR to enable the add-on manually.
The addon-framework also provides a configuration called <code>InstallStrategy</code> to support installing addon automatically.</p><p>Currently, the addon-framework supports <code>InstallAllStrategy</code> and <code>InstallByLabelStrategy</code> strategies.</p><p><code>InstallAllStrategy</code> will create <code>ManagedClusterAddOn</code> for all managed cluster namespaces automatically.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>installStrategy</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>InstallAllStrategy</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;open-cluster-management-agent-addon&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p><code>InstallByLabelStrategy</code> will create <code>ManagedClusterAddOn</code> for the selected managed cluster namespaces automatically.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>installStrategy</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>InstallStrategy</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#000>Type</span><span style=color:#000;font-weight:700>:</span>             <span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>InstallByLabel</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>InstallNamespace</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;open-cluster-management-agent-addon&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>LabelSelector</span><span style=color:#000;font-weight:700>:</span>    <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>metav1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>LabelSelector</span><span style=color:#000;font-weight:700>{</span><span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Configure the <code>InstallStrategy</code> to the agentAddon:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>agentAddon</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewAgentAddonFactory</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>FS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;manifests&#34;</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithInstallStrategy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>installStrategy</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>BuildTemplateAgentAddon</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>Addtionally, if you are using addon-framework v0.9.3 or higher, need to grant a <code>patch</code> permission on <code>ClusterManagementAddon</code> to your addon manager.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;addon.open-cluster-management.io&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;clustermanagementaddons&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;get&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;list&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;watch&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;patch&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The below annotation will be added automatically to claim the <code>ManagedClusterAddon</code> lifecycle is managed by the addon itself.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;self&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Manual</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=register-your-add-on>Register your add-on</h3><p>In most cases, the add-ons have requirements to access the hub cluster or other central service endpoint with TLS authentication.
For example, an add-on agent needs to get a resource in its cluster namespace of the hub cluster, or the add-on agent
needs to access the exposed service on the hub cluster.</p><p>The addon-framework supports a solution that the addon can access the <code>kube-apiserver</code> with a kube style API or
other endpoints on the hub cluster with client certificate authentication after it is registered using <code>CSR</code>.</p><p>The addon-framework provides an interface to help add-on manager to save the add-on configuration information to
its corresponding <code>ManagedClusterAddOns</code>.</p><p>On the managed cluster, the registration agent watches <code>ManagedClusterAddOns</code> on the hub cluster.
The registration agent follows next steps to register an add-on:</p><ol><li>The registration agent creates a <code>CSR</code> request with its own hub kubeConfig to register the add-on to the hub cluster.</li><li>On the hub cluster, the add-on manager approves the <code>CSR</code> request. The addon-framework also provides
an interface which the add-on manager can implement it to approve its <code>CSR</code> automatically.</li><li>After the <code>CSR</code> request is approved on the hub cluster, the registration agent gets the certificate from
the <code>CSR</code> request and saves the client certificate to a secret in the add-on agent install namespace.
If the <code>SignerName</code> is <code>kubernetes.io/kube-apiserver-client</code>, the secret name will be <code>{addon name}-hub-kubeconfig</code>.
Otherwise, the secret name will be <code>{addon name}-{signer name}-client-cert</code>.</li><li>The add-on agent can mount the secret to get the client certificate to connect with the hub cluster or the custom service endpoint.</li><li>When the certificate of managed cluster addon is about to expire, the registration agent will send a request to
rotate the certificate on the hub cluster, the addon manager will approve the certificate rotation request.</li></ol><p>Now we build another add-on that is going to sync configmap from the hub cluster to the managed cluster.
The add-on code can be found <a href=https://github.com/open-cluster-management-io/addon-framework/tree/4172c567862306031ac0405f82eb4f7b4d74b30a/cmd/example/helloworld>here</a> .</p><p>Specifically, since the addon agent needs to read configmap from the hub, we need to define the registration option for this addon.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>NewRegistrationOption</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>kubeConfig</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>rest</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Config</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>agentName</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RegistrationOption</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RegistrationOption</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>CSRConfigurations</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>KubeClientSignerConfigurations</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>agentName</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>        <span style=color:#000>CSRApproveCheck</span><span style=color:#000;font-weight:700>:</span>   <span style=color:#000>utils</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>DefaultCSRApprover</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>agentName</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>        <span style=color:#000>PermissionConfig</span><span style=color:#000;font-weight:700>:</span>  <span style=color:#000>rbac</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddonRBAC</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>kubeConfig</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><code>CSRConfigurations</code> returns a list of <code>CSR</code> configuration for the addd-on agent in a managed cluster. The <code>CSR</code> will
be created from the managed cluster for add-on agent with each <code>CSRConfiguration</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>KubeClientSignerConfigurations</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>agentName</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cluster</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>clusterv1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ManagedCluster</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#000>addonapiv1alpha1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RegistrationConfig</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cluster</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>clusterv1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ManagedCluster</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#000>addonapiv1alpha1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RegistrationConfig</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#000>addonapiv1alpha1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RegistrationConfig</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>SignerName</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>certificatesv1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>KubeAPIServerClientSignerName</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#000>Subject</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>addonapiv1alpha1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Subject</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>User</span><span style=color:#000;font-weight:700>:</span>   <span style=color:#000>DefaultUser</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cluster</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>agentName</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>Groups</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>DefaultGroups</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cluster</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addonName</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>The original Kubernetes <code>CSR</code> API only supports three built-in signers:</p><ul><li>kubernetes.io/kube-apiserver-client</li><li>kubernetes.io/kube-apiserver-client-kubelet</li><li>kubernetes.io/kubelet-serving</li></ul><p>However, in some cases, we need to sign additional custom certificates for the add-on agents which are not used for connecting any kube-apiserver.
The add-on manager can be serving as a custom <code>CSR</code> <code>signer</code> controller based on the addon-framework’s extensibility by implementing the signing logic.
The addon-framework will also keep rotating the certificates automatically for the add-on after successfully signing the certificates.</p><p><code>CSRApproveCheck</code> checks whether the add-on agent registration should be approved by the add-on manager.
The <code>utils.DefaultCSRApprover</code> is implemented to auto-approve all the <code>CSRs</code>. A better <code>CSR check</code> is recommended to include:</p><ol><li>The validity of the requester&rsquo;s requesting identity.</li><li>The other request payload such as key-usages.</li></ol><p>If the function is not set, the registration and certificate renewal of the add-on agent needs to be approved manually on the hub cluster.</p><p><code>PermissionConfig</code> defines a function for an add-on to set up RBAC permissions on the hub cluster after the <code>CSR</code> is approved.
In this example, it will create a role in the managed cluster namespace with <em>get/list/watch</em> configmaps permissions,
and bind the role to the group defined in <code>CSRConfigurations</code>.</p><p>Configure the registrationOption to the agentAddon.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>agentAddon</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewAgentAddonFactory</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>helloworld</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>helloworld</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;manifests/templates&#34;</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithGetValuesFuncs</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>helloworld</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetValues</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetValuesFromAddonAnnotation</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithAgentRegistrationOption</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>registrationOption</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithInstallStrategy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addonagent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>InstallAllStrategy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HelloworldAgentInstallationNamespace</span><span style=color:#000;font-weight:700>)).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>BuildTemplateAgentAddon</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>After deploying the example add-on, you can find the registration configuration in the <code>ManagedClusterAddOn</code> status.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>ownerReferences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>blockOwnerDeletion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>controller</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installNamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>registrations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>signerName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kubernetes.io/kube-apiserver-client</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>subject</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>system:open-cluster-management:cluster:cluster1:addon:helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>system:open-cluster-management:addon:helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>system:authenticated</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>system:open-cluster-management:cluster:cluster1:addon:helloworld:agent:2rn8d</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In this example, the addon requires a <code>CSR</code> access hub kube-api (with singer name <code>kubernetes.io/kube-apiserver-client</code>).
After the <code>CSR</code> is created on the hub cluster, the add-on manager will check the signer, group and subject of the <code>CSRs</code>
to verify whether the <code>CSR</code> is valid. If all fields are valid, the add-on manager will approve the <code>CSR</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>certificates.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CertificateSigningRequest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>open-cluster-management.io/addon-name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>open-cluster-management.io/cluster-name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-cluster1-helloworld-lb7cb</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>system:open-cluster-management:cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>system:open-cluster-management:managed-clusters</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>system:authenticated</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>request</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>xxx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>signerName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kubernetes.io/kube-apiserver-client</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>usages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>digital signature</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>key encipherment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>client auth</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>system:open-cluster-management:cluster1:9bkfw</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>After the <code>CSR</code> is approved, the add-on controller creates the <code>Role</code> and <code>Rolebinding</code> in the cluster namespace.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get role -n cluster1
</span></span><span style=display:flex><span>NAME                                       CREATED AT
</span></span><span style=display:flex><span>open-cluster-management:helloworld:agent   2022-07-10T10:08:37Z
</span></span><span style=display:flex><span>$ kubectl get rolebinding -n cluster1
</span></span><span style=display:flex><span>NAME                                                           ROLE                                                              AGE
</span></span><span style=display:flex><span>open-cluster-management:helloworld:agent                       Role/open-cluster-management:helloworld:agent                     13m
</span></span></code></pre></div><p>The <code>Rolebinding</code> binds the <code>Role</code> to the Group <code>system:open-cluster-management:cluster:cluster1:addon:helloworld</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RoleBinding</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management:helloworld:agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>roleRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>apiGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Role</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management:helloworld:agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>subjects</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>apiGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Group</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>system:open-cluster-management:cluster:cluster1:addon:helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The registration agent will create a kubeConfig secret named <code>&lt;add-on name>-hub-kubeconfig</code> in the <code>addonInstallNamesapce</code>.
The addon agent can mount the secret to get the hub kubeConfig to connect with the hub cluster to <em>get/list/watch</em> the Configmaps.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get secret -n default
</span></span><span style=display:flex><span>NAME                              TYPE                                  DATA   AGE
</span></span><span style=display:flex><span>helloworld-hub-kubeconfig         Opaque                                <span style=color:#0000cf;font-weight:700>3</span>      9m52s
</span></span></code></pre></div><h3 id=add-your-add-on-agent-supported-configurations>Add your add-on agent supported configurations</h3><p>For some cases, you want to specify the configurations for your add-on agent, for example, you may want to use a configuration to configure your add-on agent image or use a configuration to configure your add-on agent node Selector and tolerations to make the agent to run on specific nodes.</p><p>The addon-framework supports re-rendering the add-on agent deployment when the add-on agent configurations are changed.</p><p>You can choose the <a href=https://github.com/open-cluster-management-io/api/blob/main/addon/v1alpha1/types_addondeploymentconfig.go><code>AddOnDeploymentConfig</code></a> API as the configuration for your add-on agent, it supports setting customized variables and node placement for your add-on agent deployment, and meanwhile you can also choose your own configuration.</p><p>You can do the following steps to reference your configurations in your add-on APIs with add-on framework</p><ol><li><p>Add the supported configuration types in your add-on <code>ClusterManagementAddOn</code>, we support to add multiple different configuration types in the <code>ClusterManagementAddOn</code>, for example</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworldhelm</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># the add-on supported configurations</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>configmaps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In this example, the <code>helloworldhelm</code> add-on supports using <code>AddOnDeploymentConfig</code> and <code>ConfigMap</code> as its configuration, and you can specify one default configuration for one configuration type, for example</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworldhelm</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#8f5902;font-style:italic># the add-on supported configurations</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#8f5902;font-style:italic># the default config for helloworldhelm</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>defaultConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span>- <span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>configmaps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Thus, all helloworldhelm add-ons on each managed cluster have one same default configuration <code>open-cluster-management/deploy-config</code></p></li><li><p>Register the supported configuration types when building one <code>AgentAddon</code> with <code>AgentAddonFactory</code></p></li><li><p>Implement a <code>GetValuesFunc</code> to transform the configuration to addon-framework <code>Values</code> object and add the <code>GetValuesFunc</code> to the <code>AgentAddonFactory</code>, for example</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>agentAddon</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewAgentAddonFactory</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;helloworldhelm&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>helloworld_helm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;manifests/charts/helloworld&#34;</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// register the supported configuration types
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>WithConfigGVRs</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>      <span style=color:#000>schema</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GroupVersionResource</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>Version</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;v1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Resource</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;configmaps&#34;</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>      <span style=color:#000>schema</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GroupVersionResource</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>Group</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;addon.open-cluster-management.io&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Version</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;v1alpha1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Resource</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;addondeploymentconfigs&#34;</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>    <span style=color:#000>WithGetValuesFuncs</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// get the AddOnDeloymentConfig object and transform it to Values object
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetAddOnDeloymentConfigValues</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>        <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewAddOnDeloymentConfigGetter</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addonClient</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>        <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ToAddOnNodePlacementValues</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// get the ConfigMap object and transform it to Values object
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#000>helloworld_helm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetImageValues</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>kubeClient</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>).</span><span style=color:#000>WithAgentRegistrationOption</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>registrationOption</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>    <span style=color:#000>BuildHelmAgentAddon</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>In this example, we register the <code>ConfigMap</code> and <code>AddOnDeploymentConfig</code> as the <code>helloworldhelm</code> add-on configuration. We use add-on framework
help function <a href=https://github.com/open-cluster-management-io/addon-framework/blob/main/pkg/addonfactory/addondeploymentconfig.go#L47><code>GetAddOnDeloymentConfigValues</code></a> to transform the <code>AddOnDeploymentConfig</code>, and we implemented the <a href=https://github.com/open-cluster-management-io/addon-framework/blob/main/examples/helloworld_helm/helloworld_helm.go#L64><code>GetImageValues</code></a> function to
transform the <code>ConfigMap</code>, you can find more details for add-on framework <code>Values</code> from the <a href=/docs/developer-guides/addon/#values-definition>Values definition</a> part.</p></li><li><p>Add the <code>get</code>, <code>list</code> and <code>watch</code> permissions to an add-on <code>clusterrole</code>, for example, the <a href=https://github.com/open-cluster-management-io/addon-framework/blob/main/examples/deploy/addon/helloworld-helm/resources/cluster_role.yaml>clusterrole</a> of <code>helloworldhelm</code> should have the following permissions</p></li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworldhelm-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;configmaps&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;get&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;list&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;watch&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;addon.open-cluster-management.io&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;addondeploymentconfigs&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;get&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;list&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;watch&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>To configure add-on, the add-on user need reference their configuration objects in <code>ManagedClusterAddOn</code>, for example</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworldhelm</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installNamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>configmaps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>image-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In this example, the add-on user reference the configuration <code>cluster1/deploy-config</code> and <code>cluster1/image-config</code> for <code>helloworldhelm</code> on <code>cluster1</code>. When the configuration references are added to an add-on, the add-on framework will show them in the status of <code>ManagedClusterAddOn</code> and render the add-on once, during the rendering process, the add-on framework will callback the <code>GetValuesFunc</code>s to transform the add-on configuraton object to add-on framework <code>Values</code> object and use <code>Values</code> object to render the add-on agent deployment resources. If the add-on configuration objects are updated, the add-on framework will render the add-on again.</p><h2 id=build-an-addon-using-helm-charts-or-raw-manifests>Build an addon using helm charts or raw manifests.</h2><h3 id=building-steps>Building steps</h3><p>The addon-framework supports helm charts or raw manifests as the add-on agent manifests. The building steps are the same:</p><ol><li><p>Copy the helm chart or raw manifests files into the add-on manager project. And define an <code>embed.FS</code> to embed the files
into your Go program.</p><p>The example using helm chart is <a href=https://github.com/open-cluster-management-io/addon-framework/tree/main/examples/helloworld_helm>helloworld_helm addon</a>,
and the example using raw manifests is <a href=https://github.com/open-cluster-management-io/addon-framework/tree/main/examples/helloworld>helloworld addon</a>.</p></li><li><p>Build different <code>agentAddons</code> using the <code>agentAddonFactory</code> instance with <code>BuildHelmAgentAddon</code> or <code>BuildTemplateAgentAddon</code>.</p><p>For helm chart building:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>agentAddon</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewAgentAddonFactory</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>helloworld_helm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>helloworld_helm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;manifests/charts/helloworld&#34;</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithGetValuesFuncs</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>helloworld_helm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetValues</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetValuesFromAddonAnnotation</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithAgentRegistrationOption</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>registrationOption</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>BuildHelmAgentAddon</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>For raw manifests building:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>agentAddon</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewAgentAddonFactory</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>helloworld</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>helloworld</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;manifests/templates&#34;</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithGetValuesFuncs</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>helloworld</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetValues</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetValuesFromAddonAnnotation</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithAgentRegistrationOption</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>registrationOption</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithInstallStrategy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addonagent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>InstallAllStrategy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HelloworldAgentInstallationNamespace</span><span style=color:#000;font-weight:700>)).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>BuildTemplateAgentAddon</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div></li><li><p>Add the agentAddon to the addon manager.</p></li><li><p>Start the addon manager.</p></li></ol><h3 id=values-definition>Values definition</h3><p>The addon-framework supports 3 add-on built-in values and 3 helm chart built-in values for helm chart add-on manifests.</p><ul><li><code>Value.clusterName</code></li><li><code>Value.addonInstallNamespace</code></li><li><code>Value.hubKubeConfigSecret</code> (used when the add-on is needed to register to the hub cluster)</li><li><code>Capabilities.KubeVersion</code> is the <code>ManagedCluster.Status.Version.Kubernetes</code>.</li><li><code>Release.Name</code> is the add-on name.</li><li><code>Release.Namespace</code> is the <code>addonInstallNamespace</code>.</li></ul><p>The addon-framework supports 3 add-on built-in values in the config of templates for the raw manifests add-on.</p><ul><li><code>ClusterName</code></li><li><code>AddonInstallNamespace</code></li><li><code>HubKubeConfigSecret</code> (used when the AddOn is needed to register to the hub cluster)</li></ul><p>In the list of <code>GetValuesFuncs</code>, the values from the big index Func will override the one from low index Func.</p><p>The built-in values will override the values obtained from the list of <code>GetValuesFuncs</code>.</p><p>The Variable names in Values should begin with lowercase. So the best practice is to define a json struct for the values,
and convert it to Values using the <code>JsonStructToValues</code>.</p><p>Values from annotation of <code>ManagedClusterAddOn</code></p><p>The addon-framework supports a helper <code>GetValuesFunc</code> named <code>GetValuesFromAddonAnnotation</code> which can get values from
the annotations of <code>ManagedClusterAddOn</code>.</p><p>The key of the Helm Chart values in annotation is <code>addon.open-cluster-management.io/values</code>,
and the value should be a valid json string which has key-value format.</p><h2 id=hosted-mode>Hosted mode</h2><p>The addon-framework supports add-on in Hosted mode, that the agent manifests will be deployed outside the managed cluster.
We can choose to run add-on in Hosted mode or Default mode if the managed cluster is imported to the hub in Hosted mode.
By default, the add-on agent will run on the managed cluster(Default mode).
We can add an annotation <code>addon.open-cluster-management.io/hosting-cluster-name</code> for the <code>ManagedClusterAddon</code>,
so that the add-on agent will be deployed on the certain hosting cluster(Hosted mode),
the value of the annotation is the hosting cluster which should:</p><ul><li>be a managed cluster of the hub as well.</li><li>be the same cluster where the managed cluster <code>klusterlet</code>(registration-agent & work-agent) runs.</li></ul><p>We defined a label <code>addon.open-cluster-management.io/hosted-manifest-location</code> to indicate which cluster the add-on
agent manifests should be deployed.</p><ul><li>No matter what the value is, all manifests will be deployed on the managed cluster in Default mode.</li><li>When the label does not exist or the value is <code>managed</code>: the manifest will be deployed on the managed cluster in Hosted mode.</li><li>When the value is <code>hosting</code>: the manifest will be deployed on the hosting cluster in Hosted mode.</li><li>When the value is <code>none</code>: the manifest will not be deployed in Hosted mode.</li></ul><p>More details you can find in the <a href=https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/63-hosted-addon>design</a>,
and we have an example in <a href=https://github.com/open-cluster-management-io/addon-framework/tree/main/examples/helloworld_hosted>here</a>.</p><h2 id=pre-delete-hook>Pre-delete hook</h2><p>The addon-framework provides a hook manifest before delete the add-on.
The hook manifest supports <code>Jobs</code> or <code>Pods</code> to do some cleanup work before the add-on agent is deleted on the managed cluster.</p><p>You need only add the label <code>open-cluster-management.io/addon-pre-delete</code> to the <code>Jobs</code> or <code>Pods</code>in the add-on manifests.
The <code>Jobs</code> or <code>Pods</code> will not be applied until the <code>ManagedClusterAddOn</code> is deleted.
And the <code>Jobs</code> or <code>Pods</code> will be applied on the managed cluster by applying the manifestWork named <code>addon-&lt;addon name>-pre-delete</code>
when the <code>ManagedClusterAddOn</code> is under deleting.
After the <code>Jobs</code> are <code>Completed</code> or <code>Pods</code> are in the <code>Succeeded</code> phase, all the deployed <code>ManifestWorks</code> will be deleted.</p><p>You can find the example from <a href=https://github.com/open-cluster-management-io/addon-framework/tree/main/examples/helloworld_helm>here</a>.</p><h2 id=what-happened-under-the-scene>What happened under the scene</h2><div style=text-align:center;padding:20px><img src=/addon-architecture.png alt="Addon Architecture" style="margin:0 auto;width:80%"></div><p>This architecture graph shows how the coordination between add-on manager and add-on agent works.</p><ol><li>The registration agent creates a <code>CSR</code> request with its own hub kubeConfig to register the add-on to the hub cluster.</li><li>On the hub cluster, the add-on manager approves the <code>CSR</code> request.</li><li>After the <code>CSR</code> request is approved on the hub cluster, the registration agent gets the certificate from the <code>CSR</code> request
to establish the hub kubeConfig and save the hub kubeConfig to a secret in the managed cluster addon namespace.</li><li>The add-on manager is watching the <code>ManagedClusterAddOn</code> for all managed cluster namespaces.
And will create an add-on deploy <code>ManifestWork</code> in the managed cluster namespace once the <code>ManagedClusterAddOn</code> is created in this managed cluster namespace.</li><li>The work agent will apply the manifests in the <code>ManifestWork</code> on the managed cluster.</li><li>The add-on agent will mount the secret created by the registration agent to get the hub kubeConfig to connect with the hub cluster.</li></ol><h2 id=managing-the-add-on-agent-lifecycle-by-addon-manager>Managing the add-on agent lifecycle by addon-manager</h2><p>The add-on agent lifecycle can now be managed by the general
<code>addon-manager</code> starting from OCM v0.11.0. This is achieved through enhancements
to the <code>ClusterManagementAddOn</code> and <code>ManagedClusterAddOn</code> APIs.</p><ol><li>Install strategy</li></ol><p>With the install strategy defined in the <code>ClusterManagementAddOn</code> API, users can
configure which clusters the related <code>ManagedClusterAddon</code> should be enabled by
referencing the <code>Placement</code>. For example, enabling the <code>helloworld</code> add-on on
clusters labeled with aws.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addOnMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-aws</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-aws</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>predicates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>requiredClusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>claimSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>matchExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>platform.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>In</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>values</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#000>aws</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ol start=2><li>Rollout strategy</li></ol><p>With the rollout strategy defined in the <code>ClusterManagementAddOn</code> API, users can
control the upgrade behavior of the add-on when there are changes in the <a href=/docs/developer-guides/addon/#add-your-add-on-agent-supported-configurations>supported configurations</a>.</p><p>For example, if the add-on user updates the &ldquo;deploy-config&rdquo; and wants to apply
the change to the add-ons to a &ldquo;canary&rdquo; <a href=https://open-cluster-management.io/concepts/placement/#decision-strategy>decision group</a> first.
If all the add-on upgrade successfully, then upgrade the rest of clusters progressively per cluster
at a rate of 25%. The rollout strategy can be defined as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addOnMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-aws</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>progressive</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>maxConcurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#000>%</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Add-on developers can use addon-framework v0.9.3 and the above versions
to support the scenarios mentioned above.</p><ol><li>Modify the <code>go.mod</code> file to use the latest addon-framework and API versions.</li></ol><pre tabindex=0><code>open-cluster-management.io/addon-framework v0.9.3 // // or latest
open-cluster-management.io/api v0.13.0 // or latest
</code></pre><ol start=2><li><p>Remove the <code>WithInstallStrategy()</code> function described in the <a href=/docs/developer-guides/addon/#automatic-installation>automatic installation</a>
section since it conflicts with the install strategy defined in the <code>ClusterManagementAddOn</code> API level.</p></li><li><p>Claim that the addon is managed by the general <code>addon-manager</code> by adding the annotation
<code>addon.open-cluster-management.io/lifecycle: "addon-manager"</code> explicitly in the
<code>ClusterManagementAddOn</code>.</p></li></ol><p>Skip this step for OCM v0.14.0 and later version. The annotation is automatically added by the general addon manager.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ol start=4><li><p>Define the <code>installStrategy</code> and <code>rolloutStrategy</code> in the <code>ClusterManagementAddOn</code>
as shown in the example above. Note that the rollout strategy is triggered by
changes in configurations, so if the addon does not have <a href=/docs/developer-guides/addon/#add-your-add-on-agent-supported-configurations>supported cofingurations</a>,
the rollout strategy will not take effect.</p></li><li><p>If you do not want the automatic addon installation, set the install strategy type to <code>Manual</code>.</p></li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Manual</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=build-an-addon-with-addon-template>Build an addon with addon template</h2><p>Using the addon-framework to develop an addon requires developers to implement the interface defined in the
addon-framework via code and deploy a dedicated addon manager deployment on the hub cluster.
But if the addon you are trying to develop:</p><ul><li>not going to support hosted mode</li><li>the crucial agent workloads that need to be deployed to the managed cluster are <code>Deployments</code> and/or <code>DaemonSets</code></li><li>no other customized API is needed to configure the addon besides the <code>AddOnDeploymentConfig</code></li><li>no need to run anything on the hub cluster other than managing the addon agent</li></ul><p>you can have a try with the new API <code>AddOnTemplate</code> introduced from OCM v0.12.0 to build the addon, which can get rid
of coding, and only need to define some yaml files to build an addon.</p><p>Using <code>AddOnTemplate</code> to build an addon, the <code>AddonManagement</code> feature gate must not be disabled in
<code>ClusterManager.spec.addOnManagerConfiguration</code> and <code>Klusterlet.spec.registrationConfiguration</code></p><p>Enhancement proposal: <a href=https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/82-addon-template>Add-on Template</a></p><p>Note: The <code>DaemonSet</code> type workload is supported in the addon template(injecting environment variables, injecting
volumes, health probe for daemonsets) from OCM v0.14.0.</p><h3 id=steps-to-build-an-addon-with-addon-template>Steps to build an addon with addon template</h3><ol><li><p>Create an <code>AddOnTemplate</code> object to define the addon:
The <code>AddOnTemplate</code> API provides two parts of information to build an addon:</p><ul><li><code>manifests</code>: what resources will be deployed to the managed cluster</li><li><code>registration</code>: how to register the addon to the hub cluster</li></ul><p>For example, the following yaml file defines the <code>hello-template</code> addon, which will:</p><ul><li>deploy a <code>Deployment</code>, a <code>ServiceAccount</code>, and a <code>ClusterRoleBinding</code> to the managed cluster</li><li>register the addon to the hub cluster, and make the addon agent(Deployment hello-template-agent):<ul><li>have the permission to access resources defined in the <code>cm-admin</code> clusterRole in the <managed-cluster-name>namespace on the hub cluster(KubeClient type registration, CurrentCluster)</li><li>have the permission to access resources defined in the <code>cm-reader</code> Role in the <code>open-cluster-management</code>
namespace on the hub cluster(KubeClient type registration, SingleNamespace)</li><li>have the credential to access the customized endpoint(CustomSigner type registration)</li></ul></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnTemplate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addonName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>agentSpec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># required</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>serviceAccountName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>quay.io/open-cluster-management/addon-examples:latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>imagePullPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>IfNotPresent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>args</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span>- <span style=color:#4e9a06>&#34;/helloworld&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span>- <span style=color:#4e9a06>&#34;agent&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span>- <span style=color:#4e9a06>&#34;--cluster-name={{CLUSTER_NAME}}&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span>- <span style=color:#4e9a06>&#34;--addon-namespace=open-cluster-management-agent-addon&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span>- <span style=color:#4e9a06>&#34;--addon-name=hello-template&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span>- <span style=color:#4e9a06>&#34;--hub-kubeconfig={{HUB_KUBECONFIG}}&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span>- <span style=color:#4e9a06>&#34;--v={{LOG_LEVEL}}&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># addonDeploymentConfig variables</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRoleBinding</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>roleRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>apiGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster-admin</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>subjects</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>registration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># optional</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># kubeClient or custom signer, if kubeClient, user and group is in a certain format.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># user is &#34;system:open-cluster-management:cluster:{clusterName}:addon:{addonName}:agent:{agentName}&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># group is [&#34;system:open-cluster-management:cluster:{clusterName}:addon:{addonName}&#34;,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>#           &#34;system:open-cluster-management:addon:{addonName}&#34;, &#34;system:authenticated&#34;]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>KubeClient</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kubeClient</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>hubPermissions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CurrentCluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>currentCluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>clusterRoleName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cm-admin</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># should be created by user</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SingleNamespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>singleNamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>roleRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>apiGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Role</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># should be created by user; the addon manager will grant the permission to the agent, so if the</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># role/clusterRole contains some permissions that the addon manager doesn&#39;t have, user needs to grant</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># the permission to the addon-manager (service account open-cluster-management-hub/addon-manager-controller-sa),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># otherwise the addon manager will fail to grant the permission to the agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cm-reader</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CustomSigner</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># addon-manager only generates the credential for the agent to authenticate to the hub cluster, not responsible</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># for the authroization which should be taken care of by the user</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>customSigner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>signerName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example.com/signer-test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>subject</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user-test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#000>group-test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>organizationUnit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#000>organization-test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>signingCA</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># type is &#34;kubernetes.io/tls&#34;; namespace is optional, &#34;open-cluster-management-hub&#34; will be used if</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># namespace is not set; user needs to grant the permission to the addon-manager (service account</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># open-cluster-management-hub/addon-manager-controller-sa) to access the secret</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ca-secret</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><strong>Notes</strong>:</p><ul><li>The permission related resources(i.e. <code>RoleBinding</code> <code>ClusterRoleBinding</code>) for <em>the addon agent access the local
managed cluster</em> defined in the <code>addonTemplate.agentSpec.workload.manifests</code> will be created on the managed cluster
by the work-agent, but the work-agent may not have permission to create these resources, users should refer to
<a href=https://open-cluster-management.io/concepts/manifestwork/#permission-setting-for-work-agent>permission-setting-for-work-agent</a>
to grant the work-agnet permissions to address the permission issue on the managed cluster side.</li><li>Permissions for <em>the addon agent access the hub cluster</em> defined in
<code>addonTemplate.registration[*].kubeClient.hubPermissions</code>, users should ensure:<ol><li><p>the referenced clusterrole/role(<code>.hubPermissions.currentCluster.clusterRoleName</code>
<code>.hubPermissions.singleNamespace.roleRef.name</code>, <code>cm-admin</code> and <code>cm-reader</code> in the above example) exists on the
hub cluster</p></li><li><p>the addon-manager has permission to create rolebinding to bind these (cluster)role for the addon-agent. For
example: users can create a clusterrolebinding to grant the permission to the addon-manager (service account
<code>open-cluster-management-hub/addon-manager-controller-sa</code>) to address the permission issue on the hub cluster
side. For the above example, if the addon-manager doesn&rsquo;t have the permission to create the <code>RoleBinding</code> to
bind the <code>cm-admin</code> role, users can grant the permission to the addon-manager by creating a
<code>ClusterRoleBinding</code> like below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRoleBinding</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-manager-cm-admin</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>roleRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>apiGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cm-admin</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>subjects</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-manager-controller-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-hub</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li></ol></li></ul></li><li><p>Create a <code>ClusterManagementAddOn</code> to declare this is template type addon which should be managed by the
addon-manager:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addOnMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template is a addon built with addon template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># declare it is a template type addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addontemplates</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>defaultConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li><li><p>Create a <code>ManagedClusterAddOn</code> to enable the addon on <code>cluster1</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installNamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li></ol><h3 id=use-variables-in-the-addon-template>Use variables in the addon template</h3><p>Users can use variables in the <code>addonTemplate.agentSpec.workload.manifests</code> field in the form of <code>{{VARIABLE_NAME}}</code>, it
is similar to go template syntax but not identical, only String value is supported. And there are two types of
variables:</p><ol><li>built-in variables;<ul><li>constant parameters(can not be overridden by user&rsquo;s variables):<ul><li><code>CLUSTER_NAME</code>: name of the managed cluster(e.g cluster1)</li></ul></li><li>default parameters(can be overridden by user&rsquo;s variables)<ul><li><code>HUB_KUBECONFIG</code>: path of the kubeconfig to access the hub cluster, default value is
<code>/managed/hub-kubeconfig/kubeconfig</code></li></ul></li></ul></li><li>Customize variables; Variables defines in <code>addonDeploymentConfig.customizedVariables</code> can be used.</li></ol><h3 id=using-kubeconfigcertificates-in-the-addon-agent-deployment>Using kubeconfig/certificates in the addon agent Deployment</h3><p>The addon manager will inject volumes into the addon agent deployments and daemonsets based on the
<code>addonTemplate.spec.registration</code> field.</p><ol><li><p>If there is a <code>KubeClient</code> type registration, the hub kubeconfig will be injected to the deployments defined in the
addon template, so users can use the hub kubeconfig located at <code>/managed/hub-kubeconfig/kubeconfig</code> to access the hub</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>volumeMounts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/managed/hub-kubeconfig</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hub-kubeconfig</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hub-kubeconfig</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>defaultMode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>420</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>secretName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>&lt;addon-name&gt;-hub-kubeconfig</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li><li><p>If there is a <code>CustomSigner</code> type registration, the secret signed via the custom signer defined in the
<code>CustomSignerRegistrationConfig</code> will be injected to the deployments and daemonsets defined in the addon template,
so users can use the certificate located at <code>/managed/&lt;signer-name>/tls.crt</code> and <code>/managed/&lt;signer-name>/tls.key</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>volumeMounts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/managed/&lt;signer-name&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># if the signer name contains &#34;/&#34;, it will be replaced by &#34;-&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cert-&lt;signer-name&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cert-&lt;signer-name&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># if the signer name contains &#34;/&#34;, it will be replaced by &#34;-&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>defaultMode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>420</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>secretName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>&lt;addon-name&gt;-&lt;signer-name&gt;-client-cert</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># if the signer name contains &#34;/&#34;, it will be replaced by &#34;-&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li></ol><h3 id=health-probe-of-the-template-type-addon>Health probe of the template type addon</h3><p>Since we only support the <code>Deployment</code> and <code>DaemonSet</code> resource as the crucial agent runtime workload, the addon-manager
will check if the deployment and daemonsets are available, if not, the addon will be considered as unhealthy.</p><h3 id=support-proxy-configuration-for-the-template-type-addon>Support proxy configuration for the template type addon</h3><p>From OCM v0.16.0, the template type addon can be configured to use the proxy by setting the
<code>addonDeploymentConfig.spec.proxyConfig</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnDeploymentConfig</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>proxy-deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-hub</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>proxyConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>httpProxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;http://test.com&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>httpsProxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;https://test.com&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>noProxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;api.ocm-hub.com,172.30.0.1&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Example: hub cluster api server and the local managed cluster api server</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>caBundle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dGVzdC1idW5kbGUK</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The proxy configuration <code>httpProxy</code>, <code>httpsProxy</code>, and <code>noProxy</code> will be injected as environments
<code>HTTP_PROXY</code>, <code>http_proxy</code>, <code>HTTPS_PROXY</code>, <code>https_proxy</code>, <code>NO_PROXY</code>, <code>no_proxy</code>(both uppercase and lowercase) to
the addon agent deployments and daemonsets.</p><p>If the <code>caBundle</code> is set, the addon-manager will create a configmap containing the ca bundle data in the addon install
namespace, and mount the configmap to the addon agent deployments and daemonsets, and then set an environment
<code>CA_BUNDLE_FILE_PATH</code> to the file path of the mounted ca bundle. If the addon needs to support the <code>caBundle</code> for the
<code>proxyConfig</code>, the <strong>addon developer should get the ca bundle from the environment variable</strong> <code>CA_BUNDLE_FILE_PATH</code>
to make the agent work with the proxy.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8c3c7a28d5e041bf3f73af1a9f21e1b5>3.2 - VScode Extension</h1><p>The OCM <a href=https://github.com/open-cluster-management-io/ocm-vscode-extension>VScode Extension</a> is a UI tool for OCM related Kubernetes resources.
The extension has been built upon Visual Studio Code and offers additional OCM administrative and monitoring features in order to improve operational efficiency and accelerate development within engineering teams.
The OCM VScode Extension provides tons of useful features, including easy to generate OCM related Kubernetes resources, automated local OCM environment creation and a simple and convenient monitoring view for cluster resources.
Having an effective UI tool for managing your cluster is key to a healthy environment. With the right user interface, you can administer changes to the cluster, track resources, and troubleshoot issues more efficiently, without having to use numerous additional CLI tools.</p><h2 id=prerequisite>Prerequisite</h2><p>You must meet the following prerequisites to install the VScode Extension:</p><ul><li>Ensure your <a href=https://code.visualstudio.com/download><code>Visual Studio Code</code></a> release is at least <code>v1.71.0</code>.</li></ul><p>Some VScode Extension features require a few additional prerequisites:</p><ul><li><p>To Manage Existing Resources ensure <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl><code>kubectl</code></a> is installed.</p></li><li><p>To Create Local Environment ensure <a href=https://kind.sigs.k8s.io/docs/user/quick-start/><code>kind</code></a>, <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl><code>kubectl</code></a> and <a href=https://github.com/open-cluster-management-io/clusteradm><code>clusteradm</code></a> are all installed.</p></li><li><p>To load Resources Snippets or create a Bootstrap Project no additional prerequisites are needed</p></li></ul><h2 id=installation>Installation</h2><h3 id=install-latest-version>Install Latest version</h3><p>In your VScode instance, go to the Extensions Marketplace (by clicking on the <em>Extensions</em> icon in the composite bar on the left hand side or simply typing Ctrl+Shift+X).</p><p>Search for <em>OCM Extension</em> and click install.</p><h3 id=install-specific-version>Install specific version</h3><p>To download a specific version of VScode Extention visit the <a href=https://github.com/open-cluster-management-io/ocm-vscode-extension/releases>releases page</a>, expand the <em>Assets</em> section of the target version,
and download the version for your operating system.</p><p>In your VScode instance, go to the Extensions Marketplace (by clicking on the <em>Extensions</em> icon in the composite bar on the left hand side or simply typing Ctrl+Shift+X).</p><p>Click the <strong>&mldr;</strong> at the top right corner of the palette, select the <em>Install from VSIX&mldr;</em> action, and browes for the specific <em>VSIX</em> file you downloaded.</p><p>Select a <em>VSIX</em> file and hit install.</p><h2 id=usage>Usage</h2><h3 id=resources-snippets>Resources Snippets</h3><p>The VScode Extension allows users to load Custom Resource (CR) snippets from the command palette.</p><p>The resources available as snipperts are:</p><ul><li>Subscription</li><li>Placement</li><li>Channel</li><li>ManagedClusterSet</li><li>ManagedClusterSetBinding</li></ul><p>Subscription snippets are available specifically tailored to either Git, Helm or ObjectBucket.</p><p>To exercise this feature you must take the following steps:</p><ol><li>Create a new yaml file in a desired path</li><li>Open the file and press Ctrl+Shift+P on your keyboard</li><li>In the search container at the top of your screen choose <em>Snippets: Insert Snippet</em></li><li>Choose a desired snippet from list</li></ol><div><img src=/snippets-from-palette.gif alt="Resources Snippets"></div><br><h3 id=bootstrap-project>Bootstrap Project</h3><p>Another Valuable feature of the VScode Extension is to create a Bootstrap project for the various channel types.</p><p>The Bootstrap project is basically a collection of snippets, customized to fit one of three channel types - Git, Helm or ObjectBucket, that form a project template for you to build upon.</p><p>To exercise this feature you must take the following steps:</p><ol><li>Press Ctrl+Shift+P on your keyboard</li><li>In the search container at the top of your screen choose <em>OCM: Create an application-manager project</em></li><li>Choose a desired channel type</li><li>Type in a project name and hit enter</li></ol><div><img src=/new-project.gif alt="Bootstrap Project"></div><br><h3 id=create-local-environment>Create Local Environment</h3><p>The Create Local Environment feature allows you to create a quick OCM multi-cluster control plane on a local <a href=https://kind.sigs.k8s.io/>kind</a> environment with only a click of a button.</p><p>The feature does it all for you:</p><ul><li>Verifies the existence of the required tools.</li><li>Creates as many <a href=https://kind.sigs.k8s.io/>kind</a> clusters as you need (customizable).</li><li>Initializes the <em>hub cluster</em> by installing a <a href=https://operatorhub.io/operator/cluster-manager>Cluster Manager</a> using <a href=https://github.com/open-cluster-management-io/clusteradm>clusteradm</a>, and <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl>kubectl</a>.</li><li>Installs a <a href=https://operatorhub.io/operator/klusterlet>Klusterlet</a> agent on the <em>managed clusters</em> and sends join requests to the <em>hub cluster</em> using <a href=https://github.com/open-cluster-management-io/clusteradm>clusteradm</a>, and <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl>kubectl</a>.</li><li>Accepts the join requests from the <em>hub cluster</em> using <a href=https://github.com/open-cluster-management-io/clusteradm>clusteradm</a>, and <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl>kubectl</a>.</li></ul><p>To exercise this feature you must take the following steps:</p><ol><li>Click on the <em>OCM</em> icon in the composite bar on the left hand side to open the VScode Extension control pane</li><li>Locate the <em>Create Local Environment</em> button in the <em>Developers Tools</em> section and give it a click</li><li>Notice that at the top of your screen an action container will prompt you to choose between default or custom configuration</li><li>After configuration was specified, a progress bar at the botom right of your screen will provide feadback on the build process</li></ol><div><img src=/create-local-env.gif alt="Create Local Environment" style="margin:0 auto;width:95%"></div><br><h3 id=manage-existing-resources>Manage Existing Resources</h3><p>The Manage Existing Resources feature provides a wide and detailed overview of all the resources residing in any one cluster.</p><p>To exercise this feature you must take the following steps:</p><ol><li>Access the <em>Cluster Details</em> tab either by:
* Pressing Ctrl+Shift+P on your keyboard and choosing <em>OCM-View: Cluster Details</em> in the search container at the top of your screen
* Clicking on the <em>OCM</em> icon in the composite bar on the left hand side to open the VScode Extension control pane, locating the <em>Connected Clusters</em> section and selecting any cluster in the list</li><li>Inside the <em>Cluster Details</em> tab, use the dropdown to select any cluster from the list of availabe clusters in order to view the resources within it</li></ol><div><img src=/mng-existing-resources.gif alt="Create Local Environment" style="margin:0 auto;width:95%"></div><br><h2 id=related-materials>Related materials</h2><p>Visit the VScode Extension on <a href=https://github.com/open-cluster-management-io/ocm-vscode-extension>Github</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ed5e4e2a5768b77b50e8f92bb406319b>4 - User Scenarios</h1></div><div class=td-content><h1 id=pg-8e6e715e5d3149e708a441d8cda80620>4.1 - Deploy Kubernetes resources to the managed clusters</h1><p>After bootstrapping an OCM environment of at least one managed clusters, now
it&rsquo;s time to begin your first journey of deploying Kubernetes resources into
your managed clusters with OCM&rsquo;s <code>ManifestWork</code> API.</p><h2 id=prerequisites>Prerequisites</h2><p>Before we get start with the following tutorial, let&rsquo;s clarify a few terms
we&rsquo;re going to use in the context.</p><ul><li><p><strong>Cluster namespace</strong>: After a managed cluster is successfully registered
into the hub. The hub registration controller will be automatically
provisioning a <code>cluster namespace</code> dedicated for the cluster of which the
name will be same as the managed cluster. The <code>cluster namespace</code> is used
for storing any custom resources/configurations that effectively belongs
to the managed cluster.</p></li><li><p><strong>ManifestWork</strong>: A custom resource in the hub cluster that groups a list
of kubernetes resources together and meant for dispatching them into the
managed cluster if the <code>ManifestWork</code> is created in a valid
<code>cluster namespace</code>, see details in this <a href=https://open-cluster-management.io/docs/concepts/work-distribution/manifestwork/>page</a>.</p></li></ul><h2 id=deploy-the-resource-to-a-target-cluster>Deploy the resource to a target cluster</h2><p>Now you can deploy a set of kubernetes resources defined in files to any clusters managed by the hub cluster.</p><p>Connect to your hub cluster and you have 2 options to create a <code>ManifestWork</code>:</p><ol><li><p>Use <code>clusteradm</code> command</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm create work my-first-work -f &lt;kubernetes yaml file or directory&gt; --clusters &lt;cluster name&gt;
</span></span></code></pre></div><p>where kubernetes yaml file should be kubernetes definitions, a sample:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>serviceAccountName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx:1.14.2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>containerPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li><li><p>Use <code>kubectl</code> to create the <code>ManifestWork</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f &lt;kubernetes yaml file or directory&gt;
</span></span></code></pre></div><p>where kubernetes yaml file should be kubernetes definitions wrapped by <code>ManifestWork</code>, a sample:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-first-work</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>serviceAccountName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx:1.14.2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span>- <span style=color:#204a87;font-weight:700>containerPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li></ol><p>The above command should create a <code>ManifestWork</code> in cluster namespace of your hub cluster. To see the detailed status of this <code>ManifestWork</code>, you can run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm get works my-first-work --cluster &lt;cluster name&gt;
</span></span></code></pre></div><p>If you have some change on the manifest files, you can apply the change to the targeted cluster by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm create work my-first-work -f &lt;kubernetes yaml file or directory&gt; --clusters &lt;cluster name&gt; --overwrite
</span></span></code></pre></div><p>To remove the resources deployed on the targeted cluster, run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete manifestwork my-first-work -n &lt;cluster name&gt;
</span></span></code></pre></div><h2 id=what-happens-behind-the-scene>What happens behind the scene</h2><p>Say we would like to deploy a nginx together with a service account into &ldquo;cluster1&rdquo;.
A <code>ManifestWork</code> can be defined as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-first-work</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>serviceAccountName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx:1.14.2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span>- <span style=color:#204a87;font-weight:700>containerPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In this example:</p><ul><li><p>A <code>ManifestWork</code> named &ldquo;my-first-work&rdquo; will be created into a
&ldquo;cluster namespace&rdquo; named &ldquo;cluster1&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get manifestwork -A --context kind-hub
</span></span><span style=display:flex><span>NAMESPACE   NAME            AGE
</span></span><span style=display:flex><span>cluster1    my-first-work   2m59s
</span></span></code></pre></div></li><li><p>The resources in the <code>ManifestWork</code> including a service-account, a deployment
will be created to the cluster &ldquo;cluster1&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get deployment --context kind-cluster1
</span></span><span style=display:flex><span>NAME               READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>nginx-deployment   3/3     <span style=color:#0000cf;font-weight:700>3</span>            <span style=color:#0000cf;font-weight:700>3</span>           4m10s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl get sa my-sa --context kind-cluster1
</span></span><span style=display:flex><span>NAME    SECRETS   AGE
</span></span><span style=display:flex><span>my-sa   <span style=color:#0000cf;font-weight:700>1</span>         4m23s
</span></span></code></pre></div></li><li><p>In the status of <code>ManifestWork</code> we can check out the aggregated status
indicating whether the prescribed resources are successfully deployed by the
conditions in the field <code>.status.conditions[*]</code>:</p><ul><li><code>Applied</code>: Whether <strong>all</strong> the resources from the spec are successfully
applied since the last observed generation of <code>ManifestWork</code>.</li><li><code>Available</code>: Whether <strong>all</strong> the resources from the spec are existing in
the target managed cluster.</li></ul></li><li><p>Beside the aggregated status, the <code>ManifestWork</code> is also tracking the
per-resource status under <code>.status.resourceStatus[*]</code> where we can
discriminate different resource types via the
<code>.status.resourceStatus[*].resourceMeta</code> field. e.g.:</p></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>resourceStatus</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2021-11-25T10:17:43Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Apply manifest complete</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AppliedManifestComplete</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Applied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2021-11-25T10:17:43Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Resource is available</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceAvailable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Available</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resourceMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>ordinal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deployments</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>If possible, you can also switch the context of your kubeconfig to &ldquo;cluster1&rdquo;
to check out the new resources delivered by <code>ManifestWork</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl --context kind-cluster1 get pod
</span></span><span style=display:flex><span>NAME                                READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>nginx-deployment-556c5468f7-d5h2m   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          33m
</span></span><span style=display:flex><span>nginx-deployment-556c5468f7-gf574   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          33m
</span></span><span style=display:flex><span>nginx-deployment-556c5468f7-hhmjf   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          33m
</span></span></code></pre></div><h3 id=updating-the-manifestwork>Updating the ManifestWork</h3><p>Any updates applied to the <code>ManifestWork</code> are expected to take effect
immediately as long as the work agent deployed in the managed cluster
are healthy and actively in touch with the hub cluster.</p><p>The work agent will be dynamically computing a hash
from the prescribed resources, and a corresponding <code>AppliedManifestWork</code>
of which the name contains the hash value will be persisted to the managed
cluster and replacing the previously persisted <code>AppliedManifestWork</code>
connected to the same <code>ManifestWork</code> after the latest resources are applied.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl --context kind-cluster1 get appliedmanifestwork
</span></span><span style=display:flex><span>NAME                                                                                                   AGE
</span></span><span style=display:flex><span>ed59251487ad4e4465fa2990b36a1cc398b83e63b59fa16b83591f5afdc3dd6d-my-first-work                  59m
</span></span></code></pre></div><p>Note that if the work agent was disconnected from the hub control plane for
a period of time and missed the new updates upon <code>ManifestWork</code>. The work
agent will be catching up the latest state of <code>ManifestWork</code> as soon as it
re-connects.</p><h3 id=deleting-the-manifestwork>Deleting the ManifestWork</h3><p>The local resources deployed in the managed cluster should be cleaned up upon
receiving the deletion event from the corresponding <code>ManifestWork</code>. The resource
<code>ManifestWork</code> in the hub cluster will be protected by the finalizer named:</p><ul><li>&ldquo;cluster.open-cluster-management.io/manifest-work-cleanup&rdquo;</li></ul><p>It will be removed if the corresponding <code>AppliedManifestWork</code> is gracefully
removed from the managed cluster. Meanwhile, the <code>AppliedManifestWork</code> resource
is also protected by another finalizer named:</p><ul><li>&ldquo;cluster.open-cluster-management.io/applied-manifest-work-cleanup&rdquo;</li></ul><p>This finalizer is supposed to be detached after the deployed local resources
are <em>completely</em> removed from the manged cluster. With that being said, if any
deployed local resources are holding at the &ldquo;Terminating&rdquo; due to graceful
deletion. Both of its <code>ManifestWork</code> and <code>AppliedManifestWork</code> should stay
undeleted.</p><h2 id=troubleshoot>Troubleshoot</h2><p>In case of run into any unexpected failures,
you can make sure your environment by checking the following conditions:</p><ul><li><p>The CRD <code>ManifestWork</code> is installed in the hub cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get crd manifestworks.work.open-cluster-management.io
</span></span></code></pre></div></li><li><p>The CRD <code>AppliedManifestWork</code> is installed in the managed cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get crd appliedmanifestworks.work.open-cluster-management.io
</span></span></code></pre></div></li><li><p>The work agent is successfully running in the managed cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n open-cluster-management-agent get pod
</span></span><span style=display:flex><span>NAME                                             READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>klusterlet-registration-agent-598fd79988-jxx7n   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          20d
</span></span><span style=display:flex><span>klusterlet-work-agent-7d47f4b5c5-dnkqw           1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          20d
</span></span></code></pre></div></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f5520207f2d731962bdb209ff35b9606>4.2 - Distribute workload with placement selected managed clusters</h1><p>The <code>Placement</code> API is used to dynamically select a set of <code>ManagedCluster</code> in
one or multiple <code>ManagedClusterSets</code> so that the workloads can be deployed to
these clusters.</p><p>If you define a valid <code>Placement</code>, the placement controller generates a
corresponding <code>PlacementDecision</code> with the selected clusters listed in the
status. As an end-user, you can parse the selected clusters and then operate on
the target clusters. You can also integrate a high-level workload orchestrator
with the <code>PlacementDecision</code> to leverage its scheduling capabilities.</p><p>For example, with OCM addon <a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/>policy</a>
installed, a <code>Policy</code> that includes a <code>Placement</code> mapping can distribute the
<code>Policy</code> to the managed clusters.
For details see this <a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/configuration-policy/#placement-api>example</a>.</p><p>Some popular open source projects also integrate with the <code>Placement</code> API. For
example <a href=https://github.com/argoproj/argo-cd>Argo CD</a>, it can leverage the
generated <code>PlacementDecision</code> to drive the assignment of Argo CD Applications to a
desired set of clusters, details see this <a href=https://github.com/argoproj/argo-cd/tree/master/applicationset/examples/clusterDecisionResource>example</a>.
And <a href=https://github.com/kubevela/kubevela>KubeVela</a>, as an implementation of
the open application model, also will take advantage of the <code>Placement</code> API for
workload scheduling.</p><p>And in this article, we want to show you how to use <code>clusteradm</code> to deploy
<code>ManifestWork</code> to <code>Placement</code> selected clusters.</p><h2 id=prerequisites>Prerequisites</h2><p>Before starting with the following steps, suggest you understand the content below.</p><ul><li><p><a href=https://open-cluster-management.io/docs/concepts/content-placement/placement/><strong>Placement</strong></a>:
The <code>Placement</code> API is used to dynamically select a set of <a href=https://open-cluster-management.io/docs/concepts/cluster-inventory/managedcluster/><code>ManagedCluster</code></a>
in one or multiple <a href=https://open-cluster-management.io/docs/concepts/cluster-inventory/managedclusterset/><code>ManagedClusterSets</code></a>
so that higher-level users can either replicate Kubernetes resources to the
member clusters or run their advanced workload i.e. multi-cluster scheduling.</p></li><li><p><a href=https://open-cluster-management.io/docs/concepts/work-distribution/manifestwork/><strong>ManifestWork</strong></a>:
A custom resource in the hub cluster that groups a list of Kubernetes resources
together and is meant for dispatching them into the managed cluster if the
<code>ManifestWork</code> is created in a valid <code>cluster namespace</code>.</p></li></ul><h2 id=deploy-manifestwork-to-placement-selected-managed-clusters>Deploy manifestwork to placement selected managed clusters</h2><p>In <a href=https://open-cluster-management.io/docs/scenarios/deploy-kubernetes-resources/>deploy Kubernetes resources to the managed clusters</a>,
it shows you how to use <code>clusteradm</code> to create a <code>ManifestWork</code> and deploy it
onto a specific managed clusters. As <code>Placement</code> can dynamically select a set of
<code>ManagedCluster</code>, the next steps will show you how <code>clusteradm</code> leverages
placement scheduling ability and dynamically deploy <code>ManifestWork</code> to a set of
managed clusters.</p><ol><li><p>Following <a href=https://github.com/open-cluster-management-io/OCM/tree/main/solutions/setup-dev-environment>setup dev environment by kind</a>
to prepare an environment.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -sSL https://raw.githubusercontent.com/open-cluster-management-io/OCM/main/solutions/setup-dev-environment/local-up.sh <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div></li><li><p>Confirm there are 2 <code>ManagedCluster</code> and a default <code>ManagedClusterSet</code> created.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm get clusters
</span></span><span style=display:flex><span>NAME       ACCEPTED   AVAILABLE   CLUSTERSET   CPU   MEMORY       KUBERNETES VERSION
</span></span><span style=display:flex><span>cluster1   <span style=color:#204a87>true</span>       True        default      <span style=color:#0000cf;font-weight:700>24</span>    49265496Ki   v1.23.4
</span></span><span style=display:flex><span>cluster2   <span style=color:#204a87>true</span>       True        default      <span style=color:#0000cf;font-weight:700>24</span>    49265496Ki   v1.23.4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ clusteradm get clustersets
</span></span><span style=display:flex><span>NAME      BOUND NAMESPACES   STATUS
</span></span><span style=display:flex><span>default                      <span style=color:#0000cf;font-weight:700>2</span> ManagedClusters selected
</span></span></code></pre></div></li><li><p>Bind the default <code>ManagedClusterSet</code> to default <code>Namespace</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm clusterset <span style=color:#204a87>bind</span> default --namespace default
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm get clustersets
</span></span><span style=display:flex><span>NAME      BOUND NAMESPACES   STATUS
</span></span><span style=display:flex><span>default   default            <span style=color:#0000cf;font-weight:700>2</span> ManagedClusters selected
</span></span></code></pre></div><p>Note: click <a href=https://open-cluster-management.io/concepts/managedclusterset/#operates-managedclusterset-using-clusteradm>here</a>
to see more details about how to operate <code>ManagedClusterSet</code> using <code>clusteradm</code>.</p></li><li><p>Create a <code>Placement</code> placement1 to select the two clusters in default <code>ManagedClusterSet</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: cluster.open-cluster-management.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Placement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: placement1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: default
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  numberOfClusters: 2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  clusterSets:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - default
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div></li><li><p>Use <code>clusteradm</code> command to create <code>ManifestWork</code> my-first-work with
<code>Placement</code> placement1.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm create work my-first-work -f work.yaml --placement default/placement1
</span></span></code></pre></div><p>The <code>work.yaml</code> contains kubernetes resource definitions, for sample:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: ServiceAccount
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  namespace: default
</span></span><span style=display:flex><span>  name: my-sa
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>apiVersion: apps/v1
</span></span><span style=display:flex><span>kind: Deployment
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  namespace: default
</span></span><span style=display:flex><span>  name: nginx-deployment
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    app: nginx
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  replicas: <span style=color:#0000cf;font-weight:700>3</span>
</span></span><span style=display:flex><span>  selector:
</span></span><span style=display:flex><span>    matchLabels:
</span></span><span style=display:flex><span>      app: nginx
</span></span><span style=display:flex><span>  template:
</span></span><span style=display:flex><span>    metadata:
</span></span><span style=display:flex><span>      labels:
</span></span><span style=display:flex><span>        app: nginx
</span></span><span style=display:flex><span>    spec:
</span></span><span style=display:flex><span>      serviceAccountName: my-sa
</span></span><span style=display:flex><span>      containers:
</span></span><span style=display:flex><span>        - name: nginx
</span></span><span style=display:flex><span>          image: nginx:1.14.2
</span></span><span style=display:flex><span>          ports:
</span></span><span style=display:flex><span>            - containerPort: <span style=color:#0000cf;font-weight:700>80</span>
</span></span></code></pre></div></li><li><p>Check the <code>ManifestWork</code>, it should be distributed to both cluster1 and cluster2.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get manifestwork -A
</span></span><span style=display:flex><span>NAMESPACE   NAME            AGE
</span></span><span style=display:flex><span>cluster1    my-first-work   28s
</span></span><span style=display:flex><span>cluster2    my-first-work   28s
</span></span></code></pre></div></li><li><p>Update the <code>Placement</code> placement1 to select only one managed cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl patch placement placement1 --patch <span style=color:#4e9a06>&#39;{&#34;spec&#34;: {&#34;clusterSets&#34;: [&#34;default&#34;],&#34;numberOfClusters&#34;: 1}}&#39;</span> --type<span style=color:#ce5c00;font-weight:700>=</span>merge
</span></span></code></pre></div></li><li><p>As the placement decision changes, running below command to reschedule
<code>ManifestWork</code> my-first-work to the newly selected cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm create work my-first-work -f work.yaml --placement default/placement1 --overwrite
</span></span></code></pre></div></li><li><p>Check the <code>ManifestWork</code> again, now it&rsquo;s only deployed to cluster1.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get manifestwork -A
</span></span><span style=display:flex><span>NAMESPACE   NAME            AGE
</span></span><span style=display:flex><span>cluster1    my-first-work   18m
</span></span></code></pre></div></li></ol><h2 id=what-happens-behind-the-scene>What happens behind the scene</h2><p>The main idea is that <code>clusteradm</code> parse the selected clusters generated by
<code>Placement</code>, and fill in that as <code>ManifestWork</code> namespace. Then create the
<code>ManifestWork</code> and it would be distributed to a set of clusters.
Let&rsquo;s see more details.</p><ol><li><p><code>Placement</code> placement1 generates a <code>PlacementDecision</code> placement1-decision-1.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get placementdecision -n default -l cluster.open-cluster-management.io/placement<span style=color:#ce5c00;font-weight:700>=</span>placement1 -oyaml
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>items:
</span></span><span style=display:flex><span>- apiVersion: cluster.open-cluster-management.io/v1beta1
</span></span><span style=display:flex><span>  kind: PlacementDecision
</span></span><span style=display:flex><span>  metadata:
</span></span><span style=display:flex><span>    creationTimestamp: <span style=color:#4e9a06>&#34;2022-07-06T15:03:12Z&#34;</span>
</span></span><span style=display:flex><span>    generation: <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    labels:
</span></span><span style=display:flex><span>      cluster.open-cluster-management.io/placement: placement1
</span></span><span style=display:flex><span>    name: placement1-decision-1
</span></span><span style=display:flex><span>    namespace: default
</span></span><span style=display:flex><span>    ownerReferences:
</span></span><span style=display:flex><span>    - apiVersion: cluster.open-cluster-management.io/v1beta1
</span></span><span style=display:flex><span>      blockOwnerDeletion: <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>      controller: <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>      kind: Placement
</span></span><span style=display:flex><span>      name: placement1
</span></span><span style=display:flex><span>      uid: aa339f57-0eb7-4260-8d4d-f30c1379fd35
</span></span><span style=display:flex><span>    resourceVersion: <span style=color:#4e9a06>&#34;47679&#34;</span>
</span></span><span style=display:flex><span>    uid: 9f948619-1647-429d-894d-81e11dd8bcf1
</span></span><span style=display:flex><span>  status:
</span></span><span style=display:flex><span>    decisions:
</span></span><span style=display:flex><span>    - clusterName: cluster1
</span></span><span style=display:flex><span>      reason: <span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span>    - clusterName: cluster2
</span></span><span style=display:flex><span>      reason: <span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span>kind: List
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  resourceVersion: <span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span>  selfLink: <span style=color:#4e9a06>&#34;&#34;</span>
</span></span></code></pre></div></li><li><p><code>clusteradm</code> get the <code>PlacementDecision</code> generated by <code>Placement</code>
placement1 with label <code>cluster.open-cluster-management.io/placement: placement1</code>,
reference <a href=https://github.com/open-cluster-management-io/clusteradm/pull/247/files#diff-0f96f91e259a6a6ce0f2231444a4991174b43bc206d34897be3be897279124eaR157>code</a>.
Then parse the clusterName cluster1 and cluster2, fill in that as <code>ManifestWork</code>
namespace, reference <a href=https://github.com/open-cluster-management-io/clusteradm/pull/247/files#diff-0f96f91e259a6a6ce0f2231444a4991174b43bc206d34897be3be897279124eaR183>code</a>.
Then installs <code>ManifestWork</code> to namespace cluster1 and cluster2,
which will finally be distributed to the two clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get manifestwork -A
</span></span><span style=display:flex><span>NAMESPACE   NAME            AGE
</span></span><span style=display:flex><span>cluster1    my-first-work   28s
</span></span><span style=display:flex><span>cluster2    my-first-work   28s
</span></span></code></pre></div></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-338e3de74358e29e5f426fed18dbbcd1>4.3 - Extend the multicluster scheduling capabilities with placement</h1><p>The <code>Placement</code> API is used to dynamically select a set of <code>ManagedCluster</code> in one or multiple <code>ManagedClusterSets</code> so that the workloads can be deployed to these clusters. You can use placement to filter clusters by label or claim selector, also placement provides some default prioritizers which can be used to sort and select the most suitable clusters.</p><p>One of the default prioritizers are ResourceAllocatableCPU and ResourceAllocatableMemory. They provide the capability to sort clusters based on the allocatable CPU and memory. However, when considering the resource based scheduling, there&rsquo;s a gap that the cluster’s &ldquo;AllocatableCPU&rdquo; and &ldquo;AllocatableMemory&rdquo; are static values that won’t change even if &ldquo;the cluster is running out of resources&rdquo;. And in some cases, the prioritizer needs more extra data to calculate the score of the managed cluster. For example, there is a requirement to schedule based on resource monitoring data from the cluster. For this reason, we need a more extensible way to support scheduling based on customized scores.</p><h2 id=what-is-placement-extensible-scheduling>What is Placement extensible scheduling?</h2><p>OCM placement introduces an API <code>AddOnPlacementScore</code> to support scheduling based on customized scores. This API supports storing the customized scores and being used by placement. Details of the API&rsquo;s definition refer to <a href=https://github.com/open-cluster-management-io/api/blob/main/cluster/v1alpha1/types_addonplacementscore.go>types_addonplacementscore.go</a>. An example of <code>AddOnPlacementScore</code> is as below.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnPlacementScore</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2021-10-28T08:31:39Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnPlacementScore updated successfully</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnPlacementScoreUpdated</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnPlacementScoreUpdated</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>validUntil</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2021-10-29T18:31:39Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>scores</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;cpuAvailable&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>66</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;memAvailable&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>55</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li><code>conditions</code>. Conditions contain the different condition statuses for this <code>AddOnPlacementScore</code>.</li><li><code>validUntil</code>. ValidUntil defines the valid time of the scores. After this time, the scores are considered to be invalid by placement. nil means never expire. The controller owning this resource should keep the scores up-to-date.</li><li><code>scores</code>. Scores contain a list of score names and values of this managed cluster. In the above example, the API contains a list of customized scores: cpuAvailable and memAvailable.</li></ul><p>All the customized scores information is stored in <code>status</code>, as we don&rsquo;t expect end users to update it.</p><ul><li>As a score provider, a 3rd party controller could run on either hub or managed cluster, to maintain the lifecycle of <code>AddOnPlacementScore</code> and update the score into the <code>status</code>.</li><li>As an end user, you need to know the resource name &ldquo;default&rdquo; and customized score name &ldquo;cpuAvailable"and &ldquo;memAvailable&rdquo; , so you can specify the name in placement yaml to select clusters. For example, the below placement wants to select the top 3 clusters with the highest cpuAvailable score.<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ns1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>prioritizerPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exact</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>configurations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>scoreCoordinate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>addOn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>resourceName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>scoreName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cpuAvailable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li><li>In placement, if the end-user defines the scoreCoordinate type as AddOn, the placement controller will get the <code>AddOnPlacementScore</code> resource with the name &ldquo;default&rdquo; in each cluster&rsquo;s namespace, read score &ldquo;cpuAvailable&rdquo; in the score list, and use that score to sort clusters.</li></ul><p>You can refer to the <a href=https://github.com/open-cluster-management-io/enhancements/blob/main/enhancements/sig-architecture/32-extensiblescheduling/32-extensiblescheduling.md>enhancements</a> to learn more details about the design. In the design, how to maintain the lifecycle (create/update/delete) of the <code>AddOnPlacementScore</code> CRs is not covered, as we expect the customized score provider itself to manage it. In this article, we will use an example to show you how to implement a 3rd part controller to update your own scores and extend the multiple clusters scheduling capability with your own scores.</p><h2 id=how-to-implement-a-customized-score-provider>How to implement a customized score provider</h2><p>The example code is in GitHub repo <a href=https://github.com/open-cluster-management-io/addon-contrib/tree/main/resource-usage-collect-addon>resource-usage-collect-addon</a>. It provides the score of the cluster&rsquo;s available CPU and available memory, which can reflect the cluster’s real-time resource utilization. It is developed with OCM <a href=https://github.com/open-cluster-management-io/addon-framework>addon-framework</a> and can be installed as an addon plugin to update customized scores into <code>AddOnPlacementScore</code>. (This article won&rsquo;t talk many details about addon-framework, referring to <a href=https://open-cluster-management.io/docs/developer-guides/addon/>Add-on Developer Guide</a> to learn how to develop an addon.)</p><p>The resource-usage-collect addon follows the hub-agent architecture as below.</p><div style=text-align:center;padding:20px><img src=/extend-multicluster-scheduling-capabilities.png alt="Security model" style="margin:0 auto;width:60%"></div><p>The resource-usage-collect addon contains a controller and an agent.</p><ul><li>On the hub cluster, the resource-usage-collect-controller is running. It is responsible for creating the <code>ManifestWork</code> for resource-usage-collect-agent in each cluster namespace.</li><li>On each managed cluster, the work agent watches the <code>ManifestWork</code> and installs the resource-usage-collect-agent on each cluster. The resource-usage-collect-agent is the core part of this addon, it creates the <code>AddonPlacementScore</code> for each cluster on the Hub cluster, and refreshes the <code>scores</code> and <code>validUntil</code> every 60 seconds.</li></ul><p>When the <code>AddonPlacementScore</code> is ready, the end user can specify the customized core in a placement to select clusters.</p><p>The working flow and logic of resource-usage-collect addon are quite easy to understand. Now let&rsquo;s follow the below steps to get started!</p><p><strong>Prepare an OCM environment with 2 <code>ManagedClusters</code>.</strong></p><ol><li>Following <a href=https://github.com/open-cluster-management-io/OCM/tree/main/solutions/setup-dev-environment>setup dev environment by kind</a> to prepare an environment.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -sSL https://raw.githubusercontent.com/open-cluster-management-io/OCM/main/solutions/setup-dev-environment/local-up.sh <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><ol start=2><li>Confirm there are 2 <code>ManagedCluster</code> and a default <code>ManagedClusterSet</code> created.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ clusteradm get clusters
</span></span><span style=display:flex><span>NAME       ACCEPTED   AVAILABLE   CLUSTERSET   CPU   MEMORY       KUBERNETES VERSION
</span></span><span style=display:flex><span>cluster1   <span style=color:#204a87>true</span>       True        default      <span style=color:#0000cf;font-weight:700>24</span>    49265496Ki   v1.23.4
</span></span><span style=display:flex><span>cluster2   <span style=color:#204a87>true</span>       True        default      <span style=color:#0000cf;font-weight:700>24</span>    49265496Ki   v1.23.4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ clusteradm get clustersets
</span></span><span style=display:flex><span>NAME      BOUND NAMESPACES   STATUS
</span></span><span style=display:flex><span>default                      <span style=color:#0000cf;font-weight:700>2</span> ManagedClusters selected
</span></span></code></pre></div><ol start=3><li>Bind the default <code>ManagedClusterSet</code> to default <code>Namespace</code>.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>clusteradm clusterset <span style=color:#204a87>bind</span> default --namespace default
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ clusteradm get clustersets
</span></span><span style=display:flex><span>NAME      BOUND NAMESPACES   STATUS
</span></span><span style=display:flex><span>default   default            <span style=color:#0000cf;font-weight:700>2</span> ManagedClusters selected
</span></span></code></pre></div><p><strong>Install the resource-usage-collect addon.</strong></p><ol><li>Git clone the source code.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone git@github.com:open-cluster-management-io/addon-contrib.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> addon-contrib/resource-usage-collect-addon
</span></span></code></pre></div><ol start=2><li>Prepare the image.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Set image name, this is an optional step.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>IMAGE_NAME</span><span style=color:#ce5c00;font-weight:700>=</span>quay.io/haoqing/resource-usage-collect-addon:latest
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Build image</span>
</span></span><span style=display:flex><span>make images
</span></span></code></pre></div><p>If your are using kind, load image into kind cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kind load docker-image <span style=color:#000>$IMAGE_NAME</span> --name &lt;cluster_name&gt; <span style=color:#8f5902;font-style:italic># kind load docker-image $IMAGE_NAME --name hub</span>
</span></span></code></pre></div><ol start=3><li>Deploy the resource-usage-collect addon.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make deploy
</span></span></code></pre></div><ol start=4><li>Verify the installation.</li></ol><p>On the hub cluster, verify the resource-usage-collect-controller pod is running.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get pods -n open-cluster-management <span style=color:#000;font-weight:700>|</span> grep resource-usage-collect-controller
</span></span><span style=display:flex><span>resource-usage-collect-controller-55c58bbc5-t45dh   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          71s
</span></span></code></pre></div><p>On the hub cluster, verify the <code>AddonPlacementScore</code> is generated for each managed cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get addonplacementscore -A
</span></span><span style=display:flex><span>NAMESPACE   NAME                   AGE
</span></span><span style=display:flex><span>cluster1    resource-usage-score   3m23s
</span></span><span style=display:flex><span>cluster2    resource-usage-score   3m24s
</span></span></code></pre></div><p>The <code>AddonPlacementScore</code> status should contain a list of scores as below.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get addonplacementscore -n cluster1 resource-usage-score -oyaml
</span></span><span style=display:flex><span>apiVersion: cluster.open-cluster-management.io/v1alpha1
</span></span><span style=display:flex><span>kind: AddOnPlacementScore
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  creationTimestamp: <span style=color:#4e9a06>&#34;2022-08-08T06:46:04Z&#34;</span>
</span></span><span style=display:flex><span>  generation: <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>  name: resource-usage-score
</span></span><span style=display:flex><span>  namespace: cluster1
</span></span><span style=display:flex><span>  resourceVersion: <span style=color:#4e9a06>&#34;3907&#34;</span>
</span></span><span style=display:flex><span>  uid: 6c4280e4-38be-4d45-9c73-c18c84799781
</span></span><span style=display:flex><span>status:
</span></span><span style=display:flex><span>  scores:
</span></span><span style=display:flex><span>  - name: cpuAvailable
</span></span><span style=display:flex><span>    value: <span style=color:#0000cf;font-weight:700>12</span>
</span></span><span style=display:flex><span>  - name: memAvailable
</span></span><span style=display:flex><span>    value: <span style=color:#0000cf;font-weight:700>4</span>
</span></span></code></pre></div><p>If <code>AddonPlacementScore</code> is not created or there are no scores in the status, go into the managed cluster, and check if the resource-usage-collect-agent pod is running well.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get pods -n default <span style=color:#000;font-weight:700>|</span> grep resource-usage-collect-agent
</span></span><span style=display:flex><span>resource-usage-collect-agent-5b85cbf848-g5kqm   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          2m
</span></span></code></pre></div><p><strong>Select clusters with the customized scores.</strong></p><p>If everything is running well, now you can try to create placement and select clusters with the customized scores.</p><ol><li>Create a placement to select 1 cluster with the highest cpuAvailable score.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: cluster.open-cluster-management.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Placement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: placement1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: default
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  numberOfClusters: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  clusterSets:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - default
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  prioritizerPolicy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    mode: Exact
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    configurations:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      - scoreCoordinate:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          type: AddOn
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          addOn:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            resourceName: resource-usage-score
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            scoreName: cpuAvailable
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        weight: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><ol start=2><li>Verify the placement decision.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl describe placementdecision -n default <span style=color:#000;font-weight:700>|</span> grep Status -A <span style=color:#0000cf;font-weight:700>3</span>
</span></span><span style=display:flex><span>Status:
</span></span><span style=display:flex><span>  Decisions:
</span></span><span style=display:flex><span>    Cluster Name:  cluster1
</span></span><span style=display:flex><span>    Reason:
</span></span></code></pre></div><p>Cluster1 is selected by <code>PlacementDecision</code>.</p><p>Running below command to get the customized score in <code>AddonPlacementScore</code> and the cluster score set by <code>Placement</code>.
You can see that the &ldquo;cpuAvailable&rdquo; score is 12 in <code>AddonPlacementScore</code>, and this value is also the cluster score in <code>Placement</code> events, this indicates that placement is using the customized score to select clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get addonplacementscore -A -o<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{range .items[*]}{.metadata.namespace}{&#34;\t&#34;}{.status.scores}{&#34;\n&#34;}{end}&#39;</span>
</span></span><span style=display:flex><span>cluster1        <span style=color:#ce5c00;font-weight:700>[{</span><span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;cpuAvailable&#34;</span>,<span style=color:#4e9a06>&#34;value&#34;</span>:12<span style=color:#ce5c00;font-weight:700>}</span>,<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;memAvailable&#34;</span>,<span style=color:#4e9a06>&#34;value&#34;</span>:4<span style=color:#ce5c00;font-weight:700>}]</span>
</span></span><span style=display:flex><span>cluster2        <span style=color:#ce5c00;font-weight:700>[{</span><span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;cpuAvailable&#34;</span>,<span style=color:#4e9a06>&#34;value&#34;</span>:12<span style=color:#ce5c00;font-weight:700>}</span>,<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;memAvailable&#34;</span>,<span style=color:#4e9a06>&#34;value&#34;</span>:4<span style=color:#ce5c00;font-weight:700>}]</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl describe placement -n default placement1 <span style=color:#000;font-weight:700>|</span> grep Events -A <span style=color:#0000cf;font-weight:700>10</span>
</span></span><span style=display:flex><span>Events:
</span></span><span style=display:flex><span>  Type    Reason          Age   From                 Message
</span></span><span style=display:flex><span>  ----    ------          ----  ----                 -------
</span></span><span style=display:flex><span>  Normal  DecisionCreate  50s   placementController  Decision placement1-decision-1 is created with placement placement1 in namespace default
</span></span><span style=display:flex><span>  Normal  DecisionUpdate  50s   placementController  Decision placement1-decision-1 is updated with placement placement1 in namespace default
</span></span><span style=display:flex><span>  Normal  ScoreUpdate     50s   placementController  cluster1:12 cluster2:12
</span></span></code></pre></div><p>Now you know how to install the resource-usage-collect addon and consume the customized score to select clusters. Next, let&rsquo;s take a deeper look into some key points when you consider implementing a customized score provider.</p><h3 id=1-where-to-run-the-customized-score-provider>1. Where to run the customized score provider</h3><p>The customized score provider could run on either hub or managed cluster. Combined with user stories, you should be able to distinguish whether the controller should be placed in a hub or a managed cluster.</p><p>In our example, the customized score provider is developed with <a href=https://github.com/open-cluster-management-io/addon-framework>addon-famework</a>, it follows the hub-agent architecture. The resource-usage-collect-agent is the real score provider, it is installed on each managed cluster, it gets the available CPU and memory of the managed cluster, calculates a score, and updates it into <code>AddonPlacementScore</code>. The resource-usage-collect-controller just takes care of installing the agent.</p><p>In other cases, for example, if you want to use the metrics from Thanos to calculate a score for each cluster, then the customized score provider only needs to be placed on the hub, as Thanos has all the metrics collected from each managed cluster.</p><h3 id=2-how-to-maintain-the-addonplacementscore-cr-lifecycle>2. How to maintain the AddOnPlacementScore CR lifecycle</h3><p>In our example, the code to maintain the <code>AddOnPlacementScore</code> CR is in <a href=https://github.com/open-cluster-management-io/addon-contrib/blob/main/resource-usage-collect-addon/pkg/addon/agent/agent.go>pkg/addon/agent/agent.go</a>.</p><ul><li><p>When should the score be created?</p><p>The <code>AddOnPlacementScore</code> CR can be created with the existence of a ManagedCluster, or on demand for the purpose of reducing objects on the hub.</p><p>In our example, the addon creates an <code>AddOnPlacementScore</code> for each Managed Cluster if it does not exist, and a score will be calculated when creating the CR for the first time.</p></li><li><p>When should the score be updated?</p><p>We recommend that you set <code>ValidUntil</code> when updating the score so that the placement controller can know if the score is still valid in case it failed to update for a long time.</p><p>The score could be updated when your monitoring data changes, or at least you need to update it before it expires.</p><p>In our example, in addition to recalculate and update the score every 60 seconds, the update will also be triggered when the node or pod resource in the managed cluster changes.</p></li></ul><h3 id=3-how-to-calculate-the-score>3. How to calculate the score</h3><p>The code to calculate the score is in <a href=https://github.com/open-cluster-management-io/addon-contrib/blob/main/resource-usage-collect-addon/pkg/addon/agent/calculate.go>pkg/addon/agent/calculate.go</a>. A valid score must be in the range -100 to 100, you need to normalize the scores before updating it into <code>AddOnPlacementScore</code>.</p><p>When normalizing the score, you might meet the below cases.</p><ul><li><p>The score provider knows the max and min value of the customized scores.</p><p>In this case, it is easy to achieve smooth mapping by formula. Suppose the actual value is X, and X is in the interval [min, max], then <code>score ＝ 200 * (x - min) / (max - min) - 100</code> .</p></li><li><p>The score provider doesn&rsquo;t know the max and min value of the customized scores.</p><p>In this case, you need to set a maximum and minimum value by yourself, as without a max and min value, is unachievable to map a single value X to the range [-100, 100].</p><p>Then when the X is greater than this maximum value, the cluster can be considered healthy enough to deploy applications, and the score can be set as 100. And if X is less than the minimum value, the score can be set as -100.</p><pre tabindex=0><code>if X &gt;= max
  score = 100
if X &lt;= min
  score = -100
</code></pre></li></ul><p>In our example, the resource-usage-collect-agent running on each managed cluster doesn&rsquo;t have a whole picture view to know the max/min value of CPU/memory usage of all the clusters, so we manually set the max value as <code>MAXCPUCOUNT</code> and <code>MAXMEMCOUNT</code> in code, min value is set as 0. The score calculation formula can be simplified: <code>score = x / max * 100</code>.</p><h2 id=summary>Summary</h2><p>In this article, we introduced what is the placement extensible scheduling and used an example to show how to implement a customized score provider. Also, this article list 3 key points the developer needs to consider when implementing a 3rd party score provider. Hope after reading this article, you can have a clear view of how placement extensible scheduling can help you extend the multicluster scheduling capabilities.</p><p>Feel free to raise your question in the <a href=https://github.com/open-cluster-management-io/OCM/issues>Open-cluster-management-io GitHub community</a> or contact us using <a href=https://kubernetes.slack.com/channels/open-cluster-mgmt>Slack</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f272b8ffa037ea1ad801d9800b171b46>4.4 - Extending managed clusters with custom attributes</h1><p>Under some cases we need a convenient way to extend OCM&rsquo;s <a href=https://open-cluster-management.io/docs/concepts/cluster-inventory/managedcluster/>Managed Cluster</a>
data model so that our own custom multi-cluster system can easily work over the
OCM&rsquo;s native cluster api otherwise we will have to maintain an additional
Kubernetes&rsquo; <a href=https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/>CustomResourceDefinition</a>
in the project. OCM definitely supports developers to decorate the cluster api
with minimal effort, and in the following content we will walk through that
briefly.</p><p>The original cluster model in OCM &ldquo;Managed Cluster&rdquo; is designed to be a
<strong>neat</strong> and <strong>light-weight</strong> placeholder resource of which the spec doesn&rsquo;t
require any additional information other than &ldquo;whether the cluster is
accepted or not&rdquo; i.e. <code>.spec.hubAcceptsClient</code>, and all the other fields
in the spec are totally optional, e.g. <code>.spec.managedClusterClientConfigs</code>
is only required until we install some addons that replying on that
information.</p><p>Overall in OCM we can decorate the original cluster model with custom
attributes in the following approaches:</p><ul><li><code>Label</code>: The common label primitive in terms of a Kubernetes resource.</li><li><code>Cluster Claim</code>: A custom resource available inside the managed cluster
which will be consistently reported to the hub cluster.</li></ul><h2 id=labeling-managed-cluster>Labeling managed cluster</h2><p>Any kubernetes resource can be attached with labels in the metadata in the
form of:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&lt;domain name&gt;/&lt;label name&gt;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>&lt;label string value&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>However, there&rsquo;re some restrictions to the label value such as the content
length, and legal charset etc, so it&rsquo;s not convenient to put some structuralized
or comprehensive data in the label value.</p><p>Additionally, due to the fact that the finest granularity of authorization
mechanism in Kubernetes is &ldquo;resource&rdquo;, so it&rsquo;s also not convenient for us
to protect these extended labels from unexpected modification unless
intercepting the writes the &ldquo;Managed Cluster&rdquo; with an admission webhook which
brings additional costs in cluster administration and operation. So generally
it&rsquo;s recommended to put those immutable or static attributes (that doesn&rsquo;t
frequently change over time) such as:</p><ul><li>data-center information</li><li>network infrastructure information</li><li>geography attributes like cluster&rsquo;s region</li><li>&mldr;</li></ul><p>Last but not least, it&rsquo;s generally not recommended to grant permission to the
managed cluster to update non-status fields on the &ldquo;Managed Cluster&rdquo; so these
custom attributes in labels should only be manipulated by hub cluster
admins/operators. If you are looking for a way to make the local agents in the
managed clusters to be capable of reporting attributes in a &ldquo;bottom-up&rdquo;
pattern, go ahead read the &ldquo;Cluster Claim&rdquo; section below.</p><h2 id=decorating-managed-cluster-with-cluster-claim>Decorating managed cluster with cluster claim</h2><p>The cluster claim is a cluster-scoped custom resource working from the managed
clusters and proactively projecting custom attributes towards the hub cluster&rsquo;s
&ldquo;Managed Cluster&rdquo; model. Note that the hub cluster is not supposed to make
any direct modification upon the projected claims on the &ldquo;ManagedCluster&rdquo;, i.e.
<strong>read-only</strong> to the hub cluster.</p><p>A sample of cluster claim will be like:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterClaim</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>95f91f25-d7a2-4fc3-9237-2ef633d8451c</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>After applying the cluster claim above to any managed cluster, the value of
the claims will be instantly reflected in the cluster model. e.g.:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedCluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterClaims</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>95f91f25-d7a2-4fc3-9237-2ef633d8451c</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>And any future updates upon the claim will also be reported from the
registration agent to the hub cluster.</p><p>The claims are useful if we want the hub cluster to perform different actions
or behaviors reactively based on the feedback of reported values. They&rsquo;re
typically applicable to describe the information that changes in the managed
cluster frequently. e.g.:</p><ul><li>aggregated resource information (node counts, pod counts)</li><li>cluster resource watermark/budget</li><li>any cluster-scoped knowledge of the managed cluster&mldr;</li></ul><h2 id=next>Next</h2><p>After extending your &ldquo;Managed Cluster&rdquo; with customized attributes, now we can
try the advanced cluster selection using the <a href=https://open-cluster-management.io/docs/concepts/content-placement/placement/>placement</a>
policies, which is provided ny another module of OCM helpful for building your
own advanced multi-cluster systems.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6e0533c701ce88469bf1155ab6c497f9>4.5 - Integration with Argo CD</h1><p><a href=https://argo-cd.readthedocs.io/en/stable/>Argo CD</a> is a declarative, GitOps continuous delivery tool, which allows developers to define and control deployment of Kubernetes application resources from within their existing Git workflow. By integrating Open Cluster Management (OCM) with Argo CD, it enables both automation and greater flexibility managing Argo CD Applications across a large number of OCM managed clusters.</p><p>In this article, we want to show you how to integrate Argo CD with OCM and deploy application to OCM managed clusters by leveraging the <code>Placement</code> API, which supports multi-cluster scheduling.</p><p>Before starting with the following steps, we suggest you understand the content below:</p><ul><li><a href=https://argo-cd.readthedocs.io/en/stable/user-guide/application-set/>Argo CD ApplicationSet</a>. It adds Application automation and seeks to improve multi-cluster support and cluster multitenant support within Argo CD.</li><li><a href=https://open-cluster-management.io/docs/concepts/content-placement/placement/>OCM Placement API</a>. It is used to dynamically select a set of <a href=https://open-cluster-management.io/docs/concepts/cluster-inventory/managedcluster/>ManagedClusters</a> in one or multiple <a href=https://open-cluster-management.io/docs/concepts/cluster-inventory/managedclusterset/>ManagedClusterSets</a> so that the workloads can be deployed to these clusters.</li></ul><p>The first half of the
<a href=/kubecon-na-2022-ocm-multicluster-app-and-config-management.pdf>KubeCon NA 2022 - OCM Multicluster App & Config Management</a>
also covers the integration with ArgoCD.</p><h3 id=how-it-works>How it works</h3><div style=text-align:center;padding:20px><img src=/integration-with-argocd.png alt="How it works" style="margin:0 auto;width:75%"></div><p><strong>1. Import Kubernetes clusters to the OCM hub as managed clusters and organize them with managed clustersets.</strong></p><p><strong>2. Register the OCM managed clusters to ArgoCD.</strong></p><p>The OCM managed clusters can be registered to Argo CD one by one manually by using Argo CD CLI. It may take time to finish it if there are a large number of clusters. In order to make the cluster registration easier, consider to use <a href=https://github.com/open-cluster-management-io/multicloud-integrations>multicloud-integrations</a> to automate the procedure.</p><p><strong>3. Create a configuration of <a href=https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Generators-Cluster-Decision-Resource/>Cluster Decision Resource generator</a> by using OCM Placement API.</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ConfigMap
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: ocm-placement-generator
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: argocd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>data:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  apiVersion: cluster.open-cluster-management.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  kind: placementdecisions
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  statusListKey: decisions
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  matchKey: clusterName
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>With reference to this generator, an <code>ApplicationSet</code> can target the application to the clusters listed in the status of a set of <code>PlacementDecision</code>, which belong to a certain Placement.</p><p><strong>4. Grant Argo CD permissions to access OCM resources.</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Role
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: ocm-placement-consumer
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: argocd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>rules:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>- apiGroups: [&#34;cluster.open-cluster-management.io&#34;]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  resources: [&#34;placementdecisions&#34;]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  verbs: [&#34;get&#34;, &#34;list&#34;]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>---
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: RoleBinding
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: ocm-placement-consumer:argocd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: argocd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>roleRef:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  apiGroup: rbac.authorization.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  kind: Role
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: ocm-placement-consumer
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>subjects:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>- kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: argocd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: argocd-applicationset-controller
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p><strong>5. Bind at least one managed clusterset to the <code>argocd</code> namespace.</strong></p><p>For example, in order to bind the <code>global</code> managed clusterset to the <code>argocd</code> namespace, the user must have an RBAC rule to <code>create</code> on the virtual subresource of <code>managedclustersets/bind</code> of the <code>global</code> managed clusterset.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>clusteradm clusterset <span style=color:#204a87>bind</span> global --namespace argocd
</span></span></code></pre></div><p>The above command will create a <code>ManagedClusterSetBinding</code> resource in the <code>argocd</code> namespace. Normally, it should not be included by an application in the git repo because applying it to a Kubernetes cluster needs additional permissions.</p><p><strong>6. Create a placement in the <code>argocd</code> namespace to select some managed clusters.</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: cluster.open-cluster-management.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Placement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: guestbook-app-placement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: argocd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  numberOfClusters: 10
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p><strong>7. Create an <code>ApplicationSet</code> in the <code>argocd</code> namespace.</strong></p><p>The <code>ApplicationSet</code> has references to the Cluster Decision Resource generator previously created and placement. This will help Argo CD to determine where the application should be deployed. The managed clusters selected by the referenced placement may be changed dynamically. By setting <code>requeueAfterSeconds</code> of the generator in the <code>ApplicationSet</code> spec, the Argo CD will check the cluster decisions of the referenced placement periodically and ensure the application is deployed to the correct managed clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: argoproj.io/v1alpha1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ApplicationSet
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: guestbook-app
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: argocd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  generators:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - clusterDecisionResource:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        configMapRef: ocm-placement-generator
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        labelSelector:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            cluster.open-cluster-management.io/placement: guestbook-app-placement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        requeueAfterSeconds: 30
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  template:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      name: &#39;{{clusterName}}-guestbook-app&#39;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      project: default
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      source:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        repoURL: &#39;https://github.com/argoproj/argocd-example-apps.git&#39;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        targetRevision: HEAD
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        path: guestbook
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      destination:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        name: &#39;{{clusterName}}&#39;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        namespace: guestbook
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      syncPolicy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        automated:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          prune: true
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        syncOptions:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          - CreateNamespace=true
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p><strong>8. Check the status of the <code>ApplicationSet</code> and the <code>Application</code>.</strong></p><p>Confirm the <code>ApplicationSet</code> is created and an <code>Application</code> is generated for each selected managed cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n argocd get applicationsets
</span></span><span style=display:flex><span>NAME            AGE
</span></span><span style=display:flex><span>guestbook-app   4s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl -n argocd get applications
</span></span><span style=display:flex><span>NAME                     SYNC STATUS   HEALTH STATUS
</span></span><span style=display:flex><span>cluster1-guestbook-app   Synced        Progressing
</span></span><span style=display:flex><span>cluster2-guestbook-app   Synced        Progressing
</span></span></code></pre></div><p>And on each selected managed cluster confirm the <code>Application</code> is running.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n guestbook get pods
</span></span><span style=display:flex><span>NAME                           READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>guestbook-ui-6b689986f-cdrk8   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          112s
</span></span></code></pre></div><h3 id=whats-next>What&rsquo;s next</h3><p>To build an OCM environment integrated with Argo CD with <code>KinD</code> clusters, see <a href=https://github.com/open-cluster-management-io/OCM/tree/main/solutions/deploy-argocd-apps>Deploy applications with Argo CD</a> for more details.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-86a38af7c2840a716dc25acad93066d1>4.6 - Manage a cluster with multiple hubs</h1><p>Normally an Open Cluster Management (OCM) hub manages multiple managed clusters and a cluster only registers to one OCM hub. While there might be some user scenarios, where a single cluster may want to join more than one OCM hub as a managed cluster, including:</p><ul><li>In an organization, each department may setup an OCM hub to manage clusters owned by this department, and all clusters are managed by a central OCM hub owned by IT department to enforce organization wide security policies.</li><li>A service provider creates clusters for customers. The underlying system of the service provider uses OCM hubs to manage all the clusters. Once customer gets a cluster from the service provider, they may also want to manage this cluster with customer&rsquo;s OCM hub.</li></ul><p>This document shows how to achieve it with OCM.</p><p>Since the OCM agent is hub specific, that means an agent can connect to only one hub. In order to connect to multiple hubs, each hub should have its own agent running. Depdends on where the agent is running, there are two solutions:</p><ul><li>Run all agents on the managed cluster;</li><li>Run the agents in the hosted mode on the hosting clusters;</li></ul><h3 id=run-all-the-agents-on-the-managed-cluster>Run all the agents on the managed cluster</h3><p>Since there are multiple OCM agents are running on the managed cluster, each of them must have an unique agent namespace. So only one agent can be deployed in the default agent namespace <code>open-cluster-management-agent</code>.</p><div style=text-align:center;padding:20px><img src=/multi-hubs.png alt="multiple hubs" style="margin:0 auto;width:75%"></div><p>With this architecture, the managed cluster needs more resources, including CPUs and memory, to run agents for multiple hubs. And it&rsquo;s a challenge to handle the version skew of the OCM hubs.</p><p>An example built with <a href=https://kind.sigs.k8s.io>kind</a> and <a href=https://github.com/open-cluster-management-io/clusteradm/releases>clusteradm</a> can be found in <a href=https://github.com/open-cluster-management-io/OCM/tree/main/solutions/multiple-hubs>Manage a cluster with multiple hubs</a>.</p><h3 id=run-the-agents-in-the-hosted-mode-on-the-hosting-clusters>Run the agents in the hosted mode on the hosting clusters</h3><p>By leveraging the hosted deployment mode, it&rsquo;s possible to run OCM agent outside of the managed cluster on a hosing cluster. The hosting cluster could be a managed cluster of the same hub.</p><div style=text-align:center;padding:20px><img src=/multi-hubs-hosted1.png alt="multiple hubs in hosted mode" style="margin:0 auto;width:60%"></div><p>At most one agent can runs in the default mode on the managed cluster in this solution.</p><div style=text-align:center;padding:20px><img src=/multi-hubs-hosted2.png alt="multiple hubs in hosted mode" style="margin:0 auto;width:60%"></div><p>In order to reduce the number of the hosting clusters, agents running in the hosted mode can share the hosting clusters.</p><div style=text-align:center;padding:20px><img src=/multi-hubs-hosted3.png alt="multiple hubs in hosted mode" style="margin:0 auto;width:60%"></div><p>With this architecture, the managed cluster itself needs less resources because at most one agent runs on the managed cluster, while it needs at least one extra cluster as hosting cluster. Since each agent could run on different cluster (managed cluster or hosting cluster), it will not result in any problem if OCM hubs have different versions.</p><p>An example built with <a href=https://kind.sigs.k8s.io>kind</a> and <a href=https://github.com/open-cluster-management-io/clusteradm/releases>clusteradm</a> can be found in <a href=https://github.com/open-cluster-management-io/OCM/tree/main/solutions/multiple-hubs-hosted>Manage a cluster with multiple hubs in hosted mode</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-a248b9543af6136123ff241bf476fea3>4.7 - Migrate workload with placement</h1><p>The <code>Placement</code> API is used to dynamically select a set of <code>ManagedCluster</code> in
one or multiple <code>ManagedClusterSets</code> so that the workloads can be deployed to
these clusters.</p><p>If you define a valid <code>Placement</code>, the placement controller generates a
corresponding <code>PlacementDecision</code> with the selected clusters listed in the
status. As an end-user, you can parse the selected clusters and then operate on
the target clusters. You can also integrate a high-level workload orchestrator
with the <code>PlacementDecision</code> to leverage its scheduling capabilities.</p><p>For example, with OCM addon <a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/>policy</a>
installed, a <code>Policy</code> that includes a <code>Placement</code> mapping can distribute the
<code>Policy</code> to the managed clusters.
For details see this <a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/configuration-policy/#placement-api>example</a>.</p><p>Some popular open source projects also integrate with the <code>Placement</code> API. For
example <a href=https://github.com/argoproj/argo-cd>Argo CD</a>, it can leverage the
generated <code>PlacementDecision</code> to drive the assignment of Argo CD Applications to a
desired set of clusters, details see this <a href=https://github.com/argoproj/argo-cd/tree/master/applicationset/examples/clusterDecisionResource>example</a>.
And <a href=https://github.com/kubevela/kubevela>KubeVela</a>, as an implementation of
the open application model, also will take advantage of the <code>Placement</code> API for
workload scheduling.</p><p>In this article, we use <a href=https://github.com/open-cluster-management-io/ocm/tree/main/solutions/deploy-argocd-apps-pull>ArgoCD pull model</a>
as an example to demonstrate how, with the integration of OCM, you can migrate
ArgoCD Applications among clusters. This is useful for scenarios such as
application disaster recovery or application migration during cluster maintenance.</p><h2 id=prerequisites>Prerequisites</h2><p>Before starting with the following steps, we recommend that you familiarize yourself with the content below.</p><ul><li><p><a href=https://open-cluster-management.io/concepts/managedcluster/#taints-of-managedclusters>Taints of ManagedClusters</a>:
Taints are properties of <code>ManagedClusters</code>, they allow a <code>Placement</code> to repel
a set of <code>ManagedClusters</code>.</p></li><li><p><a href=https://open-cluster-management.io/concepts/placement/#taintstolerations>Tolerations of Placement</a>:
Tolerations are applied to <code>Placements</code>, and allow <code>Placements</code> to select
<code>ManagedClusters</code> with matching taints.</p></li><li><p><a href=https://github.com/open-cluster-management-io/ocm/tree/main/solutions/deploy-argocd-apps-pull>ArgoCD Pull Model Integration</a>:
The ArgoCD application controller uses the hub-spoke pattern or pull model mechanism
for decentralized resource delivery to remote clusters. By using Open Cluster Management (OCM) APIs
and components, the ArgoCD Applications will be pulled from the multi-cluster control plane
hub cluster down to the registered OCM managed clusters</p></li></ul><h2 id=setup-the-environment>Setup the environment</h2><p>Follow the <a href=https://github.com/open-cluster-management-io/ocm/blob/main/solutions/deploy-argocd-apps-pull/getting-started.md>deploy ArgoCD pull model steps</a>
to set up an environment with OCM and ArgoCD pull model installed.</p><p>If the above steps run successfully, on the hub cluster, you could see the application is deployed to both cluster1 and cluster2.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n argocd get app
</span></span><span style=display:flex><span>NAME                     SYNC STATUS   HEALTH STATUS
</span></span><span style=display:flex><span>cluster1-guestbook-app   Synced        Healthy
</span></span><span style=display:flex><span>cluster2-guestbook-app   Synced        Healthy
</span></span></code></pre></div><h2 id=migrate-application-to-another-cluster-automatically-when-one-cluster-is-down>Migrate application to another cluster automatically when one cluster is down</h2><ol><li><p>To demonstrate how an application can be migrated to another cluster, let&rsquo;s first deploy the application in a single cluster.</p><p>Patch the existing <code>Placement</code> to select only one cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl patch placement -n argocd guestbook-app-placement --patch <span style=color:#4e9a06>&#39;{&#34;spec&#34;: {&#34;numberOfClusters&#34;: 1}}&#39;</span> --type<span style=color:#ce5c00;font-weight:700>=</span>merge
</span></span><span style=display:flex><span>placement.cluster.open-cluster-management.io/guestbook-app-placement patched
</span></span></code></pre></div><p>Use <code>clusteradm</code> to check the placement of selected clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm get placements -otable
</span></span><span style=display:flex><span>NAME                      STATUS   REASON              SELETEDCLUSTERS
</span></span><span style=display:flex><span>guestbook-app-placement   False    Succeedconfigured   <span style=color:#ce5c00;font-weight:700>[</span>cluster1<span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div></li><li><p>Confirm the application is only deployed to cluster1.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n argocd get app
</span></span><span style=display:flex><span>NAME                     SYNC STATUS   HEALTH STATUS
</span></span><span style=display:flex><span>cluster1-guestbook-app   Synced        Healthy
</span></span></code></pre></div></li><li><p>Pause the cluster1 to simulate a cluster going down.</p><p>Use <code>docker ps -a</code> to get the cluster1 container ID.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ docker ps -a
</span></span><span style=display:flex><span>CONTAINER ID   IMAGE                  COMMAND                  CREATED       STATUS       PORTS                       NAMES
</span></span><span style=display:flex><span>499812ada5bd   kindest/node:v1.25.3   <span style=color:#4e9a06>&#34;/usr/local/bin/entr…&#34;</span>   <span style=color:#0000cf;font-weight:700>9</span> hours ago   Up <span style=color:#0000cf;font-weight:700>9</span> hours   127.0.0.1:37377-&gt;6443/tcp   cluster2-control-plane
</span></span><span style=display:flex><span>0b9d110e1a1f   kindest/node:v1.25.3   <span style=color:#4e9a06>&#34;/usr/local/bin/entr…&#34;</span>   <span style=color:#0000cf;font-weight:700>9</span> hours ago   Up <span style=color:#0000cf;font-weight:700>9</span> hours   127.0.0.1:34780-&gt;6443/tcp   cluster1-control-plane
</span></span><span style=display:flex><span>0a327d4a5b41   kindest/node:v1.25.3   <span style=color:#4e9a06>&#34;/usr/local/bin/entr…&#34;</span>   <span style=color:#0000cf;font-weight:700>9</span> hours ago   Up <span style=color:#0000cf;font-weight:700>9</span> hours   127.0.0.1:44864-&gt;6443/tcp   hub-control-plane
</span></span></code></pre></div><p>Use <code>docker pause</code> to pause the cluster1.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ docker pause 0b9d110e1a1f
</span></span><span style=display:flex><span>0b9d110e1a1f
</span></span></code></pre></div></li><li><p>Wait for a few minutes, check the <code>ManagedCluster</code> status, cluster1 available status should become &ldquo;Unknown&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get managedcluster
</span></span><span style=display:flex><span>NAME       HUB ACCEPTED   MANAGED CLUSTER URLS                  JOINED   AVAILABLE   AGE
</span></span><span style=display:flex><span>cluster1   <span style=color:#204a87>true</span>           https://cluster1-control-plane:6443   True     Unknown     9h
</span></span><span style=display:flex><span>cluster2   <span style=color:#204a87>true</span>           https://cluster2-control-plane:6443   True     True        9h
</span></span></code></pre></div><p>Use <code>clusteradm</code> to check the placement of selected clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm get placements -otable
</span></span><span style=display:flex><span>NAME                      STATUS   REASON              SELETEDCLUSTERS
</span></span><span style=display:flex><span>guestbook-app-placement   False    Succeedconfigured   <span style=color:#ce5c00;font-weight:700>[</span>cluster2<span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div></li><li><p>Confirm the application is now deployed to cluster2.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n argocd get app
</span></span><span style=display:flex><span>NAME                     SYNC STATUS   HEALTH STATUS
</span></span><span style=display:flex><span>cluster2-guestbook-app   Synced        Healthy
</span></span></code></pre></div></li></ol><h2 id=what-happens-behind-the-scene>What happens behind the scene</h2><p>Refer to <a href=https://open-cluster-management.io/concepts/managedcluster/#taints-of-managedclusters>Taints of ManagedClusters</a>,
when pausing cluster1, the status of condition <code>ManagedClusterConditionAvailable</code>
becomes <code>Unknown</code>. The taint <code>cluster.open-cluster-management.io/unreachable</code> is automatically
added to cluster1, with the effect NoSelect and an empty value.</p><pre><code>```shell
$ kubectl get managedcluster cluster1 -oyaml
apiVersion: cluster.open-cluster-management.io/v1
kind: ManagedCluster
metadata:
  name: cluster1
  labels:
    cluster.open-cluster-management.io/clusterset: default
spec:
...
  taints:
  - effect: NoSelect
    key: cluster.open-cluster-management.io/unreachable
    timeAdded: &quot;2023-11-13T16:26:16Z&quot;
status:
...
```
</code></pre><p>Since the <code>Placement</code> guestbook-app-placement doesn&rsquo;t define any toleration to match the taint,
cluster1 will be filtered from the decision. In the demo environment, once cluster1 is down,
placement will select one cluster from the rest clusters, which is cluster2.</p><p><a href=https://open-cluster-management.io/concepts/managedcluster/#taints-of-managedclusters>Taints of ManagedClusters</a>
also describes other scenarios where taints are automatically added. In some scenarios you may not want to
migrate the application immediately when a taint is added, with placement <code>TolerationSeconds</code> defined, it could tolerates the taint
for a period of time before repelling it. In above example, the <code>TolerationSeconds</code> could be defined as below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>guestbook-app-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>argocd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>tolerations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/unreachable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exists</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>tolerationSeconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>300</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><code>tolerationSeconds</code> is 300 means that the application will be migrated to cluster2 after 5 minutes when cluster1 is down.</p><h2 id=migrate-application-to-another-cluster-manually-for-cluster-maintenance>Migrate application to another cluster manually for cluster maintenance</h2><p>The above example shows how a taint is automatically added to a cluster and how the application is migrated to another cluster.
You can also choose to add a taint manually and repel the application to other clusters.</p><p>In the following example, suppose you are going to maintain cluster2, and want to repel the application to cluster1.</p><ol><li><p>Before starting, let&rsquo;s first restart the paused cluster1.</p><p>Use <code>docker restart</code> to restart the cluster1.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ docker restart 0b9d110e1a1f
</span></span><span style=display:flex><span>0b9d110e1a1f
</span></span></code></pre></div><p>Wait for a few minutes, check the <code>ManagedCluster</code> status, cluster1 available status should become &ldquo;True&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get managedcluster
</span></span><span style=display:flex><span>NAME       HUB ACCEPTED   MANAGED CLUSTER URLS                  JOINED   AVAILABLE   AGE
</span></span><span style=display:flex><span>cluster1   <span style=color:#204a87>true</span>           https://cluster1-control-plane:6443   True     True        9h
</span></span><span style=display:flex><span>cluster2   <span style=color:#204a87>true</span>           https://cluster2-control-plane:6443   True     True        9h
</span></span></code></pre></div></li><li><p>Add the taint <code>maintenance</code> to cluster2 manually.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl patch managedcluster cluster2 -p <span style=color:#4e9a06>&#39;{&#34;spec&#34;:{&#34;taints&#34;:[{&#34;effect&#34;:&#34;NoSelect&#34;,&#34;key&#34;:&#34;maintenance&#34;}]}}&#39;</span> --type<span style=color:#ce5c00;font-weight:700>=</span>merge
</span></span><span style=display:flex><span>managedcluster.cluster.open-cluster-management.io/cluster2 patched
</span></span></code></pre></div></li><li><p>Use <code>clusteradm</code> to check the placement selected clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm get placements -otable
</span></span><span style=display:flex><span>NAME                      STATUS   REASON              SELETEDCLUSTERS
</span></span><span style=display:flex><span>guestbook-app-placement   False    Succeedconfigured   <span style=color:#ce5c00;font-weight:700>[</span>cluster1<span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div></li><li><p>Confirm the application is now deployed to cluster1.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n argocd get app
</span></span><span style=display:flex><span>NAME                     SYNC STATUS   HEALTH STATUS
</span></span><span style=display:flex><span>cluster1-guestbook-app   Synced        Healthy
</span></span></code></pre></div></li></ol><h2 id=summary>Summary</h2><p>In this article, we use the ArgoCD pull model in OCM as an example, showing you how to migrate the ArgoCD applications automatically or manually when the cluster is down or during the cluster maintenance time.</p><p>The concept of <a href=https://open-cluster-management.io/concepts/managedcluster/#taints-of-managedclusters>Taints</a> and <a href=https://open-cluster-management.io/concepts/placement/#taintstolerations>Tolerations</a> can be used for any components that consume OCM <code>Placement</code>, such as <a href=https://open-cluster-management.io/concepts/addon/>add-ons</a> and <a href=https://open-cluster-management.io/concepts/manifestworkreplicaset/>ManifestworkReplicaSet</a>. If you have any questions, feel free to raise them in our <a href=https://kubernetes.slack.com/channels/open-cluster-mgmt>slack channel</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7ca5dd580066fc69d90bf611a2fff868>4.8 - Pushing Kubernetes API requests to the managed clusters</h1><p>By following the instructions in this document, an OCM hub admin will be able
to &ldquo;push&rdquo; Kubernetes API requests to the managed clusters. The benefit of using
this method for &ldquo;pushing&rdquo; requests in OCM is that we don&rsquo;t need to explicitly
configure any API endpoint for the managed clusters or provide any client
credentials as preparation. We just need to enable/install the following OCM
addons:</p><ul><li><a href=https://github.com/open-cluster-management-io/cluster-proxy>Cluster-Proxy</a>:
Setting up the <a href=https://kubernetes.io/docs/tasks/extend-kubernetes/setup-konnectivity/>konnectivity</a>
tunnels between the hub cluster and the managed clusters so the hub cluster
can connect/access the managed cluster from anywhere.</li><li><a href=https://github.com/open-cluster-management-io/managed-serviceaccount>Managed-ServiceAccount</a>:
Automating the lifecycle of the local service account in the managed clusters
and projecting the tokens back to the hub cluster so that the Kubernetes API
clients from the hub can make authenticated requests.</li><li><a href=https://github.com/oam-dev/cluster-gateway>Cluster-Gateway</a>: An aggregated
apiserver providing a &ldquo;proxy&rdquo; subresource which helps the hub admin to
gracefully access the managed clusters by standard Kubernetes API calls
(including long-running calls).</li></ul><h2 id=prerequisite>Prerequisite</h2><p>You must meet the following prerequisites to install the managed service
account:</p><ul><li>Ensure your <code>open-cluster-management</code> release is greater than <code>v0.5.0</code>.</li><li>Ensure <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl><code>kubectl</code></a> is installed.</li><li>Ensure <a href=https://helm.sh/docs/intro/install/><code>helm</code></a> is installed.</li></ul><h2 id=installation>Installation</h2><h3 id=adding-helm-chart-repo>Adding helm chart repo</h3><p>Making sure the following OCM addons are discovered by your helm environment:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ helm repo add ocm https://open-cluster-management.io/helm-charts
</span></span><span style=display:flex><span>$ helm repo update
</span></span><span style=display:flex><span>$ helm search repo ocm
</span></span><span style=display:flex><span>NAME                             	CHART VERSION	APP VERSION	DESCRIPTION                                   
</span></span><span style=display:flex><span>ocm/cluster-gateway-addon-manager	1.3.2       	1.0.0      	A Helm chart <span style=color:#204a87;font-weight:700>for</span> Cluster-Gateway Addon-Manager
</span></span><span style=display:flex><span>ocm/cluster-proxy                	0.2.0        	1.0.0      	A Helm chart <span style=color:#204a87;font-weight:700>for</span> Cluster-Proxy OCM Addon      
</span></span><span style=display:flex><span>ocm/managed-serviceaccount       	0.2.0        	1.0.0      	A Helm chart <span style=color:#204a87;font-weight:700>for</span> Managed ServiceAccount Addon 
</span></span></code></pre></div><h3 id=install-the-ocm-addons>Install the OCM addons</h3><p>By the following helm commands to install the addons:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ helm -n open-cluster-management-addon install cluster-proxy ocm/cluster-proxy
</span></span><span style=display:flex><span>$ helm -n open-cluster-management-addon install managed-serviceaccount ocm/managed-serviceaccount
</span></span><span style=display:flex><span>$ helm -n open-cluster-management-addon install cluster-gateway ocm/cluster-gateway-addon-manager  <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    <span style=color:#8f5902;font-style:italic># Delegating for secret discovery to &#34;managed-serviceaccount&#34; addon.                           \</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># Skip the option for manual secret management.                                                \</span>
</span></span><span style=display:flex><span>    --set <span style=color:#000>manualSecretManagement</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>                                                             <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    <span style=color:#8f5902;font-style:italic># Enabling konnectivity tunnels via &#34;cluster-proxy&#34; addon.                                     \</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># Skip the option if the hub cluster and the managed clusters are already mutually accessible. \</span>
</span></span><span style=display:flex><span>    --set <span style=color:#000>konnectivityEgress</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span></code></pre></div><h3 id=confirm-addon-installation>Confirm addon installation</h3><p>The commands above installs the addon manager into the hub cluster, and the
manager will creating <code>ManagedClusterAddOn</code> automatically into the cluster
namespaces representing the addon is plumbed into the managed cluster. In order
to check their status, run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get managedclusteraddon -A
</span></span><span style=display:flex><span>NAMESPACE   NAME                     AVAILABLE   DEGRADED   PROGRESSING
</span></span><span style=display:flex><span>managed1    cluster-gateway          True
</span></span><span style=display:flex><span>managed1    cluster-proxy            True                   
</span></span><span style=display:flex><span>managed1    managed-serviceaccount   True 
</span></span></code></pre></div><p>Furthermore, after the addons are all deployed successfully, the hub admin will
be able to see a new resource named <code>ClusterGateway</code> registered into the hub
cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get clustergateway
</span></span><span style=display:flex><span>NAME       PROVIDER   CREDENTIAL-TYPE       ENDPOINT-TYPE
</span></span><span style=display:flex><span>managed1              ServiceAccountToken   ClusterProxy
</span></span></code></pre></div><h2 id=usage>Usage</h2><p>Now the gateway is ready for proxying your requests to the managed clusters
dynamically. The easiest way to verify if the proxying framework is working
is to run the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ <span style=color:#204a87>export</span> <span style=color:#000>CLUSTER_NAME</span><span style=color:#ce5c00;font-weight:700>=</span>managed1 <span style=color:#8f5902;font-style:italic># Or any other valid managed cluster name</span>
</span></span><span style=display:flex><span>$ kubectl get --raw<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/apis/cluster.core.oam.dev/v1alpha1/clustergateways/</span><span style=color:#4e9a06>${</span><span style=color:#000>CLUSTER_NAME</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>/proxy/healthz&#34;</span>
</span></span><span style=display:flex><span>ok
</span></span></code></pre></div><p>Another nice feature is that you can also easily convert the kubeconfig of the
hub cluster into a managed cluster&rsquo;s kubeconfig by adding the api suffix to the
cluster endpoint in your kubeconfig:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>$ # Copy and edit your original hub kubeconfig into e.g. managed1.kubeconfig
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>clusters:
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#a40000>---    server: https://x.x.x.x
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#00a000>+++    server: https://x.x.x.x/apis/cluster.core.oam.dev/v1alpha1/clustergateways/${CLUSTER_NAME}/proxy
</span></span></span></code></pre></div><p>Then we can access the managed cluster directly via kubectl with the tweaked
kubeconfig:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>managed1.kubeconfig kubectl get ns
</span></span></code></pre></div><p>However upon your first-time installation, you may encounter the RBAC
restriction message such as:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Error from server (Forbidden): namespaces is forbidden: User &#34;system:serviceaccount:open-cluster-management-managed-serviceaccount:cluster-gateway&#34; cannot list resource &#34;namespaces&#34; in API group &#34;&#34; at the cluster scope
</span></span></code></pre></div><p>That is because we haven&rsquo;t set up proper RBAC permissions for the <code>egress</code>
service account managed by the <code>ManagedServiceAccount</code> yet. After granting
sufficient permissions for the service account in the managed clusters, you
will be able to freely operate the managed cluster from the hub without asking
for any credential or kubeconfig from the managed clusters. Note that the
service account is also periodically rotated by the addons so there&rsquo;s no need
to worry in sustainable credential management.</p><h2 id=insight>Insight</h2><p>Overall, the following picture of architecture reveals the internal technique
of the request &ldquo;pushing&rdquo; framework in the OCM:</p><div style=text-align:center;padding:20px><img src=/proxy-framework.png alt="Cluster proxy architecture" style="margin:0 auto;width:90%"></div><p>With the help of the framework, we can easily develop a web service or an
operator that runs in the hub cluster and is able to access to the managed
clusters through the gateway. Note that it&rsquo;s generally not recommended to
list-watch the managed clusters from the hub because it&rsquo;s in a sense violating
the original philosophy of &ldquo;pull&rdquo; or &ldquo;hub-agent&rdquo; architecture of OCM. In
order to coordinate the hub cluster and the managed clusters in your custom
system, consider build your own OCM addon based on the <a href=https://github.com/open-cluster-management-io/addon-framework>addon-framework</a>
which provides you utilities for further customization.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8272cdbbbcfeb7d32da1f7122d8d74fa>4.9 - Register a cluster to hub through proxy server</h1><p>When registering a cluster to an Open Cluster Management (OCM) hub, there is a network requirement for the managed cluster. It must be able to reach the hub cluster. Sometimes the managed cluster cannot directly connect to the hub cluster. For example, the hub cluster is in a public cloud, and the managed cluster is in a private cloud environment behind firewalls. The communications out of the private cloud can only go through a HTTP or HTTPS proxy server.</p><p>In this scenario, you need to configure the proxy settings to allow the communications from the managed cluster to access the hub cluster through a forward proxy server.</p><h3 id=klusterlet-proxy-settings>Klusterlet proxy settings</h3><p>During the cluster registration, a bootstrap kubeconfig is required by the Klusterlet agent running on the managed cluster to connect to the hub cluster. When the agent accesses the hub cluster through a proxy server, the URL of the proxy server should be specified in <code>cluster.proxy-url</code> of the bootstrap kubeconfig. If a HTTPS proxy server is used, the proxy CA certificate should be appended to <code>cluster.certificate-authority-data</code> of the bootstrap kubeconfig as well.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>clusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>certificate-authority-data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LS0tLS...LS0tCg==</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>server</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>https://api.server-foundation-sno-x4lcs.dev04.red-chesterfield.com:6443</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>proxy-url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>https://10.0.109.153:3129</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default-cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>contexts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>context</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default-cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default-auth</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default-context</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>current-context</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default-context</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>preferences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default-auth</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>token</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>eyJh...8PwGo</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Since the communication between the managed cluster and the hub cluster leverages mTLS, the SSL connection should not be terminated on the proxy server. So the proxy server needs to support HTTP tunneling (for example, HTTP CONNECT method), which will establish a tunnel between the managed cluster and the hub cluster and forward the traffic from the managed cluster through this tunnel.</p><p>Once the Klusterlet agent finishes the cluster registration, a secret <code>hub-kubeconfig-secret</code> is generated with a new kubeconfig. It has the similar proxy settings and the appropriate permissions. The Klusterlet agent then uses this kubeconfig to access the hub cluster.</p><div style=text-align:center;padding:20px><img src=/klusterlet-proxy.png alt="multiple hubs" style="margin:0 auto;width:75%"></div><p>You can find an example built with <a href=https://kind.sigs.k8s.io>kind</a> and <a href=https://github.com/open-cluster-management-io/clusteradm/releases>clusteradm</a> in <a href=https://github.com/open-cluster-management-io/OCM/tree/main/solutions/join-through-proxy>Join hub through a forward proxy server</a>.</p><h3 id=add-on-proxy-settings>Add-on proxy settings</h3><p>Typically the add-on agent running on the managed cluster also needs a kubeconfig to access the resources of the kube-apiserver on the hub cluster. The Klusterlet agent will generate this kubeconfig during the add-on registration. If the Klusterlet agent bootstraps with a proxy settings, the same settings will be put into the add-on kubeconfig as well. While agents of some add-ons may access services other than kube-apiserver on the hub cluster. For those add-ons, you may need to add additional configuration with proxy settings by creating a <code>AddOnDeploymentConfig</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnDeploymentConfig</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-proxy-settings</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>proxyConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>httpProxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;http://10.0.109.153:3128&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>httpsProxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;https://10.0.109.153:3129&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>noProxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;.cluster.local,.svc,10.96.0.1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>caBundle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LS0tLS...LS0tCg==</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The IP address of the <code>kube-apiserver</code> on the managed cluster should be included in the field <code>noProxy</code>. To get the IP address, run following command on the managed cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n default describe svc kubernetes <span style=color:#000;font-weight:700>|</span> grep IP:
</span></span></code></pre></div><p>You also need to associate the configuration to the <code>ManagedClusterAddOn</code> by adding an item to <code>spec.configs</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installNamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-proxy-settings</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>With the above configuration, the add-on manager of this add-on running on the hub cluster can fetch the proxy settings and then propagate it to the managed cluster side, for example as environment variables by using <code>ManifestWork</code> API. And then the add-on agent can initiate the communication to a particular service on the hub cluster with the proxy settings.</p><div style=text-align:center;padding:20px><img src=/addon-proxy.png alt="multiple hubs" style="margin:0 auto;width:75%"></div><p>Once both the klusterlet agent and the add-on agents are able to communicate with the hub cluster through the forward proxy server, workloads, like applications, can be scheduled to the managed cluster.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-99a93ef9534d11fef4be3e4b3b1a6381>5 - Contribute</h1><p>We know you&rsquo;ve got great ideas for improving Open Cluster Management. So roll up your sleeves and come join us in the community!</p><h2 id=getting-started>Getting Started</h2><p>All contributions are welcome! Open Cluster Management uses the <a href=https://www.apache.org/licenses/LICENSE-2.0>Apache 2 license</a>. Please open issues for any bugs or problems you encounter, ask questions in the <a href=https://kubernetes.slack.com/channels/open-cluster-mgmt>#open-cluster-mgmt</a> on Kubernetes Slack Channel, or get involved joining the open-cluster-management <a href=https://groups.google.com/g/open-cluster-management>mailing group</a>.</p><h2 id=contribute-to-the-source>Contribute to the Source</h2><ul><li>Join the <a href=https://groups.google.com/g/open-cluster-management>Mailing group</a></li><li>Attend an upcoming <a href=https://github.com/open-cluster-management-io/community/projects/1>Community meetings</a></li><li>Fork the <a href=https://github.com/open-cluster-management-io>repository</a> you wish to work on. For example, <a href=https://github.com/open-cluster-management-io/api>API</a>,<a href=https://github.com/open-cluster-management-io/ocm>ocm</a>, etc.</li><li>Get started by following the <code>CONTRIBUTING.md</code> guide in the repository you wish to work on</li></ul><h2 id=get-involved--file-a-bug>Get Involved / File a Bug</h2><p>Check out the project and consider contributing. You can pick up an issue to work on, or report a bug by creating a new issue <a href=https://github.com/open-cluster-management-io/ocm/issues>here</a>. When your code is ready to be reviewed, you can propose a pull request. You can find a good guide about the GitHub workflow <a href=https://git-scm.com/book/en/v2/GitHub-Contributing-to-a-Project>here</a>.</p><p>If you intend to propose an enhancement or a new feature in open-cluster-management, submit a pull request in the <a href=https://github.com/open-cluster-management-io/enhancements>enhancements repo</a>. The proposal should follow the <a href=https://github.com/open-cluster-management-io/enhancements/blob/main/guidelines/README.md>kep format</a>.</p><h2 id=certificate-of-origin>Certificate of Origin</h2><p>By contributing to this project, you agree to the Developer Certificate of
Origin (DCO). This document was created by the Linux Kernel community and is a
simple statement that you, as a contributor, have the legal right to make the
contribution. See the <a href=https://github.com/open-cluster-management-io/community/blob/main/DCO>DCO</a> file for details.</p><h2 id=talk-to-us>Talk to Us</h2><ul><li>Follow the <a href=https://groups.google.com/g/open-cluster-management>Mailing group</a></li><li>Chat with us in the <a href=https://kubernetes.slack.com/channels/open-cluster-mgmt>#open-cluster-mgmt</a> on Kubernetes Slack Channel</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-584d4c2f4c3fdde3fc9cbf0f0c15cfcf>6 - Releases</h1><p>Open Cluster Management has approximately a three to four month release cycle. The current release is <code>v0.15.0</code>.
Continue reading to view upcoming releases:</p><h2 id=0160-16-march-2025><code>0.16.0</code>, 16 March 2025</h2><p>The Open Cluster Management team is exicted to announce the release of OCM v0.16.0 with many new
features:</p><p>Breaking Changes:</p><ul><li>Addon is defaulted to be managed by addon-manager: this is the part of addon evolution work starting
from release 0.14.0, and the self-managed installation of addons is disabled in <code>v0.16.0</code>. Each addon
will need to upgrade the addon-framework to a version equal or higher than <code>v0.8.2</code></li><li>(Policy framework) The compliance history API has been removed due to lack of interest.</li><li>(Policy framework) Kubernetes v1.16 is no longer supported with the removal of the <code>v1beta1</code>
CustomResourceDefinition manifests.</li></ul><p>Notable features:</p><ul><li>Register cluster to EKS hub: user can now use an EKS cluster as a hub cluster and register other
EKS clusters with it, utilizing <a href=https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html>EKS IRSA</a>
and <a href=https://docs.aws.amazon.com/eks/latest/userguide/access-entries.html>EKS Access Entries</a> features in AWS,
see this <a href=https://github.com/open-cluster-management-io/ocm/tree/main/solutions/joining-hub-and-spoke-with-aws-auth>doc</a>
on how to enable and use this feature.</li><li>Auto register CAPI cluster: user can install the CAPI management plane on the OCM hub, and enable
the <code>ClusterImporter</code> feature gate on the <code>ClusterManager</code>. The CAPI cluster after successfully provisioned
will be automatically registered into the OCM hub.</li><li>Ignore fields update in <code>ManifestWorks</code>: when user uses the <code>ServerSideApply</code> strategy in Manifestwork, user
can now specify certain fields to be ignored during resource update/override, to avoid apply conflict error.</li><li>Support wildcard of ManifestConfigs in <code>ManifestWorks</code>: the <code>ResourceIdentifier</code> field in <code>ManifestWorks</code> can
now recognize <code>*</code> as the wildcard marker, so if there are multiple resources need to use the same <code>ManifestConfigs</code>,
user can now set one <code>ManifestConfig</code> with a wildcard <code>ResourceIdentifier</code></li><li>(Policy framework) <code>OperatorPolicy</code>: Enhanced operator handling, including approving dependent packages and raising
operator deprecation.</li><li>(Policy framework) <code>ConfigurationPolicy</code>: An <code>objectSelector</code> is added, allowing users to iterate over objects by
label without needing <code>object-templates-raw</code>. For further filtering, users can invoke the <code>{{ skipObject }}</code> Go
template function to conditionally skip a particular object template.</li><li>(Policy framework) <code>ConfigurationPolicy</code>: The <code>ObjectName</code> and <code>ObjectNamespace</code> Go template variables are added.
The <code>ObjectNamespace</code> inherits its value from the <code>namespaceSelector</code> while the <code>ObjectName</code> inherits its value
from the new <code>objectSelector</code>.</li><li>(Policy framework) The new <code>governance-standalone-hub-templating</code> addon enables hub Go templates
(i.e. <code>{{hub ... hub}}</code>) for &ldquo;standalone&rdquo; policies. This new addon is a further enablement for users to deploy
policies using GitOps pointed directly at managed clusters rather that propagating policies through the hub.</li></ul><h3 id=core-components>Core components</h3><ul><li>ocm v0.16.0 <a href=https://github.com/open-cluster-management-io/ocm/releases/tag/v0.16.0>changelog</a></li><li>addon-framework v0.12.0 <a href=https://github.com/open-cluster-management-io/addon-framework/releases/tag/v0.12.0>changelog</a></li><li>clusteradm v0.11.0 <a href=https://github.com/open-cluster-management-io/clusteradm/releases/tag/v0.11.0>changelog</a></li></ul><h3 id=addons>Addons</h3><ul><li>config-policy-controller v0.16.0 <a href=https://github.com/open-cluster-management-io/config-policy-controller/releases/tag/v0.16.0>changelog</a></li><li>governance-policy-framework-addon v0.16.0 <a href=https://github.com/open-cluster-management-io/governance-policy-framework-addon/releases/tag/v0.16.0>changelog</a></li><li>governance-policy-propagator v0.16.0 <a href=https://github.com/open-cluster-management-io/governance-policy-propagator/releases/tag/v0.16.0>changelog</a></li><li>governance-policy-addon-controller v0.16.0 <a href=https://github.com/open-cluster-management-io/governance-policy-addon-controller/releases/tag/v0.16.0>changelog</a></li><li>multicloud-operators-subscription v0.16.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-subscription/releases/tag/v0.16.0>changelog</a></li><li>multicloud-operators-channel v0.16.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-channel/releases/tag/v0.16.0>changelog</a></li><li>managed-serviceaccount v0.8.0 <a href=https://github.com/open-cluster-management-io/managed-serviceaccount/releases/tag/v0.8.0>changelog</a></li><li>cluster-proxy v0.7.0 <a href=https://github.com/open-cluster-management-io/cluster-proxy/releases/tag/v0.7.0>changelog</a></li></ul><h2 id=0150-24-oct-2024><code>0.15.0</code>, 24 Oct. 2024</h2><p>The Open Cluster Management team is proud to announce the release of OCM v0.15.0!</p><ul><li>Cluster Manager and Klusterlet helm chart: user can now install cluster manager and klusterlet using helm by
adding the <code>https://open-cluster-management.io/helm-charts</code> into the helm repo.</li><li>Multiple hubs: by enabling the <code>MultipleHubs</code> feature gate on the klusterlet, the klusterlet can switch
the connection among multiple hubs if the hub server is down, or when user explictly sets <code>hubAcceptClient</code> to <code>false</code>
on the <code>ManagedCluster</code>. See <a href=https://github.com/open-cluster-management-io/ocm/tree/main/solutions/multiplehubs>solution</a>
on how to use this feature to handle disaster recovery.</li><li>Addon support multiple configurations with the same kind: user can now set multiple configurations
with the same kind on the <code>ManagedClusterAddon</code> and <code>ClusterManagementAddon</code>. Which specific configuration
is used by the addon is decided by the addon.</li><li>Add configured condition in <code>ManagedClusterAddon</code>: the addon-manager will set condition with the type of <code>Configured</code>
on the <code>ManagedClusterAddon</code> when the configuration of the addon is determined by the addon-manager. This is to avoid
an out of date configuration being picked to deploy the addon agent.</li><li>Sync between ManagedCluster and cluster inventory API: We introduce the cluster inventory API
from sig-multicluster and sync between ManagedCluster and ClusterProfile API. See
<a href=https://github.com/kubernetes-sigs/cluster-inventory-api>here</a> for more details on cluster inventory API.</li><li>(Policy framework) Event-driven <code>ConfigurationPolicy</code> evaluations: By default, <code>ConfigurationPolicy</code> reconciles are
now event-driven, lowering resource consumption and increasing efficiency. Users can set a policy to reconcile on an
interval as they were previously by configuring <code>spec.evaluationInterval</code>.</li><li>(Policy framework) Custom <code>ConfigurationPolicy</code> compliance messages: Policy authors can now define Go templates to be
used for compliance messages, including <code>.DefaultMessage</code> and <code>.Policy</code> fields available for parsing relevant information.</li><li>(Policy framework) <code>dryrun</code> CLI: A <code>dryrun</code> CLI is available to reconcile <code>ConfigurationPolicy</code> locally, allowing you
to view the compliance and diff resulting from a <code>ConfigurationPolicy</code> without deploying it to a cluster:<pre tabindex=0><code>go install open-cluster-management.io/config-policy-controller/cmd/dryrun@latest
</code></pre></li><li>(Policy framework) Customizable hub cluster template access: Users can now set <code>spec.hubTemplateOptions.serviceAccountName</code>
to leverage a service account in the root policy namespace to resolve hub templates. Without the service account, hub
templates are only able to access objects in the same namespace as the policy.</li></ul><h3 id=core-components-1>Core components</h3><ul><li>ocm v0.15.0 <a href=https://github.com/open-cluster-management-io/ocm/releases/tag/v0.15.0>changelog</a></li><li>addon-framework v0.11.0 <a href=https://github.com/open-cluster-management-io/addon-framework/releases/tag/v0.11.0>changelog</a></li><li>clusteradm v0.10.0 <a href=https://github.com/open-cluster-management-io/clusteradm/releases/tag/v0.10.0>changelog</a></li></ul><h3 id=addons-1>Addons</h3><ul><li>config-policy-controller v0.15.0 <a href=https://github.com/open-cluster-management-io/config-policy-controller/releases/tag/v0.15.0>changelog</a></li><li>governance-policy-framework-addon v0.15.0 <a href=https://github.com/open-cluster-management-io/governance-policy-framework-addon/releases/tag/v0.15.0>changelog</a></li><li>governance-policy-propagator v0.15.0 <a href=https://github.com/open-cluster-management-io/governance-policy-propagator/releases/tag/v0.15.0>changelog</a></li><li>governance-policy-addon-controller v0.15.0 <a href=https://github.com/open-cluster-management-io/governance-policy-addon-controller/releases/tag/v0.15.0>changelog</a></li><li>multicloud-operators-subscription v0.15.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-subscription/releases/tag/v0.15.0>changelog</a></li><li>multicloud-operators-channel v0.15.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-channel/releases/tag/v0.15.0>changelog</a></li><li>managed-serviceaccount v0.7.0 <a href=https://github.com/open-cluster-management-io/managed-serviceaccount/releases/tag/v0.7.0>changelog</a></li><li>cluster-proxy v0.6.0 <a href=https://github.com/open-cluster-management-io/cluster-proxy/releases/tag/v0.6.0>changelog</a></li></ul><h2 id=0140-21-jun-2024><code>0.14.0</code>, 21 Jun. 2024</h2><p>The Open Cluster Management team is proud to announce the release of OCM v0.14.0!</p><ul><li>Exclude terminating clusters from PlacementDecision: now cluster in terminating state will not be picked by the
placement.</li><li>Send available condition events for managed cluster: klusterlet agent will send a Kubenerte event to the cluster
namespace upon status change, which makes it eaiser for user to check the state change of the managed cluster.</li><li>Set install namespace of AddonTemplate from AddonDeploymentConfig: consumers of AddonTemplate API can now use
AddonDeploymentConfig API to set the installation namespace of the agent.</li><li>Configurable controller replicas and master node selector: user can now set flags <code>--deployment-replicas</code> and
<code>--control-plane-node-label-selector</code> on klusterlet-operator to customize the replicas of the klusterlet agent.</li><li>Add CAPI into join flow: user can now use the join command to add a Cluster API provisioned cluster into OCM hub
from Cluster API management cluster with <code>--capi-import</code> and <code>--capi-cluster-name</code> flag.</li><li>(Policy Framework) <code>OperatorPolicy</code> enhancement and stabilization: OperatorPolicy can now be set to <code>mustnothave</code>
to perform cleanup, alongside stabilization improvements.</li><li>(Policy Framework) Add <code>ConfigurationPolicy</code> diff to the status: Adds a <code>recordDiff: InStatus</code> as the default value
if it&rsquo;s not set. In this mode, the difference between the policy and the object on the managed is returned in the
status. Sensitive data types are not displayed unless <code>InStatus</code> is explicitly provided.</li><li>(Policy Framework) Add <code>recreateOption</code> to <code>ConfigurationPolicy</code>: When a user needs to update an object with
immutable fields, the object must be replaced. In this case, <code>recreateOption</code> can be set to either <code>ifRequired</code> or
<code>Always</code> depending on the requirements.</li></ul><h3 id=core-components-2>Core components</h3><ul><li>ocm v0.14.0 <a href=https://github.com/open-cluster-management-io/ocm/releases/tag/v0.14.0>changelog</a></li><li>addon-framework v0.10.0 <a href=https://github.com/open-cluster-management-io/addon-framework/releases/tag/v0.10.0>changelog</a></li><li>clusteradm v0.9.0 <a href=https://github.com/open-cluster-management-io/clusteradm/releases/tag/v0.9.0>changelog</a></li></ul><h3 id=addons-2>Addons</h3><ul><li>config-policy-controller v0.14.0 <a href=https://github.com/open-cluster-management-io/config-policy-controller/releases/tag/v0.14.0>changelog</a></li><li>governance-policy-framework-addon v0.14.0 <a href=https://github.com/open-cluster-management-io/governance-policy-framework-addon/releases/tag/v0.14.0>changelog</a></li><li>governance-policy-propagator v0.14.0 <a href=https://github.com/open-cluster-management-io/governance-policy-propagator/releases/tag/v0.14.0>changelog</a></li><li>governance-policy-addon-controller v0.14.0 <a href=https://github.com/open-cluster-management-io/governance-policy-addon-controller/releases/tag/v0.14.0>changelog</a></li><li>multicloud-operators-subscription v0.14.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-subscription/releases/tag/v0.14.0>changelog</a></li><li>multicloud-operators-channel v0.14.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-channel/releases/tag/v0.14.0>changelog</a></li><li>managed-serviceaccount v0.6.0 <a href=https://github.com/open-cluster-management-io/managed-serviceaccount/releases/tag/v0.6.0>changelog</a></li><li>cluster-proxy v0.5.0 <a href=https://github.com/open-cluster-management-io/cluster-proxy/releases/tag/v0.5.0>changelog</a></li></ul><h2 id=0130-6-mar-2024><code>0.13.0</code>, 6 Mar. 2024</h2><p>The Open Cluster Management team is proud to announce the release of OCM v0.13.0! There are a bunch of new features
added into this release.</p><ul><li>Rollout API: we built a common rollout API that has been adopted in <code>ClusterManagementAddon</code> and <code>ManifestWorkReplicaSet</code>,
and will be also used in the policy addon in a future release. The API provides users a way to define a workload/addon rolling upgrade strategy
across multiple clusters. See <a href=https://open-cluster-management.io/concepts/addon/#add-on-rollout-strategy>here</a> for more
details.</li><li>More install configurations in Klusterlet: we enhanced the <code>Klusterlet</code> API by adding more configuration fields, including
resource requests, QPS/Burst and priority class.</li><li>Cloudevent support: an experimental feature to wire the work agent with a message broker using the cloudevent protocol. This enables
a work agent running in a highly scalable mode. See <a href=https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/224-event-based-manifestwork>here</a>
for more details.</li><li>Addon-framework is upgraded to v0.9.0 to better support the generic addon-manager and addon rolling out strategy. It is highly
recommended for addons to upgrade the addon-framework dependency to version v0.8.1 or higher. Also, it should be noted that
an RBAC update of the addon hub controller (adding PATCH verbs for resource <code>clustermanagementaddons</code>) is required during
the upgrade.</li><li>Application add-on <code>Subscription</code> API can now aggregate and report managed clusters&rsquo; kustomization errors.</li><li>New OperatorPolicy to handle OLM operators: A new OperatorPolicy is added, managed by the <code>config-policy-controller</code> Pod,
aimed at easing the management of OLM deployments.</li><li>(Policy framework) Add diff logging to <code>ConfigurationPolicy</code>: A <code>recordDiff</code> parameter is added to <code>ConfigurationPolicy</code>
to enable the diff between the object on the cluster and the policy definition, to be logged in the <code>config-policy-controller</code> Pod logs.</li><li>(Policy framework) New <code>OperatorPolicy</code> to handle OLM operators: A new OperatorPolicy is added, managed by the
<code>config-policy-controller</code> Pod, aimed at easing the management of OLM deployments.</li><li>(Policy framework) New Compliance History API: A Compliance History API is added to the policy framework. The compliance
history in the policy on the cluster is limited to a non-configurable 10 statuses. The Compliance History API introduces
a query-able database to keep track of history over a longer period as well as updates to a given policy.</li></ul><h3 id=core-components-3>Core components</h3><ul><li>ocm v0.13.0 <a href=https://github.com/open-cluster-management-io/ocm/releases/tag/v0.13.0>changelog</a></li><li>clusteradm v0.8.0 <a href=https://github.com/open-cluster-management-io/clusteradm/blob/v0.8.0/CHANGELOG.md>changelog</a></li></ul><h3 id=addons-3>Addons</h3><ul><li>config-policy-controller v0.13.0 <a href=https://github.com/open-cluster-management-io/config-policy-controller/releases/tag/v0.13.0>changelog</a></li><li>governance-policy-framework-addon v0.13.0 <a href=https://github.com/open-cluster-management-io/governance-policy-framework-addon/releases/tag/v0.13.0>changelog</a></li><li>governance-policy-propagator v0.13.0 <a href=https://github.com/open-cluster-management-io/governance-policy-propagator/releases/tag/v0.13.0>changelog</a></li><li>governance-policy-addon-controller v0.13.0 <a href=https://github.com/open-cluster-management-io/governance-policy-addon-controller/releases/tag/v0.13.0>changelog</a></li><li>multicloud-operators-subscription v0.13.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-subscription/releases/tag/v0.13.0>changelog</a></li><li>multicloud-operators-channel v0.13.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-channel/releases/tag/v0.13.0>changelog</a></li><li>multicloud-integrations v0.13.0 <a href=https://github.com/open-cluster-management-io/multicloud-integrations/releases/tag/v0.13.0>changelog</a></li><li>managed-serviceaccount v0.5.0 <a href=https://github.com/open-cluster-management-io/managed-serviceaccount/releases/tag/v0.5.0>changelog</a></li><li>cluster-proxy v0.4.0 <a href=https://github.com/open-cluster-management-io/cluster-proxy/releases/tag/v0.4.0>changelog</a></li></ul><h2 id=0120-11-oct-2023><code>0.12.0</code>, 11 Oct. 2023</h2><p>The Open Cluster Management team is proud to announce the release of OCM v0.12.0! We have made architecture refactors and added several features in
this release:</p><ul><li>Component consolidation: we made a big code refactor to merge code in registration, work, placement and registration-operator into the <a href=https://github.com/open-cluster-management-io/ocm>ocm</a> repo.
The original separated code repos are currently used for maintaining old releases only. This code consolidation allows us to build more robust e2e tests, and build a single
agent binary to reduce the footprint in managed clusters.</li><li>Addon Template API: A new <code>addontemplate</code> API is introduced to ease the development of addons. Users will not need to write code and run an addon-manager
controller on the hub cluster. Instead, they only need to define the <code>addontemplate</code> API to create an addon. <code>clusteradm</code> also has a new command
<code>clusteradm addon create ...</code> to create an addon from resource manifests files. See more details about <code>addontemplate</code> in the
<a href=https://open-cluster-management.io/developer-guides/addon/#build-an-addon-with-addon-template>addon documentation</a>.</li><li>Singleton agent mode: users can now choose to start the agent as a single pod using the <code>Singleton</code> mode in the klusterlet.</li><li>ManagedClusterSet/ManagedClusterSetBinding v1beta1 API is removed.</li><li><code>ConfigurationPolicy</code>: Add the <code>informOnly</code> option to <code>remediationAction</code> in <code>ConfigurationPolicy</code>, signaling that the remediation action set
on the <code>Policy</code> should not override the <code>ConfigurationPolicy</code>&rsquo;s remediation action.</li><li>Policy framework: Security, performance, and stability improvements in controllers on both the hub and managed clusters.</li><li><code>ClusterPermission</code>: New custom resource that enables administrators to automatically distribute RBAC resources to managed
clusters and manage the lifecycle of those resources. See the <a href=https://github.com/open-cluster-management-io/cluster-permission>ClusterPermission repo</a> for more details.</li></ul><h3 id=core-components-4>Core components</h3><ul><li>ocm v0.12.0 <a href=https://github.com/open-cluster-management-io/ocm/releases/tag/v0.12.0>changelog</a></li><li>clusteradm v0.7.0 <a href=https://github.com/open-cluster-management-io/clusteradm/blob/v0.6.0/CHANGELOG.md>changelog</a></li></ul><h3 id=addons-4>Addons</h3><ul><li>config-policy-controller v0.12.0 <a href=https://github.com/open-cluster-management-io/config-policy-controller/releases/tag/v0.12.0>changelog</a></li><li>governance-policy-framework-addon v0.12.0 <a href=https://github.com/open-cluster-management-io/governance-policy-framework-addon/releases/tag/v0.12.0>changelog</a></li><li>governance-policy-propagator v0.12.0 <a href=https://github.com/open-cluster-management-io/governance-policy-propagator/releases/tag/v0.12.0>changelog</a></li><li>governance-policy-addon-controller v0.12.0 <a href=https://github.com/open-cluster-management-io/governance-policy-addon-controller/releases/tag/v0.12.0>changelog</a></li><li>multicloud-operators-subscription v0.12.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-subscription/releases/tag/v0.12.0>changelog</a></li><li>multicloud-operators-channel v0.12.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-channel/releases/tag/v0.12.0>changelog</a></li><li>multicloud-integrations v0.12.0 <a href=https://github.com/open-cluster-management-io/multicloud-integrations/releases/tag/v0.12.0>changelog</a></li><li>managed-serviceaccount v0.4.0 <a href=https://github.com/open-cluster-management-io/managed-serviceaccount/releases/tag/v0.4.0>changelog</a></li></ul><h2 id=0110-1-june-2023><code>0.11.0</code>, 1, June 2023</h2><p>The Open Cluster Management team is proud to announce the release of OCM v0.11.0! There are a bunch of new features added into this release</p><ul><li>Addon install strategy and rolling upgrade: a new component <code>addon-manager</code> is introduced to handle the addon installation and upgrade.
User can specify the installation and upgrade strategy of the addon by referencing placement on <code>ClusterManagementAddon</code> API. The
feature is in the alpha stage and can be enabled by setting <code>feature-gates=AddonManagement=true</code> when running <code>clusteradm init</code>.</li><li>ManifestWorkReplicaSet: it is a new API introduced in this release to deploy <code>ManifestWork</code> to multiple clusters by placement. Users can
create a <code>ManifestWorkReplicaSet</code> together with <code>Placement</code> in the same namespace to spread the <code>ManifestWork</code> to multiple clusters, or
use the command <code>clusteradm create work &lt;work name> -f &lt;manifest yaml> --placement &lt;namespace>/&lt;placement name> -r</code>. The
feature is in the alpha stage and can be enabled by setting <code>feature-gates=ManifestWorkReplicaSet=true</code> when running <code>clusteradm init</code>.</li><li>Registration auto approve: user can configure a list of user id to auto approve the registration which makes cluster registration simpler
in some scenarios. The feature is in the alpha stage and can be enabled by setting <code>feature-gates=ManagedClusterAutoApproval=true</code> when running <code>clusteradm init</code>.
With this feautre enabled, the user does not need to run <code>accept</code> command on hub after <code>join</code> command.</li><li>ManifestWork can return structured result: previously the feedback mechanism in <code>ManifestWork</code> can only return scalar value. In this
release, we add the support to return a structured value in the format of json string. To enable this feature, user can add <code>feature-gates=RawFeedbackJsonString=true</code>
when running <code>clusteradm join</code> command.</li><li>Policies added support for syncing <a href=https://open-policy-agent.github.io/gatekeeper/website/>Gatekeeper</a> manifests directly (previously a ConfigurationPolicy was needed to sync Gatekeeper manifests).</li><li>Templates were enhanced to lookup objects by label, and added <code>copySecretData</code> and <code>copyConfigMapData</code> functions to fetch the entire <code>data</code> contents of the respective object.</li><li>Improved the integration of the ArgoCD pull model by aggregating the status of deployed resources in the managed clusters and presenting it in the hub cluster&rsquo;s <code>MulticlusterApplicationSetReport</code> custom resource.</li></ul><h3 id=core-components-5>Core components</h3><ul><li>registration v0.11.0 <a href=https://github.com/open-cluster-management-io/registration/blob/v0.11.0/CHANGELOG/CHANGELOG-v0.11.md>changelog</a></li><li>work v0.11.0 <a href=https://github.com/open-cluster-management-io/work/blob/v0.11.0/CHANGELOG/CHANGELOG-v0.11.md>changelog</a></li><li>placement v0.11.0 <a href=https://github.com/open-cluster-management-io/placement/blob/v0.11.0/CHANGELOG/CHANGELOG-v0.11.md>changelog</a></li><li>addon-framework v0.7.0 <a href=https://github.com/open-cluster-management-io/addon-framework/blob/v0.7.0/CHANGELOG/CHANGELOG-v0.7.md>changelog</a></li><li>registration-operator v0.11.0 <a href=https://github.com/open-cluster-management-io/registration-operator/blob/v0.11.0/CHANGELOG/CHANGELOG-v0.11.md>changelog</a></li><li>clusteradm v0.6.0 <a href=https://github.com/open-cluster-management-io/clusteradm/blob/v0.6.0/CHANGELOG.md>changelog</a></li></ul><h3 id=addons-5>Addons</h3><ul><li>cluster-proxy v0.3.0 <a href=https://github.com/open-cluster-management-io/cluster-proxy>repo</a></li><li>managed-serviceaccount v0.3.0 <a href=https://github.com/open-cluster-management-io/managed-serviceaccount>repo</a></li><li>config-policy-controller v0.11.0 <a href=https://github.com/open-cluster-management-io/config-policy-controller/releases/tag/v0.11.0>changelog</a></li><li>governance-policy-framework-addon v0.11.0 <a href=https://github.com/open-cluster-management-io/governance-policy-framework-addon/releases/tag/v0.11.0>changelog</a></li><li>governance-policy-propagator v0.11.0 <a href=https://github.com/open-cluster-management-io/governance-policy-propagator/releases/tag/v0.11.0>changelog</a></li><li>governance-policy-addon-controller v0.11.0 <a href=https://github.com/open-cluster-management-io/governance-policy-addon-controller/releases/tag/v0.11.0>changelog</a></li><li>multicloud-operators-subscription v0.11.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-subscription/releases/tag/v0.11.0>release note</a></li><li>multicloud-operators-channel v0.11.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-channel/releases/tag/v0.11.0>release note</a></li><li>multicloud-integrations v0.11.0 <a href=https://github.com/open-cluster-management-io/multicloud-integrations/releases/tag/v0.11.0>release note</a></li></ul><p>We are pleased to welcome several new contributors to the community: @aii-nozomu-oki, @serngawy, @maleck13, @fgiloux, @USER0308, @youhangwang, @TheRealJon, @skitt, @yiraeChristineKim
@iranzo, @nirs, @akram, @pajikos, @Arhell, @levenhagen, @eemurphy, @bellpr, @o-farag. Thanks for your contributions!</p><h2 id=0100-17th-feb-2023><code>0.10.0</code>, 17th, Feb 2023</h2><p>The Open Cluster Management team is proud to announce the release of OCM v0.10.0! We mainly focused on bug fixes, code refactoring, and code stability
in this release. Also we worked on several important design proposals on addon lifecycle enhancement and manifestwork
orchestration which will be implemented in the next release. Here are some main features included in this release:</p><ul><li>Argo CD hub-spoke / pull model application delivery integration. See <a href=https://github.com/open-cluster-management-io/argocd-pull-integration>argocd-pull-integration repo</a> for more details.</li><li>Policy templating is enhanced so that when a referenced object is updated, the template is also updated.</li><li>A Policy or ConfigurationPolicy can specify dependencies on another policy having a specified status before taking action.</li><li>A raw string with go templates can be provided in <code>object-templates-raw</code> to the ConfigurationPolicy, allowing dynamically generated objects through the use of functions like <code>{{ range ... }}</code>.</li></ul><h3 id=core-components-6>Core components</h3><ul><li>registration v0.10.0 <a href=https://github.com/open-cluster-management-io/registration/blob/v0.10.0/CHANGELOG/CHANGELOG-v0.10.md>changelog</a></li><li>work v0.10.0<a href=https://github.com/open-cluster-management-io/work/blob/v0.10.0/CHANGELOG/CHANGELOG-v0.10.md>changelog</a></li><li>placement v0.10.0 <a href=https://github.com/open-cluster-management-io/placement/blob/v0.10.0/CHANGELOG/CHANGELOG-v0.10.md>changelog</a></li><li>addon-framework v0.6.0 <a href=https://github.com/open-cluster-management-io/addon-framework/blob/v0.6.0/CHANGELOG/CHANGELOG-v0.6.md>changelog</a></li><li>registration-operator v0.9.0 <a href=https://github.com/open-cluster-management-io/registration-operator/blob/v0.10.0/CHANGELOG/CHANGELOG-v0.10.md>changelog</a></li><li>clusteradm v0.5.1 <a href=https://github.com/open-cluster-management-io/clusteradm/blob/v0.5.1/CHANGELOG.md>changelog</a></li></ul><h3 id=addons-6>Addons</h3><ul><li>config-policy-controller v0.10.0 <a href=https://github.com/open-cluster-management-io/config-policy-controller/releases/tag/v0.10.0>changelog</a></li><li>governance-policy-framework-addon v0.10.0 <a href=https://github.com/open-cluster-management-io/governance-policy-framework-addon/releases/tag/v0.10.0>changelog</a></li><li>governance-policy-propagator v0.10.0 <a href=https://github.com/open-cluster-management-io/governance-policy-propagator/releases/tag/v0.10.0>changelog</a></li><li>governance-policy-addon-controller v0.10.0 <a href=https://github.com/open-cluster-management-io/governance-policy-addon-controller/releases/tag/v0.10.0>changelog</a></li><li>multicloud-operators-subscription v0.10.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-subscription/releases/tag/v0.10.0>release note</a></li><li>multicloud-operators-channel v0.10.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-channel/releases/tag/v0.10.0>release note</a></li></ul><h2 id=v090-21st-october-2022><code>v0.9.0</code>, 21st, October 2022</h2><p>Open Cluster Management team is proud to announce the release of OCM v0.9.0! Here are some main features included in this release:</p><ul><li>De-escalate Work Agent Privilege on Managed Clusters
In previous iterations of OCM, the Work Agent process is run with admin privileges on managed clusters. This release, to exercise the principle of least privilege, OCM supports defining a non-root identity within each ManifestWork object, allowing end users to give the agent only necessary permissions to interact with the clusters which they manage.</li><li>Support referencing the AddOn configuration with AddOn APIs
For some add-ons, they want to run with configuration, we enhance the add-on APIs to support reference add-on configuration, and in add-on framework, we support to trigger re-rendering the add-on deployment if its configuration is changed</li><li>Allow Targeting Specific Services within Managed Clusters
The cluster-proxy add-on supports the exposure of services from within managed clusters to hub clusters, even across Virtual Private Clouds. Originally all traffic was routed through the Kubernetes API server on each managed cluster, increasing load on the node hosting the API server. Now the proxy agent add-on supports specifying a particular target service within a cluster, allowing for better load balancing of requests made by hub clusters and more granular control of what resources/APIs are exposed to hub clusters.</li><li>Upgraded ManagedClusterSet API to v1beta2
Update the ClusterSet API and gradually remove legacy custom resources, as well as allow for transformation of legacy resources into analogous v1beta2 resources. v1alpha1 APIs are removed.</li><li>Consolidate the policy add-on template, status, and spec synchronization controllers into a single repository, <a href=https://github.com/open-cluster-management-io/governance-policy-framework-addon>governance-policy-framework-addon</a></li><li>Application add-on is now able to expose custom Prometheus metrics via the Git subscription. See the <a href=https://github.com/open-cluster-management-io/multicloud-operators-subscription/blob/v0.9.0/docs/metrics.md>metric documentation</a> for more details.</li></ul><h3 id=core-components-7>Core components</h3><ul><li>registration v0.9.0 <a href=https://github.com/open-cluster-management-io/registration/blob/v0.9.0/CHANGELOG/CHANGELOG-v0.9.md>changelog</a></li><li>work v0.9.0 <a href=https://github.com/open-cluster-management-io/work/blob/v0.9.0/CHANGELOG/CHANGELOG-v0.9.md>changelog</a></li><li>placement v0.9.0 <a href=https://github.com/open-cluster-management-io/placement/blob/v0.9.0/CHANGELOG/CHANGELOG-v0.9.md>changelog</a></li><li>addon-framework v0.5.0 <a href=https://github.com/open-cluster-management-io/addon-framework/blob/v0.5.0/CHANGELOG/CHANGELOG-v0.5.md>changelog</a></li><li>registration-operator v0.9.0 <a href=https://github.com/open-cluster-management-io/registration-operator/blob/v0.9.0/CHANGELOG/CHANGELOG-v0.9.md>changelog</a></li></ul><h3 id=addons-7>Addons</h3><ul><li>config-policy-controller v0.9.0 <a href=https://github.com/open-cluster-management-io/config-policy-controller/blob/main/CHANGELOG/CHANGELOG-v0.9.0.md>changelog</a></li><li>governance-policy-framework-addon v0.9.0 <a href=https://github.com/open-cluster-management-io/governance-policy-framework-addon/blob/main/CHANGELOG/CHANGELOG-v0.9.0.md>changelog</a></li><li>governance-policy-propagator v0.9.0 <a href=https://github.com/open-cluster-management-io/governance-policy-propagator/blob/main/CHANGELOG/CHANGELOG-v0.9.0.md>changelog</a></li><li>governance-policy-addon-controller v0.9.0 <a href=https://github.com/open-cluster-management-io/governance-policy-addon-controller/blob/main/CHANGELOG/CHANGELOG-v0.9.0.md>changelog</a></li><li>multicloud-operators-subscription v0.9.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-subscription/releases/tag/v0.9.0>release note</a></li><li>multicloud-operators-channel v0.9.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-channel/releases/tag/v0.9.0>release note</a></li><li>multicloud-integrations v0.9.0 <a href=https://github.com/open-cluster-management-io/multicloud-integrations/releases/tag/v0.9.0>release note</a></li></ul><p>The release annoucement is also publishded in <a href=https://www.cncf.io/blog/2022/10/31/open-cluster-management-november-2022-update/>blog</a>. Thanks for all your contribution!</p><h2 id=v080-8th-july-2022><code>v0.8.0</code>, 8th, July 2022</h2><p>Open Cluster Management team is proud to annouce the release of OCM v0.8.0! It includes several enhancement on core components and addons.
Notable changes including:</p><ul><li><code>ManifestWork</code> update strategy: now user can set <code>ServerSideApply</code> or <code>CreateOnly</code> as the manifest update strategy to resolve potential
resource conflict in <code>ManifestWork</code>.</li><li>Global ClusterSet: when user enable the <code>DefaultClusterSet</code> feature gate, a global <code>ManagedClusterSet</code> will be auto-created including all
<code>ManagedCluster</code>s</li><li>Configuring feature gates for <code>klusterlet</code> and <code>cluster manager</code>: user can set feature gates when starting <code>klusterlet</code> and <code>cluster manager</code>.</li><li>Support host alaises for <code>klusterlet</code>: user can now set host aliases for <code>klusterlet</code>, it is especially useful in on-prem environment.</li><li>Running policy addon using <code>clusteradm</code>: user can now run policy addon directly using <code>clusteradm</code></li></ul><p>Also we have added two new sub projects:</p><ul><li><a href=https://github.com/open-cluster-management-io/multicluster-mesh>multicluster-mesh</a> is an addon to deploy and configure istio across the clusters.</li><li><a href=https://github.com/open-cluster-management-io/ocm-vscode-extension>ocm-vscode-extention</a> is a vscode extension to operator/develop ocm project easily in vscode.</li></ul><p>See details in the release changelogs:</p><h3 id=core-components-8>Core components</h3><ul><li>registration v0.8.0 <a href=https://github.com/open-cluster-management-io/registration/blob/v0.8.0/CHANGELOG/CHANGELOG-v0.8.md>changelog</a></li><li>work v0.8.0 <a href=https://github.com/open-cluster-management-io/work/blob/v0.8.0/CHANGELOG/CHANGELOG-v0.8.md>changelog</a></li><li>placement v0.8.0 <a href=https://github.com/open-cluster-management-io/placement/blob/v0.8.0/CHANGELOG/CHANGELOG-v0.8.md>changelog</a></li><li>addon-framework v0.4.0 <a href=https://github.com/open-cluster-management-io/addon-framework/blob/v0.4.0/CHANGELOG/CHANGELOG-v0.4.md>changelog</a></li><li>registration-operator v0.8.0 <a href=https://github.com/open-cluster-management-io/registration-operator/blob/v0.8.0/CHANGELOG/CHANGELOG-v0.8.md>changelog</a></li></ul><h3 id=addons-8>Addons</h3><ul><li>multicloud-operators-subscription v0.8.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-subscription/releases/tag/v0.8.0>changelog</a></li><li>multicloud-operators-channel v0.8.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-channel/releases/tag/v0.8.0>changelog</a></li><li>cluster-proxy v0.2.2 <a href=https://github.com/open-cluster-management-io/cluster-proxy/releases/tag/v0.2.2>changelog</a></li><li>multicluster-mesh v0.0.1 <a href=https://github.com/open-cluster-management-io/multicluster-mesh/releases/tag/v0.0.1>changelog</a></li><li>config-policy-controller v0.8.0 <a href=https://github.com/open-cluster-management-io/config-policy-controller/blob/main/CHANGELOG/CHANGELOG-v0.8.0.md>changelog</a></li><li>governance-policy-spec-sync v0.8.0 <a href=https://github.com/open-cluster-management-io/governance-policy-spec-sync/blob/main/CHANGELOG/CHANGELOG-v0.8.0.md>changelog</a></li><li>governance-policy-template-sync v0.8.0 <a href=https://github.com/open-cluster-management-io/governance-policy-template-sync/blob/main/CHANGELOG/CHANGELOG-v0.8.0.md>changelog</a></li><li>governance-policy-status-sync v0.8.0 <a href=https://github.com/open-cluster-management-io/governance-policy-status-sync/blob/main/CHANGELOG/CHANGELOG-v0.8.0.md>changelog</a></li><li>governance-policy-propagator v0.8.0 <a href=https://github.com/open-cluster-management-io/governance-policy-propagator/blob/main/CHANGELOG/CHANGELOG-v0.8.0.md>changelog</a></li><li>governance-policy-addon-controller v0.8.0 <a href=https://github.com/open-cluster-management-io/governance-policy-addon-controller/blob/main/CHANGELOG/CHANGELOG-v0.8.0.md>changelog</a></li></ul><h3 id=cli-extentions>CLI extentions</h3><ul><li>clusteradm v0.3.0 <a href=https://github.com/open-cluster-management-io/clusteradm/releases/tag/v0.3.0>changelog</a></li><li>ocm-vscode-extension 0.1.0 <a href=https://github.com/open-cluster-management-io/ocm-vscode-extension/releases/tag/1.0.0>changelog</a></li></ul><p>There are 30+ contributors making contributions in this release, they are, @ChunxiAlexLuo, @dhaiducek, @elgnay, @haoqing0110, @itdove, @ilan-pinto, @ivan-cai, @jichenjc, @JustinKuli, @ldpliu, @mikeshng, @mgold1234, @morvencao, @mprahl, @nathanweatherly, @philipwu08, @panguicai008, @Promacanthus, @qiujian16, @rokej, @skeeey, @SataQiu, @vbelouso, @xauthulei, @xiangjingli, @xuezhaojun, @ycyaoxdu, @yue9944882, @zhujian7, @zhiweiyin318. Thanks for your contributions!</p><h2 id=v070-on-6th-april-2022><code>v0.7.0</code>, on 6th, April 2022</h2><p>The Open Cluster Management team is excited to announce the release of OCM v0.7.0! We mainly focused on enhancing user experience in this release by introducing a bunch of new commands in <code>clusteradm</code>. Notable changes including:</p><ul><li>APIs including <code>placement</code>, <code>placementdecision</code>, <code>managedclusterset</code> and <code>managedclustersetbinding</code> are upgraded to <code>v1beta1</code>, <code>v1alpha1</code> version of these APIs are deprecated and will be removed in the future.</li><li>User can now use <code>clusteradm</code> to:<ul><li>create, bind and view <code>clusterset</code></li><li>create and view <code>work</code></li><li>check the controlplane status by using <code>hub-info</code> and <code>klusterlet-info</code> sub commands.</li><li>upgrade hub and klusterlet</li></ul></li><li>A default <code>managedclusterset</code> is created automatically and all clusters will be added to default <code>managedclusterset</code> by default. This feature can be disabled with feature gate <code>DefaultClusterSet</code> on registration controller.</li><li>Add the new <code>policyset</code> API that provides a way to logically group <code>policy</code> objects from a namespace, share placement, and report on overall status for the set in policy addon.</li></ul><p>See details in the release changelogs::</p><ul><li>registration v0.7.0 <a href=https://github.com/open-cluster-management-io/registration/blob/v0.7.0/CHANGELOG/CHANGELOG-v0.7.md>changelog</a></li><li>work v0.7.0 <a href=https://github.com/open-cluster-management-io/work/blob/v0.7.0/CHANGELOG/CHANGELOG-v0.7.md>changelog</a></li><li>placement v0.4.0 <a href=https://github.com/open-cluster-management-io/placement/blob/v0.4.0/CHANGELOG/CHANGELOG-v0.4.md>changelog</a></li><li>addon-framework v0.3.0 <a href=https://github.com/open-cluster-management-io/addon-framework/blob/v0.3.0/CHANGELOG/CHANGELOG-v0.3.md>changelog</a></li><li>registration-operator v0.7.0 <a href=https://github.com/open-cluster-management-io/registration-operator/blob/v0.7.0/CHANGELOG/CHANGELOG-v0.7.md>changelog</a></li><li>cluster-proxy v0.2.0 <a href=https://github.com/open-cluster-management-io/cluster-proxy>repo</a></li><li>managed-serviceaccount v0.2.0 <a href=https://github.com/open-cluster-management-io/managed-serviceaccount>repo</a></li><li>clusteradm v0.2.0 <a href=https://github.com/open-cluster-management-io/clusteradm/releases/tag/v0.2.0>changelog</a></li><li>multicloud-operators-subscription v0.7.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-subscription/releases/tag/v0.7.0>changelog</a></li><li>multicloud-operators-channel v0.7.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-channel/releases/tag/v0.7.0>changelog</a></li><li>governance policy propagator v0.7.0 <a href=https://github.com/open-cluster-management-io/governance-policy-propagator/blob/main/CHANGELOG/CHANGELOG-v0.7.0.md>changelog</a></li><li>config policy controller v0.7.0 <a href=https://github.com/open-cluster-management-io/config-policy-controller/blob/main/CHANGELOG/CHANGELOG-v0.7.0.md>changelog</a></li><li>policy spec sync controller v0.7.0 <a href=https://github.com/open-cluster-management-io/governance-policy-spec-sync/blob/main/CHANGELOG/CHANGELOG-v0.7.0.md>changelog</a></li><li>policy template sync controller v0.7.0 <a href=https://github.com/open-cluster-management-io/governance-policy-template-sync/blob/main/CHANGELOG/CHANGELOG-v0.7.0.md>changelog</a></li><li>policy status sync controller v0.7.0 <a href=https://github.com/open-cluster-management-io/governance-policy-status-sync/blob/main/CHANGELOG/CHANGELOG-v0.7.0.md>changelog</a></li></ul><p>There are 30+ contributors making contributions in this release, they are, @ChunxiAlexLuo, @dhaiducek, @elgnay, @haoqing0110, @hanqiuzh, @ilan-pinto, @ivan-cai, @JiahaoWei-RH, @jichenjc, @JustinKuli, @ldpliu, @mikeshng, @mgold1234, @morvencao, @mprahl, @nathanweatherly, @philipwu08, @qiujian16, @rcarrillocruz, @rokej, @skeeey, @TheRealHaoLiu, @vbelouso, @vMaroon, @TomerFi, @xauthulei, @xiangjingli, @xuezhaojun, @ycyaoxdu, @yue9944882, @zhujian7, @zhiweiyin318. Thanks for your contributions!</p><h2 id=v060-on-21st-january-2022><code>v0.6.0</code>, on 21st, January 2022</h2><p>The Open Cluster Management team is proud to announce the release of OCM v0.6.0! We made many enhancements on core components and introduced some new addons.</p><ul><li><a href=https://github.com/open-cluster-management-io/cluster-proxy>First release of cluster-proxy addon</a>, Cluster-Proxy addon is to provide a reverse tunnel from the managed cluster to the hub using <code>apiserver-network-proxy</code>, so user can easily visit the apiserver of the managedcluster from the hub without complicated infrstructure configuration. See <a href=https://open-cluster-management.io/docs/scenarios/pushing-kube-api-requests/>here</a> on how to use cluster-proxy in OCM.</li><li><a href=https://github.com/open-cluster-management-io/managed-serviceaccount>First release of managed-serviceaccount addon</a>, Managed-Servicesaccount addon provides a mechanism to project a service account on a managed cluster to the hub. The user can then use this projected account to visit services on the managed cluster.</li><li><a href=https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/29-manifestwork-status-feedback>Sync status of applied resources in ManifestWork</a>, The users can specify the status field of the applied resource they want to explore in the ManifestWork spec, and get results from the status of the ManifestWork. See <a href=https://open-cluster-management.io/concepts/manifestwork/#fine-grained-field-values-tracking>here</a> on how to use this feature in Manifestwork.</li><li><a href=https://github.com/open-cluster-management-io/enhancements/blob/main/enhancements/sig-architecture/32-extensiblescheduling>Placement extensible scheduling</a>, a new API AddonPlacementScore is added which allows third party controllers to score the clusters based on various metrics. The user can specify what score should be used in the Placement API to select clusters.</li><li><a href=https://github.com/open-cluster-management-io/addon-framework/pull/62>Helm chart interface for addon framework</a>, a new interface is added in addon framework with which the developer can build an addon agent from a helm chart. See <a href=https://github.com/open-cluster-management-io/addon-framework/tree/main/examples/helloworld_helm>example</a> on how to build an addon agent from the helm chart.</li><li><a href=https://github.com/open-cluster-management-io/multicloud-operators-subscription/pull/55>Placement API support for multicloud-operators-subscription</a>, subscription now supports Placement API and can leverage all new features in Placement API to deploy application packages.</li></ul><p>We also added many new functions in <a href=https://github.com/open-cluster-management-io/clusteradm>clusteradm</a> and enhanced the website documentation.</p><p>See details in the release changelogs::</p><ul><li>registration v0.6.0 <a href=https://github.com/open-cluster-management-io/registration/blob/v0.6.0/CHANGELOG/CHANGELOG-v0.6.md>changelog</a></li><li>work v0.6.0 <a href=https://github.com/open-cluster-management-io/work/blob/v0.6.0/CHANGELOG/CHANGELOG-v0.6.md>changelog</a></li><li>placement v0.3.0 <a href=https://github.com/open-cluster-management-io/placement/blob/v0.3.0/CHANGELOG/CHANGELOG-v0.3.md>changelog</a></li><li>addon-framework v0.2.0 <a href=https://github.com/open-cluster-management-io/addon-framework/blob/v0.2.0/CHANGELOG/CHANGELOG-v0.2.md>changelog</a></li><li>registration-operator v0.6.0 <a href=https://github.com/open-cluster-management-io/registration-operator/blob/v0.6.0/CHANGELOG/CHANGELOG-v0.6.md>changelog</a></li><li>multicloud-operators-subscription v0.6.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-subscription/blob/v0.6.0/CHANGELOG/CHANGELOG-v0.6.md>changelog</a></li><li>cluster-proxy v0.1.3 <a href=https://github.com/open-cluster-management-io/cluster-proxy>repo</a></li><li>managed-serviceaccount v0.1.0 <a href=https://github.com/open-cluster-management-io/managed-serviceaccount>repo</a></li><li>clusteradm v0.1.0 <a href=https://github.com/open-cluster-management-io/clusteradm/blob/v0.1.0/CHANGELOG>changelog</a></li><li>config-policy-controller v0.6.0 <a href=https://github.com/open-cluster-management-io/config-policy-controller/blob/main/CHANGELOG/CHANGELOG-v0.6.0.md>changelog</a></li><li>governance-policy-propagator v0.6.0 <a href=https://github.com/open-cluster-management-io/governance-policy-propagator/blob/main/CHANGELOG/CHANGELOG-v0.6.0.md>changelog</a></li><li>governance-policy-status-sync v0.6.0 <a href=https://github.com/open-cluster-management-io/governance-policy-status-sync/blob/main/CHANGELOG/CHANGELOG-v0.6.0%20.md>changelog</a></li><li>governance-policy-spec-sync v0.6.0 <a href=https://github.com/open-cluster-management-io/governance-policy-spec-sync/blob/main/CHANGELOG/CHANGELOG-v0.6.0.md>changelog</a></li><li>governance-policy-template-sync v0.6.0 <a href=https://github.com/open-cluster-management-io/governance-policy-template-sync/blob/main/CHANGELOG/CHANGELOG-v0.6.0.md>changelog</a></li><li>ocm-kustomize-generator-plugins v1.3.0 <a href=https://github.com/open-cluster-management-io/ocm-kustomize-generator-plugins/blob/main/CHANGELOG/CHANGELOG-v1.3.0.md>changelog</a></li></ul><p>There are 20+ contributors making contributions in this release, they are @champly, @ChunxiAlexLuo, @dhaiducek, @elgnay, @haoqing0110, @ilan-pinto, @mikeshng, @morvencao, @mprahl, @nathanweatherly, @qiujian16, @rokej, @skeeey, @TheRealHaoLiu, @serngawy, @suigh, @xauthulei, @xiangjingli, @xuezhaojun, @ycyaoxdu, @yue9944882, @zhujian7, @zhiweiyin318. Thanks for your contributions!</p><h2 id=v050-on-8th-november-2021><code>v0.5.0</code>, on 8th, November 2021</h2><p>Open Cluster Management team is proud to announce the release of OCM v0.5.0! We made several enhancements on APIs
and addons which include:</p><ul><li><a href=https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/10-deletepropagationstrategy>Support deleteOption in ManifestWork.</a></li><li><a href=https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/15-resourcebasedscheduling>Introduce plugin mechanism in Placement API and add resource based scheduling.</a></li><li>ManagedClusterSet API is upgraded from v1alpha1 to v1beta1.</li><li>Scalability improvement on application manager.</li></ul><p>In addition, we also release the first version of <a href=https://github.com/open-cluster-management-io/clusteradm>clusteradm</a>
to ease the installation of OCM, and <a href=https://github.com/open-cluster-management-io/addon-framework>addon-framework</a> to
ease the development of management addons on OCM.</p><p>To see details of the changelogs in this release:</p><ul><li>registration v0.5.0 <a href=https://github.com/open-cluster-management-io/registration/blob/v0.5.0/CHANGELOG/CHANGELOG-v0.5.md>changelog</a></li><li>work v0.5.0 <a href=https://github.com/open-cluster-management-io/work/blob/v0.5.0/CHANGELOG/CHANGELOG-v0.5.md>changelog</a></li><li>placement v0.2.0 <a href=https://github.com/open-cluster-management-io/placement/blob/v0.2.0/CHANGELOG/CHANGELOG-v0.2.md>changelog</a></li><li>addon-framework v0.1.0 <a href=https://github.com/open-cluster-management-io/addon-framework/blob/v0.1.0/CHANGELOG/CHANGELOG-v0.1.md>changelog</a></li><li>registration-operator v0.5.0 <a href=https://github.com/open-cluster-management-io/registration-operator/blob/v0.5.0/CHANGELOG/CHANGELOG-v0.5.md>changelog</a></li><li>multicloud-operators-subscription v0.5.0 <a href=https://github.com/open-cluster-management-io/multicloud-operators-subscription/blob/v0.5.0/CHANGELOG/CHANGELOG-v0.5.md>changelog</a></li></ul><p>There are 20+ contributors making contributions in this release, they are @elgnay, @haoqing0110, @hchenxa, @huiwq1990, @itdove, @kim-fitness, @mikeshng, @panpan0000, @philipwu08, @porridge, @qiujian16, @rokej, @skeeey, @suigh, @vincent-pli, @wzhanw, @xauthulei, @xiangjingli, @xuezhaojun, @yue9944882, @zhujian7, @zhiweiyin318. Thanks for your contributions!</p><h2 id=v040-on-august-2021><code>v0.4.0</code> on August 2021</h2></div><div class=td-content style=page-break-before:always><h1 id=pg-8bddc47793f55bfae90416ca0f1667ea>7 - Roadmap</h1><p>The Open Cluster Management community uses <a href=https://github.com/orgs/open-cluster-management-io/projects/2/views/9>GitHub Project</a> to track the progress of the project.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-4588103fb9a692533044ee756a5f863f>8 - FAQ</h1><p>Welcome to our Frequently Asked Questions (FAQ) page! Here, you&rsquo;ll find answers to some of the most common questions we receive. If you have a question that isn&rsquo;t covered here, feel free to reach out to us directly.</p><h2 id=questions>Questions</h2><h3 id=what-is-the-difference-between-karmada-and-ocm>What is the difference between Karmada and OCM?</h3><p>We have a post about this at CNCF blog: <a href=https://www.cncf.io/blog/2022/09/26/karmada-and-open-cluster-management-two-new-approaches-to-the-multicluster-fleet-management-challenge/>Karmada and Open Cluster Management: two new approaches to the multicluster fleet management challenge</a>.</p><h3 id=what-is-the-difference-between-manifestwork-manifestworkreplicaset-and-addon-when-to-use-them>What is the difference between ManifestWork, ManifestWorkReplicaset and AddOn? When to use them?</h3><p><strong>1. <a href=/docs/concepts/work-distribution/manifestwork/>Manifestwork</a></strong></p><p><strong><em>Definition:</em></strong> Manifestwork is a resource used to define a group of Kubernetes resources that should be applied to a managed cluster from a hub cluster. It allows for the deployment of various resources (like Deployments, Services, etc.) to a specific managed cluster.</p><p><strong><em>Use Case:</em></strong> Use ManifestWork when you want to apply a specific set of resources to a single managed cluster. It is ideal for scenarios where you need to manage resources directly and track their status on that cluster.</p><p><strong><em>Example:</em></strong> Deploying a Deployment and a Service to a managed cluster. You can use <a href=https://github.com/open-cluster-management-io/clusteradm>clusteradm</a> command <code>clusteradm create work work-example -f xxx.yaml --clusters cluster1</code> to wrap the kubernetes native resource with a ManifestWork and submit it to a sepecific managed cluster.</p><p><strong>2. <a href=/docs/concepts/work-distribution/manifestworkreplicaset/>ManifestWorkReplicaSet</a></strong></p><p><strong><em>Definition:</em></strong> ManifestWorkReplicaSet is an aggregator API that utilizes <a href=/docs/concepts/work-distribution/manifestwork/>Manifestwork</a> and <a href=/docs/concepts/content-placement/placement/>Placement</a> to create multiple ManifestWork resources for clusters selected by placements. It allows for the deployment of resources across multiple clusters based on defined rollout strategies.</p><p><strong><em>Use Case:</em></strong> Use ManifestWorkReplicaSet when you need to deploy the same resources to multiple clusters simultaneously, with the ability to control the rollout strategy (e.g., all at once, progressively, etc.). It is useful for managing deployments across a fleet of clusters.</p><p><strong><em>Example:</em></strong> Deploying a CronJob and Namespace to multiple clusters selected by a placement strategy.</p><p><strong>3. <a href=/docs/concepts/add-on-extensibility/addon/>Add-On</a></strong></p><p><strong><em>Definition:</em></strong> An Add-On in Open Cluster Management is a mechanism that consists of an Addon Agent (running in managed clusters) and an Addon Manager (running in the hub cluster). It allows for the management of extensions that work with multiple clusters, providing a way to apply configurations and manage the lifecycle of resources across clusters by using the rollout strategy.</p><p><strong><em>Use Case:</em></strong> Use Add-Ons when you need to implement a more complex solution that requires ongoing management and configuration of resources across multiple clusters.</p><p><strong><em>Example:</em></strong> A tool that collects alert events from managed clusters and sends them to the hub cluster.</p><p><strong>Summary</strong></p><ul><li>ManifestWork is for single cluster resource management.</li><li>ManifestWorkReplicaSet is for managing resources across multiple clusters with defined rollout strategies.</li><li>Add-On is for implementing extensions that require ongoing management and configuration across multiple clusters, leveraging both an agent and a manager. Also provide the ability to control the addon&rsquo;s lifecycle with rollout strategy.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-0e10aa79b66ebaf60284768f9c0d59cf>9 - Security</h1><p>The Open Cluster Management (OCM) community welcomes and appreciates responsible disclosure of security vulnerabilities.</p><p>If you know of a security issue with OCM, please report it to <a href=mailto:OCM-security@googlegroups.com>OCM-security@googlegroups.com</a>.
The OCM project owners receive security disclosures by default.
They may share disclosures with others as required to make and propagate fixes.</p><p>The OCM community security reporting process follows the
<a href=https://kubernetes.io/docs/reference/issues-security/security/>Kubernetes security reporting process</a>
as standard.</p><h2 id=security-vulnerability-response>Security Vulnerability Response</h2><p>Each report is acknowledged and analyzed by OCM project owners within 5 working days.
This will set off the Security Release Process.</p><p>Any vulnerability information shared with OCM project owners stays within the OCM community
and will not be disseminated to other projects unless it is necessary to get the issue fixed.</p><p>As the security issue moves from triage, to identified fix, to release planning we will keep the reporter updated.</p><h2 id=security-release-process>Security Release Process</h2><p>Refer to the Kubernetes
<a href=https://github.com/kubernetes/committee-security-response/blob/main/security-release-process.md>Security Release Process</a>
for details on the security disclosures and response policy.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Slack aria-label=Slack><a target=_blank rel=noopener href=https://kubernetes.slack.com/channels/open-cluster-mgmt aria-label=Slack><i class="fab fa-slack"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Youtube aria-label=Youtube><a target=_blank rel=noopener href=https://www.youtube.com/c/OpenClusterManagement aria-label=Youtube><i class="fab fa-youtube"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Calendar aria-label=Calendar><a target=_blank rel=noopener href="https://calendar.google.com/calendar/u/0/embed?src=openclustermanagement@gmail.com" aria-label=Calendar><i class="fa fa-calendar"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/open-cluster-management-io aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Mail Group" aria-label="Mail Group"><a target=_blank rel=noopener href=https://groups.google.com/g/open-cluster-management aria-label="Mail Group"><i class="fa fa-envelope"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2020&ndash;2025
<span class=td-footer__authors>Open Cluster Management Authors. The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href=https://www.linuxfoundation.org/trademark-usage/>Trademark Usage</a> | Powered by <a href=https://www.netlify.com/>Netlify</a></span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.69e2c1ae9320465ab10236d9ef752c6a4442c54b48b883b17c497b7c7d96a796.js integrity="sha256-aeLBrpMgRlqxAjbZ73UsakRCxUtIuIOxfEl7fH2Wp5Y=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>