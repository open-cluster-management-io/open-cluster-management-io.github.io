<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://open-cluster-management.io/docs/scenarios/><link rel=alternate type=application/rss+xml href=https://open-cluster-management.io/docs/scenarios/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>User Scenarios | Open Cluster Management</title>
<meta name=description content="Open Cluster Management official site"><meta property="og:url" content="https://open-cluster-management.io/docs/scenarios/"><meta property="og:site_name" content="Open Cluster Management"><meta property="og:title" content="User Scenarios"><meta property="og:description" content="Open Cluster Management official site"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="User Scenarios"><meta itemprop=description content="Open Cluster Management official site"><meta itemprop=dateModified content="2024-09-20T07:13:55+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="User Scenarios"><meta name=twitter:description content="Open Cluster Management official site"><link rel=preload href=/scss/main.min.5b781ea478351b0ae6a4b76c09a1e12144a17c359d37b236b5f1b1970ed15522.css as=style><link href=/scss/main.min.5b781ea478351b0ae6a4b76c09a1e12144a17c359d37b236b5f1b1970ed15522.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 77.76 75.84"><defs><style>.cls-1{fill:none}.cls-2{fill:#fff}.cls-3{clip-path:url(#clip-path)}.cls-4{clip-path:url(#clip-path-2)}</style><clipPath id="clip-path" transform="translate(5.38 5.32)"><path class="cls-1" d="M67.11 39.69 61.34 14.61a4.48 4.48.0 00-2.42-3L35.55.44A4.52 4.52.0 0033.38.0a4.36 4.36.0 00-1.71.43L8.3 11.61a4.41 4.41.0 00-2.42 3L.11 39.7a4.37 4.37.0 00.61 3.39c.08.13.16.24.25.36L17.15 63.56a4.49 4.49.0 003.49 1.67H46.58a4.5 4.5.0 003.5-1.66L66.25 43.44A4.37 4.37.0 0067.11 39.69zM52.3 34.43a18.71 18.71.0 01-34.09 9.82c3.87-1.37 15.74-5.69 8.4-4.44A87.29 87.29.0 0116.1 41h-.42c-.57.0-1.13.0-1.67.0h-.37c-.54.0-1.07.0-1.58.0h-.31q-.77.0-1.47-.12c-2.78-.31-4.61-1.08-4.51-2.54.25-3.72 9.12-5.71 9.12-5.71a18.7 18.7.0 0134-9.82c-3.93 1.4-15.64 5.66-8.34 4.41a87.13 87.13.0 0110.5-1.16h.43 1.66.37q.82.0 1.59.0h.31c.51.0 1 .07 1.46.12 2.78.31 4.62 1.08 4.52 2.53C61.15 32.41 52.45 34.4 52.3 34.43z"/></clipPath><clipPath id="clip-path-2" transform="translate(5.38 5.32)"><rect class="cls-1" x="-5" y="-5" width="77.22" height="75.23"/></clipPath></defs><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path id="path3055" class="cls-2" d="M34.64 3.44a4.06 4.06.0 00-1.53.38l-20.91 10A4 4 0 0010 16.51L4.87 39a3.93 3.93.0 00.55 3 3.62 3.62.0 00.22.32l14.48 18a4 4 0 003.13 1.5H46.46a4 4 0 003.12-1.49l14.47-18A3.9 3.9.0 0064.82 39L59.66 16.5a4 4 0 00-2.17-2.69l-20.91-10A4 4 0 0034.64 3.44z" transform="translate(5.38 5.32)"/><g class="cls-3"><g class="cls-4"><image width="162" height="158" transform="scale(0.48)" xlink:href="data:image/png;base64,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"/></g></g></g></g></svg></span><span class=navbar-brand__name>Open Cluster Management</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=/docs/><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/community/><span>Community</span></a></li><li class=nav-item><a class=nav-link href=/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/open-cluster-management-io/ocm target=_blank rel=noopener><i class="fab fa-github"></i><span>GitHub</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Releases</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://open-cluster-management.io>main</a></li><li><a class=dropdown-item href=https://v0-16.open-cluster-management.io>v0.16</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.5240367ca69fafe579b22b0f25f014ae.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/scenarios/>Return to the regular view of this page</a>.</p></div><h1 class=title>User Scenarios</h1><ul><li>1: <a href=#pg-8e6e715e5d3149e708a441d8cda80620>Deploy Kubernetes resources to the managed clusters</a></li><li>2: <a href=#pg-f5520207f2d731962bdb209ff35b9606>Distribute workload with placement selected managed clusters</a></li><li>3: <a href=#pg-338e3de74358e29e5f426fed18dbbcd1>Extend the multicluster scheduling capabilities with placement</a></li><li>4: <a href=#pg-f272b8ffa037ea1ad801d9800b171b46>Extending managed clusters with custom attributes</a></li><li>5: <a href=#pg-6e0533c701ce88469bf1155ab6c497f9>Integration with Argo CD</a></li><li>6: <a href=#pg-86a38af7c2840a716dc25acad93066d1>Manage a cluster with multiple hubs</a></li><li>7: <a href=#pg-a248b9543af6136123ff241bf476fea3>Migrate workload with placement</a></li><li>8: <a href=#pg-7ca5dd580066fc69d90bf611a2fff868>Pushing Kubernetes API requests to the managed clusters</a></li><li>9: <a href=#pg-8272cdbbbcfeb7d32da1f7122d8d74fa>Register a cluster to hub through proxy server</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-8e6e715e5d3149e708a441d8cda80620>1 - Deploy Kubernetes resources to the managed clusters</h1><p>After bootstrapping an OCM environment of at least one managed clusters, now
it&rsquo;s time to begin your first journey of deploying Kubernetes resources into
your managed clusters with OCM&rsquo;s <code>ManifestWork</code> API.</p><h2 id=prerequisites>Prerequisites</h2><p>Before we get start with the following tutorial, let&rsquo;s clarify a few terms
we&rsquo;re going to use in the context.</p><ul><li><p><strong>Cluster namespace</strong>: After a managed cluster is successfully registered
into the hub. The hub registration controller will be automatically
provisioning a <code>cluster namespace</code> dedicated for the cluster of which the
name will be same as the managed cluster. The <code>cluster namespace</code> is used
for storing any custom resources/configurations that effectively belongs
to the managed cluster.</p></li><li><p><strong>ManifestWork</strong>: A custom resource in the hub cluster that groups a list
of kubernetes resources together and meant for dispatching them into the
managed cluster if the <code>ManifestWork</code> is created in a valid
<code>cluster namespace</code>, see details in this <a href=https://open-cluster-management.io/docs/concepts/work-distribution/manifestwork/>page</a>.</p></li></ul><h2 id=deploy-the-resource-to-a-target-cluster>Deploy the resource to a target cluster</h2><p>Now you can deploy a set of kubernetes resources defined in files to any clusters managed by the hub cluster.</p><p>Connect to your hub cluster and you have 2 options to create a <code>ManifestWork</code>:</p><ol><li><p>Use <code>clusteradm</code> command</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm create work my-first-work -f &lt;kubernetes yaml file or directory&gt; --clusters &lt;cluster name&gt;
</span></span></code></pre></div><p>where kubernetes yaml file should be kubernetes definitions, a sample:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>serviceAccountName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx:1.14.2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>containerPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li><li><p>Use <code>kubectl</code> to create the <code>ManifestWork</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f &lt;kubernetes yaml file or directory&gt;
</span></span></code></pre></div><p>where kubernetes yaml file should be kubernetes definitions wrapped by <code>ManifestWork</code>, a sample:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-first-work</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>serviceAccountName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx:1.14.2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span>- <span style=color:#204a87;font-weight:700>containerPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li></ol><p>The above command should create a <code>ManifestWork</code> in cluster namespace of your hub cluster. To see the detailed status of this <code>ManifestWork</code>, you can run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm get works my-first-work --cluster &lt;cluster name&gt;
</span></span></code></pre></div><p>If you have some change on the manifest files, you can apply the change to the targeted cluster by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm create work my-first-work -f &lt;kubernetes yaml file or directory&gt; --clusters &lt;cluster name&gt; --overwrite
</span></span></code></pre></div><p>To remove the resources deployed on the targeted cluster, run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete manifestwork my-first-work -n &lt;cluster name&gt;
</span></span></code></pre></div><h2 id=what-happens-behind-the-scene>What happens behind the scene</h2><p>Say we would like to deploy a nginx together with a service account into &ldquo;cluster1&rdquo;.
A <code>ManifestWork</code> can be defined as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManifestWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-first-work</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>serviceAccountName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx:1.14.2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span>- <span style=color:#204a87;font-weight:700>containerPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In this example:</p><ul><li><p>A <code>ManifestWork</code> named &ldquo;my-first-work&rdquo; will be created into a
&ldquo;cluster namespace&rdquo; named &ldquo;cluster1&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get manifestwork -A --context kind-hub
</span></span><span style=display:flex><span>NAMESPACE   NAME            AGE
</span></span><span style=display:flex><span>cluster1    my-first-work   2m59s
</span></span></code></pre></div></li><li><p>The resources in the <code>ManifestWork</code> including a service-account, a deployment
will be created to the cluster &ldquo;cluster1&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get deployment --context kind-cluster1
</span></span><span style=display:flex><span>NAME               READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>nginx-deployment   3/3     <span style=color:#0000cf;font-weight:700>3</span>            <span style=color:#0000cf;font-weight:700>3</span>           4m10s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl get sa my-sa --context kind-cluster1
</span></span><span style=display:flex><span>NAME    SECRETS   AGE
</span></span><span style=display:flex><span>my-sa   <span style=color:#0000cf;font-weight:700>1</span>         4m23s
</span></span></code></pre></div></li><li><p>In the status of <code>ManifestWork</code> we can check out the aggregated status
indicating whether the prescribed resources are successfully deployed by the
conditions in the field <code>.status.conditions[*]</code>:</p><ul><li><code>Applied</code>: Whether <strong>all</strong> the resources from the spec are successfully
applied since the last observed generation of <code>ManifestWork</code>.</li><li><code>Available</code>: Whether <strong>all</strong> the resources from the spec are existing in
the target managed cluster.</li></ul></li><li><p>Beside the aggregated status, the <code>ManifestWork</code> is also tracking the
per-resource status under <code>.status.resourceStatus[*]</code> where we can
discriminate different resource types via the
<code>.status.resourceStatus[*].resourceMeta</code> field. e.g.:</p></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>resourceStatus</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2021-11-25T10:17:43Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Apply manifest complete</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AppliedManifestComplete</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Applied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2021-11-25T10:17:43Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Resource is available</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceAvailable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Available</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resourceMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>ordinal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deployments</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>If possible, you can also switch the context of your kubeconfig to &ldquo;cluster1&rdquo;
to check out the new resources delivered by <code>ManifestWork</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl --context kind-cluster1 get pod
</span></span><span style=display:flex><span>NAME                                READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>nginx-deployment-556c5468f7-d5h2m   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          33m
</span></span><span style=display:flex><span>nginx-deployment-556c5468f7-gf574   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          33m
</span></span><span style=display:flex><span>nginx-deployment-556c5468f7-hhmjf   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          33m
</span></span></code></pre></div><h3 id=updating-the-manifestwork>Updating the ManifestWork</h3><p>Any updates applied to the <code>ManifestWork</code> are expected to take effect
immediately as long as the work agent deployed in the managed cluster
are healthy and actively in touch with the hub cluster.</p><p>The work agent will be dynamically computing a hash
from the prescribed resources, and a corresponding <code>AppliedManifestWork</code>
of which the name contains the hash value will be persisted to the managed
cluster and replacing the previously persisted <code>AppliedManifestWork</code>
connected to the same <code>ManifestWork</code> after the latest resources are applied.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl --context kind-cluster1 get appliedmanifestwork
</span></span><span style=display:flex><span>NAME                                                                                                   AGE
</span></span><span style=display:flex><span>ed59251487ad4e4465fa2990b36a1cc398b83e63b59fa16b83591f5afdc3dd6d-my-first-work                  59m
</span></span></code></pre></div><p>Note that if the work agent was disconnected from the hub control plane for
a period of time and missed the new updates upon <code>ManifestWork</code>. The work
agent will be catching up the latest state of <code>ManifestWork</code> as soon as it
re-connects.</p><h3 id=deleting-the-manifestwork>Deleting the ManifestWork</h3><p>The local resources deployed in the managed cluster should be cleaned up upon
receiving the deletion event from the corresponding <code>ManifestWork</code>. The resource
<code>ManifestWork</code> in the hub cluster will be protected by the finalizer named:</p><ul><li>&ldquo;cluster.open-cluster-management.io/manifest-work-cleanup&rdquo;</li></ul><p>It will be removed if the corresponding <code>AppliedManifestWork</code> is gracefully
removed from the managed cluster. Meanwhile, the <code>AppliedManifestWork</code> resource
is also protected by another finalizer named:</p><ul><li>&ldquo;cluster.open-cluster-management.io/applied-manifest-work-cleanup&rdquo;</li></ul><p>This finalizer is supposed to be detached after the deployed local resources
are <em>completely</em> removed from the manged cluster. With that being said, if any
deployed local resources are holding at the &ldquo;Terminating&rdquo; due to graceful
deletion. Both of its <code>ManifestWork</code> and <code>AppliedManifestWork</code> should stay
undeleted.</p><h2 id=troubleshoot>Troubleshoot</h2><p>In case of run into any unexpected failures,
you can make sure your environment by checking the following conditions:</p><ul><li><p>The CRD <code>ManifestWork</code> is installed in the hub cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get crd manifestworks.work.open-cluster-management.io
</span></span></code></pre></div></li><li><p>The CRD <code>AppliedManifestWork</code> is installed in the managed cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get crd appliedmanifestworks.work.open-cluster-management.io
</span></span></code></pre></div></li><li><p>The work agent is successfully running in the managed cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n open-cluster-management-agent get pod
</span></span><span style=display:flex><span>NAME                                             READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>klusterlet-registration-agent-598fd79988-jxx7n   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          20d
</span></span><span style=display:flex><span>klusterlet-work-agent-7d47f4b5c5-dnkqw           1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          20d
</span></span></code></pre></div></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f5520207f2d731962bdb209ff35b9606>2 - Distribute workload with placement selected managed clusters</h1><p>The <code>Placement</code> API is used to dynamically select a set of <code>ManagedCluster</code> in
one or multiple <code>ManagedClusterSets</code> so that the workloads can be deployed to
these clusters.</p><p>If you define a valid <code>Placement</code>, the placement controller generates a
corresponding <code>PlacementDecision</code> with the selected clusters listed in the
status. As an end-user, you can parse the selected clusters and then operate on
the target clusters. You can also integrate a high-level workload orchestrator
with the <code>PlacementDecision</code> to leverage its scheduling capabilities.</p><p>For example, with OCM addon <a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/>policy</a>
installed, a <code>Policy</code> that includes a <code>Placement</code> mapping can distribute the
<code>Policy</code> to the managed clusters.
For details see this <a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/configuration-policy/#placement-api>example</a>.</p><p>Some popular open source projects also integrate with the <code>Placement</code> API. For
example <a href=https://github.com/argoproj/argo-cd>Argo CD</a>, it can leverage the
generated <code>PlacementDecision</code> to drive the assignment of Argo CD Applications to a
desired set of clusters, details see this <a href=https://github.com/argoproj/argo-cd/tree/master/applicationset/examples/clusterDecisionResource>example</a>.
And <a href=https://github.com/kubevela/kubevela>KubeVela</a>, as an implementation of
the open application model, also will take advantage of the <code>Placement</code> API for
workload scheduling.</p><p>And in this article, we want to show you how to use <code>clusteradm</code> to deploy
<code>ManifestWork</code> to <code>Placement</code> selected clusters.</p><h2 id=prerequisites>Prerequisites</h2><p>Before starting with the following steps, suggest you understand the content below.</p><ul><li><p><a href=https://open-cluster-management.io/docs/concepts/content-placement/placement/><strong>Placement</strong></a>:
The <code>Placement</code> API is used to dynamically select a set of <a href=https://open-cluster-management.io/docs/concepts/cluster-inventory/managedcluster/><code>ManagedCluster</code></a>
in one or multiple <a href=https://open-cluster-management.io/docs/concepts/cluster-inventory/managedclusterset/><code>ManagedClusterSets</code></a>
so that higher-level users can either replicate Kubernetes resources to the
member clusters or run their advanced workload i.e. multi-cluster scheduling.</p></li><li><p><a href=https://open-cluster-management.io/docs/concepts/work-distribution/manifestwork/><strong>ManifestWork</strong></a>:
A custom resource in the hub cluster that groups a list of Kubernetes resources
together and is meant for dispatching them into the managed cluster if the
<code>ManifestWork</code> is created in a valid <code>cluster namespace</code>.</p></li></ul><h2 id=deploy-manifestwork-to-placement-selected-managed-clusters>Deploy manifestwork to placement selected managed clusters</h2><p>In <a href=https://open-cluster-management.io/docs/scenarios/deploy-kubernetes-resources/>deploy Kubernetes resources to the managed clusters</a>,
it shows you how to use <code>clusteradm</code> to create a <code>ManifestWork</code> and deploy it
onto a specific managed clusters. As <code>Placement</code> can dynamically select a set of
<code>ManagedCluster</code>, the next steps will show you how <code>clusteradm</code> leverages
placement scheduling ability and dynamically deploy <code>ManifestWork</code> to a set of
managed clusters.</p><ol><li><p>Following <a href=https://github.com/open-cluster-management-io/OCM/tree/main/solutions/setup-dev-environment>setup dev environment by kind</a>
to prepare an environment.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -sSL https://raw.githubusercontent.com/open-cluster-management-io/OCM/main/solutions/setup-dev-environment/local-up.sh <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div></li><li><p>Confirm there are 2 <code>ManagedCluster</code> and a default <code>ManagedClusterSet</code> created.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm get clusters
</span></span><span style=display:flex><span>NAME       ACCEPTED   AVAILABLE   CLUSTERSET   CPU   MEMORY       KUBERNETES VERSION
</span></span><span style=display:flex><span>cluster1   <span style=color:#204a87>true</span>       True        default      <span style=color:#0000cf;font-weight:700>24</span>    49265496Ki   v1.23.4
</span></span><span style=display:flex><span>cluster2   <span style=color:#204a87>true</span>       True        default      <span style=color:#0000cf;font-weight:700>24</span>    49265496Ki   v1.23.4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ clusteradm get clustersets
</span></span><span style=display:flex><span>NAME      BOUND NAMESPACES   STATUS
</span></span><span style=display:flex><span>default                      <span style=color:#0000cf;font-weight:700>2</span> ManagedClusters selected
</span></span></code></pre></div></li><li><p>Bind the default <code>ManagedClusterSet</code> to default <code>Namespace</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm clusterset <span style=color:#204a87>bind</span> default --namespace default
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm get clustersets
</span></span><span style=display:flex><span>NAME      BOUND NAMESPACES   STATUS
</span></span><span style=display:flex><span>default   default            <span style=color:#0000cf;font-weight:700>2</span> ManagedClusters selected
</span></span></code></pre></div><p>Note: click <a href=https://open-cluster-management.io/concepts/managedclusterset/#operates-managedclusterset-using-clusteradm>here</a>
to see more details about how to operate <code>ManagedClusterSet</code> using <code>clusteradm</code>.</p></li><li><p>Create a <code>Placement</code> placement1 to select the two clusters in default <code>ManagedClusterSet</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: cluster.open-cluster-management.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Placement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: placement1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: default
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  numberOfClusters: 2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  clusterSets:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - default
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div></li><li><p>Use <code>clusteradm</code> command to create <code>ManifestWork</code> my-first-work with
<code>Placement</code> placement1.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm create work my-first-work -f work.yaml --placement default/placement1
</span></span></code></pre></div><p>The <code>work.yaml</code> contains kubernetes resource definitions, for sample:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: ServiceAccount
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  namespace: default
</span></span><span style=display:flex><span>  name: my-sa
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>apiVersion: apps/v1
</span></span><span style=display:flex><span>kind: Deployment
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  namespace: default
</span></span><span style=display:flex><span>  name: nginx-deployment
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    app: nginx
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  replicas: <span style=color:#0000cf;font-weight:700>3</span>
</span></span><span style=display:flex><span>  selector:
</span></span><span style=display:flex><span>    matchLabels:
</span></span><span style=display:flex><span>      app: nginx
</span></span><span style=display:flex><span>  template:
</span></span><span style=display:flex><span>    metadata:
</span></span><span style=display:flex><span>      labels:
</span></span><span style=display:flex><span>        app: nginx
</span></span><span style=display:flex><span>    spec:
</span></span><span style=display:flex><span>      serviceAccountName: my-sa
</span></span><span style=display:flex><span>      containers:
</span></span><span style=display:flex><span>        - name: nginx
</span></span><span style=display:flex><span>          image: nginx:1.14.2
</span></span><span style=display:flex><span>          ports:
</span></span><span style=display:flex><span>            - containerPort: <span style=color:#0000cf;font-weight:700>80</span>
</span></span></code></pre></div></li><li><p>Check the <code>ManifestWork</code>, it should be distributed to both cluster1 and cluster2.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get manifestwork -A
</span></span><span style=display:flex><span>NAMESPACE   NAME            AGE
</span></span><span style=display:flex><span>cluster1    my-first-work   28s
</span></span><span style=display:flex><span>cluster2    my-first-work   28s
</span></span></code></pre></div></li><li><p>Update the <code>Placement</code> placement1 to select only one managed cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl patch placement placement1 --patch <span style=color:#4e9a06>&#39;{&#34;spec&#34;: {&#34;clusterSets&#34;: [&#34;default&#34;],&#34;numberOfClusters&#34;: 1}}&#39;</span> --type<span style=color:#ce5c00;font-weight:700>=</span>merge
</span></span></code></pre></div></li><li><p>As the placement decision changes, running below command to reschedule
<code>ManifestWork</code> my-first-work to the newly selected cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>clusteradm create work my-first-work -f work.yaml --placement default/placement1 --overwrite
</span></span></code></pre></div></li><li><p>Check the <code>ManifestWork</code> again, now it&rsquo;s only deployed to cluster1.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get manifestwork -A
</span></span><span style=display:flex><span>NAMESPACE   NAME            AGE
</span></span><span style=display:flex><span>cluster1    my-first-work   18m
</span></span></code></pre></div></li></ol><h2 id=what-happens-behind-the-scene>What happens behind the scene</h2><p>The main idea is that <code>clusteradm</code> parse the selected clusters generated by
<code>Placement</code>, and fill in that as <code>ManifestWork</code> namespace. Then create the
<code>ManifestWork</code> and it would be distributed to a set of clusters.
Let&rsquo;s see more details.</p><ol><li><p><code>Placement</code> placement1 generates a <code>PlacementDecision</code> placement1-decision-1.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get placementdecision -n default -l cluster.open-cluster-management.io/placement<span style=color:#ce5c00;font-weight:700>=</span>placement1 -oyaml
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>items:
</span></span><span style=display:flex><span>- apiVersion: cluster.open-cluster-management.io/v1beta1
</span></span><span style=display:flex><span>  kind: PlacementDecision
</span></span><span style=display:flex><span>  metadata:
</span></span><span style=display:flex><span>    creationTimestamp: <span style=color:#4e9a06>&#34;2022-07-06T15:03:12Z&#34;</span>
</span></span><span style=display:flex><span>    generation: <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    labels:
</span></span><span style=display:flex><span>      cluster.open-cluster-management.io/placement: placement1
</span></span><span style=display:flex><span>    name: placement1-decision-1
</span></span><span style=display:flex><span>    namespace: default
</span></span><span style=display:flex><span>    ownerReferences:
</span></span><span style=display:flex><span>    - apiVersion: cluster.open-cluster-management.io/v1beta1
</span></span><span style=display:flex><span>      blockOwnerDeletion: <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>      controller: <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>      kind: Placement
</span></span><span style=display:flex><span>      name: placement1
</span></span><span style=display:flex><span>      uid: aa339f57-0eb7-4260-8d4d-f30c1379fd35
</span></span><span style=display:flex><span>    resourceVersion: <span style=color:#4e9a06>&#34;47679&#34;</span>
</span></span><span style=display:flex><span>    uid: 9f948619-1647-429d-894d-81e11dd8bcf1
</span></span><span style=display:flex><span>  status:
</span></span><span style=display:flex><span>    decisions:
</span></span><span style=display:flex><span>    - clusterName: cluster1
</span></span><span style=display:flex><span>      reason: <span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span>    - clusterName: cluster2
</span></span><span style=display:flex><span>      reason: <span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span>kind: List
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  resourceVersion: <span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span>  selfLink: <span style=color:#4e9a06>&#34;&#34;</span>
</span></span></code></pre></div></li><li><p><code>clusteradm</code> get the <code>PlacementDecision</code> generated by <code>Placement</code>
placement1 with label <code>cluster.open-cluster-management.io/placement: placement1</code>,
reference <a href=https://github.com/open-cluster-management-io/clusteradm/pull/247/files#diff-0f96f91e259a6a6ce0f2231444a4991174b43bc206d34897be3be897279124eaR157>code</a>.
Then parse the clusterName cluster1 and cluster2, fill in that as <code>ManifestWork</code>
namespace, reference <a href=https://github.com/open-cluster-management-io/clusteradm/pull/247/files#diff-0f96f91e259a6a6ce0f2231444a4991174b43bc206d34897be3be897279124eaR183>code</a>.
Then installs <code>ManifestWork</code> to namespace cluster1 and cluster2,
which will finally be distributed to the two clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get manifestwork -A
</span></span><span style=display:flex><span>NAMESPACE   NAME            AGE
</span></span><span style=display:flex><span>cluster1    my-first-work   28s
</span></span><span style=display:flex><span>cluster2    my-first-work   28s
</span></span></code></pre></div></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-338e3de74358e29e5f426fed18dbbcd1>3 - Extend the multicluster scheduling capabilities with placement</h1><p>The <code>Placement</code> API is used to dynamically select a set of <code>ManagedCluster</code> in one or multiple <code>ManagedClusterSets</code> so that the workloads can be deployed to these clusters. You can use placement to filter clusters by label or claim selector, also placement provides some default prioritizers which can be used to sort and select the most suitable clusters.</p><p>One of the default prioritizers are ResourceAllocatableCPU and ResourceAllocatableMemory. They provide the capability to sort clusters based on the allocatable CPU and memory. However, when considering the resource based scheduling, there&rsquo;s a gap that the cluster’s &ldquo;AllocatableCPU&rdquo; and &ldquo;AllocatableMemory&rdquo; are static values that won’t change even if &ldquo;the cluster is running out of resources&rdquo;. And in some cases, the prioritizer needs more extra data to calculate the score of the managed cluster. For example, there is a requirement to schedule based on resource monitoring data from the cluster. For this reason, we need a more extensible way to support scheduling based on customized scores.</p><h2 id=what-is-placement-extensible-scheduling>What is Placement extensible scheduling?</h2><p>OCM placement introduces an API <code>AddOnPlacementScore</code> to support scheduling based on customized scores. This API supports storing the customized scores and being used by placement. Details of the API&rsquo;s definition refer to <a href=https://github.com/open-cluster-management-io/api/blob/main/cluster/v1alpha1/types_addonplacementscore.go>types_addonplacementscore.go</a>. An example of <code>AddOnPlacementScore</code> is as below.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnPlacementScore</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2021-10-28T08:31:39Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnPlacementScore updated successfully</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnPlacementScoreUpdated</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnPlacementScoreUpdated</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>validUntil</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2021-10-29T18:31:39Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>scores</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;cpuAvailable&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>66</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;memAvailable&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>55</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li><code>conditions</code>. Conditions contain the different condition statuses for this <code>AddOnPlacementScore</code>.</li><li><code>validUntil</code>. ValidUntil defines the valid time of the scores. After this time, the scores are considered to be invalid by placement. nil means never expire. The controller owning this resource should keep the scores up-to-date.</li><li><code>scores</code>. Scores contain a list of score names and values of this managed cluster. In the above example, the API contains a list of customized scores: cpuAvailable and memAvailable.</li></ul><p>All the customized scores information is stored in <code>status</code>, as we don&rsquo;t expect end users to update it.</p><ul><li>As a score provider, a 3rd party controller could run on either hub or managed cluster, to maintain the lifecycle of <code>AddOnPlacementScore</code> and update the score into the <code>status</code>.</li><li>As an end user, you need to know the resource name &ldquo;default&rdquo; and customized score name &ldquo;cpuAvailable"and &ldquo;memAvailable&rdquo; , so you can specify the name in placement yaml to select clusters. For example, the below placement wants to select the top 3 clusters with the highest cpuAvailable score.<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ns1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>prioritizerPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exact</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>configurations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>scoreCoordinate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>addOn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>resourceName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>scoreName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cpuAvailable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li><li>In placement, if the end-user defines the scoreCoordinate type as AddOn, the placement controller will get the <code>AddOnPlacementScore</code> resource with the name &ldquo;default&rdquo; in each cluster&rsquo;s namespace, read score &ldquo;cpuAvailable&rdquo; in the score list, and use that score to sort clusters.</li></ul><p>You can refer to the <a href=https://github.com/open-cluster-management-io/enhancements/blob/main/enhancements/sig-architecture/32-extensiblescheduling/32-extensiblescheduling.md>enhancements</a> to learn more details about the design. In the design, how to maintain the lifecycle (create/update/delete) of the <code>AddOnPlacementScore</code> CRs is not covered, as we expect the customized score provider itself to manage it. In this article, we will use an example to show you how to implement a 3rd part controller to update your own scores and extend the multiple clusters scheduling capability with your own scores.</p><h2 id=how-to-implement-a-customized-score-provider>How to implement a customized score provider</h2><p>The example code is in GitHub repo <a href=https://github.com/open-cluster-management-io/addon-contrib/tree/main/resource-usage-collect-addon>resource-usage-collect-addon</a>. It provides the score of the cluster&rsquo;s available CPU and available memory, which can reflect the cluster’s real-time resource utilization. It is developed with OCM <a href=https://github.com/open-cluster-management-io/addon-framework>addon-framework</a> and can be installed as an addon plugin to update customized scores into <code>AddOnPlacementScore</code>. (This article won&rsquo;t talk many details about addon-framework, referring to <a href=https://open-cluster-management.io/docs/developer-guides/addon/>Add-on Developer Guide</a> to learn how to develop an addon.)</p><p>The resource-usage-collect addon follows the hub-agent architecture as below.</p><div style=text-align:center;padding:20px><img src=/extend-multicluster-scheduling-capabilities.png alt="Security model" style="margin:0 auto;width:60%"></div><p>The resource-usage-collect addon contains a controller and an agent.</p><ul><li>On the hub cluster, the resource-usage-collect-controller is running. It is responsible for creating the <code>ManifestWork</code> for resource-usage-collect-agent in each cluster namespace.</li><li>On each managed cluster, the work agent watches the <code>ManifestWork</code> and installs the resource-usage-collect-agent on each cluster. The resource-usage-collect-agent is the core part of this addon, it creates the <code>AddonPlacementScore</code> for each cluster on the Hub cluster, and refreshes the <code>scores</code> and <code>validUntil</code> every 60 seconds.</li></ul><p>When the <code>AddonPlacementScore</code> is ready, the end user can specify the customized core in a placement to select clusters.</p><p>The working flow and logic of resource-usage-collect addon are quite easy to understand. Now let&rsquo;s follow the below steps to get started!</p><p><strong>Prepare an OCM environment with 2 <code>ManagedClusters</code>.</strong></p><ol><li>Following <a href=https://github.com/open-cluster-management-io/OCM/tree/main/solutions/setup-dev-environment>setup dev environment by kind</a> to prepare an environment.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -sSL https://raw.githubusercontent.com/open-cluster-management-io/OCM/main/solutions/setup-dev-environment/local-up.sh <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><ol start=2><li>Confirm there are 2 <code>ManagedCluster</code> and a default <code>ManagedClusterSet</code> created.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ clusteradm get clusters
</span></span><span style=display:flex><span>NAME       ACCEPTED   AVAILABLE   CLUSTERSET   CPU   MEMORY       KUBERNETES VERSION
</span></span><span style=display:flex><span>cluster1   <span style=color:#204a87>true</span>       True        default      <span style=color:#0000cf;font-weight:700>24</span>    49265496Ki   v1.23.4
</span></span><span style=display:flex><span>cluster2   <span style=color:#204a87>true</span>       True        default      <span style=color:#0000cf;font-weight:700>24</span>    49265496Ki   v1.23.4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ clusteradm get clustersets
</span></span><span style=display:flex><span>NAME      BOUND NAMESPACES   STATUS
</span></span><span style=display:flex><span>default                      <span style=color:#0000cf;font-weight:700>2</span> ManagedClusters selected
</span></span></code></pre></div><ol start=3><li>Bind the default <code>ManagedClusterSet</code> to default <code>Namespace</code>.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>clusteradm clusterset <span style=color:#204a87>bind</span> default --namespace default
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ clusteradm get clustersets
</span></span><span style=display:flex><span>NAME      BOUND NAMESPACES   STATUS
</span></span><span style=display:flex><span>default   default            <span style=color:#0000cf;font-weight:700>2</span> ManagedClusters selected
</span></span></code></pre></div><p><strong>Install the resource-usage-collect addon.</strong></p><ol><li>Git clone the source code.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone git@github.com:open-cluster-management-io/addon-contrib.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> addon-contrib/resource-usage-collect-addon
</span></span></code></pre></div><ol start=2><li>Prepare the image.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Set image name, this is an optional step.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>IMAGE_NAME</span><span style=color:#ce5c00;font-weight:700>=</span>quay.io/haoqing/resource-usage-collect-addon:latest
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Build image</span>
</span></span><span style=display:flex><span>make images
</span></span></code></pre></div><p>If your are using kind, load image into kind cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kind load docker-image <span style=color:#000>$IMAGE_NAME</span> --name &lt;cluster_name&gt; <span style=color:#8f5902;font-style:italic># kind load docker-image $IMAGE_NAME --name hub</span>
</span></span></code></pre></div><ol start=3><li>Deploy the resource-usage-collect addon.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make deploy
</span></span></code></pre></div><ol start=4><li>Verify the installation.</li></ol><p>On the hub cluster, verify the resource-usage-collect-controller pod is running.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get pods -n open-cluster-management <span style=color:#000;font-weight:700>|</span> grep resource-usage-collect-controller
</span></span><span style=display:flex><span>resource-usage-collect-controller-55c58bbc5-t45dh   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          71s
</span></span></code></pre></div><p>On the hub cluster, verify the <code>AddonPlacementScore</code> is generated for each managed cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get addonplacementscore -A
</span></span><span style=display:flex><span>NAMESPACE   NAME                   AGE
</span></span><span style=display:flex><span>cluster1    resource-usage-score   3m23s
</span></span><span style=display:flex><span>cluster2    resource-usage-score   3m24s
</span></span></code></pre></div><p>The <code>AddonPlacementScore</code> status should contain a list of scores as below.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get addonplacementscore -n cluster1 resource-usage-score -oyaml
</span></span><span style=display:flex><span>apiVersion: cluster.open-cluster-management.io/v1alpha1
</span></span><span style=display:flex><span>kind: AddOnPlacementScore
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  creationTimestamp: <span style=color:#4e9a06>&#34;2022-08-08T06:46:04Z&#34;</span>
</span></span><span style=display:flex><span>  generation: <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>  name: resource-usage-score
</span></span><span style=display:flex><span>  namespace: cluster1
</span></span><span style=display:flex><span>  resourceVersion: <span style=color:#4e9a06>&#34;3907&#34;</span>
</span></span><span style=display:flex><span>  uid: 6c4280e4-38be-4d45-9c73-c18c84799781
</span></span><span style=display:flex><span>status:
</span></span><span style=display:flex><span>  scores:
</span></span><span style=display:flex><span>  - name: cpuAvailable
</span></span><span style=display:flex><span>    value: <span style=color:#0000cf;font-weight:700>12</span>
</span></span><span style=display:flex><span>  - name: memAvailable
</span></span><span style=display:flex><span>    value: <span style=color:#0000cf;font-weight:700>4</span>
</span></span></code></pre></div><p>If <code>AddonPlacementScore</code> is not created or there are no scores in the status, go into the managed cluster, and check if the resource-usage-collect-agent pod is running well.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get pods -n default <span style=color:#000;font-weight:700>|</span> grep resource-usage-collect-agent
</span></span><span style=display:flex><span>resource-usage-collect-agent-5b85cbf848-g5kqm   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          2m
</span></span></code></pre></div><p><strong>Select clusters with the customized scores.</strong></p><p>If everything is running well, now you can try to create placement and select clusters with the customized scores.</p><ol><li>Create a placement to select 1 cluster with the highest cpuAvailable score.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: cluster.open-cluster-management.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Placement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: placement1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: default
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  numberOfClusters: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  clusterSets:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - default
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  prioritizerPolicy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    mode: Exact
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    configurations:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      - scoreCoordinate:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          type: AddOn
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          addOn:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            resourceName: resource-usage-score
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            scoreName: cpuAvailable
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        weight: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><ol start=2><li>Verify the placement decision.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl describe placementdecision -n default <span style=color:#000;font-weight:700>|</span> grep Status -A <span style=color:#0000cf;font-weight:700>3</span>
</span></span><span style=display:flex><span>Status:
</span></span><span style=display:flex><span>  Decisions:
</span></span><span style=display:flex><span>    Cluster Name:  cluster1
</span></span><span style=display:flex><span>    Reason:
</span></span></code></pre></div><p>Cluster1 is selected by <code>PlacementDecision</code>.</p><p>Running below command to get the customized score in <code>AddonPlacementScore</code> and the cluster score set by <code>Placement</code>.
You can see that the &ldquo;cpuAvailable&rdquo; score is 12 in <code>AddonPlacementScore</code>, and this value is also the cluster score in <code>Placement</code> events, this indicates that placement is using the customized score to select clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get addonplacementscore -A -o<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{range .items[*]}{.metadata.namespace}{&#34;\t&#34;}{.status.scores}{&#34;\n&#34;}{end}&#39;</span>
</span></span><span style=display:flex><span>cluster1        <span style=color:#ce5c00;font-weight:700>[{</span><span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;cpuAvailable&#34;</span>,<span style=color:#4e9a06>&#34;value&#34;</span>:12<span style=color:#ce5c00;font-weight:700>}</span>,<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;memAvailable&#34;</span>,<span style=color:#4e9a06>&#34;value&#34;</span>:4<span style=color:#ce5c00;font-weight:700>}]</span>
</span></span><span style=display:flex><span>cluster2        <span style=color:#ce5c00;font-weight:700>[{</span><span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;cpuAvailable&#34;</span>,<span style=color:#4e9a06>&#34;value&#34;</span>:12<span style=color:#ce5c00;font-weight:700>}</span>,<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;memAvailable&#34;</span>,<span style=color:#4e9a06>&#34;value&#34;</span>:4<span style=color:#ce5c00;font-weight:700>}]</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl describe placement -n default placement1 <span style=color:#000;font-weight:700>|</span> grep Events -A <span style=color:#0000cf;font-weight:700>10</span>
</span></span><span style=display:flex><span>Events:
</span></span><span style=display:flex><span>  Type    Reason          Age   From                 Message
</span></span><span style=display:flex><span>  ----    ------          ----  ----                 -------
</span></span><span style=display:flex><span>  Normal  DecisionCreate  50s   placementController  Decision placement1-decision-1 is created with placement placement1 in namespace default
</span></span><span style=display:flex><span>  Normal  DecisionUpdate  50s   placementController  Decision placement1-decision-1 is updated with placement placement1 in namespace default
</span></span><span style=display:flex><span>  Normal  ScoreUpdate     50s   placementController  cluster1:12 cluster2:12
</span></span></code></pre></div><p>Now you know how to install the resource-usage-collect addon and consume the customized score to select clusters. Next, let&rsquo;s take a deeper look into some key points when you consider implementing a customized score provider.</p><h3 id=1-where-to-run-the-customized-score-provider>1. Where to run the customized score provider</h3><p>The customized score provider could run on either hub or managed cluster. Combined with user stories, you should be able to distinguish whether the controller should be placed in a hub or a managed cluster.</p><p>In our example, the customized score provider is developed with <a href=https://github.com/open-cluster-management-io/addon-framework>addon-famework</a>, it follows the hub-agent architecture. The resource-usage-collect-agent is the real score provider, it is installed on each managed cluster, it gets the available CPU and memory of the managed cluster, calculates a score, and updates it into <code>AddonPlacementScore</code>. The resource-usage-collect-controller just takes care of installing the agent.</p><p>In other cases, for example, if you want to use the metrics from Thanos to calculate a score for each cluster, then the customized score provider only needs to be placed on the hub, as Thanos has all the metrics collected from each managed cluster.</p><h3 id=2-how-to-maintain-the-addonplacementscore-cr-lifecycle>2. How to maintain the AddOnPlacementScore CR lifecycle</h3><p>In our example, the code to maintain the <code>AddOnPlacementScore</code> CR is in <a href=https://github.com/open-cluster-management-io/addon-contrib/blob/main/resource-usage-collect-addon/pkg/addon/agent/agent.go>pkg/addon/agent/agent.go</a>.</p><ul><li><p>When should the score be created?</p><p>The <code>AddOnPlacementScore</code> CR can be created with the existence of a ManagedCluster, or on demand for the purpose of reducing objects on the hub.</p><p>In our example, the addon creates an <code>AddOnPlacementScore</code> for each Managed Cluster if it does not exist, and a score will be calculated when creating the CR for the first time.</p></li><li><p>When should the score be updated?</p><p>We recommend that you set <code>ValidUntil</code> when updating the score so that the placement controller can know if the score is still valid in case it failed to update for a long time.</p><p>The score could be updated when your monitoring data changes, or at least you need to update it before it expires.</p><p>In our example, in addition to recalculate and update the score every 60 seconds, the update will also be triggered when the node or pod resource in the managed cluster changes.</p></li></ul><h3 id=3-how-to-calculate-the-score>3. How to calculate the score</h3><p>The code to calculate the score is in <a href=https://github.com/open-cluster-management-io/addon-contrib/blob/main/resource-usage-collect-addon/pkg/addon/agent/calculate.go>pkg/addon/agent/calculate.go</a>. A valid score must be in the range -100 to 100, you need to normalize the scores before updating it into <code>AddOnPlacementScore</code>.</p><p>When normalizing the score, you might meet the below cases.</p><ul><li><p>The score provider knows the max and min value of the customized scores.</p><p>In this case, it is easy to achieve smooth mapping by formula. Suppose the actual value is X, and X is in the interval [min, max], then <code>score ＝ 200 * (x - min) / (max - min) - 100</code> .</p></li><li><p>The score provider doesn&rsquo;t know the max and min value of the customized scores.</p><p>In this case, you need to set a maximum and minimum value by yourself, as without a max and min value, is unachievable to map a single value X to the range [-100, 100].</p><p>Then when the X is greater than this maximum value, the cluster can be considered healthy enough to deploy applications, and the score can be set as 100. And if X is less than the minimum value, the score can be set as -100.</p><pre tabindex=0><code>if X &gt;= max
  score = 100
if X &lt;= min
  score = -100
</code></pre></li></ul><p>In our example, the resource-usage-collect-agent running on each managed cluster doesn&rsquo;t have a whole picture view to know the max/min value of CPU/memory usage of all the clusters, so we manually set the max value as <code>MAXCPUCOUNT</code> and <code>MAXMEMCOUNT</code> in code, min value is set as 0. The score calculation formula can be simplified: <code>score = x / max * 100</code>.</p><h2 id=summary>Summary</h2><p>In this article, we introduced what is the placement extensible scheduling and used an example to show how to implement a customized score provider. Also, this article list 3 key points the developer needs to consider when implementing a 3rd party score provider. Hope after reading this article, you can have a clear view of how placement extensible scheduling can help you extend the multicluster scheduling capabilities.</p><p>Feel free to raise your question in the <a href=https://github.com/open-cluster-management-io/OCM/issues>Open-cluster-management-io GitHub community</a> or contact us using <a href=https://kubernetes.slack.com/channels/open-cluster-mgmt>Slack</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f272b8ffa037ea1ad801d9800b171b46>4 - Extending managed clusters with custom attributes</h1><p>Under some cases we need a convenient way to extend OCM&rsquo;s <a href=https://open-cluster-management.io/docs/concepts/cluster-inventory/managedcluster/>Managed Cluster</a>
data model so that our own custom multi-cluster system can easily work over the
OCM&rsquo;s native cluster api otherwise we will have to maintain an additional
Kubernetes&rsquo; <a href=https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/>CustomResourceDefinition</a>
in the project. OCM definitely supports developers to decorate the cluster api
with minimal effort, and in the following content we will walk through that
briefly.</p><p>The original cluster model in OCM &ldquo;Managed Cluster&rdquo; is designed to be a
<strong>neat</strong> and <strong>light-weight</strong> placeholder resource of which the spec doesn&rsquo;t
require any additional information other than &ldquo;whether the cluster is
accepted or not&rdquo; i.e. <code>.spec.hubAcceptsClient</code>, and all the other fields
in the spec are totally optional, e.g. <code>.spec.managedClusterClientConfigs</code>
is only required until we install some addons that replying on that
information.</p><p>Overall in OCM we can decorate the original cluster model with custom
attributes in the following approaches:</p><ul><li><code>Label</code>: The common label primitive in terms of a Kubernetes resource.</li><li><code>Cluster Claim</code>: A custom resource available inside the managed cluster
which will be consistently reported to the hub cluster.</li></ul><h2 id=labeling-managed-cluster>Labeling managed cluster</h2><p>Any kubernetes resource can be attached with labels in the metadata in the
form of:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&lt;domain name&gt;/&lt;label name&gt;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>&lt;label string value&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>However, there&rsquo;re some restrictions to the label value such as the content
length, and legal charset etc, so it&rsquo;s not convenient to put some structuralized
or comprehensive data in the label value.</p><p>Additionally, due to the fact that the finest granularity of authorization
mechanism in Kubernetes is &ldquo;resource&rdquo;, so it&rsquo;s also not convenient for us
to protect these extended labels from unexpected modification unless
intercepting the writes the &ldquo;Managed Cluster&rdquo; with an admission webhook which
brings additional costs in cluster administration and operation. So generally
it&rsquo;s recommended to put those immutable or static attributes (that doesn&rsquo;t
frequently change over time) such as:</p><ul><li>data-center information</li><li>network infrastructure information</li><li>geography attributes like cluster&rsquo;s region</li><li>&mldr;</li></ul><p>Last but not least, it&rsquo;s generally not recommended to grant permission to the
managed cluster to update non-status fields on the &ldquo;Managed Cluster&rdquo; so these
custom attributes in labels should only be manipulated by hub cluster
admins/operators. If you are looking for a way to make the local agents in the
managed clusters to be capable of reporting attributes in a &ldquo;bottom-up&rdquo;
pattern, go ahead read the &ldquo;Cluster Claim&rdquo; section below.</p><h2 id=decorating-managed-cluster-with-cluster-claim>Decorating managed cluster with cluster claim</h2><p>The cluster claim is a cluster-scoped custom resource working from the managed
clusters and proactively projecting custom attributes towards the hub cluster&rsquo;s
&ldquo;Managed Cluster&rdquo; model. Note that the hub cluster is not supposed to make
any direct modification upon the projected claims on the &ldquo;ManagedCluster&rdquo;, i.e.
<strong>read-only</strong> to the hub cluster.</p><p>A sample of cluster claim will be like:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterClaim</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>95f91f25-d7a2-4fc3-9237-2ef633d8451c</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>After applying the cluster claim above to any managed cluster, the value of
the claims will be instantly reflected in the cluster model. e.g.:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedCluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterClaims</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>95f91f25-d7a2-4fc3-9237-2ef633d8451c</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>And any future updates upon the claim will also be reported from the
registration agent to the hub cluster.</p><p>The claims are useful if we want the hub cluster to perform different actions
or behaviors reactively based on the feedback of reported values. They&rsquo;re
typically applicable to describe the information that changes in the managed
cluster frequently. e.g.:</p><ul><li>aggregated resource information (node counts, pod counts)</li><li>cluster resource watermark/budget</li><li>any cluster-scoped knowledge of the managed cluster&mldr;</li></ul><h2 id=next>Next</h2><p>After extending your &ldquo;Managed Cluster&rdquo; with customized attributes, now we can
try the advanced cluster selection using the <a href=https://open-cluster-management.io/docs/concepts/content-placement/placement/>placement</a>
policies, which is provided ny another module of OCM helpful for building your
own advanced multi-cluster systems.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6e0533c701ce88469bf1155ab6c497f9>5 - Integration with Argo CD</h1><p><a href=https://argo-cd.readthedocs.io/en/stable/>Argo CD</a> is a declarative, GitOps continuous delivery tool, which allows developers to define and control deployment of Kubernetes application resources from within their existing Git workflow. By integrating Open Cluster Management (OCM) with Argo CD, it enables both automation and greater flexibility managing Argo CD Applications across a large number of OCM managed clusters.</p><p>In this article, we want to show you how to integrate Argo CD with OCM and deploy application to OCM managed clusters by leveraging the <code>Placement</code> API, which supports multi-cluster scheduling.</p><p>Before starting with the following steps, we suggest you understand the content below:</p><ul><li><a href=https://argo-cd.readthedocs.io/en/stable/user-guide/application-set/>Argo CD ApplicationSet</a>. It adds Application automation and seeks to improve multi-cluster support and cluster multitenant support within Argo CD.</li><li><a href=https://open-cluster-management.io/docs/concepts/content-placement/placement/>OCM Placement API</a>. It is used to dynamically select a set of <a href=https://open-cluster-management.io/docs/concepts/cluster-inventory/managedcluster/>ManagedClusters</a> in one or multiple <a href=https://open-cluster-management.io/docs/concepts/cluster-inventory/managedclusterset/>ManagedClusterSets</a> so that the workloads can be deployed to these clusters.</li></ul><p>The first half of the
<a href=/kubecon-na-2022-ocm-multicluster-app-and-config-management.pdf>KubeCon NA 2022 - OCM Multicluster App & Config Management</a>
also covers the integration with ArgoCD.</p><h3 id=how-it-works>How it works</h3><div style=text-align:center;padding:20px><img src=/integration-with-argocd.png alt="How it works" style="margin:0 auto;width:75%"></div><p><strong>1. Import Kubernetes clusters to the OCM hub as managed clusters and organize them with managed clustersets.</strong></p><p><strong>2. Register the OCM managed clusters to ArgoCD.</strong></p><p>The OCM managed clusters can be registered to Argo CD one by one manually by using Argo CD CLI. It may take time to finish it if there are a large number of clusters. In order to make the cluster registration easier, consider to use <a href=https://github.com/open-cluster-management-io/multicloud-integrations>multicloud-integrations</a> to automate the procedure.</p><p><strong>3. Create a configuration of <a href=https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Generators-Cluster-Decision-Resource/>Cluster Decision Resource generator</a> by using OCM Placement API.</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ConfigMap
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: ocm-placement-generator
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: argocd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>data:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  apiVersion: cluster.open-cluster-management.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  kind: placementdecisions
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  statusListKey: decisions
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  matchKey: clusterName
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>With reference to this generator, an <code>ApplicationSet</code> can target the application to the clusters listed in the status of a set of <code>PlacementDecision</code>, which belong to a certain Placement.</p><p><strong>4. Grant Argo CD permissions to access OCM resources.</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Role
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: ocm-placement-consumer
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: argocd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>rules:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>- apiGroups: [&#34;cluster.open-cluster-management.io&#34;]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  resources: [&#34;placementdecisions&#34;]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  verbs: [&#34;get&#34;, &#34;list&#34;]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>---
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: RoleBinding
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: ocm-placement-consumer:argocd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: argocd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>roleRef:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  apiGroup: rbac.authorization.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  kind: Role
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: ocm-placement-consumer
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>subjects:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>- kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: argocd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: argocd-applicationset-controller
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p><strong>5. Bind at least one managed clusterset to the <code>argocd</code> namespace.</strong></p><p>For example, in order to bind the <code>global</code> managed clusterset to the <code>argocd</code> namespace, the user must have an RBAC rule to <code>create</code> on the virtual subresource of <code>managedclustersets/bind</code> of the <code>global</code> managed clusterset.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>clusteradm clusterset <span style=color:#204a87>bind</span> global --namespace argocd
</span></span></code></pre></div><p>The above command will create a <code>ManagedClusterSetBinding</code> resource in the <code>argocd</code> namespace. Normally, it should not be included by an application in the git repo because applying it to a Kubernetes cluster needs additional permissions.</p><p><strong>6. Create a placement in the <code>argocd</code> namespace to select some managed clusters.</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: cluster.open-cluster-management.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Placement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: guestbook-app-placement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: argocd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  numberOfClusters: 10
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p><strong>7. Create an <code>ApplicationSet</code> in the <code>argocd</code> namespace.</strong></p><p>The <code>ApplicationSet</code> has references to the Cluster Decision Resource generator previously created and placement. This will help Argo CD to determine where the application should be deployed. The managed clusters selected by the referenced placement may be changed dynamically. By setting <code>requeueAfterSeconds</code> of the generator in the <code>ApplicationSet</code> spec, the Argo CD will check the cluster decisions of the referenced placement periodically and ensure the application is deployed to the correct managed clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: argoproj.io/v1alpha1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ApplicationSet
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: guestbook-app
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: argocd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  generators:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - clusterDecisionResource:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        configMapRef: ocm-placement-generator
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        labelSelector:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            cluster.open-cluster-management.io/placement: guestbook-app-placement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        requeueAfterSeconds: 30
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  template:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      name: &#39;{{clusterName}}-guestbook-app&#39;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      project: default
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      source:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        repoURL: &#39;https://github.com/argoproj/argocd-example-apps.git&#39;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        targetRevision: HEAD
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        path: guestbook
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      destination:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        name: &#39;{{clusterName}}&#39;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        namespace: guestbook
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      syncPolicy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        automated:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          prune: true
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        syncOptions:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          - CreateNamespace=true
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p><strong>8. Check the status of the <code>ApplicationSet</code> and the <code>Application</code>.</strong></p><p>Confirm the <code>ApplicationSet</code> is created and an <code>Application</code> is generated for each selected managed cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n argocd get applicationsets
</span></span><span style=display:flex><span>NAME            AGE
</span></span><span style=display:flex><span>guestbook-app   4s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl -n argocd get applications
</span></span><span style=display:flex><span>NAME                     SYNC STATUS   HEALTH STATUS
</span></span><span style=display:flex><span>cluster1-guestbook-app   Synced        Progressing
</span></span><span style=display:flex><span>cluster2-guestbook-app   Synced        Progressing
</span></span></code></pre></div><p>And on each selected managed cluster confirm the <code>Application</code> is running.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n guestbook get pods
</span></span><span style=display:flex><span>NAME                           READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>guestbook-ui-6b689986f-cdrk8   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          112s
</span></span></code></pre></div><h3 id=whats-next>What&rsquo;s next</h3><p>To build an OCM environment integrated with Argo CD with <code>KinD</code> clusters, see <a href=https://github.com/open-cluster-management-io/OCM/tree/main/solutions/deploy-argocd-apps>Deploy applications with Argo CD</a> for more details.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-86a38af7c2840a716dc25acad93066d1>6 - Manage a cluster with multiple hubs</h1><p>Normally an Open Cluster Management (OCM) hub manages multiple managed clusters and a cluster only registers to one OCM hub. While there might be some user scenarios, where a single cluster may want to join more than one OCM hub as a managed cluster, including:</p><ul><li>In an organization, each department may setup an OCM hub to manage clusters owned by this department, and all clusters are managed by a central OCM hub owned by IT department to enforce organization wide security policies.</li><li>A service provider creates clusters for customers. The underlying system of the service provider uses OCM hubs to manage all the clusters. Once customer gets a cluster from the service provider, they may also want to manage this cluster with customer&rsquo;s OCM hub.</li></ul><p>This document shows how to achieve it with OCM.</p><p>Since the OCM agent is hub specific, that means an agent can connect to only one hub. In order to connect to multiple hubs, each hub should have its own agent running. Depdends on where the agent is running, there are two solutions:</p><ul><li>Run all agents on the managed cluster;</li><li>Run the agents in the hosted mode on the hosting clusters;</li></ul><h3 id=run-all-the-agents-on-the-managed-cluster>Run all the agents on the managed cluster</h3><p>Since there are multiple OCM agents are running on the managed cluster, each of them must have an unique agent namespace. So only one agent can be deployed in the default agent namespace <code>open-cluster-management-agent</code>.</p><div style=text-align:center;padding:20px><img src=/multi-hubs.png alt="multiple hubs" style="margin:0 auto;width:75%"></div><p>With this architecture, the managed cluster needs more resources, including CPUs and memory, to run agents for multiple hubs. And it&rsquo;s a challenge to handle the version skew of the OCM hubs.</p><p>An example built with <a href=https://kind.sigs.k8s.io>kind</a> and <a href=https://github.com/open-cluster-management-io/clusteradm/releases>clusteradm</a> can be found in <a href=https://github.com/open-cluster-management-io/OCM/tree/main/solutions/multiple-hubs>Manage a cluster with multiple hubs</a>.</p><h3 id=run-the-agents-in-the-hosted-mode-on-the-hosting-clusters>Run the agents in the hosted mode on the hosting clusters</h3><p>By leveraging the hosted deployment mode, it&rsquo;s possible to run OCM agent outside of the managed cluster on a hosing cluster. The hosting cluster could be a managed cluster of the same hub.</p><div style=text-align:center;padding:20px><img src=/multi-hubs-hosted1.png alt="multiple hubs in hosted mode" style="margin:0 auto;width:60%"></div><p>At most one agent can runs in the default mode on the managed cluster in this solution.</p><div style=text-align:center;padding:20px><img src=/multi-hubs-hosted2.png alt="multiple hubs in hosted mode" style="margin:0 auto;width:60%"></div><p>In order to reduce the number of the hosting clusters, agents running in the hosted mode can share the hosting clusters.</p><div style=text-align:center;padding:20px><img src=/multi-hubs-hosted3.png alt="multiple hubs in hosted mode" style="margin:0 auto;width:60%"></div><p>With this architecture, the managed cluster itself needs less resources because at most one agent runs on the managed cluster, while it needs at least one extra cluster as hosting cluster. Since each agent could run on different cluster (managed cluster or hosting cluster), it will not result in any problem if OCM hubs have different versions.</p><p>An example built with <a href=https://kind.sigs.k8s.io>kind</a> and <a href=https://github.com/open-cluster-management-io/clusteradm/releases>clusteradm</a> can be found in <a href=https://github.com/open-cluster-management-io/OCM/tree/main/solutions/multiple-hubs-hosted>Manage a cluster with multiple hubs in hosted mode</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-a248b9543af6136123ff241bf476fea3>7 - Migrate workload with placement</h1><p>The <code>Placement</code> API is used to dynamically select a set of <code>ManagedCluster</code> in
one or multiple <code>ManagedClusterSets</code> so that the workloads can be deployed to
these clusters.</p><p>If you define a valid <code>Placement</code>, the placement controller generates a
corresponding <code>PlacementDecision</code> with the selected clusters listed in the
status. As an end-user, you can parse the selected clusters and then operate on
the target clusters. You can also integrate a high-level workload orchestrator
with the <code>PlacementDecision</code> to leverage its scheduling capabilities.</p><p>For example, with OCM addon <a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/>policy</a>
installed, a <code>Policy</code> that includes a <code>Placement</code> mapping can distribute the
<code>Policy</code> to the managed clusters.
For details see this <a href=https://open-cluster-management.io/docs/getting-started/integration/policy-controllers/configuration-policy/#placement-api>example</a>.</p><p>Some popular open source projects also integrate with the <code>Placement</code> API. For
example <a href=https://github.com/argoproj/argo-cd>Argo CD</a>, it can leverage the
generated <code>PlacementDecision</code> to drive the assignment of Argo CD Applications to a
desired set of clusters, details see this <a href=https://github.com/argoproj/argo-cd/tree/master/applicationset/examples/clusterDecisionResource>example</a>.
And <a href=https://github.com/kubevela/kubevela>KubeVela</a>, as an implementation of
the open application model, also will take advantage of the <code>Placement</code> API for
workload scheduling.</p><p>In this article, we use <a href=https://github.com/open-cluster-management-io/ocm/tree/main/solutions/deploy-argocd-apps-pull>ArgoCD pull model</a>
as an example to demonstrate how, with the integration of OCM, you can migrate
ArgoCD Applications among clusters. This is useful for scenarios such as
application disaster recovery or application migration during cluster maintenance.</p><h2 id=prerequisites>Prerequisites</h2><p>Before starting with the following steps, we recommend that you familiarize yourself with the content below.</p><ul><li><p><a href=https://open-cluster-management.io/concepts/managedcluster/#taints-of-managedclusters>Taints of ManagedClusters</a>:
Taints are properties of <code>ManagedClusters</code>, they allow a <code>Placement</code> to repel
a set of <code>ManagedClusters</code>.</p></li><li><p><a href=https://open-cluster-management.io/concepts/placement/#taintstolerations>Tolerations of Placement</a>:
Tolerations are applied to <code>Placements</code>, and allow <code>Placements</code> to select
<code>ManagedClusters</code> with matching taints.</p></li><li><p><a href=https://github.com/open-cluster-management-io/ocm/tree/main/solutions/deploy-argocd-apps-pull>ArgoCD Pull Model Integration</a>:
The ArgoCD application controller uses the hub-spoke pattern or pull model mechanism
for decentralized resource delivery to remote clusters. By using Open Cluster Management (OCM) APIs
and components, the ArgoCD Applications will be pulled from the multi-cluster control plane
hub cluster down to the registered OCM managed clusters</p></li></ul><h2 id=setup-the-environment>Setup the environment</h2><p>Follow the <a href=https://github.com/open-cluster-management-io/ocm/blob/main/solutions/deploy-argocd-apps-pull/getting-started.md>deploy ArgoCD pull model steps</a>
to set up an environment with OCM and ArgoCD pull model installed.</p><p>If the above steps run successfully, on the hub cluster, you could see the application is deployed to both cluster1 and cluster2.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n argocd get app
</span></span><span style=display:flex><span>NAME                     SYNC STATUS   HEALTH STATUS
</span></span><span style=display:flex><span>cluster1-guestbook-app   Synced        Healthy
</span></span><span style=display:flex><span>cluster2-guestbook-app   Synced        Healthy
</span></span></code></pre></div><h2 id=migrate-application-to-another-cluster-automatically-when-one-cluster-is-down>Migrate application to another cluster automatically when one cluster is down</h2><ol><li><p>To demonstrate how an application can be migrated to another cluster, let&rsquo;s first deploy the application in a single cluster.</p><p>Patch the existing <code>Placement</code> to select only one cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl patch placement -n argocd guestbook-app-placement --patch <span style=color:#4e9a06>&#39;{&#34;spec&#34;: {&#34;numberOfClusters&#34;: 1}}&#39;</span> --type<span style=color:#ce5c00;font-weight:700>=</span>merge
</span></span><span style=display:flex><span>placement.cluster.open-cluster-management.io/guestbook-app-placement patched
</span></span></code></pre></div><p>Use <code>clusteradm</code> to check the placement of selected clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm get placements -otable
</span></span><span style=display:flex><span>NAME                      STATUS   REASON              SELETEDCLUSTERS
</span></span><span style=display:flex><span>guestbook-app-placement   False    Succeedconfigured   <span style=color:#ce5c00;font-weight:700>[</span>cluster1<span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div></li><li><p>Confirm the application is only deployed to cluster1.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n argocd get app
</span></span><span style=display:flex><span>NAME                     SYNC STATUS   HEALTH STATUS
</span></span><span style=display:flex><span>cluster1-guestbook-app   Synced        Healthy
</span></span></code></pre></div></li><li><p>Pause the cluster1 to simulate a cluster going down.</p><p>Use <code>docker ps -a</code> to get the cluster1 container ID.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ docker ps -a
</span></span><span style=display:flex><span>CONTAINER ID   IMAGE                  COMMAND                  CREATED       STATUS       PORTS                       NAMES
</span></span><span style=display:flex><span>499812ada5bd   kindest/node:v1.25.3   <span style=color:#4e9a06>&#34;/usr/local/bin/entr…&#34;</span>   <span style=color:#0000cf;font-weight:700>9</span> hours ago   Up <span style=color:#0000cf;font-weight:700>9</span> hours   127.0.0.1:37377-&gt;6443/tcp   cluster2-control-plane
</span></span><span style=display:flex><span>0b9d110e1a1f   kindest/node:v1.25.3   <span style=color:#4e9a06>&#34;/usr/local/bin/entr…&#34;</span>   <span style=color:#0000cf;font-weight:700>9</span> hours ago   Up <span style=color:#0000cf;font-weight:700>9</span> hours   127.0.0.1:34780-&gt;6443/tcp   cluster1-control-plane
</span></span><span style=display:flex><span>0a327d4a5b41   kindest/node:v1.25.3   <span style=color:#4e9a06>&#34;/usr/local/bin/entr…&#34;</span>   <span style=color:#0000cf;font-weight:700>9</span> hours ago   Up <span style=color:#0000cf;font-weight:700>9</span> hours   127.0.0.1:44864-&gt;6443/tcp   hub-control-plane
</span></span></code></pre></div><p>Use <code>docker pause</code> to pause the cluster1.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ docker pause 0b9d110e1a1f
</span></span><span style=display:flex><span>0b9d110e1a1f
</span></span></code></pre></div></li><li><p>Wait for a few minutes, check the <code>ManagedCluster</code> status, cluster1 available status should become &ldquo;Unknown&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get managedcluster
</span></span><span style=display:flex><span>NAME       HUB ACCEPTED   MANAGED CLUSTER URLS                  JOINED   AVAILABLE   AGE
</span></span><span style=display:flex><span>cluster1   <span style=color:#204a87>true</span>           https://cluster1-control-plane:6443   True     Unknown     9h
</span></span><span style=display:flex><span>cluster2   <span style=color:#204a87>true</span>           https://cluster2-control-plane:6443   True     True        9h
</span></span></code></pre></div><p>Use <code>clusteradm</code> to check the placement of selected clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm get placements -otable
</span></span><span style=display:flex><span>NAME                      STATUS   REASON              SELETEDCLUSTERS
</span></span><span style=display:flex><span>guestbook-app-placement   False    Succeedconfigured   <span style=color:#ce5c00;font-weight:700>[</span>cluster2<span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div></li><li><p>Confirm the application is now deployed to cluster2.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n argocd get app
</span></span><span style=display:flex><span>NAME                     SYNC STATUS   HEALTH STATUS
</span></span><span style=display:flex><span>cluster2-guestbook-app   Synced        Healthy
</span></span></code></pre></div></li></ol><h2 id=what-happens-behind-the-scene>What happens behind the scene</h2><p>Refer to <a href=https://open-cluster-management.io/concepts/managedcluster/#taints-of-managedclusters>Taints of ManagedClusters</a>,
when pausing cluster1, the status of condition <code>ManagedClusterConditionAvailable</code>
becomes <code>Unknown</code>. The taint <code>cluster.open-cluster-management.io/unreachable</code> is automatically
added to cluster1, with the effect NoSelect and an empty value.</p><pre><code>```shell
$ kubectl get managedcluster cluster1 -oyaml
apiVersion: cluster.open-cluster-management.io/v1
kind: ManagedCluster
metadata:
  name: cluster1
  labels:
    cluster.open-cluster-management.io/clusterset: default
spec:
...
  taints:
  - effect: NoSelect
    key: cluster.open-cluster-management.io/unreachable
    timeAdded: &quot;2023-11-13T16:26:16Z&quot;
status:
...
```
</code></pre><p>Since the <code>Placement</code> guestbook-app-placement doesn&rsquo;t define any toleration to match the taint,
cluster1 will be filtered from the decision. In the demo environment, once cluster1 is down,
placement will select one cluster from the rest clusters, which is cluster2.</p><p><a href=https://open-cluster-management.io/concepts/managedcluster/#taints-of-managedclusters>Taints of ManagedClusters</a>
also describes other scenarios where taints are automatically added. In some scenarios you may not want to
migrate the application immediately when a taint is added, with placement <code>TolerationSeconds</code> defined, it could tolerates the taint
for a period of time before repelling it. In above example, the <code>TolerationSeconds</code> could be defined as below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>guestbook-app-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>argocd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>tolerations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/unreachable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exists</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>tolerationSeconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>300</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><code>tolerationSeconds</code> is 300 means that the application will be migrated to cluster2 after 5 minutes when cluster1 is down.</p><h2 id=migrate-application-to-another-cluster-manually-for-cluster-maintenance>Migrate application to another cluster manually for cluster maintenance</h2><p>The above example shows how a taint is automatically added to a cluster and how the application is migrated to another cluster.
You can also choose to add a taint manually and repel the application to other clusters.</p><p>In the following example, suppose you are going to maintain cluster2, and want to repel the application to cluster1.</p><ol><li><p>Before starting, let&rsquo;s first restart the paused cluster1.</p><p>Use <code>docker restart</code> to restart the cluster1.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ docker restart 0b9d110e1a1f
</span></span><span style=display:flex><span>0b9d110e1a1f
</span></span></code></pre></div><p>Wait for a few minutes, check the <code>ManagedCluster</code> status, cluster1 available status should become &ldquo;True&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get managedcluster
</span></span><span style=display:flex><span>NAME       HUB ACCEPTED   MANAGED CLUSTER URLS                  JOINED   AVAILABLE   AGE
</span></span><span style=display:flex><span>cluster1   <span style=color:#204a87>true</span>           https://cluster1-control-plane:6443   True     True        9h
</span></span><span style=display:flex><span>cluster2   <span style=color:#204a87>true</span>           https://cluster2-control-plane:6443   True     True        9h
</span></span></code></pre></div></li><li><p>Add the taint <code>maintenance</code> to cluster2 manually.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl patch managedcluster cluster2 -p <span style=color:#4e9a06>&#39;{&#34;spec&#34;:{&#34;taints&#34;:[{&#34;effect&#34;:&#34;NoSelect&#34;,&#34;key&#34;:&#34;maintenance&#34;}]}}&#39;</span> --type<span style=color:#ce5c00;font-weight:700>=</span>merge
</span></span><span style=display:flex><span>managedcluster.cluster.open-cluster-management.io/cluster2 patched
</span></span></code></pre></div></li><li><p>Use <code>clusteradm</code> to check the placement selected clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ clusteradm get placements -otable
</span></span><span style=display:flex><span>NAME                      STATUS   REASON              SELETEDCLUSTERS
</span></span><span style=display:flex><span>guestbook-app-placement   False    Succeedconfigured   <span style=color:#ce5c00;font-weight:700>[</span>cluster1<span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div></li><li><p>Confirm the application is now deployed to cluster1.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n argocd get app
</span></span><span style=display:flex><span>NAME                     SYNC STATUS   HEALTH STATUS
</span></span><span style=display:flex><span>cluster1-guestbook-app   Synced        Healthy
</span></span></code></pre></div></li></ol><h2 id=summary>Summary</h2><p>In this article, we use the ArgoCD pull model in OCM as an example, showing you how to migrate the ArgoCD applications automatically or manually when the cluster is down or during the cluster maintenance time.</p><p>The concept of <a href=https://open-cluster-management.io/concepts/managedcluster/#taints-of-managedclusters>Taints</a> and <a href=https://open-cluster-management.io/concepts/placement/#taintstolerations>Tolerations</a> can be used for any components that consume OCM <code>Placement</code>, such as <a href=https://open-cluster-management.io/concepts/addon/>add-ons</a> and <a href=https://open-cluster-management.io/concepts/manifestworkreplicaset/>ManifestworkReplicaSet</a>. If you have any questions, feel free to raise them in our <a href=https://kubernetes.slack.com/channels/open-cluster-mgmt>slack channel</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7ca5dd580066fc69d90bf611a2fff868>8 - Pushing Kubernetes API requests to the managed clusters</h1><p>By following the instructions in this document, an OCM hub admin will be able
to &ldquo;push&rdquo; Kubernetes API requests to the managed clusters. The benefit of using
this method for &ldquo;pushing&rdquo; requests in OCM is that we don&rsquo;t need to explicitly
configure any API endpoint for the managed clusters or provide any client
credentials as preparation. We just need to enable/install the following OCM
addons:</p><ul><li><a href=https://github.com/open-cluster-management-io/cluster-proxy>Cluster-Proxy</a>:
Setting up the <a href=https://kubernetes.io/docs/tasks/extend-kubernetes/setup-konnectivity/>konnectivity</a>
tunnels between the hub cluster and the managed clusters so the hub cluster
can connect/access the managed cluster from anywhere.</li><li><a href=https://github.com/open-cluster-management-io/managed-serviceaccount>Managed-ServiceAccount</a>:
Automating the lifecycle of the local service account in the managed clusters
and projecting the tokens back to the hub cluster so that the Kubernetes API
clients from the hub can make authenticated requests.</li><li><a href=https://github.com/oam-dev/cluster-gateway>Cluster-Gateway</a>: An aggregated
apiserver providing a &ldquo;proxy&rdquo; subresource which helps the hub admin to
gracefully access the managed clusters by standard Kubernetes API calls
(including long-running calls).</li></ul><h2 id=prerequisite>Prerequisite</h2><p>You must meet the following prerequisites to install the managed service
account:</p><ul><li>Ensure your <code>open-cluster-management</code> release is greater than <code>v0.5.0</code>.</li><li>Ensure <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl><code>kubectl</code></a> is installed.</li><li>Ensure <a href=https://helm.sh/docs/intro/install/><code>helm</code></a> is installed.</li></ul><h2 id=installation>Installation</h2><h3 id=adding-helm-chart-repo>Adding helm chart repo</h3><p>Making sure the following OCM addons are discovered by your helm environment:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ helm repo add ocm https://open-cluster-management.io/helm-charts
</span></span><span style=display:flex><span>$ helm repo update
</span></span><span style=display:flex><span>$ helm search repo ocm
</span></span><span style=display:flex><span>NAME                             	CHART VERSION	APP VERSION	DESCRIPTION                                   
</span></span><span style=display:flex><span>ocm/cluster-gateway-addon-manager	1.3.2       	1.0.0      	A Helm chart <span style=color:#204a87;font-weight:700>for</span> Cluster-Gateway Addon-Manager
</span></span><span style=display:flex><span>ocm/cluster-proxy                	0.2.0        	1.0.0      	A Helm chart <span style=color:#204a87;font-weight:700>for</span> Cluster-Proxy OCM Addon      
</span></span><span style=display:flex><span>ocm/managed-serviceaccount       	0.2.0        	1.0.0      	A Helm chart <span style=color:#204a87;font-weight:700>for</span> Managed ServiceAccount Addon 
</span></span></code></pre></div><h3 id=install-the-ocm-addons>Install the OCM addons</h3><p>By the following helm commands to install the addons:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ helm -n open-cluster-management-addon install cluster-proxy ocm/cluster-proxy
</span></span><span style=display:flex><span>$ helm -n open-cluster-management-addon install managed-serviceaccount ocm/managed-serviceaccount
</span></span><span style=display:flex><span>$ helm -n open-cluster-management-addon install cluster-gateway ocm/cluster-gateway-addon-manager  <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    <span style=color:#8f5902;font-style:italic># Delegating for secret discovery to &#34;managed-serviceaccount&#34; addon.                           \</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># Skip the option for manual secret management.                                                \</span>
</span></span><span style=display:flex><span>    --set <span style=color:#000>manualSecretManagement</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>                                                             <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    <span style=color:#8f5902;font-style:italic># Enabling konnectivity tunnels via &#34;cluster-proxy&#34; addon.                                     \</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># Skip the option if the hub cluster and the managed clusters are already mutually accessible. \</span>
</span></span><span style=display:flex><span>    --set <span style=color:#000>konnectivityEgress</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span></code></pre></div><h3 id=confirm-addon-installation>Confirm addon installation</h3><p>The commands above installs the addon manager into the hub cluster, and the
manager will creating <code>ManagedClusterAddOn</code> automatically into the cluster
namespaces representing the addon is plumbed into the managed cluster. In order
to check their status, run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get managedclusteraddon -A
</span></span><span style=display:flex><span>NAMESPACE   NAME                     AVAILABLE   DEGRADED   PROGRESSING
</span></span><span style=display:flex><span>managed1    cluster-gateway          True
</span></span><span style=display:flex><span>managed1    cluster-proxy            True                   
</span></span><span style=display:flex><span>managed1    managed-serviceaccount   True 
</span></span></code></pre></div><p>Furthermore, after the addons are all deployed successfully, the hub admin will
be able to see a new resource named <code>ClusterGateway</code> registered into the hub
cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get clustergateway
</span></span><span style=display:flex><span>NAME       PROVIDER   CREDENTIAL-TYPE       ENDPOINT-TYPE
</span></span><span style=display:flex><span>managed1              ServiceAccountToken   ClusterProxy
</span></span></code></pre></div><h2 id=usage>Usage</h2><p>Now the gateway is ready for proxying your requests to the managed clusters
dynamically. The easiest way to verify if the proxying framework is working
is to run the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ <span style=color:#204a87>export</span> <span style=color:#000>CLUSTER_NAME</span><span style=color:#ce5c00;font-weight:700>=</span>managed1 <span style=color:#8f5902;font-style:italic># Or any other valid managed cluster name</span>
</span></span><span style=display:flex><span>$ kubectl get --raw<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/apis/cluster.core.oam.dev/v1alpha1/clustergateways/</span><span style=color:#4e9a06>${</span><span style=color:#000>CLUSTER_NAME</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>/proxy/healthz&#34;</span>
</span></span><span style=display:flex><span>ok
</span></span></code></pre></div><p>Another nice feature is that you can also easily convert the kubeconfig of the
hub cluster into a managed cluster&rsquo;s kubeconfig by adding the api suffix to the
cluster endpoint in your kubeconfig:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>$ # Copy and edit your original hub kubeconfig into e.g. managed1.kubeconfig
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>clusters:
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#a40000>---    server: https://x.x.x.x
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#00a000>+++    server: https://x.x.x.x/apis/cluster.core.oam.dev/v1alpha1/clustergateways/${CLUSTER_NAME}/proxy
</span></span></span></code></pre></div><p>Then we can access the managed cluster directly via kubectl with the tweaked
kubeconfig:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>managed1.kubeconfig kubectl get ns
</span></span></code></pre></div><p>However upon your first-time installation, you may encounter the RBAC
restriction message such as:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Error from server (Forbidden): namespaces is forbidden: User &#34;system:serviceaccount:open-cluster-management-managed-serviceaccount:cluster-gateway&#34; cannot list resource &#34;namespaces&#34; in API group &#34;&#34; at the cluster scope
</span></span></code></pre></div><p>That is because we haven&rsquo;t set up proper RBAC permissions for the <code>egress</code>
service account managed by the <code>ManagedServiceAccount</code> yet. After granting
sufficient permissions for the service account in the managed clusters, you
will be able to freely operate the managed cluster from the hub without asking
for any credential or kubeconfig from the managed clusters. Note that the
service account is also periodically rotated by the addons so there&rsquo;s no need
to worry in sustainable credential management.</p><h2 id=insight>Insight</h2><p>Overall, the following picture of architecture reveals the internal technique
of the request &ldquo;pushing&rdquo; framework in the OCM:</p><div style=text-align:center;padding:20px><img src=/proxy-framework.png alt="Cluster proxy architecture" style="margin:0 auto;width:90%"></div><p>With the help of the framework, we can easily develop a web service or an
operator that runs in the hub cluster and is able to access to the managed
clusters through the gateway. Note that it&rsquo;s generally not recommended to
list-watch the managed clusters from the hub because it&rsquo;s in a sense violating
the original philosophy of &ldquo;pull&rdquo; or &ldquo;hub-agent&rdquo; architecture of OCM. In
order to coordinate the hub cluster and the managed clusters in your custom
system, consider build your own OCM addon based on the <a href=https://github.com/open-cluster-management-io/addon-framework>addon-framework</a>
which provides you utilities for further customization.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8272cdbbbcfeb7d32da1f7122d8d74fa>9 - Register a cluster to hub through proxy server</h1><p>When registering a cluster to an Open Cluster Management (OCM) hub, there is a network requirement for the managed cluster. It must be able to reach the hub cluster. Sometimes the managed cluster cannot directly connect to the hub cluster. For example, the hub cluster is in a public cloud, and the managed cluster is in a private cloud environment behind firewalls. The communications out of the private cloud can only go through a HTTP or HTTPS proxy server.</p><p>In this scenario, you need to configure the proxy settings to allow the communications from the managed cluster to access the hub cluster through a forward proxy server.</p><h3 id=klusterlet-proxy-settings>Klusterlet proxy settings</h3><p>During the cluster registration, a bootstrap kubeconfig is required by the Klusterlet agent running on the managed cluster to connect to the hub cluster. When the agent accesses the hub cluster through a proxy server, the URL of the proxy server should be specified in <code>cluster.proxy-url</code> of the bootstrap kubeconfig. If a HTTPS proxy server is used, the proxy CA certificate should be appended to <code>cluster.certificate-authority-data</code> of the bootstrap kubeconfig as well.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>clusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>certificate-authority-data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LS0tLS...LS0tCg==</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>server</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>https://api.server-foundation-sno-x4lcs.dev04.red-chesterfield.com:6443</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>proxy-url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>https://10.0.109.153:3129</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default-cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>contexts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>context</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default-cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default-auth</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default-context</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>current-context</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default-context</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>preferences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default-auth</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>token</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>eyJh...8PwGo</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Since the communication between the managed cluster and the hub cluster leverages mTLS, the SSL connection should not be terminated on the proxy server. So the proxy server needs to support HTTP tunneling (for example, HTTP CONNECT method), which will establish a tunnel between the managed cluster and the hub cluster and forward the traffic from the managed cluster through this tunnel.</p><p>Once the Klusterlet agent finishes the cluster registration, a secret <code>hub-kubeconfig-secret</code> is generated with a new kubeconfig. It has the similar proxy settings and the appropriate permissions. The Klusterlet agent then uses this kubeconfig to access the hub cluster.</p><div style=text-align:center;padding:20px><img src=/klusterlet-proxy.png alt="multiple hubs" style="margin:0 auto;width:75%"></div><p>You can find an example built with <a href=https://kind.sigs.k8s.io>kind</a> and <a href=https://github.com/open-cluster-management-io/clusteradm/releases>clusteradm</a> in <a href=https://github.com/open-cluster-management-io/OCM/tree/main/solutions/join-through-proxy>Join hub through a forward proxy server</a>.</p><h3 id=add-on-proxy-settings>Add-on proxy settings</h3><p>Typically the add-on agent running on the managed cluster also needs a kubeconfig to access the resources of the kube-apiserver on the hub cluster. The Klusterlet agent will generate this kubeconfig during the add-on registration. If the Klusterlet agent bootstraps with a proxy settings, the same settings will be put into the add-on kubeconfig as well. While agents of some add-ons may access services other than kube-apiserver on the hub cluster. For those add-ons, you may need to add additional configuration with proxy settings by creating a <code>AddOnDeploymentConfig</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnDeploymentConfig</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-proxy-settings</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>proxyConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>httpProxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;http://10.0.109.153:3128&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>httpsProxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;https://10.0.109.153:3129&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>noProxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;.cluster.local,.svc,10.96.0.1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>caBundle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LS0tLS...LS0tCg==</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The IP address of the <code>kube-apiserver</code> on the managed cluster should be included in the field <code>noProxy</code>. To get the IP address, run following command on the managed cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n default describe svc kubernetes <span style=color:#000;font-weight:700>|</span> grep IP:
</span></span></code></pre></div><p>You also need to associate the configuration to the <code>ManagedClusterAddOn</code> by adding an item to <code>spec.configs</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installNamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-proxy-settings</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>With the above configuration, the add-on manager of this add-on running on the hub cluster can fetch the proxy settings and then propagate it to the managed cluster side, for example as environment variables by using <code>ManifestWork</code> API. And then the add-on agent can initiate the communication to a particular service on the hub cluster with the proxy settings.</p><div style=text-align:center;padding:20px><img src=/addon-proxy.png alt="multiple hubs" style="margin:0 auto;width:75%"></div><p>Once both the klusterlet agent and the add-on agents are able to communicate with the hub cluster through the forward proxy server, workloads, like applications, can be scheduled to the managed cluster.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Slack aria-label=Slack><a target=_blank rel=noopener href=https://kubernetes.slack.com/channels/open-cluster-mgmt aria-label=Slack><i class="fab fa-slack"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Youtube aria-label=Youtube><a target=_blank rel=noopener href=https://www.youtube.com/c/OpenClusterManagement aria-label=Youtube><i class="fab fa-youtube"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Calendar aria-label=Calendar><a target=_blank rel=noopener href="https://calendar.google.com/calendar/u/0/embed?src=openclustermanagement@gmail.com" aria-label=Calendar><i class="fa fa-calendar"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/open-cluster-management-io aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Mail Group" aria-label="Mail Group"><a target=_blank rel=noopener href=https://groups.google.com/g/open-cluster-management aria-label="Mail Group"><i class="fa fa-envelope"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2020&ndash;2025
<span class=td-footer__authors>Open Cluster Management Authors. The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href=https://www.linuxfoundation.org/trademark-usage/>Trademark Usage</a> | Powered by <a href=https://www.netlify.com/>Netlify</a></span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.69e2c1ae9320465ab10236d9ef752c6a4442c54b48b883b17c497b7c7d96a796.js integrity="sha256-aeLBrpMgRlqxAjbZ73UsakRCxUtIuIOxfEl7fH2Wp5Y=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>