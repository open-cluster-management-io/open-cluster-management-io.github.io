<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://open-cluster-management.io/docs/developer-guides/><link rel=alternate type=application/rss+xml href=https://open-cluster-management.io/docs/developer-guides/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Developer Guides | Open Cluster Management</title>
<meta name=description content="Open Cluster Management official site"><meta property="og:url" content="https://open-cluster-management.io/docs/developer-guides/"><meta property="og:site_name" content="Open Cluster Management"><meta property="og:title" content="Developer Guides"><meta property="og:description" content="Open Cluster Management official site"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Developer Guides"><meta itemprop=description content="Open Cluster Management official site"><meta itemprop=dateModified content="2024-09-20T07:13:55+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Developer Guides"><meta name=twitter:description content="Open Cluster Management official site"><link rel=preload href=/scss/main.min.5b781ea478351b0ae6a4b76c09a1e12144a17c359d37b236b5f1b1970ed15522.css as=style><link href=/scss/main.min.5b781ea478351b0ae6a4b76c09a1e12144a17c359d37b236b5f1b1970ed15522.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 77.76 75.84"><defs><style>.cls-1{fill:none}.cls-2{fill:#fff}.cls-3{clip-path:url(#clip-path)}.cls-4{clip-path:url(#clip-path-2)}</style><clipPath id="clip-path" transform="translate(5.38 5.32)"><path class="cls-1" d="M67.11 39.69 61.34 14.61a4.48 4.48.0 00-2.42-3L35.55.44A4.52 4.52.0 0033.38.0a4.36 4.36.0 00-1.71.43L8.3 11.61a4.41 4.41.0 00-2.42 3L.11 39.7a4.37 4.37.0 00.61 3.39c.08.13.16.24.25.36L17.15 63.56a4.49 4.49.0 003.49 1.67H46.58a4.5 4.5.0 003.5-1.66L66.25 43.44A4.37 4.37.0 0067.11 39.69zM52.3 34.43a18.71 18.71.0 01-34.09 9.82c3.87-1.37 15.74-5.69 8.4-4.44A87.29 87.29.0 0116.1 41h-.42c-.57.0-1.13.0-1.67.0h-.37c-.54.0-1.07.0-1.58.0h-.31q-.77.0-1.47-.12c-2.78-.31-4.61-1.08-4.51-2.54.25-3.72 9.12-5.71 9.12-5.71a18.7 18.7.0 0134-9.82c-3.93 1.4-15.64 5.66-8.34 4.41a87.13 87.13.0 0110.5-1.16h.43 1.66.37q.82.0 1.59.0h.31c.51.0 1 .07 1.46.12 2.78.31 4.62 1.08 4.52 2.53C61.15 32.41 52.45 34.4 52.3 34.43z"/></clipPath><clipPath id="clip-path-2" transform="translate(5.38 5.32)"><rect class="cls-1" x="-5" y="-5" width="77.22" height="75.23"/></clipPath></defs><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path id="path3055" class="cls-2" d="M34.64 3.44a4.06 4.06.0 00-1.53.38l-20.91 10A4 4 0 0010 16.51L4.87 39a3.93 3.93.0 00.55 3 3.62 3.62.0 00.22.32l14.48 18a4 4 0 003.13 1.5H46.46a4 4 0 003.12-1.49l14.47-18A3.9 3.9.0 0064.82 39L59.66 16.5a4 4 0 00-2.17-2.69l-20.91-10A4 4 0 0034.64 3.44z" transform="translate(5.38 5.32)"/><g class="cls-3"><g class="cls-4"><image width="162" height="158" transform="scale(0.48)" xlink:href="data:image/png;base64,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"/></g></g></g></g></svg></span><span class=navbar-brand__name>Open Cluster Management</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=/docs/><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/community/><span>Community</span></a></li><li class=nav-item><a class=nav-link href=/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/open-cluster-management-io/ocm target=_blank rel=noopener><i class="fab fa-github"></i><span>GitHub</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Releases</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://open-cluster-management.io>main</a></li><li><a class=dropdown-item href=https://v0-16.open-cluster-management.io>v0.16</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.5240367ca69fafe579b22b0f25f014ae.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/developer-guides/>Return to the regular view of this page</a>.</p></div><h1 class=title>Developer Guides</h1><ul><li>1: <a href=#pg-f12d911ccbae76575b9c0ec1c1b3680f>Add-on Developer Guide</a></li><li>2: <a href=#pg-8c3c7a28d5e041bf3f73af1a9f21e1b5>VScode Extension</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-f12d911ccbae76575b9c0ec1c1b3680f>1 - Add-on Developer Guide</h1><p>This page is a developer guide about how to build an OCM add-on using addon-framework.</p><h2 id=supported-version>Supported version</h2><p>The OCM v1.0.0 requires addon-framework v0.9.3 and above versions.</p><p>And notice there&rsquo;s breaking changes in <a href=/docs/developer-guides/addon/#automatic-installation>automatic installation</a> in addon-framework version v0.10.0.</p><h2 id=overview>Overview</h2><p>Add-on is an extension which can work with multiple clusters based on the foundation components in open-cluster-management.
Add-ons are Open Cluster Management-based extensions that can be used to work with multiple clusters.
Add-ons can support different configurations for different managed clusters, and can also be used to read data from the hub cluster.
For example, you might use the <a href=https://github.com/open-cluster-management-io/managed-serviceaccount>managed-serviceaccount</a> add-on to collect the tokens from managed cluster back to the hub cluster,
use the <a href=https://github.com/open-cluster-management-io/cluster-proxy>cluster-proxy </a>addon to establish a reverse proxy tunnels from the managed cluster to the hub cluster, etc.</p><p>A typical add-on should consist of two kinds of components:</p><p><strong>Add-on agent:</strong> The components running in the managed clusters which can be any kubernetes resources, for example
it might be a container with permissions to access the hub cluster, an Operator, or an instance of Operator, etc.</p><p><strong>Add-on manager:</strong> A kubernetes controller in the hub cluster that generates and applies the add-on agent manifests to the managed clusters
via the ManifestWork API. The manager also can optionally manage the lifecycle of add-on.</p><p>There are 2 API resources for add-on in the OCM hub cluster:</p><p><strong>ClusterManagementAddOn:</strong> This is a cluster-scoped resource which allows the user to discover which add-on is available
for the cluster manager and also provides metadata information about the add-on such as display name and description information.
The name of the <code>ClusterManagementAddOn</code> resource will be used for the namespace-scoped <code>ManagedClusterAddOn</code> resource.</p><p><strong>ManagedClusterAddOn:</strong> This is a namespace-scoped resource which is used to trigger the add-on agent to be installed
on the managed cluster, and should be created in the <code>ManagedCluster</code> namespace of the hub cluster.
<code>ManagedClusterAddOn</code> also holds the current state of an add-on.</p><p>There is a library named <a href=https://github.com/open-cluster-management-io/addon-framework>addon-framework</a> which provides
some simple user interfaces for developers to build their add-on managers easily.</p><p>We have some available add-ons in the OCM community:</p><ul><li><a href=https://github.com/open-cluster-management-io/cluster-proxy>cluster-proxy</a></li><li><a href=https://github.com/open-cluster-management-io/managed-serviceaccount>managed-serviceaccount</a></li><li><a href=https://github.com/open-cluster-management-io/argocd-pull-integration>argocd-pull-integration</a></li><li><a href=https://github.com/open-cluster-management-io/governance-policy-addon-controller>config-policy-controller</a></li><li><a href=https://github.com/open-cluster-management-io/governance-policy-addon-controller>governance-policy-framework</a></li></ul><h2 id=write-your-first-add-on>Write your first add-on</h2><p>Let&rsquo;s implement a simple add-on manager using addon-framework, which deploys a busybox deployment in the managed cluster.
You can find the example in <a href=https://github.com/open-cluster-management-io/addon-framework/tree/4172c567862306031ac0405f82eb4f7b4d74b30a/cmd/example/busybox>here</a>.</p><h3 id=implement-the-addon-manager>Implement the addon manager</h3><p>First, create your Go project, and the project should contain a <code>main.go</code> file and a folder <code>manifests</code>. The folder name
can be customized, the example uses <code>manifests</code> as the folder name. <code>main.go</code> contains the Go code of the addon manager.
<code>manifests</code> contains the addon agent&rsquo;s manifest files to be deployed on the managed cluster.</p><p>The <code>main.go</code> file is like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;context&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;embed&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;os&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>restclient</span> <span style=color:#4e9a06>&#34;k8s.io/client-go/rest&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;k8s.io/klog/v2&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;open-cluster-management.io/addon-framework/pkg/addonfactory&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;open-cluster-management.io/addon-framework/pkg/addonmanager&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//go:embed manifests
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>FS</span> <span style=color:#000>embed</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FS</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>  <span style=color:#000>addonName</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;busybox-addon&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>kubeConfig</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>restclient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>InClusterConfig</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>     <span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Exit</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>addonMgr</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>addonmanager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>New</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>kubeConfig</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>     <span style=color:#000>klog</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Errorf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;unable to setup addon manager: %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>     <span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Exit</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>agentAddon</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewAgentAddonFactory</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>FS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;manifests&#34;</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>BuildTemplateAgentAddon</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>     <span style=color:#000>klog</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Errorf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;failed to build agent addon %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>     <span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Exit</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>addonMgr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddAgent</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>agentAddon</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>     <span style=color:#000>klog</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Errorf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;failed to add addon agent: %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>     <span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Exit</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>ctx</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Background</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>go</span> <span style=color:#000>addonMgr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Start</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Done</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>You need to define an <code>embed.FS</code> to embed the files in <code>manifests</code> folder.</p><p>And then you need to build an <code>agentAddon</code> using the <code>agentAddonFactory</code>, and tell the <code>agentAddonFactory</code> the name of
the add-on and the agent manifests.</p><p>Finally, you just add the <code>agentAddon</code> to the <code>addonManager</code> and start the <code>addonManager</code>.</p><p>With above code, the addon manager is implemented. Next is to implement the addon agent part. In this example, the add-on agent
manifest to be deployed on managed cluster is a busybox deployment.</p><p>Create file <code>deployment.yaml</code> in <code>manifests</code> folder, the <code>deployment.yaml</code> is like this:</p><pre tabindex=0><code>kind: Deployment
apiVersion: apps/v1
metadata:
 name: busybox
 namespace: open-cluster-management-agent-addon
spec:
 replicas: 1
 selector:
   matchLabels:
     addon: busybox
 template:
   metadata:
     labels:
       addon: busybox
   spec:
     containers:
       - name: busybox
         image: busybox
         imagePullPolicy: IfNotPresent
         args:
           - &#34;sleep&#34;
           - &#34;3600&#34;
</code></pre><p>Then you can follow next section to <a href=/docs/developer-guides/addon/##deploy-the-add-on-manager-on-your-hub-cluster>deploy the add-on manager on your hub cluster</a>. The add-on manager will watch the <code>ManagedClusterAddOn</code>, and deploy the add-on agent manifests to the targeted managed cluster via <code>ManifestWork</code>.</p><h3 id=deploy-the-add-on-manager-on-your-hub-cluster>Deploy the add-on manager on your hub cluster</h3><p>Now you can build your add-on manager as an image and deploy it on the hub cluster.</p><p>Following below steps to build the image for the <a href=https://github.com/open-cluster-management-io/addon-framework/tree/4172c567862306031ac0405f82eb4f7b4d74b30a/cmd/example/busybox>example</a>.
This image contains several example addon managers, including the busybox example.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/open-cluster-management-io/addon-framework.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> addon-framework
</span></span><span style=display:flex><span>make images
</span></span></code></pre></div><p>In addition to the deployment definition, there are also some additional resources to be deployed on the hub cluster. An example of the deployment manifests for the add-on manager is <a href=https://github.com/open-cluster-management-io/addon-framework/tree/main/examples/deploy/addon/busybox>here</a>.
Following below steps to deploy the add-on manager.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make deploy-busybox
</span></span></code></pre></div><p>With the add-on manager deployed, you can see the <code>busybox-addon-controller</code> running in namespace <code>open-cluster-management</code> on the hub cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc get pods -n open-cluster-management
</span></span><span style=display:flex><span>NAME                                       READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>busybox-addon-controller-d977665d5-x28qc   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          27m
</span></span></code></pre></div><h4 id=rbac-of-the-addon-manager>RBAC of the addon manager</h4><p>There are some minimum required permissions for the addon manager controller to run on the hub cluster. It needs to:</p><ol><li><em>get/list/watch/update</em> the <code>ManagedCluster</code>.</li><li><em>get/list/watch/create/update/patch/delete</em> the <code>ManagedClusterAddOn</code> and <code>ManifestWork</code>.</li><li><em>get/list/watch</em> the <code>ClusterManagementAddOn</code>.</li></ol><h4 id=clustermanagementaddon>ClusterManagementAddOn</h4><p>From a user’s perspective, to install the addon to the hub cluster the hub admin should register a globally-unique
<code>ClusterManagementAddOn</code> resource as a singleton placeholder in the hub cluster. For instance, the <a href=https://github.com/open-cluster-management-io/addon-framework/blob/main/examples/deploy/addon/busybox/resources/busybox_clustermanagementaddon.yaml><code>ClusterManagementAddOn</code></a>
for the busybox-addon:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>busybox-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>addOnMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Busybox Addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;busybox-addon is an example addon to deploy busybox pod on the managed cluster&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=enable-the-add-on-for-a-managed-cluster>Enable the add-on for a managed cluster.</h3><p>Now your addon-manager is running on the hub cluster.
To deploy the busybox add-on agent to a certain managed cluster, you need to create a <code>ManagedClusterAddOn</code> in the
managed cluster namespace of hub cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>busybox-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>installNamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>You can set any existing namespace in the managed cluster as the <code>installNamespace</code> here, and the add-on manager will
deploy the add-on agent manifests in this namespace of the managed cluster.</p><blockquote><p>Note: <code>open-cluster-management-agent-addon</code> is our default namespace to install the add-on agent manifests in the managed cluster.</p></blockquote><p>You can also use the <code>clusteradm</code> command to enable the busybox-addon for the managed cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ clusteradm addon <span style=color:#204a87>enable</span> --names busybox-addon --namespace open-cluster-management-agent-addon --clusters cluster1
</span></span></code></pre></div><p>After enabling the add-on for the managed cluster, you can find a <code>ManifestWork</code> named <code>addon-busybox-addon-deploy</code> is
deploying on the managed cluster namespace of the hub cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get manifestworks.work.open-cluster-management.io -n cluster1
</span></span><span style=display:flex><span>NAME                         AGE
</span></span><span style=display:flex><span>addon-busybox-addon-deploy   2m
</span></span></code></pre></div><p>And the busybox deployment is deployed on the managed cluster too.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get deployment -n open-cluster-management-agent-addon
</span></span><span style=display:flex><span>NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>busybox                   1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           2m
</span></span></code></pre></div><h3 id=disable-the-add-on-for-a-managed-cluster>Disable the add-on for a managed cluster</h3><p>You can delete the <code>ManagedClusterAddOn</code> CR in the managed cluster namespace of the hub cluster to disable the add-on for
the managed cluster.The created <code>ManifestWork</code> will be deleted and the add-on agent manifests will be removed from the
managed cluster too.</p><p>You also can use the <code>clusteradm</code> command to disable the add-on for a managed cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ clusteradm addon disable --names busybox-addon --clusters cluster1
</span></span></code></pre></div><p>You can also use the <code>clusteradm</code> command to disable the add-ons for all managed clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ clusteradm addon disable --names busybox-addon --all-clusters <span style=color:#204a87>true</span>
</span></span></code></pre></div><p>If you delete the <code>ClusterManagementAddOn</code> on the hub cluster, the <code>ManagedClusterAddOn</code> CRs in all managed cluster
namespaces will be deleted too.</p><h3 id=whats-the-next>What’s the next</h3><p>However, this add-on just ensures a pod to run on the managed cluster, and you cannot see the status of the addon,
and there are not any functionality to manage the clusters. The addon-framework also provides other configurations
for add-on developers.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get managedclusteraddons.addon.open-cluster-management.io -n cluster1
</span></span><span style=display:flex><span>NAME                AVAILABLE   DEGRADED   PROGRESSING
</span></span><span style=display:flex><span>busybox-addon      Unknown
</span></span></code></pre></div><p>Next, you need to configure the addon.</p><h2 id=add-on-agent-configurations>Add-on agent configurations</h2><h3 id=monitor-addon-healthiness>Monitor addon healthiness</h3><p>In the busybox example above, we found the <code>AVAILABLE</code> status of the <code>ManagedClusterAddOn</code> is always <code>Unknown</code>.</p><p>That’s because the add-on manager did not monitor the status of the add-on agent from the hub cluster.</p><p>We support 3 kinds of health prober types to monitor the healthiness of add-on agents.</p><ol><li><p><strong>Lease</strong></p><p>The add-on agent maintains a <code>Lease</code> in its installation namespace with its status, the <a href=https://open-cluster-management.io/concepts/architecture/#registration>registration agent</a> will
check this <code>Lease</code> to maintain the <code>AVAILABLE</code> status of the <code>ManagedClusterAddOn</code>.</p><p>The addon-framework provides a <a href=https://github.com/open-cluster-management-io/addon-framework/blob/main/pkg/lease/lease_controller.go#L24>leaseUpdater</a> interface which can make it easier.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>leaseUpdater</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>lease</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewLeaseUpdater</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>spokeKubeClient</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>installNamespace</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>go</span> <span style=color:#000>leaseUpdater</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Start</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Background</span><span style=color:#000;font-weight:700>())</span>
</span></span></code></pre></div><p><code>Lease</code> is the default prober type for add-on, there is nothing to configure for the add-on manager.</p></li><li><p><strong>Work</strong></p><p><code>Work</code> health prober indicates the healthiness of the add-on is equal to the overall dispatching status of the
corresponding ManifestWork resources. It&rsquo;s applicable to those add-ons that don&rsquo;t have a container agent
in the managed clusters or don&rsquo;t expect to add <code>Lease</code> for the agent container.
The add-on manager will check if the work is <code>Available</code> on the managed clusters.
In addition, the user can define a <code>HealthCheck</code> prober function to check more detailed status based on status
feedback from the <code>ManifestWork</code>.</p><p>It is required to define a <code>HealthProber</code> instance first. Here is an example to check if the <code>availableReplicas</code> of
add-on agent deployment is more than 1. If yes, it will set the <code>AVAILABLE</code> status of <code>ManagedClusterAddOn</code> to <code>true</code>.
Otherwise, the <code>AVAILABLE</code> status of <code>ManagedClusterAddOn</code> will be false.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>healthProber</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>utils</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewDeploymentProber</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>types</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NamespacedName</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>Name</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;workprober-addon-agent&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Namespace</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;open-cluster-management-agent-addon&#34;</span><span style=color:#000;font-weight:700>})</span>
</span></span></code></pre></div><p>And then you can configure the <code>HealthProber</code> to the agentAddon.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>agentAddon</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewAgentAddonFactory</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>FS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;manifests&#34;</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithAgentHealthProber</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>healthProber</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>BuildTemplateAgentAddon</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div></li><li><p><strong>DeploymentAvailability</strong></p><p><code>DeploymentAvailability</code> health prober indicates the healthiness of the add-on is connected to the availability of
the corresponding agent deployment resources on the managed cluster. It&rsquo;s applicable to those add-ons that running
<code>Deployment</code> type workload on the managed cluster. The add-on manager will check if the <code>readyReplicas</code> of the
add-on agent deployment is more than 1 to set the addon Status.</p><p>Set the type of <code>healthProber</code> to <code>DeploymentAvailability</code> to enable this prober.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>healthProber</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HealthProber</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Type</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HealthProberTypeDeploymentAvailability</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></li><li><p><strong>WorkloadAvailability</strong></p><p><code>WorkloadAvailability</code> health prober indicates the healthiness of the add-on is connected to the availability of
the corresponding agent workload resources(only <code>Deployment</code> and <code>DaemonSet</code> are supported for now) on the managed
cluster. It&rsquo;s applicable to those add-ons that running <code>Deployment</code> and/or <code>DeamonSet</code> workloads on the managed
cluster. The add-on manager will check if <code>readyReplicas > 1</code> for each <code>Deployment</code> and
<code>NumberReady == DesiredNumberScheduled</code> for each <code>DaemonSet</code> of the add-on agent to set the addon Status.</p><p>Set the type of <code>healthProber</code> to <code>WorkloadAvailability</code> to enable this prober.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>healthProber</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HealthProber</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Type</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HealthProberTypeWorkloadAvailability</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></li><li><p><strong>None</strong></p><p>If you want to check and maintain the <code>AVAILABLE</code> status of <code>ManagedClusterAddOn</code> by yourself, set the type of
<code>healthProber</code> to <code>None</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>healthProber</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HealthProber</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Type</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HealthProberTypeNone</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></li></ol><h3 id=automatic-installation>Automatic installation</h3><p>NOTE:</p><ul><li>The automatic installation is no longer supported since addon-framework v0.10.0. Please use the <code>InstallStrategy</code> in
<a href=/docs/developer-guides/addon/#managing-the-add-on-agent-lifecycle-by-addon-manager>Managing the add-on agent lifecycle by addon-manager</a> section
instead.</li><li>The automatic installation is still avaliable in addon-framework version v0.9.3, which is also the
minimal supported addon-framework version in OCM v1.0.0. Using the previous version will have install conficts.</li></ul><p>In the busybox add-on example, you need to create a <code>ManagedClusterAddOn</code> CR to enable the add-on manually.
The addon-framework also provides a configuration called <code>InstallStrategy</code> to support installing addon automatically.</p><p>Currently, the addon-framework supports <code>InstallAllStrategy</code> and <code>InstallByLabelStrategy</code> strategies.</p><p><code>InstallAllStrategy</code> will create <code>ManagedClusterAddOn</code> for all managed cluster namespaces automatically.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>installStrategy</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>InstallAllStrategy</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;open-cluster-management-agent-addon&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p><code>InstallByLabelStrategy</code> will create <code>ManagedClusterAddOn</code> for the selected managed cluster namespaces automatically.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>installStrategy</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>InstallStrategy</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#000>Type</span><span style=color:#000;font-weight:700>:</span>             <span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>InstallByLabel</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>InstallNamespace</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;open-cluster-management-agent-addon&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>LabelSelector</span><span style=color:#000;font-weight:700>:</span>    <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>metav1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>LabelSelector</span><span style=color:#000;font-weight:700>{</span><span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Configure the <code>InstallStrategy</code> to the agentAddon:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>agentAddon</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewAgentAddonFactory</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>FS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;manifests&#34;</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithInstallStrategy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>installStrategy</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>BuildTemplateAgentAddon</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>Addtionally, if you are using addon-framework v0.9.3 or higher, need to grant a <code>patch</code> permission on <code>ClusterManagementAddon</code> to your addon manager.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;addon.open-cluster-management.io&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;clustermanagementaddons&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;get&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;list&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;watch&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;patch&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The below annotation will be added automatically to claim the <code>ManagedClusterAddon</code> lifecycle is managed by the addon itself.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;self&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Manual</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=register-your-add-on>Register your add-on</h3><p>In most cases, the add-ons have requirements to access the hub cluster or other central service endpoint with TLS authentication.
For example, an add-on agent needs to get a resource in its cluster namespace of the hub cluster, or the add-on agent
needs to access the exposed service on the hub cluster.</p><p>The addon-framework supports a solution that the addon can access the <code>kube-apiserver</code> with a kube style API or
other endpoints on the hub cluster with client certificate authentication after it is registered using <code>CSR</code>.</p><p>The addon-framework provides an interface to help add-on manager to save the add-on configuration information to
its corresponding <code>ManagedClusterAddOns</code>.</p><p>On the managed cluster, the registration agent watches <code>ManagedClusterAddOns</code> on the hub cluster.
The registration agent follows next steps to register an add-on:</p><ol><li>The registration agent creates a <code>CSR</code> request with its own hub kubeConfig to register the add-on to the hub cluster.</li><li>On the hub cluster, the add-on manager approves the <code>CSR</code> request. The addon-framework also provides
an interface which the add-on manager can implement it to approve its <code>CSR</code> automatically.</li><li>After the <code>CSR</code> request is approved on the hub cluster, the registration agent gets the certificate from
the <code>CSR</code> request and saves the client certificate to a secret in the add-on agent install namespace.
If the <code>SignerName</code> is <code>kubernetes.io/kube-apiserver-client</code>, the secret name will be <code>{addon name}-hub-kubeconfig</code>.
Otherwise, the secret name will be <code>{addon name}-{signer name}-client-cert</code>.</li><li>The add-on agent can mount the secret to get the client certificate to connect with the hub cluster or the custom service endpoint.</li><li>When the certificate of managed cluster addon is about to expire, the registration agent will send a request to
rotate the certificate on the hub cluster, the addon manager will approve the certificate rotation request.</li></ol><p>Now we build another add-on that is going to sync configmap from the hub cluster to the managed cluster.
The add-on code can be found <a href=https://github.com/open-cluster-management-io/addon-framework/tree/4172c567862306031ac0405f82eb4f7b4d74b30a/cmd/example/helloworld>here</a> .</p><p>Specifically, since the addon agent needs to read configmap from the hub, we need to define the registration option for this addon.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>NewRegistrationOption</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>kubeConfig</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>rest</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Config</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>agentName</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RegistrationOption</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RegistrationOption</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>CSRConfigurations</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>KubeClientSignerConfigurations</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>agentName</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>        <span style=color:#000>CSRApproveCheck</span><span style=color:#000;font-weight:700>:</span>   <span style=color:#000>utils</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>DefaultCSRApprover</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>agentName</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>        <span style=color:#000>PermissionConfig</span><span style=color:#000;font-weight:700>:</span>  <span style=color:#000>rbac</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddonRBAC</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>kubeConfig</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><code>CSRConfigurations</code> returns a list of <code>CSR</code> configuration for the addd-on agent in a managed cluster. The <code>CSR</code> will
be created from the managed cluster for add-on agent with each <code>CSRConfiguration</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>KubeClientSignerConfigurations</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>agentName</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cluster</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>clusterv1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ManagedCluster</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#000>addonapiv1alpha1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RegistrationConfig</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cluster</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>clusterv1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ManagedCluster</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#000>addonapiv1alpha1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RegistrationConfig</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#000>addonapiv1alpha1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RegistrationConfig</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>SignerName</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>certificatesv1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>KubeAPIServerClientSignerName</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#000>Subject</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>addonapiv1alpha1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Subject</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>User</span><span style=color:#000;font-weight:700>:</span>   <span style=color:#000>DefaultUser</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cluster</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>agentName</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>Groups</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>DefaultGroups</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cluster</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addonName</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>The original Kubernetes <code>CSR</code> API only supports three built-in signers:</p><ul><li>kubernetes.io/kube-apiserver-client</li><li>kubernetes.io/kube-apiserver-client-kubelet</li><li>kubernetes.io/kubelet-serving</li></ul><p>However, in some cases, we need to sign additional custom certificates for the add-on agents which are not used for connecting any kube-apiserver.
The add-on manager can be serving as a custom <code>CSR</code> <code>signer</code> controller based on the addon-framework’s extensibility by implementing the signing logic.
The addon-framework will also keep rotating the certificates automatically for the add-on after successfully signing the certificates.</p><p><code>CSRApproveCheck</code> checks whether the add-on agent registration should be approved by the add-on manager.
The <code>utils.DefaultCSRApprover</code> is implemented to auto-approve all the <code>CSRs</code>. A better <code>CSR check</code> is recommended to include:</p><ol><li>The validity of the requester&rsquo;s requesting identity.</li><li>The other request payload such as key-usages.</li></ol><p>If the function is not set, the registration and certificate renewal of the add-on agent needs to be approved manually on the hub cluster.</p><p><code>PermissionConfig</code> defines a function for an add-on to set up RBAC permissions on the hub cluster after the <code>CSR</code> is approved.
In this example, it will create a role in the managed cluster namespace with <em>get/list/watch</em> configmaps permissions,
and bind the role to the group defined in <code>CSRConfigurations</code>.</p><p>Configure the registrationOption to the agentAddon.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>agentAddon</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewAgentAddonFactory</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>helloworld</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>helloworld</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;manifests/templates&#34;</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithGetValuesFuncs</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>helloworld</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetValues</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetValuesFromAddonAnnotation</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithAgentRegistrationOption</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>registrationOption</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithInstallStrategy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addonagent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>InstallAllStrategy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HelloworldAgentInstallationNamespace</span><span style=color:#000;font-weight:700>)).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>BuildTemplateAgentAddon</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>After deploying the example add-on, you can find the registration configuration in the <code>ManagedClusterAddOn</code> status.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>ownerReferences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>blockOwnerDeletion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>controller</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installNamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>registrations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>signerName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kubernetes.io/kube-apiserver-client</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>subject</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>system:open-cluster-management:cluster:cluster1:addon:helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>system:open-cluster-management:addon:helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>system:authenticated</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>system:open-cluster-management:cluster:cluster1:addon:helloworld:agent:2rn8d</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In this example, the addon requires a <code>CSR</code> access hub kube-api (with singer name <code>kubernetes.io/kube-apiserver-client</code>).
After the <code>CSR</code> is created on the hub cluster, the add-on manager will check the signer, group and subject of the <code>CSRs</code>
to verify whether the <code>CSR</code> is valid. If all fields are valid, the add-on manager will approve the <code>CSR</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>certificates.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CertificateSigningRequest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>open-cluster-management.io/addon-name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>open-cluster-management.io/cluster-name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-cluster1-helloworld-lb7cb</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>system:open-cluster-management:cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>system:open-cluster-management:managed-clusters</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>system:authenticated</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>request</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>xxx</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>signerName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kubernetes.io/kube-apiserver-client</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>usages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>digital signature</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>key encipherment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>client auth</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>system:open-cluster-management:cluster1:9bkfw</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>After the <code>CSR</code> is approved, the add-on controller creates the <code>Role</code> and <code>Rolebinding</code> in the cluster namespace.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get role -n cluster1
</span></span><span style=display:flex><span>NAME                                       CREATED AT
</span></span><span style=display:flex><span>open-cluster-management:helloworld:agent   2022-07-10T10:08:37Z
</span></span><span style=display:flex><span>$ kubectl get rolebinding -n cluster1
</span></span><span style=display:flex><span>NAME                                                           ROLE                                                              AGE
</span></span><span style=display:flex><span>open-cluster-management:helloworld:agent                       Role/open-cluster-management:helloworld:agent                     13m
</span></span></code></pre></div><p>The <code>Rolebinding</code> binds the <code>Role</code> to the Group <code>system:open-cluster-management:cluster:cluster1:addon:helloworld</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RoleBinding</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management:helloworld:agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>roleRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>apiGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Role</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management:helloworld:agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>subjects</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>apiGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Group</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>system:open-cluster-management:cluster:cluster1:addon:helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The registration agent will create a kubeConfig secret named <code>&lt;add-on name>-hub-kubeconfig</code> in the <code>addonInstallNamesapce</code>.
The addon agent can mount the secret to get the hub kubeConfig to connect with the hub cluster to <em>get/list/watch</em> the Configmaps.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get secret -n default
</span></span><span style=display:flex><span>NAME                              TYPE                                  DATA   AGE
</span></span><span style=display:flex><span>helloworld-hub-kubeconfig         Opaque                                <span style=color:#0000cf;font-weight:700>3</span>      9m52s
</span></span></code></pre></div><h3 id=add-your-add-on-agent-supported-configurations>Add your add-on agent supported configurations</h3><p>For some cases, you want to specify the configurations for your add-on agent, for example, you may want to use a configuration to configure your add-on agent image or use a configuration to configure your add-on agent node Selector and tolerations to make the agent to run on specific nodes.</p><p>The addon-framework supports re-rendering the add-on agent deployment when the add-on agent configurations are changed.</p><p>You can choose the <a href=https://github.com/open-cluster-management-io/api/blob/main/addon/v1alpha1/types_addondeploymentconfig.go><code>AddOnDeploymentConfig</code></a> API as the configuration for your add-on agent, it supports setting customized variables and node placement for your add-on agent deployment, and meanwhile you can also choose your own configuration.</p><p>You can do the following steps to reference your configurations in your add-on APIs with add-on framework</p><ol><li><p>Add the supported configuration types in your add-on <code>ClusterManagementAddOn</code>, we support to add multiple different configuration types in the <code>ClusterManagementAddOn</code>, for example</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworldhelm</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># the add-on supported configurations</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>configmaps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In this example, the <code>helloworldhelm</code> add-on supports using <code>AddOnDeploymentConfig</code> and <code>ConfigMap</code> as its configuration, and you can specify one default configuration for one configuration type, for example</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworldhelm</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#8f5902;font-style:italic># the add-on supported configurations</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#8f5902;font-style:italic># the default config for helloworldhelm</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>defaultConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span>- <span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>configmaps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Thus, all helloworldhelm add-ons on each managed cluster have one same default configuration <code>open-cluster-management/deploy-config</code></p></li><li><p>Register the supported configuration types when building one <code>AgentAddon</code> with <code>AgentAddonFactory</code></p></li><li><p>Implement a <code>GetValuesFunc</code> to transform the configuration to addon-framework <code>Values</code> object and add the <code>GetValuesFunc</code> to the <code>AgentAddonFactory</code>, for example</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>agentAddon</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewAgentAddonFactory</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;helloworldhelm&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>helloworld_helm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;manifests/charts/helloworld&#34;</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// register the supported configuration types
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>WithConfigGVRs</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>      <span style=color:#000>schema</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GroupVersionResource</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>Version</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;v1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Resource</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;configmaps&#34;</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>      <span style=color:#000>schema</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GroupVersionResource</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>Group</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;addon.open-cluster-management.io&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Version</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;v1alpha1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Resource</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;addondeploymentconfigs&#34;</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>    <span style=color:#000>WithGetValuesFuncs</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// get the AddOnDeloymentConfig object and transform it to Values object
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetAddOnDeloymentConfigValues</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>        <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewAddOnDeloymentConfigGetter</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addonClient</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>        <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ToAddOnNodePlacementValues</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// get the ConfigMap object and transform it to Values object
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#000>helloworld_helm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetImageValues</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>kubeClient</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>).</span><span style=color:#000>WithAgentRegistrationOption</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>registrationOption</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>    <span style=color:#000>BuildHelmAgentAddon</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>In this example, we register the <code>ConfigMap</code> and <code>AddOnDeploymentConfig</code> as the <code>helloworldhelm</code> add-on configuration. We use add-on framework
help function <a href=https://github.com/open-cluster-management-io/addon-framework/blob/main/pkg/addonfactory/addondeploymentconfig.go#L47><code>GetAddOnDeloymentConfigValues</code></a> to transform the <code>AddOnDeploymentConfig</code>, and we implemented the <a href=https://github.com/open-cluster-management-io/addon-framework/blob/main/examples/helloworld_helm/helloworld_helm.go#L64><code>GetImageValues</code></a> function to
transform the <code>ConfigMap</code>, you can find more details for add-on framework <code>Values</code> from the <a href=/docs/developer-guides/addon/#values-definition>Values definition</a> part.</p></li><li><p>Add the <code>get</code>, <code>list</code> and <code>watch</code> permissions to an add-on <code>clusterrole</code>, for example, the <a href=https://github.com/open-cluster-management-io/addon-framework/blob/main/examples/deploy/addon/helloworld-helm/resources/cluster_role.yaml>clusterrole</a> of <code>helloworldhelm</code> should have the following permissions</p></li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworldhelm-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;configmaps&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;get&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;list&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;watch&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;addon.open-cluster-management.io&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;addondeploymentconfigs&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;get&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;list&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;watch&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>To configure add-on, the add-on user need reference their configuration objects in <code>ManagedClusterAddOn</code>, for example</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworldhelm</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installNamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>configmaps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>image-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In this example, the add-on user reference the configuration <code>cluster1/deploy-config</code> and <code>cluster1/image-config</code> for <code>helloworldhelm</code> on <code>cluster1</code>. When the configuration references are added to an add-on, the add-on framework will show them in the status of <code>ManagedClusterAddOn</code> and render the add-on once, during the rendering process, the add-on framework will callback the <code>GetValuesFunc</code>s to transform the add-on configuraton object to add-on framework <code>Values</code> object and use <code>Values</code> object to render the add-on agent deployment resources. If the add-on configuration objects are updated, the add-on framework will render the add-on again.</p><h2 id=build-an-addon-using-helm-charts-or-raw-manifests>Build an addon using helm charts or raw manifests.</h2><h3 id=building-steps>Building steps</h3><p>The addon-framework supports helm charts or raw manifests as the add-on agent manifests. The building steps are the same:</p><ol><li><p>Copy the helm chart or raw manifests files into the add-on manager project. And define an <code>embed.FS</code> to embed the files
into your Go program.</p><p>The example using helm chart is <a href=https://github.com/open-cluster-management-io/addon-framework/tree/main/examples/helloworld_helm>helloworld_helm addon</a>,
and the example using raw manifests is <a href=https://github.com/open-cluster-management-io/addon-framework/tree/main/examples/helloworld>helloworld addon</a>.</p></li><li><p>Build different <code>agentAddons</code> using the <code>agentAddonFactory</code> instance with <code>BuildHelmAgentAddon</code> or <code>BuildTemplateAgentAddon</code>.</p><p>For helm chart building:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>agentAddon</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewAgentAddonFactory</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>helloworld_helm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>helloworld_helm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;manifests/charts/helloworld&#34;</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithGetValuesFuncs</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>helloworld_helm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetValues</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetValuesFromAddonAnnotation</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithAgentRegistrationOption</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>registrationOption</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>BuildHelmAgentAddon</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>For raw manifests building:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>agentAddon</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewAgentAddonFactory</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>helloworld</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddonName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>helloworld</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;manifests/templates&#34;</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithGetValuesFuncs</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>helloworld</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetValues</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addonfactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetValuesFromAddonAnnotation</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithAgentRegistrationOption</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>registrationOption</span><span style=color:#000;font-weight:700>).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>WithInstallStrategy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addonagent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>InstallAllStrategy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>agent</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HelloworldAgentInstallationNamespace</span><span style=color:#000;font-weight:700>)).</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>BuildTemplateAgentAddon</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div></li><li><p>Add the agentAddon to the addon manager.</p></li><li><p>Start the addon manager.</p></li></ol><h3 id=values-definition>Values definition</h3><p>The addon-framework supports 3 add-on built-in values and 3 helm chart built-in values for helm chart add-on manifests.</p><ul><li><code>Value.clusterName</code></li><li><code>Value.addonInstallNamespace</code></li><li><code>Value.hubKubeConfigSecret</code> (used when the add-on is needed to register to the hub cluster)</li><li><code>Capabilities.KubeVersion</code> is the <code>ManagedCluster.Status.Version.Kubernetes</code>.</li><li><code>Release.Name</code> is the add-on name.</li><li><code>Release.Namespace</code> is the <code>addonInstallNamespace</code>.</li></ul><p>The addon-framework supports 3 add-on built-in values in the config of templates for the raw manifests add-on.</p><ul><li><code>ClusterName</code></li><li><code>AddonInstallNamespace</code></li><li><code>HubKubeConfigSecret</code> (used when the AddOn is needed to register to the hub cluster)</li></ul><p>In the list of <code>GetValuesFuncs</code>, the values from the big index Func will override the one from low index Func.</p><p>The built-in values will override the values obtained from the list of <code>GetValuesFuncs</code>.</p><p>The Variable names in Values should begin with lowercase. So the best practice is to define a json struct for the values,
and convert it to Values using the <code>JsonStructToValues</code>.</p><p>Values from annotation of <code>ManagedClusterAddOn</code></p><p>The addon-framework supports a helper <code>GetValuesFunc</code> named <code>GetValuesFromAddonAnnotation</code> which can get values from
the annotations of <code>ManagedClusterAddOn</code>.</p><p>The key of the Helm Chart values in annotation is <code>addon.open-cluster-management.io/values</code>,
and the value should be a valid json string which has key-value format.</p><h2 id=hosted-mode>Hosted mode</h2><p>The addon-framework supports add-on in Hosted mode, that the agent manifests will be deployed outside the managed cluster.
We can choose to run add-on in Hosted mode or Default mode if the managed cluster is imported to the hub in Hosted mode.
By default, the add-on agent will run on the managed cluster(Default mode).
We can add an annotation <code>addon.open-cluster-management.io/hosting-cluster-name</code> for the <code>ManagedClusterAddon</code>,
so that the add-on agent will be deployed on the certain hosting cluster(Hosted mode),
the value of the annotation is the hosting cluster which should:</p><ul><li>be a managed cluster of the hub as well.</li><li>be the same cluster where the managed cluster <code>klusterlet</code>(registration-agent & work-agent) runs.</li></ul><p>We defined a label <code>addon.open-cluster-management.io/hosted-manifest-location</code> to indicate which cluster the add-on
agent manifests should be deployed.</p><ul><li>No matter what the value is, all manifests will be deployed on the managed cluster in Default mode.</li><li>When the label does not exist or the value is <code>managed</code>: the manifest will be deployed on the managed cluster in Hosted mode.</li><li>When the value is <code>hosting</code>: the manifest will be deployed on the hosting cluster in Hosted mode.</li><li>When the value is <code>none</code>: the manifest will not be deployed in Hosted mode.</li></ul><p>More details you can find in the <a href=https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/63-hosted-addon>design</a>,
and we have an example in <a href=https://github.com/open-cluster-management-io/addon-framework/tree/main/examples/helloworld_hosted>here</a>.</p><h2 id=pre-delete-hook>Pre-delete hook</h2><p>The addon-framework provides a hook manifest before delete the add-on.
The hook manifest supports <code>Jobs</code> or <code>Pods</code> to do some cleanup work before the add-on agent is deleted on the managed cluster.</p><p>You need only add the label <code>open-cluster-management.io/addon-pre-delete</code> to the <code>Jobs</code> or <code>Pods</code>in the add-on manifests.
The <code>Jobs</code> or <code>Pods</code> will not be applied until the <code>ManagedClusterAddOn</code> is deleted.
And the <code>Jobs</code> or <code>Pods</code> will be applied on the managed cluster by applying the manifestWork named <code>addon-&lt;addon name>-pre-delete</code>
when the <code>ManagedClusterAddOn</code> is under deleting.
After the <code>Jobs</code> are <code>Completed</code> or <code>Pods</code> are in the <code>Succeeded</code> phase, all the deployed <code>ManifestWorks</code> will be deleted.</p><p>You can find the example from <a href=https://github.com/open-cluster-management-io/addon-framework/tree/main/examples/helloworld_helm>here</a>.</p><h2 id=what-happened-under-the-scene>What happened under the scene</h2><div style=text-align:center;padding:20px><img src=/addon-architecture.png alt="Addon Architecture" style="margin:0 auto;width:80%"></div><p>This architecture graph shows how the coordination between add-on manager and add-on agent works.</p><ol><li>The registration agent creates a <code>CSR</code> request with its own hub kubeConfig to register the add-on to the hub cluster.</li><li>On the hub cluster, the add-on manager approves the <code>CSR</code> request.</li><li>After the <code>CSR</code> request is approved on the hub cluster, the registration agent gets the certificate from the <code>CSR</code> request
to establish the hub kubeConfig and save the hub kubeConfig to a secret in the managed cluster addon namespace.</li><li>The add-on manager is watching the <code>ManagedClusterAddOn</code> for all managed cluster namespaces.
And will create an add-on deploy <code>ManifestWork</code> in the managed cluster namespace once the <code>ManagedClusterAddOn</code> is created in this managed cluster namespace.</li><li>The work agent will apply the manifests in the <code>ManifestWork</code> on the managed cluster.</li><li>The add-on agent will mount the secret created by the registration agent to get the hub kubeConfig to connect with the hub cluster.</li></ol><h2 id=managing-the-add-on-agent-lifecycle-by-addon-manager>Managing the add-on agent lifecycle by addon-manager</h2><p>The add-on agent lifecycle can now be managed by the general
<code>addon-manager</code> starting from OCM v0.11.0. This is achieved through enhancements
to the <code>ClusterManagementAddOn</code> and <code>ManagedClusterAddOn</code> APIs.</p><ol><li>Install strategy</li></ol><p>With the install strategy defined in the <code>ClusterManagementAddOn</code> API, users can
configure which clusters the related <code>ManagedClusterAddon</code> should be enabled by
referencing the <code>Placement</code>. For example, enabling the <code>helloworld</code> add-on on
clusters labeled with aws.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addOnMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-aws</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-aws</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>predicates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>requiredClusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>claimSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>matchExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>platform.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>In</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>values</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#000>aws</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ol start=2><li>Rollout strategy</li></ol><p>With the rollout strategy defined in the <code>ClusterManagementAddOn</code> API, users can
control the upgrade behavior of the add-on when there are changes in the <a href=/docs/developer-guides/addon/#add-your-add-on-agent-supported-configurations>supported configurations</a>.</p><p>For example, if the add-on user updates the &ldquo;deploy-config&rdquo; and wants to apply
the change to the add-ons to a &ldquo;canary&rdquo; <a href=https://open-cluster-management.io/concepts/placement/#decision-strategy>decision group</a> first.
If all the add-on upgrade successfully, then upgrade the rest of clusters progressively per cluster
at a rate of 25%. The rollout strategy can be defined as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addOnMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement-aws</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>progressive</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>maxConcurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#000>%</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Add-on developers can use addon-framework v0.9.3 and the above versions
to support the scenarios mentioned above.</p><ol><li>Modify the <code>go.mod</code> file to use the latest addon-framework and API versions.</li></ol><pre tabindex=0><code>open-cluster-management.io/addon-framework v0.9.3 // // or latest
open-cluster-management.io/api v0.13.0 // or latest
</code></pre><ol start=2><li><p>Remove the <code>WithInstallStrategy()</code> function described in the <a href=/docs/developer-guides/addon/#automatic-installation>automatic installation</a>
section since it conflicts with the install strategy defined in the <code>ClusterManagementAddOn</code> API level.</p></li><li><p>Claim that the addon is managed by the general <code>addon-manager</code> by adding the annotation
<code>addon.open-cluster-management.io/lifecycle: "addon-manager"</code> explicitly in the
<code>ClusterManagementAddOn</code>.</p></li></ol><p>Skip this step for OCM v0.14.0 and later version. The annotation is automatically added by the general addon manager.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ol start=4><li><p>Define the <code>installStrategy</code> and <code>rolloutStrategy</code> in the <code>ClusterManagementAddOn</code>
as shown in the example above. Note that the rollout strategy is triggered by
changes in configurations, so if the addon does not have <a href=/docs/developer-guides/addon/#add-your-add-on-agent-supported-configurations>supported cofingurations</a>,
the rollout strategy will not take effect.</p></li><li><p>If you do not want the automatic addon installation, set the install strategy type to <code>Manual</code>.</p></li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Manual</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=build-an-addon-with-addon-template>Build an addon with addon template</h2><p>Using the addon-framework to develop an addon requires developers to implement the interface defined in the
addon-framework via code and deploy a dedicated addon manager deployment on the hub cluster.
But if the addon you are trying to develop:</p><ul><li>not going to support hosted mode</li><li>the crucial agent workloads that need to be deployed to the managed cluster are <code>Deployments</code> and/or <code>DaemonSets</code></li><li>no other customized API is needed to configure the addon besides the <code>AddOnDeploymentConfig</code></li><li>no need to run anything on the hub cluster other than managing the addon agent</li></ul><p>you can have a try with the new API <code>AddOnTemplate</code> introduced from OCM v0.12.0 to build the addon, which can get rid
of coding, and only need to define some yaml files to build an addon.</p><p>Using <code>AddOnTemplate</code> to build an addon, the <code>AddonManagement</code> feature gate must not be disabled in
<code>ClusterManager.spec.addOnManagerConfiguration</code> and <code>Klusterlet.spec.registrationConfiguration</code></p><p>Enhancement proposal: <a href=https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/82-addon-template>Add-on Template</a></p><p>Note: The <code>DaemonSet</code> type workload is supported in the addon template(injecting environment variables, injecting
volumes, health probe for daemonsets) from OCM v0.14.0.</p><h3 id=steps-to-build-an-addon-with-addon-template>Steps to build an addon with addon template</h3><ol><li><p>Create an <code>AddOnTemplate</code> object to define the addon:
The <code>AddOnTemplate</code> API provides two parts of information to build an addon:</p><ul><li><code>manifests</code>: what resources will be deployed to the managed cluster</li><li><code>registration</code>: how to register the addon to the hub cluster</li></ul><p>For example, the following yaml file defines the <code>hello-template</code> addon, which will:</p><ul><li>deploy a <code>Deployment</code>, a <code>ServiceAccount</code>, and a <code>ClusterRoleBinding</code> to the managed cluster</li><li>register the addon to the hub cluster, and make the addon agent(Deployment hello-template-agent):<ul><li>have the permission to access resources defined in the <code>cm-admin</code> clusterRole in the <managed-cluster-name>namespace on the hub cluster(KubeClient type registration, CurrentCluster)</li><li>have the permission to access resources defined in the <code>cm-reader</code> Role in the <code>open-cluster-management</code>
namespace on the hub cluster(KubeClient type registration, SingleNamespace)</li><li>have the credential to access the customized endpoint(CustomSigner type registration)</li></ul></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnTemplate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addonName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>agentSpec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># required</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>serviceAccountName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>helloworld-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>quay.io/open-cluster-management/addon-examples:latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>imagePullPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>IfNotPresent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>args</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span>- <span style=color:#4e9a06>&#34;/helloworld&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span>- <span style=color:#4e9a06>&#34;agent&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span>- <span style=color:#4e9a06>&#34;--cluster-name={{CLUSTER_NAME}}&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span>- <span style=color:#4e9a06>&#34;--addon-namespace=open-cluster-management-agent-addon&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span>- <span style=color:#4e9a06>&#34;--addon-name=hello-template&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span>- <span style=color:#4e9a06>&#34;--hub-kubeconfig={{HUB_KUBECONFIG}}&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span>- <span style=color:#4e9a06>&#34;--v={{LOG_LEVEL}}&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># addonDeploymentConfig variables</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRoleBinding</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>roleRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>apiGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster-admin</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>subjects</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>registration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># optional</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># kubeClient or custom signer, if kubeClient, user and group is in a certain format.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># user is &#34;system:open-cluster-management:cluster:{clusterName}:addon:{addonName}:agent:{agentName}&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># group is [&#34;system:open-cluster-management:cluster:{clusterName}:addon:{addonName}&#34;,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>#           &#34;system:open-cluster-management:addon:{addonName}&#34;, &#34;system:authenticated&#34;]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>KubeClient</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kubeClient</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>hubPermissions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CurrentCluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>currentCluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>clusterRoleName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cm-admin</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># should be created by user</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SingleNamespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>singleNamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>roleRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>apiGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Role</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># should be created by user; the addon manager will grant the permission to the agent, so if the</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># role/clusterRole contains some permissions that the addon manager doesn&#39;t have, user needs to grant</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># the permission to the addon-manager (service account open-cluster-management-hub/addon-manager-controller-sa),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># otherwise the addon manager will fail to grant the permission to the agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cm-reader</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CustomSigner</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># addon-manager only generates the credential for the agent to authenticate to the hub cluster, not responsible</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># for the authroization which should be taken care of by the user</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>customSigner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>signerName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example.com/signer-test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>subject</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user-test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#000>group-test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>organizationUnit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#000>organization-test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>signingCA</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># type is &#34;kubernetes.io/tls&#34;; namespace is optional, &#34;open-cluster-management-hub&#34; will be used if</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># namespace is not set; user needs to grant the permission to the addon-manager (service account</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># open-cluster-management-hub/addon-manager-controller-sa) to access the secret</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ca-secret</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><strong>Notes</strong>:</p><ul><li>The permission related resources(i.e. <code>RoleBinding</code> <code>ClusterRoleBinding</code>) for <em>the addon agent access the local
managed cluster</em> defined in the <code>addonTemplate.agentSpec.workload.manifests</code> will be created on the managed cluster
by the work-agent, but the work-agent may not have permission to create these resources, users should refer to
<a href=https://open-cluster-management.io/concepts/manifestwork/#permission-setting-for-work-agent>permission-setting-for-work-agent</a>
to grant the work-agnet permissions to address the permission issue on the managed cluster side.</li><li>Permissions for <em>the addon agent access the hub cluster</em> defined in
<code>addonTemplate.registration[*].kubeClient.hubPermissions</code>, users should ensure:<ol><li><p>the referenced clusterrole/role(<code>.hubPermissions.currentCluster.clusterRoleName</code>
<code>.hubPermissions.singleNamespace.roleRef.name</code>, <code>cm-admin</code> and <code>cm-reader</code> in the above example) exists on the
hub cluster</p></li><li><p>the addon-manager has permission to create rolebinding to bind these (cluster)role for the addon-agent. For
example: users can create a clusterrolebinding to grant the permission to the addon-manager (service account
<code>open-cluster-management-hub/addon-manager-controller-sa</code>) to address the permission issue on the hub cluster
side. For the above example, if the addon-manager doesn&rsquo;t have the permission to create the <code>RoleBinding</code> to
bind the <code>cm-admin</code> role, users can grant the permission to the addon-manager by creating a
<code>ClusterRoleBinding</code> like below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRoleBinding</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-manager-cm-admin</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>roleRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>apiGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cm-admin</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>subjects</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-manager-controller-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-hub</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li></ol></li></ul></li><li><p>Create a <code>ClusterManagementAddOn</code> to declare this is template type addon which should be managed by the
addon-manager:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addOnMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template is a addon built with addon template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># declare it is a template type addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addontemplates</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>defaultConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li><li><p>Create a <code>ManagedClusterAddOn</code> to enable the addon on <code>cluster1</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installNamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li></ol><h3 id=use-variables-in-the-addon-template>Use variables in the addon template</h3><p>Users can use variables in the <code>addonTemplate.agentSpec.workload.manifests</code> field in the form of <code>{{VARIABLE_NAME}}</code>, it
is similar to go template syntax but not identical, only String value is supported. And there are two types of
variables:</p><ol><li>built-in variables;<ul><li>constant parameters(can not be overridden by user&rsquo;s variables):<ul><li><code>CLUSTER_NAME</code>: name of the managed cluster(e.g cluster1)</li></ul></li><li>default parameters(can be overridden by user&rsquo;s variables)<ul><li><code>HUB_KUBECONFIG</code>: path of the kubeconfig to access the hub cluster, default value is
<code>/managed/hub-kubeconfig/kubeconfig</code></li></ul></li></ul></li><li>Customize variables; Variables defines in <code>addonDeploymentConfig.customizedVariables</code> can be used.</li></ol><h3 id=using-kubeconfigcertificates-in-the-addon-agent-deployment>Using kubeconfig/certificates in the addon agent Deployment</h3><p>The addon manager will inject volumes into the addon agent deployments and daemonsets based on the
<code>addonTemplate.spec.registration</code> field.</p><ol><li><p>If there is a <code>KubeClient</code> type registration, the hub kubeconfig will be injected to the deployments defined in the
addon template, so users can use the hub kubeconfig located at <code>/managed/hub-kubeconfig/kubeconfig</code> to access the hub</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>volumeMounts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/managed/hub-kubeconfig</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hub-kubeconfig</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hub-kubeconfig</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>defaultMode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>420</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>secretName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>&lt;addon-name&gt;-hub-kubeconfig</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li><li><p>If there is a <code>CustomSigner</code> type registration, the secret signed via the custom signer defined in the
<code>CustomSignerRegistrationConfig</code> will be injected to the deployments and daemonsets defined in the addon template,
so users can use the certificate located at <code>/managed/&lt;signer-name>/tls.crt</code> and <code>/managed/&lt;signer-name>/tls.key</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>volumeMounts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/managed/&lt;signer-name&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># if the signer name contains &#34;/&#34;, it will be replaced by &#34;-&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cert-&lt;signer-name&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cert-&lt;signer-name&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># if the signer name contains &#34;/&#34;, it will be replaced by &#34;-&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>defaultMode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>420</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>secretName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>&lt;addon-name&gt;-&lt;signer-name&gt;-client-cert</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># if the signer name contains &#34;/&#34;, it will be replaced by &#34;-&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li></ol><h3 id=health-probe-of-the-template-type-addon>Health probe of the template type addon</h3><p>Since we only support the <code>Deployment</code> and <code>DaemonSet</code> resource as the crucial agent runtime workload, the addon-manager
will check if the deployment and daemonsets are available, if not, the addon will be considered as unhealthy.</p><h3 id=support-proxy-configuration-for-the-template-type-addon>Support proxy configuration for the template type addon</h3><p>From OCM v0.16.0, the template type addon can be configured to use the proxy by setting the
<code>addonDeploymentConfig.spec.proxyConfig</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnDeploymentConfig</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>proxy-deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-hub</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>proxyConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>httpProxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;http://test.com&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>httpsProxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;https://test.com&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>noProxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;api.ocm-hub.com,172.30.0.1&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Example: hub cluster api server and the local managed cluster api server</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>caBundle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dGVzdC1idW5kbGUK</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The proxy configuration <code>httpProxy</code>, <code>httpsProxy</code>, and <code>noProxy</code> will be injected as environments
<code>HTTP_PROXY</code>, <code>http_proxy</code>, <code>HTTPS_PROXY</code>, <code>https_proxy</code>, <code>NO_PROXY</code>, <code>no_proxy</code>(both uppercase and lowercase) to
the addon agent deployments and daemonsets.</p><p>If the <code>caBundle</code> is set, the addon-manager will create a configmap containing the ca bundle data in the addon install
namespace, and mount the configmap to the addon agent deployments and daemonsets, and then set an environment
<code>CA_BUNDLE_FILE_PATH</code> to the file path of the mounted ca bundle. If the addon needs to support the <code>caBundle</code> for the
<code>proxyConfig</code>, the <strong>addon developer should get the ca bundle from the environment variable</strong> <code>CA_BUNDLE_FILE_PATH</code>
to make the agent work with the proxy.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8c3c7a28d5e041bf3f73af1a9f21e1b5>2 - VScode Extension</h1><p>The OCM <a href=https://github.com/open-cluster-management-io/ocm-vscode-extension>VScode Extension</a> is a UI tool for OCM related Kubernetes resources.
The extension has been built upon Visual Studio Code and offers additional OCM administrative and monitoring features in order to improve operational efficiency and accelerate development within engineering teams.
The OCM VScode Extension provides tons of useful features, including easy to generate OCM related Kubernetes resources, automated local OCM environment creation and a simple and convenient monitoring view for cluster resources.
Having an effective UI tool for managing your cluster is key to a healthy environment. With the right user interface, you can administer changes to the cluster, track resources, and troubleshoot issues more efficiently, without having to use numerous additional CLI tools.</p><h2 id=prerequisite>Prerequisite</h2><p>You must meet the following prerequisites to install the VScode Extension:</p><ul><li>Ensure your <a href=https://code.visualstudio.com/download><code>Visual Studio Code</code></a> release is at least <code>v1.71.0</code>.</li></ul><p>Some VScode Extension features require a few additional prerequisites:</p><ul><li><p>To Manage Existing Resources ensure <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl><code>kubectl</code></a> is installed.</p></li><li><p>To Create Local Environment ensure <a href=https://kind.sigs.k8s.io/docs/user/quick-start/><code>kind</code></a>, <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl><code>kubectl</code></a> and <a href=https://github.com/open-cluster-management-io/clusteradm><code>clusteradm</code></a> are all installed.</p></li><li><p>To load Resources Snippets or create a Bootstrap Project no additional prerequisites are needed</p></li></ul><h2 id=installation>Installation</h2><h3 id=install-latest-version>Install Latest version</h3><p>In your VScode instance, go to the Extensions Marketplace (by clicking on the <em>Extensions</em> icon in the composite bar on the left hand side or simply typing Ctrl+Shift+X).</p><p>Search for <em>OCM Extension</em> and click install.</p><h3 id=install-specific-version>Install specific version</h3><p>To download a specific version of VScode Extention visit the <a href=https://github.com/open-cluster-management-io/ocm-vscode-extension/releases>releases page</a>, expand the <em>Assets</em> section of the target version,
and download the version for your operating system.</p><p>In your VScode instance, go to the Extensions Marketplace (by clicking on the <em>Extensions</em> icon in the composite bar on the left hand side or simply typing Ctrl+Shift+X).</p><p>Click the <strong>&mldr;</strong> at the top right corner of the palette, select the <em>Install from VSIX&mldr;</em> action, and browes for the specific <em>VSIX</em> file you downloaded.</p><p>Select a <em>VSIX</em> file and hit install.</p><h2 id=usage>Usage</h2><h3 id=resources-snippets>Resources Snippets</h3><p>The VScode Extension allows users to load Custom Resource (CR) snippets from the command palette.</p><p>The resources available as snipperts are:</p><ul><li>Subscription</li><li>Placement</li><li>Channel</li><li>ManagedClusterSet</li><li>ManagedClusterSetBinding</li></ul><p>Subscription snippets are available specifically tailored to either Git, Helm or ObjectBucket.</p><p>To exercise this feature you must take the following steps:</p><ol><li>Create a new yaml file in a desired path</li><li>Open the file and press Ctrl+Shift+P on your keyboard</li><li>In the search container at the top of your screen choose <em>Snippets: Insert Snippet</em></li><li>Choose a desired snippet from list</li></ol><div><img src=/snippets-from-palette.gif alt="Resources Snippets"></div><br><h3 id=bootstrap-project>Bootstrap Project</h3><p>Another Valuable feature of the VScode Extension is to create a Bootstrap project for the various channel types.</p><p>The Bootstrap project is basically a collection of snippets, customized to fit one of three channel types - Git, Helm or ObjectBucket, that form a project template for you to build upon.</p><p>To exercise this feature you must take the following steps:</p><ol><li>Press Ctrl+Shift+P on your keyboard</li><li>In the search container at the top of your screen choose <em>OCM: Create an application-manager project</em></li><li>Choose a desired channel type</li><li>Type in a project name and hit enter</li></ol><div><img src=/new-project.gif alt="Bootstrap Project"></div><br><h3 id=create-local-environment>Create Local Environment</h3><p>The Create Local Environment feature allows you to create a quick OCM multi-cluster control plane on a local <a href=https://kind.sigs.k8s.io/>kind</a> environment with only a click of a button.</p><p>The feature does it all for you:</p><ul><li>Verifies the existence of the required tools.</li><li>Creates as many <a href=https://kind.sigs.k8s.io/>kind</a> clusters as you need (customizable).</li><li>Initializes the <em>hub cluster</em> by installing a <a href=https://operatorhub.io/operator/cluster-manager>Cluster Manager</a> using <a href=https://github.com/open-cluster-management-io/clusteradm>clusteradm</a>, and <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl>kubectl</a>.</li><li>Installs a <a href=https://operatorhub.io/operator/klusterlet>Klusterlet</a> agent on the <em>managed clusters</em> and sends join requests to the <em>hub cluster</em> using <a href=https://github.com/open-cluster-management-io/clusteradm>clusteradm</a>, and <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl>kubectl</a>.</li><li>Accepts the join requests from the <em>hub cluster</em> using <a href=https://github.com/open-cluster-management-io/clusteradm>clusteradm</a>, and <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl>kubectl</a>.</li></ul><p>To exercise this feature you must take the following steps:</p><ol><li>Click on the <em>OCM</em> icon in the composite bar on the left hand side to open the VScode Extension control pane</li><li>Locate the <em>Create Local Environment</em> button in the <em>Developers Tools</em> section and give it a click</li><li>Notice that at the top of your screen an action container will prompt you to choose between default or custom configuration</li><li>After configuration was specified, a progress bar at the botom right of your screen will provide feadback on the build process</li></ol><div><img src=/create-local-env.gif alt="Create Local Environment" style="margin:0 auto;width:95%"></div><br><h3 id=manage-existing-resources>Manage Existing Resources</h3><p>The Manage Existing Resources feature provides a wide and detailed overview of all the resources residing in any one cluster.</p><p>To exercise this feature you must take the following steps:</p><ol><li>Access the <em>Cluster Details</em> tab either by:
* Pressing Ctrl+Shift+P on your keyboard and choosing <em>OCM-View: Cluster Details</em> in the search container at the top of your screen
* Clicking on the <em>OCM</em> icon in the composite bar on the left hand side to open the VScode Extension control pane, locating the <em>Connected Clusters</em> section and selecting any cluster in the list</li><li>Inside the <em>Cluster Details</em> tab, use the dropdown to select any cluster from the list of availabe clusters in order to view the resources within it</li></ol><div><img src=/mng-existing-resources.gif alt="Create Local Environment" style="margin:0 auto;width:95%"></div><br><h2 id=related-materials>Related materials</h2><p>Visit the VScode Extension on <a href=https://github.com/open-cluster-management-io/ocm-vscode-extension>Github</a>.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Slack aria-label=Slack><a target=_blank rel=noopener href=https://kubernetes.slack.com/channels/open-cluster-mgmt aria-label=Slack><i class="fab fa-slack"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Youtube aria-label=Youtube><a target=_blank rel=noopener href=https://www.youtube.com/c/OpenClusterManagement aria-label=Youtube><i class="fab fa-youtube"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Calendar aria-label=Calendar><a target=_blank rel=noopener href="https://calendar.google.com/calendar/u/0/embed?src=openclustermanagement@gmail.com" aria-label=Calendar><i class="fa fa-calendar"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/open-cluster-management-io aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Mail Group" aria-label="Mail Group"><a target=_blank rel=noopener href=https://groups.google.com/g/open-cluster-management aria-label="Mail Group"><i class="fa fa-envelope"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2020&ndash;2025
<span class=td-footer__authors>Open Cluster Management Authors. The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href=https://www.linuxfoundation.org/trademark-usage/>Trademark Usage</a> | Powered by <a href=https://www.netlify.com/>Netlify</a></span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.69e2c1ae9320465ab10236d9ef752c6a4442c54b48b883b17c497b7c7d96a796.js integrity="sha256-aeLBrpMgRlqxAjbZ73UsakRCxUtIuIOxfEl7fH2Wp5Y=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>