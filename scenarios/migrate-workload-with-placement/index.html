<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"/>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css"/>
  <link rel="stylesheet" href="/main.css"/>
  <link rel="shortcut icon" type="image/svg" href="/ocm.svg">
  <title>Open Cluster Management</title>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1PXKZXT157"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1PXKZXT157');
  </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">




<input id="current-lang" type="hidden" value="en">

<header class="navbar navbar-expand-lg navbar-dark bd-navbar">
  <nav class="navbar navbar-expand-lg navbar-dark py-3 fixed-top">
    <div class="container-fluid flex-wrap flex-lg-nowrap">
      <a href="/" class="navbar-brand">
        <img src="/ocm.svg" alt="" width="30" height="24" class="align-text-top">
        <span>Open Cluster Management</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navmenu">
        <ul class="navbar-nav ms-auto ">
          <li class="nav-item pe-2">
            <a href="/community" class="nav-link text-light">Community</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/contribute" class="nav-link text-light">Contribute</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/concepts" class="nav-link text-light">Document</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/blog" class="nav-link text-light">Blog</a>
          </li>
          <li class="nav-item dropdown pe-2">
            
            <a class="nav-link dropdown-toggle text-light" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">English</a>
            

            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              
              <li><a class="dropdown-item" href="#" id="to-zh">中文</a></li>
              
            </ul>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://www.youtube.com/c/OpenClusterManagement" target="_blank" aria-label="youtube">
                <i class="bi bi-youtube"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://github.com/open-cluster-management-io" target="_blank" aria-label="github">
              <i class="bi bi-github"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://kubernetes.slack.com/channels/open-cluster-mgmt" target="_blank" aria-label="slack">
              <i class="bi bi-slack"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>
</div>
        <div class="row subject-padding">
            <div class="col-lg-2 col-md-3 padding-none sidebar-bgc">




<div class="sidebar-toggle sidebar-toggle-sm">
    <button type="button" id="sidebarToggle" class="btn btn-info">
        <i class="bi bi-list"></i>
    </button>
</div>
<nav id="sidebar" class="sidebar-hide-sm">
    <ul class="components">
        <li id="concepts">
            <a class="navlink" href="/concepts">Concepts</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/concepts/architecture">Architecture</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/clusterclaim">ClusterClaim</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/managedcluster">ManagedCluster</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/managedclusterset">ManagedClusterSet</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/placement">Placement</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/manifestwork">ManifestWork</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/manifestworkreplicaset">ManifestWorkReplicaSet</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/addon">Add-ons</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/policy">Policy</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/multicluster-controlplane">Multicluster Control Plane</a>
                </li>
            </ul>
        </li>
        <li id="getting-started">
            <a class="navlink" href="/getting-started">Getting Started</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/getting-started/quick-start">Quick Start</a>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/installation">Installation</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/getting-started/installation/start-the-control-plane">Start the Control Plane</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/installation/register-a-cluster">Register a Cluster</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/integration">Add-ons and Integrations</a>
                    <ul class="collapse ">
                        <li>
                            <a class="navlink" href="/getting-started/integration/app-lifecycle">Application lifecycle management</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/cluster-proxy">Cluster proxy</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/policy-framework">Policy framework</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/policy-controllers">Policy controllers</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/managed-serviceaccount">Managed service account</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/administration">Administration</a>
                    <ul class="collapse ">
                        <li>
                            <a class="navlink" href="/getting-started/administration/upgrading">Upgrading</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/administration/monitoring">Monitoring</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </li>
        <li id="developer-guides">
            <a class="navlink" href="/developer-guides">Developer Guides</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/developer-guides/addon">Add-on Developer Guide</a>
                </li>
                <li>
                    <a class="navlink" href="/developer-guides/vscode-extension">VScode Extension</a>
                </li>
            </ul>
        </li>
        <li id="scenarios">
            <a class="navlink" href="/scenarios">Scenarios</a>
            <ul class="collapse show">
                <li>
                    <a class="navlink" href="/scenarios/deploy-kubernetes-resources">Deploy Kubernetes Resources</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/distribute-workload-with-placement">Distribute Workload With Placement</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/migrate-workload-with-placement">Migrate Workload With Placement</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/extend-multicluster-scheduling-capabilities">Extend Multicluster Scheduling Capabilities</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/extending-managed-clusters">Extend Managed Clusters</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/integration-with-argocd">Integration with Argo CD</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/manage-cluster-with-multiple-hubs">Manage a cluster with multiple hubs</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/pushing-kube-api-requests">Pushing Kube API Requests to the Managed Clusters</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/register-cluster-through-proxy">Register a cluster to hub through proxy server</a>
                </li>
            </ul>
        </li>
        <li id="community">
            <a class="navlink" href="/community">Community</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/community/releases">Releases</a>
                </li>
                <li >
                    <a class="navlink" href="/community/roadmap">Roadmap</a>
                </li>
            </ul>
        </li>
        <li id="contribute">
            <a class="navlink" href="/contribute">Contribute</a>
        </li>
        <li id="blog">
            <a class="navlink" href="/blog">Blog</a>
        </li>
        <li style="padding-top: 10px; border-top: 2px solid #448a78;">
            <a class="navlink resource" href="https://github.com/open-cluster-management-io" target="_blank"><i class="bi bi-github"></i><span style="padding-left: 10px;">GitHub</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://kubernetes.slack.com/channels/open-cluster-mgmt" target="_blank"><i class="bi bi-slack"></i><span style="padding-left: 10px;">Slack</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://www.youtube.com/c/OpenClusterManagement" target="_blank"><i class="bi bi-youtube"></i><span style="padding-left: 10px;">YouTube</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://groups.google.com/g/open-cluster-management" target="_blank"><i class="bi bi-envelope-fill"></i><span style="padding-left: 10px;">Mailing group</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://calendar.google.com/calendar/u/0/embed?src=openclustermanagement@gmail.com" target="_blank"><i class="bi bi-calendar-event-fill"></i><span style="padding-left: 10px;">Community meetings</span></a>
        </li>
    </ul>
</nav>
<script type="text/javascript" src="/sidebar.js"></script>
</div>
            <div class="col-lg-10 col-md-9 padding-none">
<div id="content">
    <h1>Migrate workload with placement</h1>
    <p>The <code>Placement</code> API is used to dynamically select a set of <code>ManagedCluster</code> in
one or multiple <code>ManagedClusterSets</code> so that the workloads can be deployed to
these clusters.</p>
<p>If you define a valid <code>Placement</code>, the placement controller generates a
corresponding <code>PlacementDecision</code> with the selected clusters listed in the
status. As an end-user, you can parse the selected clusters and then operate on
the target clusters. You can also integrate a high-level workload orchestrator
with the <code>PlacementDecision</code> to leverage its scheduling capabilities.</p>
<p>For example, with OCM addon <a href="https://open-cluster-management.io/getting-started/integration/policy-controllers/">policy</a>
installed, a <code>Policy</code> that includes a <code>Placement</code> mapping can distribute the
<code>Policy</code> to the managed clusters, details see this <a href="https://open-cluster-management.io/getting-started/integration/policy-controllers/configuration-policy/#placement-api">example</a>.</p>
<p>Some popular open source projects also integrate with the <code>Placement</code> API. For
example <a href="https://github.com/argoproj/argo-cd">Argo CD</a>, it can leverage the
generated <code>PlacementDecision</code> to drive the assignment of Argo CD Applications to a
desired set of clusters, details see this <a href="https://github.com/argoproj/argo-cd/tree/master/applicationset/examples/clusterDecisionResource">example</a>.
And <a href="https://github.com/kubevela/kubevela">KubeVela</a>, as an implementation of
the open application model, also will take advantage of the <code>Placement</code> API for
workload scheduling.</p>
<p>In this article, we use <a href="https://github.com/open-cluster-management-io/ocm/tree/main/solutions/deploy-argocd-apps-pull">ArgoCD pull model</a>
as an example to demonstrate how, with the integration of OCM, you can migrate
ArgoCD Applications among clusters. This is useful for scenarios such as
application disaster recovery or application migration during cluster maintenance.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Before starting with the following steps, we recommend that you familiarize yourself with the content below.</p>
<ul>
<li>
<p><a href="https://open-cluster-management.io/concepts/managedcluster/#taints-of-managedclusters">Taints of ManagedClusters</a>:
Taints are properties of <code>ManagedClusters</code>, they allow a <code>Placement</code> to repel
a set of <code>ManagedClusters</code>.</p>
</li>
<li>
<p><a href="https://open-cluster-management.io/concepts/placement/#taintstolerations">Tolerations of Placement</a>:
Tolerations are applied to <code>Placements</code>, and allow <code>Placements</code> to select
<code>ManagedClusters</code> with matching taints.</p>
</li>
<li>
<p><a href="https://github.com/open-cluster-management-io/ocm/tree/main/solutions/deploy-argocd-apps-pull">ArgoCD Pull Model Integration</a>:
The ArgoCD application controller uses the hub-spoke pattern or pull model mechanism
for decentralized resource delivery to remote clusters. By using Open Cluster Management (OCM) APIs
and components, the ArgoCD Applications will be pulled from the multi-cluster control plane
hub cluster down to the registered OCM managed clusters</p>
</li>
</ul>
<h2 id="setup-the-environment">Setup the environment</h2>
<p>Follow the <a href="https://github.com/open-cluster-management-io/ocm/blob/main/solutions/deploy-argocd-apps-pull/getting-started.md">deploy ArgoCD pull model steps</a>
to set up an environment with OCM and ArgoCD pull model installed.</p>
<p>If the above steps run successfully, on the hub cluster, you could see the application is deployed to both cluster1 and cluster2.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl -n argocd get app
NAME                     SYNC STATUS   HEALTH STATUS
cluster1-guestbook-app   Synced        Healthy
cluster2-guestbook-app   Synced        Healthy
</code></pre></div><h2 id="migrate-application-to-another-cluster-automatically-when-one-cluster-is-down">Migrate application to another cluster automatically when one cluster is down</h2>
<ol>
<li>
<p>To demonstrate how an application can be migrated to another cluster, let&rsquo;s first deploy the application in a single cluster.</p>
<p>Path the existing <code>Placement</code> to select only one cluster.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl patch placement -n argocd guestbook-app-placement --patch <span style="color:#e6db74">&#39;{&#34;spec&#34;: {&#34;numberOfClusters&#34;: 1}}&#39;</span> --type<span style="color:#f92672">=</span>merge
placement.cluster.open-cluster-management.io/guestbook-app-placement patched
</code></pre></div><p>Use <code>clusteradm</code> to check the placement of selected clusters.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ clusteradm get placements -otable
NAME                      STATUS   REASON              SELETEDCLUSTERS
guestbook-app-placement   False    Succeedconfigured   <span style="color:#f92672">[</span>cluster1<span style="color:#f92672">]</span>
</code></pre></div></li>
<li>
<p>Confirm the application is only deployed to cluster1.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl -n argocd get app
NAME                     SYNC STATUS   HEALTH STATUS
cluster1-guestbook-app   Synced        Healthy
</code></pre></div></li>
<li>
<p>Pause the cluster1 to simulate a cluster going down.</p>
<p>Use <code>docker ps -a</code> to get the cluster1 container ID.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker ps -a
CONTAINER ID   IMAGE                  COMMAND                  CREATED       STATUS       PORTS                       NAMES
499812ada5bd   kindest/node:v1.25.3   <span style="color:#e6db74">&#34;/usr/local/bin/entr…&#34;</span>   <span style="color:#ae81ff">9</span> hours ago   Up <span style="color:#ae81ff">9</span> hours   127.0.0.1:37377-&gt;6443/tcp   cluster2-control-plane
0b9d110e1a1f   kindest/node:v1.25.3   <span style="color:#e6db74">&#34;/usr/local/bin/entr…&#34;</span>   <span style="color:#ae81ff">9</span> hours ago   Up <span style="color:#ae81ff">9</span> hours   127.0.0.1:34780-&gt;6443/tcp   cluster1-control-plane
0a327d4a5b41   kindest/node:v1.25.3   <span style="color:#e6db74">&#34;/usr/local/bin/entr…&#34;</span>   <span style="color:#ae81ff">9</span> hours ago   Up <span style="color:#ae81ff">9</span> hours   127.0.0.1:44864-&gt;6443/tcp   hub-control-plane
</code></pre></div><p>Use <code>docker pause</code> to pause the cluster1.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker pause 0b9d110e1a1f
0b9d110e1a1f
</code></pre></div></li>
<li>
<p>Wait for a few minutes, check the <code>ManagedCluster</code> status, cluster1 available status should become &ldquo;Unknown&rdquo;.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl get managedcluster
NAME       HUB ACCEPTED   MANAGED CLUSTER URLS                  JOINED   AVAILABLE   AGE
cluster1   true           https://cluster1-control-plane:6443   True     Unknown     9h
cluster2   true           https://cluster2-control-plane:6443   True     True        9h
</code></pre></div><p>Use <code>clusteradm</code> to check the placement of selected clusters.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ clusteradm get placements -otable
NAME                      STATUS   REASON              SELETEDCLUSTERS
guestbook-app-placement   False    Succeedconfigured   <span style="color:#f92672">[</span>cluster2<span style="color:#f92672">]</span>
</code></pre></div></li>
<li>
<p>Confirm the application is now deployed to cluster2.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl -n argocd get app
NAME                     SYNC STATUS   HEALTH STATUS
cluster2-guestbook-app   Synced        Healthy
</code></pre></div></li>
</ol>
<h2 id="what-happens-behind-the-scene">What happens behind the scene</h2>
<p>Refer to <a href="https://open-cluster-management.io/concepts/managedcluster/#taints-of-managedclusters">Taints of ManagedClusters</a>,
when pausing cluster1, the status of condition <code>ManagedClusterConditionAvailable</code>
becomes <code>Unknown</code>. The taint <code>cluster.open-cluster-management.io/unreachable</code> is automatically
added to cluster1, with the effect NoSelect and an empty value.</p>
<pre><code>```shell
$ kubectl get managedcluster cluster1 -oyaml
apiVersion: cluster.open-cluster-management.io/v1
kind: ManagedCluster
metadata:
  name: cluster1
  labels:
    cluster.open-cluster-management.io/clusterset: default
spec:
...
  taints:
  - effect: NoSelect
    key: cluster.open-cluster-management.io/unreachable
    timeAdded: &quot;2023-11-13T16:26:16Z&quot;
status: 
...
```
</code></pre>
<p>Since the <code>Placement</code> guestbook-app-placement doesn&rsquo;t define any toleration to match the taint,
cluster1 will be filtered from the decision. In the demo environment, once cluster1 is down,
placement will select one cluster from the rest clusters, which is cluster2.</p>
<p><a href="https://open-cluster-management.io/concepts/managedcluster/#taints-of-managedclusters">Taints of ManagedClusters</a>
also describes other scenarios where taints are automatically added. In some scenarios you may not want to
migrate the application immediately when a taint is added, with placement <code>TolerationSeconds</code> defined, it could tolerates the taint
for a period of time before repelling it. In above example, the <code>TolerationSeconds</code> could be defined as below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: cluster.open-cluster-management.io/v1beta1
<span style="color:#66d9ef">kind</span>: Placement
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: guestbook-app-placement
  <span style="color:#66d9ef">namespace</span>: argocd
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">numberOfClusters</span>: <span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">tolerations</span>:
    - <span style="color:#66d9ef">key</span>: cluster.open-cluster-management.io/unreachable
      <span style="color:#66d9ef">operator</span>: Exists
      <span style="color:#66d9ef">tolerationSeconds</span>: <span style="color:#ae81ff">300</span>
</code></pre></div><p><code>tolerationSeconds</code> is 300 means that the application will be migrated to cluster2 after 5 minutes when cluster1 is down.</p>
<h2 id="migrate-application-to-another-cluster-manually-for-cluster-maintenance">Migrate application to another cluster manually for cluster maintenance</h2>
<p>The above example shows how a taint is automatically added to a cluster and how the application is migrated to another cluster.
You can also choose to add a taint manually and repel the application to other clusters.</p>
<p>In the following example, suppose you are going to maintain cluster2, and want to repel the application to cluster1.</p>
<ol>
<li>
<p>Before starting, let&rsquo;s first restart the paused cluster1.</p>
<p>Use <code>docker restart</code> to restart the cluster1.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker restart 0b9d110e1a1f
0b9d110e1a1f
</code></pre></div><p>Wait for a few minutes, check the <code>ManagedCluster</code> status, cluster1 available status should become &ldquo;True&rdquo;.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl get managedcluster
NAME       HUB ACCEPTED   MANAGED CLUSTER URLS                  JOINED   AVAILABLE   AGE
cluster1   true           https://cluster1-control-plane:6443   True     True        9h
cluster2   true           https://cluster2-control-plane:6443   True     True        9h
</code></pre></div></li>
<li>
<p>Add the taint <code>maintenance</code> to cluster2 manually.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl patch managedcluster cluster2 -p <span style="color:#e6db74">&#39;{&#34;spec&#34;:{&#34;taints&#34;:[{&#34;effect&#34;:&#34;NoSelect&#34;,&#34;key&#34;:&#34;maintenance&#34;}]}}&#39;</span> --type<span style="color:#f92672">=</span>merge
managedcluster.cluster.open-cluster-management.io/cluster2 patched
</code></pre></div></li>
<li>
<p>Use <code>clusteradm</code> to check the placement selected clusters.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ clusteradm get placements -otable
NAME                      STATUS   REASON              SELETEDCLUSTERS
guestbook-app-placement   False    Succeedconfigured   <span style="color:#f92672">[</span>cluster1<span style="color:#f92672">]</span>
</code></pre></div></li>
<li>
<p>Confirm the application is now deployed to cluster1.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl -n argocd get app
NAME                     SYNC STATUS   HEALTH STATUS
cluster1-guestbook-app   Synced        Healthy
</code></pre></div></li>
</ol>
<h2 id="summary">Summary</h2>
<p>In this article, we use the ArgoCD pull model in OCM as an example, showing you how to migrate the ArgoCD applications automatically or manually when the cluster is down or during the cluster maintenance time.</p>
<p>The concept of <a href="https://open-cluster-management.io/concepts/managedcluster/#taints-of-managedclusters">Taints</a> and <a href="https://open-cluster-management.io/concepts/placement/#taintstolerations">Tolerations</a> can be used for any components that consume OCM <code>Placement</code>, such as <a href="https://open-cluster-management.io/concepts/addon/">add-ons</a> and <a href="https://open-cluster-management.io/concepts/manifestworkreplicaset/">ManifestworkReplicaSet</a>. If you have any questions, feel free to raise them in our <a href="https://kubernetes.slack.com/channels/open-cluster-mgmt">slack channel</a>.</p>

</div>
<script type="text/javascript" src="/clipboard-copy.js"></script>
</div>
        </div>
        <div class="row"><nav class="ocm navbar navbar-expand-lg navbar-dark py-3">
  <div class="container-fluid flex-wrap flex-md-nowrap">
    <div class="text-light">&copy; 2024 Open Cluster Management Authors. The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href="https://www.linuxfoundation.org/trademark-usage/" target="_blank" style="color: #f8f9fa;">Trademark Usage</a></div>
  </div>
</nav>
<script type="text/javascript" src="/lang.js"></script>
</div>
    </div>
</body>
</html>
