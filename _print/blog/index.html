<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://open-cluster-management.io/blog/><link rel=alternate type=application/rss+xml href=https://open-cluster-management.io/blog/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Blog | Open Cluster Management</title><meta name=description content="Open Cluster Management official site"><meta property="og:url" content="https://open-cluster-management.io/blog/"><meta property="og:site_name" content="Open Cluster Management"><meta property="og:title" content="Blog"><meta property="og:description" content="Open Cluster Management official site"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Blog"><meta itemprop=description content="Open Cluster Management official site"><meta itemprop=datePublished content="2025-11-11T00:00:00+00:00"><meta itemprop=dateModified content="2025-11-11T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Blog"><meta name=twitter:description content="Open Cluster Management official site"><link rel=preload href=/scss/main.min.a18ccf6c73f2e225bd9dc88b82c5dd7b4132cdbdea3298b8eb2fca5c2016783c.css as=style integrity="sha256-oYzPbHPy4iW9nciLgsXde0Eyzb3qMpi46y/KXCAWeDw=" crossorigin=anonymous><link href=/scss/main.min.a18ccf6c73f2e225bd9dc88b82c5dd7b4132cdbdea3298b8eb2fca5c2016783c.css rel=stylesheet integrity="sha256-oYzPbHPy4iW9nciLgsXde0Eyzb3qMpi46y/KXCAWeDw=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class="td-section td-blog"><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 77.76 75.84"><defs><style>.cls-1{fill:none}.cls-2{fill:#fff}.cls-3{clip-path:url(#clip-path)}.cls-4{clip-path:url(#clip-path-2)}</style><clipPath id="clip-path" transform="translate(5.38 5.32)"><path class="cls-1" d="M67.11 39.69 61.34 14.61a4.48 4.48.0 00-2.42-3L35.55.44A4.52 4.52.0 0033.38.0a4.36 4.36.0 00-1.71.43L8.3 11.61a4.41 4.41.0 00-2.42 3L.11 39.7a4.37 4.37.0 00.61 3.39c.08.13.16.24.25.36L17.15 63.56a4.49 4.49.0 003.49 1.67H46.58a4.5 4.5.0 003.5-1.66L66.25 43.44A4.37 4.37.0 0067.11 39.69zM52.3 34.43a18.71 18.71.0 01-34.09 9.82c3.87-1.37 15.74-5.69 8.4-4.44A87.29 87.29.0 0116.1 41h-.42c-.57.0-1.13.0-1.67.0h-.37c-.54.0-1.07.0-1.58.0h-.31q-.77.0-1.47-.12c-2.78-.31-4.61-1.08-4.51-2.54.25-3.72 9.12-5.71 9.12-5.71a18.7 18.7.0 0134-9.82c-3.93 1.4-15.64 5.66-8.34 4.41a87.13 87.13.0 0110.5-1.16h.43 1.66.37q.82.0 1.59.0h.31c.51.0 1 .07 1.46.12 2.78.31 4.62 1.08 4.52 2.53C61.15 32.41 52.45 34.4 52.3 34.43z"/></clipPath><clipPath id="clip-path-2" transform="translate(5.38 5.32)"><rect class="cls-1" x="-5" y="-5" width="77.22" height="75.23"/></clipPath></defs><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path id="path3055" class="cls-2" d="M34.64 3.44a4.06 4.06.0 00-1.53.38l-20.91 10A4 4 0 0010 16.51L4.87 39a3.93 3.93.0 00.55 3 3.62 3.62.0 00.22.32l14.48 18a4 4 0 003.13 1.5H46.46a4 4 0 003.12-1.49l14.47-18A3.9 3.9.0 0064.82 39L59.66 16.5a4 4 0 00-2.17-2.69l-20.91-10A4 4 0 0034.64 3.44z" transform="translate(5.38 5.32)"/><g class="cls-3"><g class="cls-4"><image width="162" height="158" transform="scale(0.48)" xlink:href="data:image/png;base64,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"/></g></g></g></g></svg></span><span class=navbar-brand__name>Open Cluster Management</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/><img referrerpolicy=no-referrer-when-downgrade src="https://static.scarf.sh/a.png?x-pxid=94243eae-daeb-494c-a300-099ab02c56f5"><span></span></a></li><li class=nav-item><a class=nav-link href=/docs/release/#100-20-june-2025><span>ğŸ‰ v1.0.0 Released!</span></a></li><li class=nav-item><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/community/><span>Community</span></a></li><li class=nav-item><a class="nav-link active" href=/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/open-cluster-management-io/ocm target=_blank rel=noopener><i class="fab fa-github"></i><span>GitHub</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Releases</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://open-cluster-management.io>main</a></li><li><a class=dropdown-item href=https://v1-0.open-cluster-management.io>v1.0</a></li><li><a class=dropdown-item href=https://v0-16.open-cluster-management.io>v0.16</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this siteâ€¦" aria-label="Search this siteâ€¦" autocomplete=off data-offline-search-index-json-src=/offline-search-index.ee6bafafba94c6fd2017b00199b92379.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/blog/>Return to the regular view of this page</a>.</p></div><h1 class=title>Blog</h1><ul><li><a href=#pg-6ae714f8e45cecaaa5c66367d3ca3e89>Cluster Proxy Now Supports "Service Proxy" â€” An Easy Way to Access Services in Managed Clusters</a></li><li><a href=#pg-a4fade813263f89fecc5895e40ff8638>Open Cluster Management ç¤¾åŒºè¯šé‚€æ‚¨å…±èµ´ KubeCon China 2025 æ¢è®¨å¤šé›†ç¾¤ç®¡ç†æ–°æœªæ¥</a></li><li><a href=#pg-58542dd090182588aa753add0977dac4>Joining OCM Hub and Spoke using AWS IRSA authentication</a></li><li><a href=#pg-e699b31346e6258210c791d4f965cbcb>KubeCon NA 2024 - Scheduling AI Workload Among Multiple Clusters</a></li><li><a href=#pg-b03a552881e305db2c02f594de29f9f0>KubeDay Australia 2024 - Open Sourcing the Open Cluster Management Project and the Lessons We Can Learn for AI</a></li><li><a href=#pg-db2a7b7fdb17d06afb81db2ca320f1e3>KubeCon CN 2024 - Boundaryless Computing: Optimizing LLM Performance, Cost, and Efficiency in Multi-Cloud Architecture | æ— è¾¹ç•Œè®¡ç®—ï¼šåœ¨å¤šäº‘æ¶æ„ä¸­ä¼˜åŒ–LLMæ€§èƒ½ã€æˆæœ¬å’Œæ•ˆç‡</a></li><li><a href=#pg-d71450f51c2c85cb64c9f06dc40f2b4b>KubeCon CN 2024 - Connecting the Dots: Towards a Unified Multi-Cluster AI/ML Experience | è¿æ¥ç‚¹ï¼šèµ°å‘ç»Ÿä¸€çš„å¤šé›†ç¾¤AI/MLä½“éªŒ</a></li><li><a href=#pg-4fa6a2f0a46cbfce6b28e33880d0b187>KubeCon CN 2024 - Extend Kubernetes to Edge Using Event-Based Transport | ä½¿ç”¨åŸºäºäº‹ä»¶çš„ä¼ è¾“å°†Kubernetesæ‰©å±•åˆ°è¾¹ç¼˜</a></li><li><a href=#pg-027563391b79d1175e323c20b2b42709>The HA Hub clusters solution -- MultipleHubs</a></li><li><a href=#pg-990faab21a4dc06e65343bf113d26d98>Using the GitOps way to deal with the upgrade challenges of multi-cluster tool chains</a></li><li><a href=#pg-ed18b7525c323d590749f6553ff42217>Open Cluster Management - Configuring Your Kubernetes Fleet With the Policy Addon</a></li><li><a href=#pg-96a59b1cfa663cf5552b8282ca098ca1>ä»¥GitOpsæ–¹å¼åº”å¯¹å¤šé›†ç¾¤å·¥å…·é“¾çš„å‡çº§æŒ‘æˆ˜</a></li><li><a href=#pg-e0d11ba97d8228bd67e6046bda354da2>è¯¦è§£OCM add-onæ’ä»¶</a></li><li><a href=#pg-55e775ad1f48aade31a37cf5766a8d8f>ä½¿ç”¨OCMè®©å¤šé›†ç¾¤è°ƒåº¦æ›´å…·å¯æ‰©å±•æ€§</a></li><li><a href=#pg-db74eba3bd0537bd15014d1f4d2d9218>How to distribute workloads using Open Cluster Management</a></li><li><a href=#pg-da1547e89e69281e8c02839ca9ab63b2>KubeCon NA 2022 - OCM Multicluster App & Config Management</a></li><li><a href=#pg-e9ac27c25f598dce5dca326a80b63c85>KubeCon NA 2022 - OCM Workload distribution with Placement API</a></li><li><a href=#pg-8d8f585bf45ed3f61f5980b5e6e87979>Karmada and Open Cluster Management: two new approaches to the multicluster fleet management challenge</a></li><li><a href=#pg-e9ba9d2c68d5ccd206616e82b5f6e9da>Extending the Multicluster Scheduling Capabilities with Open Cluster Management Placement</a></li><li><a href=#pg-bdb85c652c92f04d83fafe1d6d09f3ba>è¯¦è§£ocm klusterletç§˜é’¥ç®¡ç†æœºåˆ¶</a></li><li><a href=#pg-e47cc96fd834566eec3252a197439295>é€šè¿‡OCMè®¿é—®ä¸åŒVPCä¸‹çš„é›†ç¾¤</a></li><li><a href=#pg-859fbabac8a015dfbf92d10a8e7bb555>Using the Open Cluster Management Placement for Multicluster Scheduling</a></li><li><a href=#pg-25491c199a7bdd0dd25b1cfd2cf2e8b9>Using the Open Cluster Management Add-on Framework to Develop a Managed Cluster Add-on</a></li><li><a href=#pg-31ca460fc70daa6787626171e94fab9d>The Next Kubernetes Frontier: Multicluster Management</a></li><li><a href=#pg-2ef5f25ba0914032b30232b4e7d0d126>Put together a user walk through for the basic Open Cluster Management API using `kind`, `olm`, and other open source technologies</a></li><li><a href=#pg-8b452ffcb42621d1af16a8aff31733d8>Setting up Open Cluster Management the hard way</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-6ae714f8e45cecaaa5c66367d3ca3e89>Cluster Proxy Now Supports "Service Proxy" â€” An Easy Way to Access Services in Managed Clusters</h1><div class="td-byline mb-4">By <b>Zhao Xue <a href=https://github.com/xuezhaojun>@xuezhaojun</a></b> |
<time datetime=2025-11-11 class=text-body-secondary>Tuesday, November 11, 2025</time></div><h2 id=introduction>Introduction</h2><p>Cluster Proxy is an <a href=https://github.com/open-cluster-management-io/cluster-proxy>OCM addon</a> that provides L4 network connectivity between hub and managed clusters through a reverse proxy tunnel. In previous versions, accessing services on managed clusters through cluster-proxy required using a specialized Go package, the <a href=https://github.com/open-cluster-management-io/cluster-proxy/blob/main/examples/test-client.md>konnectivity client</a>.</p><p>With the new v0.9.0 release, we&rsquo;ve introduced a more convenient approach â€” &ldquo;Service Proxy&rdquo;. This feature provides an HTTPS service that allows users to access the kube-apiserver and other services in managed clusters through a specific URL structure. Additionally, it introduces a more user-friendly authentication and authorization mechanism using <strong>Impersonation</strong>, enabling users to authenticate and authorize against the managed cluster&rsquo;s kube-apiserver using their hub user token.</p><p>Let&rsquo;s set up a simple test environment to demonstrate these new capabilities.</p><h2 id=setting-up-the-environment>Setting Up the Environment</h2><p>First, create a basic OCM environment with one hub cluster and one managed cluster.</p><p>Create a hub cluster with port mapping for the proxy-entrypoint service. The <code>extraPortMappings</code> configuration exposes port 30091 from the container to the host machine, allowing external access to the proxy service:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Create hub cluster with port mapping for proxy-entrypoint service</span>
</span></span><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kind create cluster --name &#34;hub&#34; --config=-
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Cluster
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: kind.x-k8s.io/v1alpha4
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>nodes:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>- role: control-plane
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  extraPortMappings:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - containerPort: 30091
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    hostPort: 30091
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    protocol: TCP
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Create managed cluster</span>
</span></span><span style=display:flex><span>kind create cluster --name <span style=color:#4e9a06>&#34;managed&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Initialize the OCM hub cluster</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Initializing the OCM hub cluster...&#34;</span>
</span></span><span style=display:flex><span>clusteradm init --wait --context kind-hub
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Get join command from hub</span>
</span></span><span style=display:flex><span><span style=color:#000>joincmd</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>clusteradm get token --context kind-hub <span style=color:#000;font-weight:700>|</span> grep clusteradm<span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Join managed cluster to hub</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Joining managed cluster to hub...&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>$(</span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>${</span><span style=color:#000>joincmd</span><span style=color:#4e9a06>}</span> --force-internal-endpoint-lookup --wait --context kind-managed <span style=color:#000;font-weight:700>|</span> sed <span style=color:#4e9a06>&#34;s/&lt;cluster_name&gt;/managed/g&#34;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Accept the managed cluster</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Accepting managed cluster...&#34;</span>
</span></span><span style=display:flex><span>clusteradm accept --context kind-hub --clusters managed --wait
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Verify the setup</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Verifying the setup...&#34;</span>
</span></span><span style=display:flex><span>kubectl get managedclusters --all-namespaces --context kind-hub
</span></span></code></pre></div><h2 id=installing-cluster-proxy>Installing Cluster Proxy</h2><p>Next, install the Cluster Proxy addon following the <a href=https://open-cluster-management.io/docs/getting-started/integration/cluster-proxy/>official installation guide</a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>helm repo add ocm https://open-cluster-management.io/helm-charts/
</span></span><span style=display:flex><span>helm repo update
</span></span><span style=display:flex><span>helm search repo ocm/cluster-proxy
</span></span></code></pre></div><p>Verify that the CHART VERSION is v0.9.0 or later:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ helm search repo ocm/cluster-proxy
</span></span><span style=display:flex><span>NAME                    CHART VERSION   APP VERSION     DESCRIPTION
</span></span><span style=display:flex><span>ocm/cluster-proxy       0.9.0           1.1.0           A Helm chart <span style=color:#204a87;font-weight:700>for</span> Cluster-Proxy OCM Addon
</span></span></code></pre></div><h3 id=setting-up-tls-certificates>Setting Up TLS Certificates</h3><p>The new deployment <code>cluster-proxy-addon-user</code> requires server certificates for its HTTPS service, otherwise the deployment will hang in the container creating state:</p><p>To create the certificates, first install cert-manager:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl --context kind-hub apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.17.0/cert-manager.yaml
</span></span><span style=display:flex><span>kubectl --context kind-hub <span style=color:#204a87>wait</span> --for<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>condition</span><span style=color:#ce5c00;font-weight:700>=</span>ready pod -l app.kubernetes.io/instance<span style=color:#ce5c00;font-weight:700>=</span>cert-manager -n cert-manager --timeout<span style=color:#ce5c00;font-weight:700>=</span>300s
</span></span></code></pre></div><p>Next, create the certificate resources using the kind cluster&rsquo;s root CA. This approach allows all pods and services in the kind cluster to automatically trust the cluster-proxy certificates without requiring additional CA certificate mounting:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Create namespace and certificates using kind cluster&#39;s CA</span>
</span></span><span style=display:flex><span>kubectl --context kind-hub create namespace open-cluster-management-addon
</span></span><span style=display:flex><span><span style=color:#000>CA_CRT</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl --context kind-hub config view --raw -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.clusters[?(@.name==&#34;kind-hub&#34;)].cluster.certificate-authority-data}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>CA_KEY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>docker <span style=color:#204a87>exec</span> hub-control-plane cat /etc/kubernetes/pki/ca.key <span style=color:#000;font-weight:700>|</span> base64 -w 0<span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl --context kind-hub apply -f - <span style=color:#4e9a06>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Secret
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: kind-cluster-ca
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: open-cluster-management-addon
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>type: kubernetes.io/tls
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>data:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  tls.crt: ${CA_CRT}
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  tls.key: ${CA_KEY}
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>---
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: cert-manager.io/v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Issuer
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: kind-ca-issuer
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: open-cluster-management-addon
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  ca:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    secretName: kind-cluster-ca
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>---
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: cert-manager.io/v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Certificate
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: cluster-proxy-user-serving-cert
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: open-cluster-management-addon
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  secretName: cluster-proxy-user-serving-cert
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  duration: 8760h  # 1 year
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  renewBefore: 720h  # 30 days
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  commonName: cluster-proxy-addon-user.open-cluster-management-addon.svc
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  dnsNames:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - cluster-proxy-addon-user
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - cluster-proxy-addon-user.open-cluster-management-addon
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - cluster-proxy-addon-user.open-cluster-management-addon.svc
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - cluster-proxy-addon-user.open-cluster-management-addon.svc.cluster.local
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  privateKey:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    algorithm: RSA
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    size: 2048
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  issuerRef:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    name: kind-ca-issuer
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    kind: Issuer
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>Verify the secret is created:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl --context kind-hub get secret -n open-cluster-management-addon cluster-proxy-user-serving-cert
</span></span></code></pre></div><h3 id=installing-the-cluster-proxy-helm-chart>Installing the Cluster Proxy Helm Chart</h3><p>Now install the cluster-proxy addon with the necessary configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Set the gateway IP address for the proxy server</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># This is the Docker gateway IP that allows the Kind cluster to communicate with services</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># running on the host machine. The managed cluster will use this address to connect</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># to the proxy server running in the hub cluster.</span>
</span></span><span style=display:flex><span><span style=color:#000>GATEWAY_IP</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>docker inspect hub-control-plane --format <span style=color:#4e9a06>&#39;{{.NetworkSettings.Networks.kind.IPAddress}}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl config use-context kind-hub
</span></span><span style=display:flex><span>helm install -n open-cluster-management-addon --create-namespace <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    cluster-proxy ocm/cluster-proxy <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#4e9a06>&#34;proxyServer.entrypointAddress=</span><span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_IP</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#4e9a06>&#34;proxyServer.port=30091&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#4e9a06>&#34;enableServiceProxy=true&#34;</span>
</span></span></code></pre></div><p>To expose the proxy server to the managed clusters, we need to create a service that makes the proxy server accessible from the external network.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;&#39;EOF&#39; | kubectl --context kind-hub apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Service
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: proxy-entrypoint-external
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: open-cluster-management-addon
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  labels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    app: cluster-proxy
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    component: proxy-entrypoint-external
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  type: NodePort
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  selector:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    proxy.open-cluster-management.io/component-name: proxy-server
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  ports:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - name: agent-server
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    port: 8091
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    targetPort: 8091
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    nodePort: 30091
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    protocol: TCP
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><h3 id=verifying-the-deployment>Verifying the Deployment</h3><p>After completing the installation, verify that the <code>cluster-proxy-addon-user</code> deployment and service have been created and are running in the <code>open-cluster-management-addon</code> namespace:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get deploy -n open-cluster-management-addon
</span></span><span style=display:flex><span>NAME                       READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>cluster-proxy-addon-user   1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           10s
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get svc -n open-cluster-management-addon
</span></span><span style=display:flex><span>NAME                       TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span style=color:#ce5c00;font-weight:700>(</span>S<span style=color:#ce5c00;font-weight:700>)</span>   AGE
</span></span><span style=display:flex><span>cluster-proxy-addon-user   ClusterIP   10.96.100.100   &lt;none&gt;        443/TCP   10s
</span></span></code></pre></div><h2 id=using-service-proxy-to-access-managed-clusters>Using Service Proxy to Access Managed Clusters</h2><p>Now that the installation is complete, let&rsquo;s demonstrate how to use the Service Proxy feature to access resources in managed clusters. We&rsquo;ll access pods in the <code>open-cluster-management-agent</code> namespace in the <code>managed</code> cluster, which will also showcase the impersonation authentication mechanism.</p><h3 id=creating-a-hub-user>Creating a Hub User</h3><p>First, create a hub user (a service account in the hub cluster) named <code>test-sa</code>:</p><pre tabindex=0><code>kubectl --context kind-hub create serviceaccount -n open-cluster-management-hub test-sa
</code></pre><h3 id=configuring-rbac-permissions>Configuring RBAC Permissions</h3><p>Next, create a Role and RoleBinding in the <code>managed</code> cluster to grant the <code>test-sa</code> user permission to list and get pods in the <code>open-cluster-management-agent</code> namespace:</p><pre tabindex=0><code>kubectl --context kind-managed apply -f - &lt;&lt;EOF
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: test-sa-rolebinding
  namespace: open-cluster-management-agent
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: test-sa-role
subjects:
- kind: User
  name: cluster:hub:system:serviceaccount:open-cluster-management-hub:test-sa
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: test-sa-role
  namespace: open-cluster-management-agent
rules:
- apiGroups: [&#34;&#34;]
  resources: [&#34;pods&#34;]
  verbs: [&#34;get&#34;, &#34;list&#34;]
EOF
</code></pre><p><strong>Important Note:</strong></p><ul><li>The <code>User</code> name follows the format <code>cluster:hub:system:serviceaccount:&lt;namespace>:&lt;serviceaccount></code>, where <code>&lt;namespace></code> and <code>&lt;serviceaccount></code> are the namespace and name of the service account in the hub cluster.</li><li>Alternatively, you can use <a href=https://github.com/open-cluster-management-io/cluster-permission>cluster-permission</a> to create roles and role bindings from the hub cluster side.</li></ul><h3 id=generating-an-access-token>Generating an Access Token</h3><p>Generate a token for the <code>test-sa</code> service account:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#000>TOKEN</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl --context kind-hub -n open-cluster-management-hub create token test-sa<span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><h3 id=testing-the-service-proxy>Testing the Service Proxy</h3><p>Now let&rsquo;s test accessing pods in the <code>managed</code> cluster through the <code>cluster-proxy-addon-user</code> service. We&rsquo;ll start a debug container in the hub cluster and use curl to make the request:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>POD</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl get pods -n open-cluster-management-addon -l <span style=color:#000>component</span><span style=color:#ce5c00;font-weight:700>=</span>cluster-proxy-addon-user --field-selector<span style=color:#ce5c00;font-weight:700>=</span>status.phase<span style=color:#ce5c00;font-weight:700>=</span>Running -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.items[0].metadata.name}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl debug -it <span style=color:#000>$POD</span> -n open-cluster-management-addon --image<span style=color:#ce5c00;font-weight:700>=</span>praqma/network-multitool -- sh -c <span style=color:#4e9a06>&#34;curl -k -H &#39;Authorization: Bearer </span><span style=color:#000>$TOKEN</span><span style=color:#4e9a06>&#39; https://cluster-proxy-addon-user.open-cluster-management-addon.svc.cluster.local:9092/managed/api/v1/namespaces/open-cluster-management-agent/pods&#34;</span>
</span></span></code></pre></div><p>The URL structure for accessing resources is:</p><pre tabindex=0><code>https://cluster-proxy-addon-user.&lt;namespace&gt;.svc.cluster.local:9092/&lt;cluster-name&gt;/&lt;kubernetes-api-path&gt;
</code></pre><p>You should see a JSON response listing the pods in the <code>open-cluster-management-agent</code> namespace of the <code>managed</code> cluster, demonstrating successful authentication and authorization through the impersonation mechanism.</p><h2 id=summary>Summary</h2><p>In this blog post, we&rsquo;ve demonstrated the new Service Proxy feature introduced in cluster-proxy v0.9.0. The key highlights include:</p><ul><li><strong>Service Proxy</strong>: A new HTTPS-based method to access services in managed clusters without requiring the konnectivity client package</li><li><strong>Impersonation</strong>: A user-friendly authentication mechanism that allows hub users to access managed cluster resources using their hub tokens</li><li><strong>Simple URL Structure</strong>: Access managed cluster resources through a straightforward URL pattern</li></ul><p>These features significantly simplify the process of accessing managed cluster services, making it easier to build tools and integrations on top of OCM&rsquo;s multi-cluster management capabilities.</p><p>We hope you find these new features useful! For more information, please visit the <a href=https://github.com/open-cluster-management-io/cluster-proxy>cluster-proxy GitHub repository</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-a4fade813263f89fecc5895e40ff8638>Open Cluster Management ç¤¾åŒºè¯šé‚€æ‚¨å…±èµ´ KubeCon China 2025 æ¢è®¨å¤šé›†ç¾¤ç®¡ç†æ–°æœªæ¥</h1><div class="td-byline mb-4"><time datetime=2025-05-22 class=text-body-secondary>Thursday, May 22, 2025</time></div><p>KubeCon + CloudNativeCon China 2025 å³å°†äº6 æœˆ 10-11 æ—¥åœ¨é¦™æ¸¯ç››å¤§ä¸¾è¡Œï¼Œè¿™æ˜¯äº‘åŸç”Ÿé¢†åŸŸæœ€å…·å½±å“åŠ›çš„æŠ€æœ¯ç››ä¼šä¹‹ä¸€ã€‚ä½œä¸ºäº‘åŸç”Ÿå¤šé›†ç¾¤ç®¡ç†é¢†åŸŸçš„é¢†å†›é¡¹ç›®ä¹‹ä¸€ï¼ŒOpen Cluster Management (OCM) ç¤¾åŒºå°†å¸¦æ¥ä¸‰ä¸ªç²¾å½©è®®é¢˜ï¼Œä¸æ‚¨å…±åŒæ¢è®¨å¤šé›†ç¾¤ç®¡ç†é¢†åŸŸçš„æœ€æ–°åˆ›æ–°å’Œçªç ´ã€‚åœ¨è¿™é‡Œï¼Œæ‚¨å°†æœ‰æœºä¼šä¸æ¥è‡ªå…¨çƒçš„äº‘åŸç”Ÿä¸“å®¶é¢å¯¹é¢äº¤æµï¼Œæ·±å…¥äº†è§£ OCM å¦‚ä½•é€šè¿‡åˆ›æ–°çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œå¸®åŠ©ä¼ä¸šåº”å¯¹æ—¥ç›Šå¤æ‚çš„å¤šé›†ç¾¤ç®¡ç†æŒ‘æˆ˜ï¼Œå¼€å¯äº‘åŸç”Ÿå¤šé›†ç¾¤ç®¡ç†çš„æ–°ç¯‡ç« ã€‚</p><img src=./assets/kubecon2025cn.jpg alt="KubeCon China 2025 Banner" width=80% style=display:block;margin:0><h2 id=è®®é¢˜ä¿¡æ¯>è®®é¢˜ä¿¡æ¯</h2><h3 id=é—ªç”µæ¼”è®²ä½¿ç”¨ocm-addonç®€åŒ–å¤šé›†ç¾¤é›†æˆ><a href="https://kccncchn2025.sched.com/event/1xjzH/project-lightning-talk-simplifying-multi-cluster-integrations-with-ocm-addon-jian-zhu-maintainer?iframe=no&amp;w=100%25&amp;sidebar=yes&amp;bg=no">é—ªç”µæ¼”è®²ï¼šä½¿ç”¨OCM Addonç®€åŒ–å¤šé›†ç¾¤é›†æˆ</a></h3><p><strong>æ—¶é—´</strong>ï¼š6 æœˆ 10 æ—¥ 11:42 - 11:47 HKT<br><strong>åœ°ç‚¹</strong>ï¼šLevel 16 | Grand Ballroom I<br><strong>æ¼”è®²è€…</strong>ï¼šJian Zhu (Red Hat)</p><p>åœ¨è¿™ä¸ªé—ªç”µæ¼”è®²ä¸­ï¼ŒJian Zhu å°†ä»‹ç» OCM çš„ Addon æœºåˆ¶ï¼Œå±•ç¤ºå¦‚ä½•é€šè¿‡ç®€å•çš„ YAML æ–‡ä»¶å®ç°å¤šé›†ç¾¤èƒ½åŠ›çš„æ‰©å±•ã€‚ä¸»è¦å†…å®¹åŒ…æ‹¬ï¼š</p><ul><li>OCM Addon æœºåˆ¶æ¦‚è¿°åŠå…¶åœ¨å¤šé›†ç¾¤ç¯å¢ƒä¸­çš„ä½œç”¨</li><li>é¡¹ç›®é›†æˆæ¡ˆä¾‹ï¼šä»¥ Fluid ä¸ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•é€šè¿‡ Addon å¢å¼ºå¤šé›†ç¾¤ç®¡ç†èƒ½åŠ›</li><li>AddonTemplate APIï¼šç®€åŒ– addon åˆ›å»ºå’Œç®¡ç†çš„åˆ›æ–°æ–¹æ¡ˆ</li><li>å®é™…åº”ç”¨ä»·å€¼ï¼šå±•ç¤º OCM Addons çš„æ•ˆç‡å’Œå¯æ‰©å±•æ€§</li></ul><h3 id=è§£é”-cel-åœ¨å¤šé›†ç¾¤è°ƒåº¦ä¸­çš„å¼ºå¤§èƒ½åŠ›><a href="https://kccncchn2025.sched.com/event/1x5jG/unlocking-the-power-of-cel-for-advanced-multi-cluster-scheduling-qing-hao-jian-qiu-red-hat?iframe=no&amp;w=100%25&amp;sidebar=yes&amp;bg=no">è§£é” CEL åœ¨å¤šé›†ç¾¤è°ƒåº¦ä¸­çš„å¼ºå¤§èƒ½åŠ›</a></h3><p><strong>æ—¶é—´</strong>ï¼š6 æœˆ 10 æ—¥ 17:00 - 17:30 HKT<br><strong>åœ°ç‚¹</strong>ï¼šLevel 19 | Crystal Court II<br><strong>æ¼”è®²è€…</strong>ï¼šQing Hao (Red Hat)</p><p>Common Expression Language (CEL) ä½œä¸º Kubernetes API ä¸­çš„å¼ºå¤§å·¥å…·ï¼Œåœ¨ Kubernetes v1.32 ä¸­è¢«ç”¨äºå˜å¼‚å‡†å…¥ç­–ç•¥ï¼ŒåŒæ—¶ä¹Ÿåœ¨ Envoy å’Œ Istio ä¸­å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚æœ¬æ¬¡æ¼”è®²å°†æ·±å…¥æ¢è®¨ CEL åœ¨å¤šé›†ç¾¤è°ƒåº¦ä¸­å¸¦æ¥çš„ä¼˜åŠ¿å’Œç‰¹æ€§ã€‚</p><p>éšç€å¤šé›†ç¾¤è°ƒåº¦éœ€æ±‚çš„ä¸æ–­å¢é•¿ï¼Œç”¨æˆ·å¯¹è°ƒåº¦ç­–ç•¥çš„ç²¾ç»†åŒ–å’Œå®šåˆ¶åŒ–è¦æ±‚è¶Šæ¥è¶Šé«˜ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯èƒ½å¸Œæœ›ä½¿ç”¨ &ldquo;version&rdquo; > v1.30.0 è¿™æ ·çš„æ ‡ç­¾è¡¨è¾¾å¼æ¥ç­›é€‰é›†ç¾¤ï¼Œè€Œä¸æ˜¯ç®€å•åœ°åˆ—å‡ºæ‰€æœ‰ç‰ˆæœ¬ã€‚è®¸å¤šç”¨æˆ·è¿˜å¸Œæœ›èƒ½å¤Ÿä½¿ç”¨è‡ªå®šä¹‰èµ„æºï¼ˆCRDï¼‰å­—æ®µæˆ–æŒ‡æ ‡æ¥è¿›è¡Œè°ƒåº¦å†³ç­–ã€‚CEL çš„æ‰©å±•æ€§èƒ½å¤Ÿæœ‰æ•ˆåº”å¯¹è¿™äº›æŒ‘æˆ˜ï¼Œå› ä¸ºå®ƒå¯ä»¥å¤„ç†å¤æ‚çš„è¡¨è¾¾å¼ã€‚</p><p>åœ¨æœ¬æ¬¡æ¼”è®²ä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤º Open Cluster Management (OCM) å¦‚ä½•åˆ©ç”¨ CEL å®ç°å¤šé›†ç¾¤è°ƒåº¦ã€‚ä»¥ ClusterProfile API ä¸ºä¾‹ï¼Œæˆ‘ä»¬å°†æ¼”ç¤º CEL å¦‚ä½•æ»¡è¶³å¤æ‚çš„è°ƒåº¦éœ€æ±‚ï¼Œå¹¶é€šè¿‡è§£å†³è£…ç®±ï¼ˆbin-packingï¼‰é—®é¢˜æ¥å±•ç¤ºå…¶åœ¨æå‡ AI åº”ç”¨ GPU èµ„æºåˆ©ç”¨ç‡æ–¹é¢çš„æ½œåŠ›ã€‚</p><h3 id=ç»Ÿä¸€æ··åˆå¤šé›†ç¾¤è®¤è¯ä½“éªŒspiffe-ä¸-cluster-inventory-api-çš„ç»“åˆ><a href="https://kccncchn2025.sched.com/event/1x5jq/connecting-dots-unified-hybrid-multi-cluster-auth-experience-with-spiffe-and-cluster-inventory-api-chen-yu-microsoft-jian-zhu-red-hat?iframe=no&amp;w=100%25&amp;sidebar=yes&amp;bg=no">ç»Ÿä¸€æ··åˆå¤šé›†ç¾¤è®¤è¯ä½“éªŒï¼šSPIFFE ä¸ Cluster Inventory API çš„ç»“åˆ</a></h3><p><strong>æ—¶é—´</strong>ï¼š6 æœˆ 11 æ—¥ 13:45 - 14:15 HKT<br><strong>åœ°ç‚¹</strong>ï¼šLevel 16 | Grand Ballroom I<br><strong>æ¼”è®²è€…</strong>ï¼šChen Yu (Microsoft) & Jian Zhu (Red Hat)</p><p>éšç€å¤šé›†ç¾¤æ¨¡å¼çš„ä¸æ–­å‘å±•ï¼Œä¸ºå›¢é˜Ÿå’Œå¤šé›†ç¾¤åº”ç”¨ï¼ˆå¦‚ Argo å’Œ Kueueï¼‰ç®¡ç† Kubernetes èº«ä»½ã€å‡­è¯å’Œæƒé™å˜å¾—è¶Šæ¥è¶Šç¹çã€‚ç›®å‰çš„åšæ³•é€šå¸¸éœ€è¦åœ¨æ¯ä¸ªé›†ç¾¤ä¸Šå•ç‹¬ç®¡ç†æœåŠ¡è´¦å·ï¼Œå¹¶åœ¨é›†ç¾¤é—´ä¼ é€’å‡­è¯ã€‚è¿™ç§è®¾ç½®å¾€å¾€åˆ†æ•£ã€é‡å¤ï¼Œéš¾ä»¥è¿½è¸ªå’Œå®¡è®¡ï¼Œè¿˜å¯èƒ½å¸¦æ¥å®‰å…¨å’Œè¿ç»´æ–¹é¢çš„æŒ‘æˆ˜ã€‚åœ¨æ··åˆäº‘ç¯å¢ƒä¸­ï¼Œç”±äºä¸åŒå¹³å°å¯èƒ½é‡‡ç”¨ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸ªé—®é¢˜å°¤ä¸ºçªå‡ºã€‚</p><p>æœ¬æ¬¡æ¼”ç¤ºå°†ä»‹ç»ä¸€ä¸ªåŸºäº OpenIDã€SPIFFE/SPIRE å’Œ Multi-Cluster SIG çš„ Cluster Inventory API çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒèƒ½å¤Ÿæä¾›ç»Ÿä¸€ã€æ— ç¼ä¸”å®‰å…¨çš„è®¤è¯ä½“éªŒã€‚é€šè¿‡ CNCF å¤šé›†ç¾¤é¡¹ç›® OCM å’Œ Kueue çš„æ”¯æŒï¼Œä¸ä¼šè€…å°†äº†è§£å¦‚ä½•åˆ©ç”¨å¼€æºè§£å†³æ–¹æ¡ˆæ¥æ¶ˆé™¤å‡­è¯åˆ†æ•£é—®é¢˜ï¼Œé™ä½è¿ç»´å¤æ‚åº¦ï¼Œå¹¶åœ¨æ··åˆäº‘ç¯å¢ƒä¸­ä¸ºå›¢é˜Ÿå’Œåº”ç”¨è®¿é—®å¤šé›†ç¾¤è®¾ç½®æ—¶æå‡å®‰å…¨æ€§ã€‚</p><h2 id=æ¼”è®²è€…ä¿¡æ¯>æ¼”è®²è€…ä¿¡æ¯</h2><h4 id=jian-zhu>Jian Zhu</h4><p><strong>èŒä½</strong>ï¼šé«˜çº§è½¯ä»¶å·¥ç¨‹å¸ˆï¼ŒRed Hat<br><strong>ç®€ä»‹</strong>ï¼šJian Zhu æ˜¯ Red Hat çš„é«˜çº§è½¯ä»¶å·¥ç¨‹å¸ˆï¼ŒKubeCon China 2024 çš„æ¼”è®²å˜‰å®¾ï¼Œä¹Ÿæ˜¯ Open Cluster Management é¡¹ç›®çš„æ ¸å¿ƒè´¡çŒ®è€…ã€‚ä»–ä¸“æ³¨äºè§£å†³å¤šé›†ç¾¤å·¥ä½œè´Ÿè½½åˆ†å‘é—®é¢˜å’Œé€šè¿‡ addon æœºåˆ¶æ‰©å±• OCM çš„åŠŸèƒ½ã€‚</p><h4 id=qing-hao>Qing Hao</h4><p><strong>èŒä½</strong>ï¼šé«˜çº§è½¯ä»¶å·¥ç¨‹å¸ˆï¼ŒRed Hat<br><strong>ç®€ä»‹</strong>ï¼šQing Hao æ˜¯ Red Hat çš„é«˜çº§è½¯ä»¶å·¥ç¨‹å¸ˆï¼Œæ‹…ä»» Open Cluster Management çš„ç»´æŠ¤è€…ã€‚å¥¹åŒæ—¶æ‹…ä»» CNCF Ambassadorï¼Œæ˜¯ KubeCon China 2024 çš„æ¼”è®²å˜‰å®¾ï¼Œä»¥åŠ OSPP 2022 å’Œ GSoC 2024 çš„å¯¼å¸ˆã€‚å¥¹ä¸“æ³¨äºè§£å†³å¤šé›†ç¾¤ç¯å¢ƒä¸­çš„å¤æ‚æŒ‘æˆ˜ï¼Œä¾‹å¦‚åº”ç”¨è°ƒåº¦å’Œç®¡ç†ç»„ä»¶çš„æ»šåŠ¨å‡çº§ã€‚åœ¨åŠ å…¥ Red Hat ä¹‹å‰ï¼ŒQing æ›¾åœ¨ IBM å·¥ä½œï¼Œåœ¨å®¹å™¨ã€äº‘åŸç”ŸæŠ€æœ¯å’Œé«˜æ€§èƒ½è®¡ç®—ï¼ˆHPCï¼‰é¢†åŸŸæ‹¥æœ‰å¤šå¹´ç»éªŒã€‚</p><h2 id=å±•å°ä¿¡æ¯>å±•å°ä¿¡æ¯</h2><p>é™¤äº†ç²¾å½©çš„æ¼”è®²ï¼ŒOpen Cluster Management è¿˜å°†åœ¨ KubeCon China 2025 è®¾ç½®å±•å°ï¼Œæ¬¢è¿æ‚¨å‰æ¥äº¤æµï¼</p><p><strong>å±•å°ä¿¡æ¯</strong>ï¼š</p><ul><li><strong>é¡¹ç›®</strong>ï¼šOpen Cluster Management</li><li><strong>å±•å°ç¼–å·</strong>ï¼š8</li><li><strong>å±•å°ä½ç½®</strong>ï¼šHopewell Hotel | Level 16 | Grand Ballroom II | Solutions Showcase</li><li><strong>å±•å°æ—¶é—´</strong>ï¼š6 æœˆ 11 æ—¥ 10:15 - 12:30 HKT</li></ul><p>åœ¨å±•å°ï¼Œæ‚¨å°†æœ‰æœºä¼šï¼š</p><ul><li>ä¸ OCM æ ¸å¿ƒå¼€å‘è€…é¢å¯¹é¢äº¤æµ</li><li>äº†è§£æœ€æ–°çš„å¤šé›†ç¾¤ç®¡ç†è§£å†³æ–¹æ¡ˆ</li><li>æ¢è®¨å®é™…åº”ç”¨åœºæ™¯å’ŒæŠ€æœ¯æŒ‘æˆ˜</li><li>è·å–ç¤¾åŒºèµ„æºå’Œå‚ä¸æ–¹å¼ä»¥åŠä¸€äº›ç²¾ç¾çš„å°ç¤¼å“</li></ul><img src=./assets/gifts.jpg alt="OCM Gifts" width=800 height=600 style=display:block;margin:0><h2 id=åŠ å…¥æˆ‘ä»¬>åŠ å…¥æˆ‘ä»¬</h2><p>Open Cluster Management ç¤¾åŒºè¯šæŒšé‚€è¯·æ‚¨å‚åŠ è¿™äº›ç²¾å½©æ¼”è®²ï¼Œä¸€èµ·æ¢è®¨å¤šé›†ç¾¤ç®¡ç†çš„æœªæ¥å‘å±•æ–¹å‘ã€‚æ— è®ºæ‚¨æ˜¯å¼€å‘è€…ã€è¿ç»´å·¥ç¨‹å¸ˆè¿˜æ˜¯æ¶æ„å¸ˆï¼Œéƒ½èƒ½åœ¨è¿™äº›è®®é¢˜ä¸­æ‰¾åˆ°æœ‰ä»·å€¼çš„å†…å®¹ã€‚</p><p>è®©æˆ‘ä»¬ç›¸çº¦ KubeCon China 2025ï¼Œå…±åŒæ¢è®¨äº‘åŸç”Ÿå¤šé›†ç¾¤ç®¡ç†çš„åˆ›æ–°ä¸å®è·µï¼</p><h2 id=ç›¸å…³èµ„æº>ç›¸å…³èµ„æº</h2><ul><li><a href=https://open-cluster-management.io>Open Cluster Management é¡¹ç›®ä¸»é¡µ</a></li><li><a href=https://github.com/open-cluster-management-io>GitHub ä»“åº“</a></li><li><a href=https://kubernetes.slack.com/channels/open-cluster-mgmt>ç¤¾åŒº Slack é¢‘é“</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-58542dd090182588aa753add0977dac4>Joining OCM Hub and Spoke using AWS IRSA authentication</h1><div class="td-byline mb-4">By <b>Guidewire <a href=https://github.com/suvaanshkumar>Suvaansh Kumar</a>, <a href=https://github.com/jaswalkiranavtar>Gaurav Jaswal</a>, <a href=https://github.com/dtclxy64>Emily Li</a>, <a href=https://github.com/alex0chan>Alex Chan</a></b> |
<time datetime=2024-12-02 class=text-body-secondary>Monday, December 02, 2024</time></div><p>Refer <a href=https://github.com/open-cluster-management-io/ocm/tree/main/solutions/joining-hub-and-spoke-with-aws-auth>this</a> solution.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e699b31346e6258210c791d4f965cbcb>KubeCon NA 2024 - Scheduling AI Workload Among Multiple Clusters</h1><div class="td-byline mb-4"><time datetime=2024-11-12 class=text-body-secondary>Tuesday, November 12, 2024</time></div><p>Read more at <a href=https://kccncna2024.sched.com/event/1iW9B/open-cluster-management-scheduling-ai-workload-among-multiple-clusters-project-lightning-talk>KubeCon NA 2024 - Open Cluster Management: Scheduling AI Workload Among Multiple Clusters | Project Lightning Talk</a> |
<a href="https://www.youtube.com/watch?v=bZrjMEzX0rU">video</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b03a552881e305db2c02f594de29f9f0>KubeDay Australia 2024 - Open Sourcing the Open Cluster Management Project and the Lessons We Can Learn for AI</h1><div class="td-byline mb-4"><time datetime=2024-10-15 class=text-body-secondary>Tuesday, October 15, 2024</time></div><p>Read more at <a href=https://kubedayaustralia2024.sched.com/event/1hAUw/open-sourcing-the-open-cluster-management-project-and-the-lessons-we-can-learn-for-ai-august-simonelli-red-hat>KubeDay Australia 2024 - Open Sourcing the Open Cluster Management Project and the Lessons We Can Learn for AI</a> |
<a href="https://www.youtube.com/watch?v=SLmJ6yJ6lAI">video</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-db2a7b7fdb17d06afb81db2ca320f1e3>KubeCon CN 2024 - Boundaryless Computing: Optimizing LLM Performance, Cost, and Efficiency in Multi-Cloud Architecture | æ— è¾¹ç•Œè®¡ç®—ï¼šåœ¨å¤šäº‘æ¶æ„ä¸­ä¼˜åŒ–LLMæ€§èƒ½ã€æˆæœ¬å’Œæ•ˆç‡</h1><div class="td-byline mb-4"><time datetime=2024-08-21 class=text-body-secondary>Wednesday, August 21, 2024</time></div><p>Read more at <a href=https://kccncossaidevchn2024.sched.com/event/1eYXG/boundaryless-computing-optimizing-llm-performance-cost-and-efficiency-in-multi-cloud-architecture-yi-dui-dou-zhao-daepnano-llmxia-reyi-jian-zhu-red-hat-kai-zhang-alibaba-cloud-intelligence>KubeCon CN 2024 - Boundaryless Computing: Optimizing LLM Performance, Cost, and Efficiency in Multi-Cloud Architecture</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-d71450f51c2c85cb64c9f06dc40f2b4b>KubeCon CN 2024 - Connecting the Dots: Towards a Unified Multi-Cluster AI/ML Experience | è¿æ¥ç‚¹ï¼šèµ°å‘ç»Ÿä¸€çš„å¤šé›†ç¾¤AI/MLä½“éªŒ</h1><div class="td-byline mb-4"><time datetime=2024-08-21 class=text-body-secondary>Wednesday, August 21, 2024</time></div><p>Read more at <a href=https://kccncossaidevchn2024.sched.com/event/1eYXc/connecting-the-dots-towards-a-unified-multi-cluster-aiml-experience-pu-daepyu-ni-zha-zhong-shi-aimlmo-qing-hao-redhat-chen-yu-microsoft>KubeCon CN 2024 - Connecting the Dots: Towards a Unified Multi-Cluster AI/ML Experience</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-4fa6a2f0a46cbfce6b28e33880d0b187>KubeCon CN 2024 - Extend Kubernetes to Edge Using Event-Based Transport | ä½¿ç”¨åŸºäºäº‹ä»¶çš„ä¼ è¾“å°†Kubernetesæ‰©å±•åˆ°è¾¹ç¼˜</h1><div class="td-byline mb-4"><time datetime=2024-08-21 class=text-body-secondary>Wednesday, August 21, 2024</time></div><p>Read more at <a href=https://kccncossaidevchn2024.sched.com/event/1eYX1/extend-kubernetes-to-edge-using-event-based-transport-zhi-27dzha-lian-kubernetesyi-sui-longlong-cao-meng-yan-red-hat>KubeCon CN 2024 - Extend Kubernetes to Edge Using Event-Based Transport</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-027563391b79d1175e323c20b2b42709>The HA Hub clusters solution -- MultipleHubs</h1><div class="td-byline mb-4">By <b>Zhao Xue <a href=https://github.com/xuezhaojun>@xuezhaojun</a></b> |
<time datetime=2024-08-11 class=text-body-secondary>Sunday, August 11, 2024</time></div><p>The <code>MultipleHubs</code> is a new feature in Open Cluster Management (OCM) that allows you to configure a list of bootstrap kubeconfigs of multiple hubs. This feature is designed to provide a high availability (HA) solution of hub clusters. In this blog, we will introduce the MultipleHubs feature and how to use it.</p><p>The high availability of hub clusters means that if one hub cluster is down, the managed clusters can still communicate with other hub clusters. Users can also specify the hub cluster that the managed cluster should connect to by configuring the <code>ManagedCluster</code> resource.</p><p>The <code>MultipleHubs</code> feature is currently in the experimental stage and is disabled by default. To enable the <code>MultipleHubs</code> feature, you need to set the <code>featureGate</code> in <code>Klusterlet</code>&rsquo;s registration configuration. The following is an example of the <code>Klusterlet</code>&rsquo;s registration configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operator.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Klusterlet</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>registrationConfiguration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>featureGates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>feature</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>MultipleHubs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Enable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>If <code>MultipleHubs</code> is enabled, you don&rsquo;t need to prepare the default <code>bootstrapKubeConfig</code> for the managed cluster. The managed cluster will use the <code>bootstrapKubeConfigs</code> in the <code>Klusterlet</code>&rsquo;s registration configuration to connect to the hub clusters. An example of <code>bootstrapKubeConfigs</code> is like following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operator.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Klusterlet</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>registrationConfiguration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>featureGates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>feature</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>MultipleHubs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Enable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>bootstrapKubeConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;LocalSecrets&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>localSecretsConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kubeConfigSecrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;hub1-bootstrap&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;hub2-bootstrap&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>hubConnectionTimeoutSeconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>600</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In the above configuration, the <code>hub1-bootstrap</code> and <code>hub2-bootstrap</code> are the secrets that contain the kubeconfig of the hub clusters. You should create the secrets before you set the <code>bootstrapKubeConfigs</code> in the <code>Klusterlet</code>&rsquo;s registration configuration.</p><p>The order of the secrets in the <code>kubeConfigSecrets</code> is the order of the hub clusters that the managed cluster will try to connect to. The managed cluster will try to connect to the first hub cluster in the list first. If the managed cluster cannot connect to the first hub cluster, it will try to connect to the second hub cluster, and so on.</p><p>Note that the expiration time of the credentials in kubeconfigs should be long enough to ensure the managed cluster can connect to another hub cluster when one hub cluster is down.</p><p>The <code>hubConnectionTimeoutSeconds</code> is the timeout for the managed cluster to connect to the hub clusters. If the managed cluster cannot connect to the hub cluster within the timeout, it will try to connect to another hub cluster. It is also used to avoid the effect of network disturbance. The default value is 600 seconds and the minimum value is 180 seconds.</p><p>Currently, the <code>MultipleHubs</code> feature only supports the <code>LocalSecrets</code> type of <code>bootstrapKubeConfigs</code>.</p><p>As we mentioned before, you can also specify the hub&rsquo;s connectivity in the <code>ManagedCluster</code> resource from the hub side. We use the <code>hubAcceptsClient</code> field in the <code>ManagedCluster</code> resource to specify whether the hub cluster accepts the managed cluster. The following is an example of the <code>ManagedCluster</code> resource:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedCluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>hubAcceptsClient</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>If the <code>hubAcceptsClient</code> is set to <code>false</code>, the managed cluster currently connected to the hub will immediately disconnect from the hub and try to connect to another hub cluster.</p><p>And the managed clusters that are trying to connect to another hub cluster will ignore the hub cluster that the managed cluster&rsquo;s <code>hubAcceptsClient</code> is set to <code>false</code>.</p><p>That&rsquo;s the brief introduction of the <code>MultipleHubs</code> feature in Open Cluster Management. We hope this feature can help you to start building a high availability solution of hub clusters and we are looking forward to your feedback. If you have any questions or suggestions, please feel free to contact us.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-990faab21a4dc06e65343bf113d26d98>Using the GitOps way to deal with the upgrade challenges of multi-cluster tool chains</h1><div class="td-byline mb-4">By <b>Qing Hao <a href=https://github.com/haoqing0110>@haoqing0110</a></b> |
<time datetime=2024-01-19 class=text-body-secondary>Friday, January 19, 2024</time></div><h2 id=upgrading-challenges-of-tool-chains-in-multi-cluster-environments>Upgrading challenges of tool chains in multi-cluster environments</h2><p>Open Cluster Management (OCM) is a community-driven project focused on multicluster and multicloud scenarios for Kubernetes applications. It provides functions such as cluster registration, application and workload distribution, and scheduling. Add-on is an extension mechanism based on the foundation components provided by OCM, which allows applications in the Kubernetes ecosystem to be easily migrated to the OCM platform and has the ability to orchestrate and schedule across multiple clusters and multiple clouds. For example, Istio, Prometheus, and Submarine can be expanded to multiple clusters through Add-on. In a multi-cluster environment, how to upgrade the entire tool chain (such as Istio, Prometheus and other tools) gracefully and smoothly is a challenge we encounter in multi-cluster management. A failed upgrade of the tool chain can potentially render thousands of user workloads inaccessible. Therefore, finding an easy and safe upgrade solution across clusters becomes important.</p><p>In this article, we will introduce how Open Cluster Management (OCM) treats tool chain upgrades as configuration file changes, allowing users to leverage Kustomize or GitOps to achieve seamless rolling/canary upgrades across clusters.</p><p>Before we begin, let us first introduce several concepts in OCM.</p><h2 id=add-on>Add-on</h2><p>On the OCM platform, add-on can apply different configurations on different managed clusters, and can also implement functions such as obtaining data from the control plane (Hub) to the managed cluster. For example, you can use <a href=https://github.com/open-cluster-management-io/managed-serviceaccount>managed-serviceaccount</a>, this add-on returns the specified <code>ServiceAccount</code> information on the managed cluster to the hub cluster. You can use the <a href=https://github.com/open-cluster-management-io/cluster-proxy>cluster-proxy</a> add-on to establish a reverse proxy channel from spoke to hub.</p><p>At this stage, there are some add-ons in the OCM community:</p><ul><li><a href=https://github.com/open-cluster-management-io/multicluster-mesh>Multicluster Mesh Addon</a> can be used to manage (discovery, deploy and federate) service meshes across multiple clusters in OCM.</li><li><a href=https://github.com/stolostron/submariner-addon>Submarine Addon</a> deploys the Submariner Broker on the Hub cluster and the required Submariner components on the managed clusters.</li><li><a href=https://github.com/open-cluster-management-io/addon-contrib/tree/main/open-telemetry-addon>Open-telemetry add-on</a> automates the installation of otelCollector on both hub cluster and managed clusters and jaeget-all-in-one on hub cluster for processing and storing the traces.</li><li><a href=https://open-cluster-management.io/zh/getting-started/integration/app-lifecycle/>Application lifecycle management</a> enables application lifecycle management in multi-cluster or multi-cloud environments.</li><li><a href=https://open-cluster-management.io/getting-started/integration/policy-framework/>Policy framework</a> and <a href=https://open-cluster-management.io/getting-started/integration/policy-controllers/>Policy controllers</a> allows Hub cluster administrators to easily deploy security-related policies for managed clusters.</li><li><a href=https://open-cluster-management.io/getting-started/integration/managed-serviceaccount/>Managed service account</a> enables a hub cluster admin to manage service account across multiple clusters on ease.</li><li><a href=https://open-cluster-management.io/getting-started/integration/cluster-proxy/>Cluster proxy</a> provides L4 network connectivity from hub cluster to the managed clusters.</li></ul><p><strong>For more information about add-on, please refer to <a href=https://open-cluster-management.io/concepts/addon/>Add-on concept</a> and <a href=https://open-cluster-management.io/developer-guides/addon/>Add-on Developer Guide</a>.</strong></p><p>OCM provides two ways to help developers develop their own add-ons:</p><ul><li>Hard mode: Using the built-in mechanism of <a href=https://github.com/open-cluster-management-io/addon-framework>addon-framework</a>, you can follow the <a href=https://open-cluster-management.io/developer-guides/addon/>Add-on Development Guide</a> to develop the addon manager and addon agent.</li><li>Easy mode: OCM provides a new development model, which can use <a href=https://open-cluster-management.io/developer-guides/addon/#build-an-addon-with-addon-template>AddOnTemplate</a> to build add-on. In this model, developers do not need to develop the addon manager, but only need to prepare the addon agent&rsquo;s image and <code>AddOnTemplate</code>. <code>AddOnTemplate</code> describes how to deploy the addon agent and how to register the add-on.</li></ul><p>Below is the <code>ClusterManagementAddOn</code> and <code>AddOnTemplate</code> of a sample add-on. <code>AddOnTemplate</code> is treated as an add-on configuration file, defined in <code>supportedConfigs</code>. The <code>AddOnTemplate</code> resource contains the manifest required to deploy the add-on and the add-on registration method.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>addOnMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template is an addon built with addon template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># declare it is a template type addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addontemplates</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>defaultConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnTemplate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>addonName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>agentSpec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>#required</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>             </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>             </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRoleBinding</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>registration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>#optional</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=placement-decision-strategy>Placement Decision Strategy</h2><p>The Placement API is used to select a set of <code>ManagedClusters</code> in one or more <code>ManagedClusterSets</code> to deploy workloads to these clusters.</p><p><strong>For more introduction to the Placement API, please refer to <a href=https://open-cluster-management.io/concepts/placement/>Placement concept</a>.</strong></p><p>The &ldquo;input&rdquo; and &ldquo;output&rdquo; of the Placement scheduling process are decoupled into two independent Kubernetes APIs: <code>Placement</code> and <code>PlacementDecision</code>.</p><ul><li>Placement provides filtering of clusters through the <code>labelSelector</code> or the <code>claimSelector</code>, and also provides some built-in <code>prioritizers</code>, which can score, sort and prioritize the filtered clusters.</li><li>The scheduling results of <code>Placement</code> will be placed in <code>PlacementDecision</code>, <code>status.decisions</code> lists the top N clusters with the highest scores and sorts them by name, and the scheduling results will dynamically change as the cluster changes. The <code>decisionStrategy</code> section in Placement can be used to divide the created <code>PlacementDecision</code> into multiple groups and define the number of clusters in each decision group. <code>PlacementDecision</code> supports paging display, and each resource supports containing 100 cluster names.</li></ul><p>Below is an example of <code>Placement</code> and <code>decisionStrategy</code>. Assume that there are 300 <code>ManagedClusters</code> in the global <code>ManagedClusterSets</code>, and 10 of them have the label canary. The following example describes grouping the canary-labeled clusters into a group and grouping the remaining clusters into groups of up to 150 clusters each.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>clusterSets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#000>global</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>decisionStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>groupStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>clustersPerDecisionGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>150</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>decisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>groupClusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>             </span><span style=color:#204a87;font-weight:700>matchExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>               </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exists</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The grouped results will be displayed in the <code>status</code> of <code>Placement</code>. The canary group has 10 clusters, and the results are placed in <code>aws-placement-decision-1</code>. The other default groupings are only group index, each group has 150 and 140 clusters respectively. Since a <code>PlacementDecsion</code> only supports 100 clusters, the results for each group are put into two <code>PlacementDecisions</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>decisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span>- <span style=color:#204a87;font-weight:700>clusterCount</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>decisionGroupIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>decisionGroupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>decisions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#000>aws-placement-decision-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span>- <span style=color:#204a87;font-weight:700>clusterCount</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>150</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>decisionGroupIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>decisionGroupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>decisions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#000>aws-placement-decision-2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#000>aws-placement-decision-3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span>- <span style=color:#204a87;font-weight:700>clusterCount</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>140</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>decisionGroupIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>decisionGroupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>decisions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#000>placement1-decision-3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#000>placement1-decision-4</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>numberOfSelectedClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>300</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Taking the canary group as an example, its <code>PlacementDecision</code> is as follows, where the label <code>cluster.open-cluster-management.io/decision-group-index</code> represents the index of the group to which it belongs, <code>cluster.open-cluster-management.io/decision-group-name</code> represents the name of the group it belongs to, and <code>cluster.open-cluster-management.io/placement</code> represents the <code>Placement</code> it belongs to. Users can flexibly obtain scheduling results through tag selectors.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PlacementDecision</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>cluster.open-cluster-management.io/decision-group-index</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>cluster.open-cluster-management.io/decision-group-name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>cluster.open-cluster-management.io/placement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement-decision-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>decisions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=simplify-upgrades-the-gitops-way>Simplify upgrades the GitOps way</h2><p>The above briefly introduces the concepts of add-on template and placement decision strategy.</p><p>In OCM, we regard the upgrade of add-on as the upgrade of its configuration file. The configuration here can be <code>AddOnTemplate</code> or other customized configuration file such as <code>AddOnDeploymentConfig</code>. An add-on upgrade is treated as a configuration file update, which enables users to leverage Kustomize or GitOps for seamless cross-cluster rolling/canary upgrades. <code>RolloutStrategy</code> defines the upgrade strategy, supports upgrade all, progressive upgrades by cluster and progressive upgrades by cluster group, and can define a set of <code>MandatoryDecisionGroups</code> to try new configurations first.</p><p>According to the four principles of GitOps, let&rsquo;s take a look at how OCM supports the GitOps approach to address upgrade challenges in multi-cluster environments.</p><ul><li>Declarative</li></ul><p>The configuration file used by add-on can be declared in <code>ClusterManagementAddOn</code>. The configuration file can be declared in the global <code>supportedConfigs</code>, and the configuration file will be applied to all <code>ManagedClusterAddOn</code> instances. It can also be declared in different placements under <code>installStrategy</code>. The <code>ManagedClusterAddOn</code> of the cluster selected by each Placement will have the same configuration file. The configuration declared in placements will override the global configuration.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>defaultConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-0.4.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addontemplates</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-addon-deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>progressive</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>maxConcurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>Version control</li></ul><p>Changes in the add-on configuration file name or spec content will be considered a configuration change and will trigger an upgrade of the add-on. Users can leverage Kustomize or GitOps to control configuration file upgrades.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnTemplate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-0.4.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>agentSpec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># required</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-addon-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>â€¦</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>registration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># optional</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>Automation</li></ul><p>The OCM component addon-manager-controller under the open-cluster-management-hub namespace is a more general addon manager. It will watch the following two types of add-on and be responsible for maintaining the lifecycle of such add-on. Includes installation and upgrades. When the name or spec content of the configuration file changes, this component will upgrade the add-on according to the upgrade strategy defined by rolloutStrategy.</p><ul><li>Hard mode: Using the add-on developed by the latest <a href=https://github.com/open-cluster-management-io/addon-framework>addon-framework</a>, you need to delete the <code>WithInstallStrategy()</code> method in the code and add annotation <code>addon.open-cluster-management.io/lifecycle: "addon-manager"</code> in <code>ClusterManagementAddOn</code>. For details, refer to <a href=https://open-cluster-management.io/developer-guides/addon/#managing-the-add-on-agent-lifecycle-by-addon-manager>Add-on Development Guide</a>.</li><li>Easy mode: add-on developed using <code>AddOnTemplate</code> mode.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>âœ— kubectl get deploy -n open-cluster-management-hub
</span></span><span style=display:flex><span>NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>cluster-manager-addon-manager-controller   1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           10h
</span></span><span style=display:flex><span>cluster-manager-placement-controller       1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           10h
</span></span><span style=display:flex><span>cluster-manager-registration-controller    1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           10h
</span></span><span style=display:flex><span>cluster-manager-registration-webhook       1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           10h
</span></span><span style=display:flex><span>cluster-manager-work-webhook               1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           10h
</span></span></code></pre></div><ul><li>Coordination</li></ul><p>The spec hash of the add-on configuration file will be recorded in the status of <code>ClusterManagementAddOn</code> and <code>ManagedClusterAddOn</code>. When the spec hash changes, add-on-manager-controller will continue to update the add-on according to the upgrade strategy defined by rolloutStrategy until <code>lastAppliedConfig</code>, <code>lastKnownGoodConfig</code> is consistent with <code>desiredConfig</code>. In the following example, because <code>lastAppliedConfig</code> does not match <code>desiredConfig</code>, the add-on status is displayed as &ldquo;Upgrading&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>â€¦</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>installProgressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2023-09-21T06:53:59Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000>/3 upgrading, 0 timeout.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Upgrading</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressing</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>configReferences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span>- <span style=color:#204a87;font-weight:700>desiredConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-0.4.1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>specHash</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dcf88f5b11bd191ed2f886675f967684da8b5bcbe6902458f672277d469e2044</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>lastAppliedConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-0.4.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>specHash</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>1f7874ac272f3e4266f89a250d8a76f0ac1c6a4d63d18e7dcbad9068523cf187</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>lastKnownGoodConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-0.4.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>specHash</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>1f7874ac272f3e4266f89a250d8a76f0ac1c6a4d63d18e7dcbad9068523cf187</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addontemplates</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placementl</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>â€¦</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2023-09-21T06:53:42Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>upgrading.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Upgrading</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressing</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>configReferences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>desiredConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-0.4.1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>specHash</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dcf88f5b11bd191ed2f886675f967684da8b5bcbe6902458f672277d469e2044</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>lastAppliedConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-0.4.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>specHash</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dcf88f5b11bd191ed2f886675f967684da8b5bcbe6902458f672277d469e2044</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>lastObservedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-0.4.1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addontemplates</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=three-upgrade-strategies>Three upgrade strategies</h2><p>The <code>rolloutStrategy</code> field of <code>ClusterManagementAddOn</code> defines the upgrade strategy. Currently, OCM supports three types of upgrade strategies.</p><ul><li>All</li></ul><p>The default upgrade type is All, which means the new configuration file will be applied to all the clusters immediately.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#000>namespace:default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>All</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>Progressive</li></ul><p>Progressive means that the new configuration file will be deployed to the selected clusters progressively per cluster. The new configuration file will not be applied to the next cluster unless one of the current applied clusters reach the successful state and haven&rsquo;t breached the <code>MaxFailures</code>. We introduced the concept of &ldquo;Placement Decision Group&rdquo; earlier. One or more decision groups can be specified in <code>MandatoryDecisionGroups</code>. If <code>MandatoryDecisionGroups</code> are defined, new configuration files are deployed to these cluster groups first. <code>MaxConcurrency</code> defines the maximum number of clusters deployed simultaneously.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#000>namespace:default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>progressive</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>maxConcurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>ProgressivePerGroup</li></ul><p>ProgressivePerGroup means that the new configuration file will be deployed to decisionGroup clusters progressively per group. The new configuration file will not be applied to the next cluster group unless all the clusters in the current group reach the successful state and haven&rsquo;t breached the <code>MaxFailures</code>. If <code>MandatoryDecisionGroups</code> are defined, new configuration files are deployed to these cluster groups first. If there are no <code>MandatoryDecisionGroups</code>, the cluster group will be upgraded in order of index.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#000>namespace:default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ProgressivePerGroup</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>progressivePerGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>According to the four principles of GitOps and the three upgrade strategies of OCM, users can use Kustomize or GitOps to achieve seamless rolling/canary upgrades across clusters. It is worth noting that installStrategy supports multiple placement definitions, and users can implement more advanced upgrade strategies based on this.</p><p>As in the example below, you can define two placements at the same time to select clusters on aws and gcp respectively, so that the same add-on can use different configuration files and upgrade strategies in different clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-addon-deploy-config-aws</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ProgressivePerGroup</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>progressivePerGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gcp-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-addon-deploy-config-gcp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ProgressivePerGroup</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>progressivePerGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=three-upgrade-configurations>Three upgrade configurations</h2><p>The <code>rolloutStrategy</code> upgrade strategy can also define <code>MinSuccessTime</code>, <code>ProgressDeadline</code> and <code>MaxFailures</code> to achieve more fine-grained upgrade configuration.</p><ul><li>MinSuccessTime</li></ul><p><code>MinSuccessTime</code> defines how long the controller needs to wait before continuing to upgrade the next cluster when the addon upgrade is successful and <code>MaxFailures</code> is not reached. The default value is 0 meaning the controller proceeds immediately after a successful state is reached.</p><p>In the following example, add-on will be upgraded at a rate of one cluster every 5 minutes.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>progressive</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>maxConcurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>minSuccessTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;5m&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>ProgressDeadline</li></ul><p><code>ProgressDeadline</code> defines the maximum time for the controller to wait for the add-on upgrade to be successful. If the add-on does not reach a successful state after <code>ProgressDeadline</code>, controller will stop waiting and this cluster will be treated as &ldquo;timeout&rdquo; and be counted into <code>MaxFailures</code>. Once the <code>MaxFailures</code> is breached, the rollout will stop. The default value is &ldquo;None&rdquo;, which means the controller will wait for a successful state indefinitely.</p><p>In the following example, the controller will wait for 10 minutes on each cluster until the addon upgrade is successful. If it fails after 10 minutes, the upgrade status of the cluster will be marked as &ldquo;timeout&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#000>namespace:default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>progressive</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>maxConcurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>progressDeadline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;10m&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>MaxFailures</li></ul><p><code>MaxFailures</code> defines the number of clusters that can tolerate upgrade failures, which can be a numerical value or a percentage. If the cluster status is failed or timeout, it will be regarded as an upgrade failure. If the failed cluster exceeds <code>MaxFailures</code>, the upgrade will stop.</p><p>In the following example, when 3 addons fail to upgrade or does not reach successful status for more than 10 minutes, the upgrade will stop.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>progressive</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>maxConcurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>maxFailures</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>progressDeadline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;10m&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=summary>Summary</h2><p>This article details how to use Open Cluster Management to address tool chain upgrade challenges in a multi-cluster environment using the GitOps way. OCM provides a Kubernetes-based management platform across multiple clusters and multiple clouds. Through Add-on and Placement API, users can upgrade the entire tool chain gracefully and smoothly. At the same time, OCM treats add-on upgrades as configuration file changes, enabling users to leverage Kustomize or GitOps for seamless rolling/canary upgrades across clusters. In addition, OCM also provides a variety of upgrade strategies, including all upgrade (All), progressive upgrade by cluster (Progressive) and progressive upgrade by cluster group (ProgressivePerGroup) to meet different upgrade needs.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ed18b7525c323d590749f6553ff42217>Open Cluster Management - Configuring Your Kubernetes Fleet With the Policy Addon</h1><div class="td-byline mb-4">By <b>Matt Prahl</b> |
<time datetime=2023-11-22 class=text-body-secondary>Wednesday, November 22, 2023</time></div><p>View the video at <a href="https://www.youtube.com/watch?v=ZZH654t5YpI">YouTube</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-96a59b1cfa663cf5552b8282ca098ca1>ä»¥GitOpsæ–¹å¼åº”å¯¹å¤šé›†ç¾¤å·¥å…·é“¾çš„å‡çº§æŒ‘æˆ˜</h1><div class="td-byline mb-4">By <b>éƒé’ <a href=https://github.com/haoqing0110>@haoqing0110</a></b> |
<time datetime=2023-10-27 class=text-body-secondary>Friday, October 27, 2023</time></div><h2 id=å¤šé›†ç¾¤ç¯å¢ƒä¸‹å·¥å…·é“¾çš„å‡çº§æŒ‘æˆ˜>å¤šé›†ç¾¤ç¯å¢ƒä¸‹å·¥å…·é“¾çš„å‡çº§æŒ‘æˆ˜</h2><p>OCMï¼ˆopen-cluster-managementï¼‰æ˜¯ä¸€ä¸ªä¸“æ³¨äº Kubernetes åº”ç”¨è·¨å¤šé›†ç¾¤å’Œå¤šäº‘çš„ç®¡ç†å¹³å°ï¼Œæä¾›äº†é›†ç¾¤çš„æ³¨å†Œï¼Œåº”ç”¨å’Œè´Ÿè½½çš„åˆ†å‘ï¼Œè°ƒåº¦ç­‰åŸºç¡€åŠŸèƒ½ã€‚Add-on æ’ä»¶æ˜¯ OCM æä¾›çš„ä¸€ç§åŸºäºåŸºç¡€ç»„ä»¶çš„æ‰©å±•æœºåˆ¶ï¼Œå¯ä»¥è®© Kubernetes ç”Ÿæ€çš„åº”ç”¨å¾ˆå®¹æ˜“è¿ç§»åˆ° OCM å¹³å°ä¸Šï¼Œæ‹¥æœ‰è·¨å¤šé›†ç¾¤å¤šäº‘çš„ç¼–æ’å’Œè°ƒåº¦çš„èƒ½åŠ›ã€‚å¦‚ Istioï¼ŒPrometheusï¼ŒSubmarine å¯ä»¥é€šè¿‡ Add-on çš„æ–¹å¼æ‰©å±•è‡³å¤šé›†ç¾¤ã€‚åœ¨å¤šé›†ç¾¤ç¯å¢ƒä¸­ï¼Œå¦‚ä½•ä¼˜é›…ã€å¹³æ»‘åœ°å‡çº§æ•´ä¸ªå·¥å…·é“¾ï¼ˆæ¯”å¦‚ Istioã€Prometheus å’Œå…¶ä»–å·¥å…·ï¼‰æ˜¯æˆ‘ä»¬åœ¨å¤šé›†ç¾¤ç®¡ç†ä¸­é‡åˆ°çš„æŒ‘æˆ˜ï¼Œå·¥å…·é“¾çš„å‡çº§å¤±è´¥å¯èƒ½ä¼šå¯¼è‡´æ•°åƒä¸ªç”¨æˆ·å·¥ä½œè´Ÿè½½æ— æ³•è®¿é—®ã€‚å› æ­¤ï¼Œæ‰¾åˆ°ä¸€ç§ç®€å•ã€å®‰å…¨çš„è·¨é›†ç¾¤å‡çº§è§£å†³æ–¹æ¡ˆå˜å¾—éå¸¸é‡è¦ã€‚</p><p>æœ¬æ–‡æˆ‘ä»¬å°†ä»‹ç» Open Cluster Management(OCM)å¦‚ä½•å°†å·¥å…·é“¾å‡çº§è§†ä¸ºé…ç½®æ–‡ä»¶çš„å˜æ›´ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿåˆ©ç”¨ Kustomize æˆ– GitOps å®ç°è·¨é›†ç¾¤çš„æ— ç¼æ»šåŠ¨/é‡‘ä¸é›€å‡çº§ã€‚</p><p>åœ¨æ­£å¼å¼€å§‹å‰ï¼Œé¦–å…ˆä»‹ç»å‡ ä¸ª OCM ä¸­çš„æ¦‚å¿µã€‚</p><h2 id=add-on-æ’ä»¶>add-on æ’ä»¶</h2><p>åœ¨ OCM å¹³å°ä¸Šï¼Œadd-on æ’ä»¶å¯ä»¥å®ç°åœ¨ä¸åŒæ‰˜ç®¡é›†ç¾¤ï¼ˆSpokeï¼‰ä¸Šåº”ç”¨ä¸åŒçš„é…ç½®ï¼Œä¹Ÿå¯ä»¥å®ç°ä»æ§åˆ¶é¢ï¼ˆHubï¼‰è·å–æ•°æ®åˆ° Spoke é›†ç¾¤ä¸Šç­‰åŠŸèƒ½ã€‚æ¯”å¦‚ï¼šä½ å¯ä»¥ä½¿ç”¨<a href=https://github.com/open-cluster-management-io/managed-serviceaccount>managed-serviceaccount</a>
æ’ä»¶åœ¨ Spoke é›†ç¾¤ä¸Šå°†æŒ‡å®šçš„ ServiceaCount ä¿¡æ¯è¿”å›ç»™ Hub é›†ç¾¤ï¼Œå¯ä»¥ä½¿ç”¨<a href=https://github.com/open-cluster-management-io/cluster-proxy>cluster-proxy</a>æ’ä»¶å»ºç«‹ä¸€ä¸ªä» spoke åˆ° hub çš„åå‘ä»£ç†é€šé“ã€‚</p><p>ç°é˜¶æ®µ OCM ç¤¾åŒºå·²ç»æœ‰çš„ä¸€äº› add-onï¼š</p><ul><li><a href=https://github.com/open-cluster-management-io/multicluster-mesh>Multicluster Mesh Addon</a> å¯ç”¨äºç®¡ç†ï¼ˆå‘ç°ã€éƒ¨ç½²å’Œè”åˆï¼‰OCM ä¸­è·¨å¤šä¸ªé›†ç¾¤çš„æœåŠ¡ç½‘æ ¼ã€‚</li><li><a href=https://github.com/stolostron/submariner-addon>Submarine Addon</a> è®©<a href=https://github.com/submariner-io/submariner>Submarine</a>
å’Œ OCM æ–¹ä¾¿é›†æˆï¼Œåœ¨ hub cluster ä¸Šéƒ¨ç½² Submariner Brokerï¼Œåœ¨ managed cluster ä¸Šéƒ¨ç½²æ‰€éœ€çš„ Submariner ç»„ä»¶, ä¸ºæ‰˜ç®¡é›†ç¾¤æä¾›è·¨é›†ç¾¤çš„ Pod å’Œ Service ç½‘ç»œäº’ç›¸è®¿é—®çš„èƒ½åŠ›ã€‚</li><li><a href=https://github.com/open-cluster-management-io/addon-contrib/tree/main/open-telemetry-addon>Open-telemetry add-on</a> è‡ªåŠ¨åœ¨ hub cluster å’Œ managed cluster ä¸Š
å®‰è£… otelCollectorï¼Œå¹¶åœ¨ hub cluster ä¸Šè‡ªåŠ¨å®‰è£… jaeger-all-in-one ä»¥å¤„ç†å’Œå­˜å‚¨ tracesã€‚</li><li><a href=https://open-cluster-management.io/zh/getting-started/integration/app-lifecycle/>Application lifecycle management</a>
å®ç°å¤šé›†ç¾¤æˆ–å¤šäº‘ç¯å¢ƒä¸­çš„åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚add-on æ’ä»¶æä¾›äº†ä¸€å¥—é€šè¿‡ Subscriptions è®¢é˜… channelï¼Œå°† github ä»“åº“ï¼ŒHelm release æˆ–è€…å¯¹è±¡å­˜å‚¨ä»“åº“çš„åº”ç”¨åˆ†å‘åˆ°æŒ‡å®š Spoke é›†ç¾¤ä¸Šçš„æœºåˆ¶ã€‚</li><li><a href=https://open-cluster-management.io/getting-started/integration/policy-framework/>Policy framework</a>å’Œ<a href=https://open-cluster-management.io/getting-started/integration/policy-controllers/>Policy controllers</a> add-on æ’ä»¶å¯ä»¥è®© Hub é›†ç¾¤ç®¡ç†å‘˜å¾ˆè½»æ¾ä¸º Spoke é›†ç¾¤éƒ¨ç½²å®‰å…¨ç›¸å…³çš„ policy ç­–ç•¥ã€‚</li><li><a href=https://open-cluster-management.io/getting-started/integration/managed-serviceaccount/>Managed service account</a> add-on æ’ä»¶å¯ä»¥è®© Hub é›†ç¾¤ç®¡ç†å‘˜å¾ˆå®¹æ˜“ç®¡ç† Spoke é›†ç¾¤ä¸Š serviceaccountã€‚</li><li><a href=https://open-cluster-management.io/getting-started/integration/cluster-proxy/>Cluster proxy</a> add-on æ’ä»¶é€šè¿‡åå‘ä»£ç†é€šé“æä¾›äº† Hub å’Œ Spoke é›†ç¾¤ä¹‹é—´ L4 ç½‘ç»œè¿æ¥ã€‚</li></ul><p><strong>æ›´å¤šå…³äº add-on æ’ä»¶çš„ä»‹ç»å¯ä»¥å‚è€ƒ<a href=https://open-cluster-management.io/zh/blog/addon-introduction/>è¯¦è§£ OCM add-on æ’ä»¶</a>ã€‚</strong></p><p>OCM æä¾›äº†ä¸¤ç§æ–¹å¼å¸®åŠ©å¼€å‘è€…å¼€å‘è‡ªå·±çš„ add-onï¼š</p><ul><li>Hard æ¨¡å¼ï¼šä½¿ç”¨<a href=https://github.com/open-cluster-management-io/addon-framework>addon-framework</a>çš„å†…ç½®æœºåˆ¶ï¼Œå¯æ ¹æ®<a href=https://open-cluster-management.io/developer-guides/addon/>Add-on å¼€å‘æŒ‡å—</a>æ¥å¼€å‘ add-on æ’ä»¶çš„ addon manager å’Œ addon agentã€‚</li><li>Easy æ¨¡å¼ï¼šOCM æä¾›äº†ä¸€ä¸ªæ–°çš„æ’ä»¶å¼€å‘æ¨¡å‹ï¼Œå¯ä½¿ç”¨<a href=https://open-cluster-management.io/developer-guides/addon/#build-an-addon-with-addon-template>AddOnTemplate</a>æ¥æ„å»º add-onã€‚åœ¨æ­¤æ¨¡å‹ä¸­å¼€å‘è€…æ— éœ€å¼€å‘ addon managerï¼Œåªéœ€å‡†å¤‡ addon agent çš„ image å’Œ AddOnTemplateï¼ŒAddOnTemplate æè¿°äº†å¦‚ä½•éƒ¨ç½² addon agent ä»¥åŠå¦‚ä½•æ³¨å†Œ addonã€‚</li></ul><p>å¦‚ä¸‹æ˜¯ä¸€ä¸ªæ ·ä¾‹ add-on çš„ ClusterManagementAddOn å’Œ AddOnTemplateã€‚AddOnTemplate è¢«è§†ä¸º add-on ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®šä¹‰åœ¨ supportedConfigs ä¸­ã€‚AddOnTemplate èµ„æºä¸­åˆ™åŒ…å«äº†éƒ¨ç½² add-on æ‰€éœ€çš„ manifest ä»¥åŠ add-on çš„æ³¨å†Œæ–¹å¼ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addOnMeta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template is a addon built with addon template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># declare it is a template type addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addontemplates</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>defaultConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnTemplate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addonName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>agentSpec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># required</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent-sa</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRoleBinding</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>             </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello-template-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>registration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># optional</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=placement-decision-strategy>Placement Decision Strategy</h2><p>Placement API ç”¨äºåœ¨ä¸€ä¸ªæˆ–å¤šä¸ªæ‰˜ç®¡é›†ç¾¤ç»„(ManagedClusterSet)ä¸­é€‰æ‹©ä¸€ç»„æ‰˜ç®¡ç¾¤é›†(ManagedCluster)ï¼Œä»¥ä¾¿å°†å·¥ä½œè´Ÿè½½éƒ¨ç½²åˆ°è¿™äº›ç¾¤é›†ä¸Šã€‚</p><p><strong>æ›´å¤šå…³äº Placement API çš„ä»‹ç»å¯ä»¥å‚è€ƒ<a href=https://open-cluster-management.io/concepts/placement/>Placement æ–‡æ¡£</a>ã€‚</strong></p><p>Placement è°ƒåº¦è¿‡ç¨‹çš„â€œè¾“å…¥â€å’Œâ€œè¾“å‡ºâ€è¢«è§£è€¦ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„ Kubernetes API: Placement å’Œ PlacementDecisionã€‚</p><ul><li>Placement æä¾›äº†é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨<code>labelSelector</code>æˆ–å£°æ˜é€‰æ‹©å™¨<code>claimSelector</code>è¿‡æ»¤é›†ç¾¤ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†ä¸€äº›å†…ç½®çš„ä¼˜é€‰å™¨<code>prioritizer</code>ï¼Œå¯å¯¹è¿‡æ»¤åçš„é›†ç¾¤è¿›è¡Œæ‰“åˆ†æ’åºå’Œä¼˜å…ˆé€‰æ‹©ã€‚</li><li>Placement çš„è°ƒåº¦ç»“æœä¼šæ”¾åœ¨<code>PlacementDecision</code>ä¸­, <code>status.decisions</code>åˆ—å‡ºå¾—åˆ†æœ€é«˜çš„å‰ N ä¸ªé›†ç¾¤å¹¶æŒ‰åç§°æ’åºï¼Œä¸”è°ƒåº¦ç»“æœä¼šéšç€é›†ç¾¤çš„å˜åŒ–è€ŒåŠ¨æ€å˜åŒ–ã€‚Placement ä¸­çš„<code>decisionStrategy</code>éƒ¨åˆ†å¯ä»¥ç”¨æ¥å°†åˆ›å»ºçš„<code>PlacementDecision</code>åˆ’åˆ†ä¸ºå¤šä¸ªç»„ï¼Œå¹¶å®šä¹‰æ¯ä¸ªå†³ç­–ç»„ä¸­çš„é›†ç¾¤æ•°é‡ã€‚<code>PlacementDecision</code>æ”¯æŒåˆ†é¡µæ˜¾ç¤ºï¼Œæ¯ä¸ª resource åšå¤šæ”¯æŒæ”¾ç½® 100 ä¸ªé›†ç¾¤çš„åç§°ã€‚</li></ul><p>å¦‚ä¸‹æ˜¯ä¸€ä¸ª Placement å’Œ<code>decisionStrategy</code>çš„ä¾‹å­ã€‚å‡è®¾ global é›†ç¾¤ç»„ä¸­æœ‰ 300 ä¸ªæ‰˜ç®¡é›†ç¾¤(ManagedCluster)ï¼Œå…¶ä¸­ 10 ä¸ªé›†ç¾¤æœ‰æ ‡ç­¾ canaryã€‚ä¸‹é¢çš„ä¾‹å­æè¿°äº†å°†æ‹¥æœ‰ canary æ ‡ç­¾çš„é›†ç¾¤åˆ†ä¸ºä¸€ç»„ï¼Œå¹¶å°†å‰©ä¸‹çš„é›†ç¾¤ä»¥æ¯ç»„æœ€å¤š 150 ä¸ªé›†ç¾¤æ¥è¿›è¡Œåˆ†ç»„ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterSets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>global</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>decisionStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>groupStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>clustersPerDecisionGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>150</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>decisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>groupClusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>matchExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exists</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>åˆ†ç»„çš„ç»“æœå°†æ˜¾ç¤ºåœ¨ Placement çš„ status ä¸­ã€‚å…¶ä¸­ canary ç»„æœ‰ 10 ä¸ªé›†ç¾¤ï¼Œç»“æœæ”¾åœ¨ aws-placement-decision-1 ä¸­ã€‚å…¶ä»–çš„é»˜è®¤åˆ†ç»„åªæœ‰ group indexï¼Œæ¯ç»„åˆ†åˆ«æœ‰ 150 ä¸ªå’Œ 140 ä¸ªé›†ç¾¤ã€‚ç”±äºä¸€ä¸ª PlacementDecsion åªæ”¯æŒ 100 ä¸ªé›†ç¾¤ï¼Œå› æ­¤æ¯ç»„çš„ç»“æœæ”¾å…¥ä¸¤ä¸ª PlacementDecision ä¸­ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>decisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>clusterCount</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisionGroupIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisionGroupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>aws-placement-decision-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>clusterCount</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>150</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisionGroupIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisionGroupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>aws-placement-decision-2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>aws-placement-decision-3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>clusterCount</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>140</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisionGroupIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisionGroupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>decisions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>placement1-decision-3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>placement1-decision-4</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>numberOfSelectedClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>300</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>ä»¥ canary ç»„ä¸ºä¾‹ï¼Œå®ƒçš„ PlacementDecision å¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ä¸­çš„æ ‡ç­¾ cluster.open-cluster-management.io/decision-group-index ä»£è¡¨äº†æ‰€å±ç»„çš„ indexï¼Œcluster.open-cluster-management.io/decision-group-name ä»£è¡¨äº†æ‰€å±ç»„çš„åç§°ï¼Œcluster.open-cluster-management.io/placement ä»£è¡¨äº†æ‰€å±äºçš„ Placementã€‚ä½¿ç”¨è€…å¯ä»¥é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨æ¥çµæ´»è·å–è°ƒåº¦ç»“æœã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PlacementDecision</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>cluster.open-cluster-management.io/decision-group-index</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>cluster.open-cluster-management.io/decision-group-name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>cluster.open-cluster-management.io/placement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement-decision-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>decisions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=ä»¥-gitops-æ–¹å¼ç®€åŒ–å‡çº§>ä»¥ GitOps æ–¹å¼ç®€åŒ–å‡çº§</h2><p>ä»¥ä¸Šç®€å•ä»‹ç»äº† add-on template å’Œ placement decision strategy çš„æ¦‚å¿µã€‚</p><p>åœ¨ OCM ä¸­ï¼Œæˆ‘ä»¬å°† add-on çš„å‡çº§è§†ä¸ºå…¶é…ç½®æ–‡ä»¶çš„å‡çº§ï¼Œè¿™é‡Œçš„é…ç½®å¯ä»¥æ˜¯ AddOnTemplateï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶ AddOnDeploymentConfigã€‚ä¸€æ¬¡ add-on çš„å‡çº§ç­‰åŒäºä¸€æ¬¡é…ç½®æ–‡ä»¶çš„æ›´æ–°ï¼Œè¿™ä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿåˆ©ç”¨ Kustomize æˆ– GitOps æ¥è¿›è¡Œæ— ç¼çš„è·¨é›†ç¾¤æ»šåŠ¨/é‡‘ä¸é›€å‡çº§ã€‚RolloutStrategy å®šä¹‰äº†å‡çº§ç­–ç•¥ï¼Œæ”¯æŒå…¨éƒ¨å‡çº§(All)ï¼ŒæŒ‰é›†ç¾¤æ¸è¿›å‡çº§(Progressive Per Cluster)å’ŒæŒ‰é›†ç¾¤ç»„æ¸è¿›å‡çº§(Progressive Per Group)ï¼Œå¹¶å¯å®šä¹‰ä¸€ç»„ MandatoryDecisionGroups æ¥ä¼˜å…ˆå°è¯•æ–°é…ç½®ã€‚</p><p>ä¾ç…§ GitOps çš„å››ä¸ªåŸåˆ™ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ OCM å¦‚ä½•æ”¯æŒä»¥ GitOps çš„æ–¹å¼åº”å¯¹å¤šé›†ç¾¤ç¯å¢ƒä¸‹çš„å‡çº§æŒ‘æˆ˜ã€‚</p><ul><li>å£°æ˜å¼</li></ul><p>åœ¨<code>ClusterManagementAddOn</code>ä¸­å¯ä»¥å£°æ˜ add-on æ‰€ä½¿ç”¨çš„é…ç½®æ–‡ä»¶ã€‚é…ç½®æ–‡ä»¶å¯åœ¨å…¨å±€çš„<code>supportedConfigs</code>ä¸­å£°æ˜ï¼Œè¯¥é…ç½®æ–‡ä»¶ä¼šåº”ç”¨åˆ°æ‰€æœ‰çš„<code>ManagedClusterAddOn</code>å®ä¾‹ä¸Šã€‚ä¹Ÿå¯åœ¨<code>installStrategy</code>ä¸‹ä¸åŒçš„ placements ä¸­å£°æ˜ï¼Œæ¯ä¸ª Placement æ‰€é€‰æ‹©é›†ç¾¤çš„<code>ManagedClusterAddOn</code>å°†æ‹¥æœ‰ç›¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œplacements ä¸­å£°æ˜çš„é…ç½®ä¼šè¦†ç›–å…¨å±€é…ç½®ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>defaultConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-0.4.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addontemplates</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-addon-deploy-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>progressive</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>maxConcurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>ç‰ˆæœ¬æ§åˆ¶</li></ul><p>add-on é…ç½®æ–‡ä»¶åç§°æˆ– spec å†…å®¹çš„å˜åŒ–ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªé…ç½®æ›´æ”¹ï¼Œä¼šè§¦å‘ add-on çš„ä¸€æ¬¡å‡çº§ã€‚ç”¨æˆ·å¯ä»¥åˆ©ç”¨ Kustomize æˆ– GitOps æ¥æ§åˆ¶é…ç½®æ–‡ä»¶å‡çº§ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnTemplate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-0.4.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>agentSpec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># required</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>workload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>manifests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-addon-agent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-agent-addon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>â€¦</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>registration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># optional</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>è‡ªåŠ¨åŒ–</li></ul><p>OCM åœ¨ open-cluster-management-hub å‘½åç©ºé—´ä¸‹çš„ç»„ä»¶ addon-manager-controller æ˜¯ä¸€ä¸ªæ›´é€šç”¨çš„ addon managerï¼Œå®ƒä¼š watch ä»¥ä¸‹ä¸¤ç§ç±»å‹çš„ add-on å¹¶è´Ÿè´£ç»´æŠ¤æ­¤ç±» add-on çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬å®‰è£…ä¸å‡çº§ã€‚å½“é…ç½®æ–‡ä»¶çš„åç§°æˆ–è€… spec å†…å®¹å˜åŒ–æ—¶ï¼Œæ­¤ç»„ä»¶ä¼šæŒ‰ç…§ rolloutStrategy æ‰€å®šä¹‰çš„å‡çº§ç­–ç•¥æ¥å‡çº§ add-onã€‚</p><ul><li>Hard æ¨¡å¼ï¼šä½¿ç”¨æœ€æ–°<a href=https://github.com/open-cluster-management-io/addon-framework>addon-framework</a>å¼€å‘çš„ add-onï¼Œéœ€è¦åˆ é™¤ä»£ç ä¸­çš„<code>WithInstallStrategy()</code>æ–¹æ³•å¹¶åœ¨<code>ClusterManagementAddOn</code>æ·»åŠ  annotation <code>addon.open-cluster-management.io/lifecycle: "addon-manager"</code>ã€‚è¯¦ç»†å†…å®¹å‚è€ƒ<a href=https://open-cluster-management.io/developer-guides/addon/#managing-the-add-on-agent-lifecycle-by-addon-manager>Add-on å¼€å‘æŒ‡å—</a>ã€‚</li><li>Easy æ¨¡å¼ï¼šä½¿ç”¨ AddOnTemplate æ¨¡å¼å¼€å‘çš„ add-onã€‚</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>âœ— kubectl get deploy -n open-cluster-management-hub
</span></span><span style=display:flex><span>NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>cluster-manager-addon-manager-controller   1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           10h
</span></span><span style=display:flex><span>cluster-manager-placement-controller       1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           10h
</span></span><span style=display:flex><span>cluster-manager-registration-controller    1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           10h
</span></span><span style=display:flex><span>cluster-manager-registration-webhook       1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           10h
</span></span><span style=display:flex><span>cluster-manager-work-webhook               1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           10h
</span></span></code></pre></div><ul><li>æŒç»­åè°ƒ</li></ul><p>Add-on é…ç½®æ–‡ä»¶çš„ spec hash ä¼šè¢«è®°å½•åœ¨<code>ClusterManagementAddOn</code>ä»¥åŠ<code>ManagedClusterAddOn</code>çš„ status ä¸­ï¼Œå½“ spec hash å˜åŒ–æ—¶ï¼Œaddon-manager-controller ä¼šæ ¹æ® rolloutStrategy å®šä¹‰çš„å‡çº§ç­–ç•¥æŒç»­æ›´æ–° add-onï¼Œç›´è‡³ lastAppliedConfigï¼ŒlastKnownGoodConfig å’Œ desiredConfig ç›¸ä¸€è‡´ã€‚å¦‚ä¸‹ä¾‹å­ä¸­ï¼Œç”±äº lastAppliedConfig ä¸ desiredConfig ä¸åŒ¹é…ï¼Œadd-on çŠ¶æ€æ˜¾ç¤ºä¸ºå‡çº§ä¸­ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>â€¦</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>installProgressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2023-09-21T06:53:59Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000>/3 upgrading, 0 timeout.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Upgrading</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressing</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>configReferences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span>- <span style=color:#204a87;font-weight:700>desiredConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-0.4.1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>specHash</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dcf88f5b11bd191ed2f886675f967684da8b5bcbe6902458f672277d469e2044</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>lastAppliedConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-0.4.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>specHash</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>1f7874ac272f3e4266f89a250d8a76f0ac1c6a4d63d18e7dcbad9068523cf187</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>lastKnownGoodConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-0.4.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>specHash</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>1f7874ac272f3e4266f89a250d8a76f0ac1c6a4d63d18e7dcbad9068523cf187</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addontemplates</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placementl</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ManagedClusterAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>â€¦</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2023-09-21T06:53:42Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>upgrading.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Upgrading</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressing</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>configReferences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>desiredConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-0.4.1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>specHash</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dcf88f5b11bd191ed2f886675f967684da8b5bcbe6902458f672277d469e2044</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>lastAppliedConfig</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-0.4.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>specHash</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dcf88f5b11bd191ed2f886675f967684da8b5bcbe6902458f672277d469e2044</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>lastObservedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-0.4.1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addontemplates</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=ä¸‰ç§å‡çº§ç­–ç•¥>ä¸‰ç§å‡çº§ç­–ç•¥</h2><p>ClusterManagementAddOn çš„<code>rolloutStrategy</code>å­—æ®µå®šä¹‰äº†å‡çº§çš„ç­–ç•¥ï¼Œç›®å‰ OCM æ”¯æŒä¸‰ç§ç±»å‹çš„å‡çº§ç­–ç•¥ã€‚</p><ul><li>å…¨éƒ¨å‡çº§(All)</li></ul><p>é»˜è®¤çš„å‡çº§ç±»å‹æ˜¯ Allï¼Œæ„å‘³ç€æ–°çš„é…ç½®æ–‡ä»¶ä¼šç«‹åˆ»åº”ç”¨äºæ‰€æœ‰çš„é›†ç¾¤ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>All</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>æŒ‰é›†ç¾¤æ¸è¿›å‡çº§(Progressive Per Cluster)</li></ul><p>Progressive æ„å‘³ç€å°†æ–°çš„é…ç½®æ–‡ä»¶ä¾æ¬¡éƒ¨ç½²åœ¨æ‰€é€‰æ‹©çš„æ¯ä¸ªé›†ç¾¤ï¼Œåªæœ‰å½“å‰é›†ç¾¤å‡çº§æˆåŠŸåæ–°çš„é…ç½®æ–‡ä»¶æ‰ä¼šåº”ç”¨åˆ°ä¸‹ä¸ªé›†ç¾¤ã€‚å‰é¢æˆ‘ä»¬ä»‹ç»äº† Placement Decision Group çš„æ¦‚å¿µï¼ŒMandatoryDecisionGroups ä¸­å¯ä»¥æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ª Decision Groupã€‚å¦‚æœå®šä¹‰äº† MandatoryDecisionGroupsï¼Œåˆ™ä¼˜å…ˆå°†æ–°çš„é…ç½®æ–‡ä»¶éƒ¨ç½²åˆ°è¿™äº›é›†ç¾¤ç»„ã€‚ MaxConcurrency å®šä¹‰äº†åŒæ—¶éƒ¨ç½²çš„æœ€å¤§é›†ç¾¤æ•°é‡ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>progressive</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>maxConcurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>æŒ‰é›†ç¾¤ç»„æ¸è¿›å‡çº§(Progressive Per Group)</li></ul><p>ProgressivePerGroup æ„å‘³ç€å°†æ–°çš„é…ç½®æ–‡ä»¶ä¾æ¬¡éƒ¨ç½²åœ¨æ‰€é€‰æ‹©çš„æ¯ä¸ªé›†ç¾¤ç»„ï¼Œåªæœ‰å½“å‰é›†ç¾¤ç»„å‡çº§æˆåŠŸåæ–°çš„é…ç½®æ–‡ä»¶æ‰ä¼šåº”ç”¨åˆ°ä¸‹ä¸ªé›†ç¾¤ç»„ã€‚å¦‚æœå®šä¹‰äº† MandatoryDecisionGroupsï¼Œåˆ™ä¼˜å…ˆå°†æ–°çš„é…ç½®æ–‡ä»¶éƒ¨ç½²åˆ°è¿™äº›é›†ç¾¤ç»„ã€‚å¦‚æœæ²¡æœ‰ mandatoryDecisionGroupsï¼Œåˆ™æŒ‰ç…§é›†ç¾¤ç»„çš„ index é¡ºåºä¾æ¬¡å‡çº§ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ProgressivePerGroup</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>progressivePerGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>ä¾ç…§ GitOps çš„å››ä¸ªåŸåˆ™ï¼Œå’Œ OCM çš„ä¸‰ç§å‡çº§ç­–ç•¥ï¼Œä½¿ç”¨è€…å¯ä»¥åˆ©ç”¨ Kustomize æˆ– GitOps å®ç°è·¨é›†ç¾¤çš„æ— ç¼æ»šåŠ¨/é‡‘ä¸é›€å‡çº§ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒinstallStrategy ä¸‹æ”¯æŒå¤šä¸ª Placement çš„å®šä¹‰ï¼Œä½¿ç”¨è€…å¯ä»¥åŸºäºæ­¤å®ç°æ›´å¤šé«˜çº§çš„å‡çº§ç­–ç•¥ã€‚å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œå¯ä»¥åŒæ—¶å®šä¹‰ä¸¤ä¸ª Placement åˆ†åˆ«é€‰æ‹© aws ä¸ gcp ä¸Šçš„é›†ç¾¤ï¼Œä½¿å¾—åŒä¸€ä¸ª add-on åœ¨ä¸åŒçš„é›†ç¾¤ä¸­ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶å’Œå‡çº§ç­–ç•¥ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-addon-deploy-config-aws</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ProgressivePerGroup</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>progressivePerGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gcp-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addondeploymentconfigs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount-addon-deploy-config-gcp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ProgressivePerGroup</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>progressivePerGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=ä¸‰ç§å‡çº§é…ç½®>ä¸‰ç§å‡çº§é…ç½®</h2><p><code>rolloutStrategy</code>å‡çº§ç­–ç•¥ä¸­è¿˜å¯ä»¥å®šä¹‰<code>MinSuccessTime</code>, <code>ProgressDeadline</code>å’Œ<code>MaxFailures</code>æ¥å®ç°æ›´ç»†ç²’åº¦çš„å‡çº§é…ç½®ã€‚</p><ul><li>MinSuccessTime</li></ul><p><code>MinSuccessTime</code>å®šä¹‰äº†å½“addonå‡çº§æˆåŠŸä¸”æœªè¾¾åˆ°<code>MaxFailures</code>æ—¶ï¼Œcontrolleréœ€è¦ç­‰å¾…å¤šé•¿æ—¶é—´æ‰èƒ½ç»§ç»­å‡çº§ä¸‹ä¸€ä¸ªé›†ç¾¤ã€‚é»˜è®¤å€¼æ˜¯0ä»£ç å‡çº§æˆåŠŸåç«‹åˆ»å‡çº§ä¸‹ä¸€ä¸ªé›†ç¾¤ã€‚å¦‚ä¸‹ä¾‹å­ä¸­ï¼Œå°†æŒ‰ç…§æ¯5åˆ†é’Ÿä¸€ä¸ªé›†ç¾¤çš„é€Ÿåº¦å‡çº§addonã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>progressive</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>maxConcurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>minSuccessTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;5m&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>ProgressDeadline</li></ul><p><code>ProgressDeadline</code>å®šä¹‰äº†controllerç­‰å¾…addonå‡çº§æˆåŠŸçš„æœ€å¤§æ—¶é—´ï¼Œåœ¨æ­¤æ—¶é—´ä¹‹åå°†addonè§†ä¸ºè¶…æ—¶â€œtimeoutâ€å¹¶è®¡å…¥<code>MaxFailures</code>ã€‚è¶…è¿‡<code>MaxFailures</code>æ—¶å°†åœæ­¢å‡çº§ã€‚é»˜è®¤å€¼ä¸ºâ€œNoneâ€ä»£è¡¨controllerä¼šä¸€ç›´ç­‰å¾…addonå‡çº§æˆåŠŸã€‚
å¦‚ä¸‹ä¾‹å­ä¸­ï¼Œcontrollerä¼šåœ¨æ¯ä¸ªé›†ç¾¤ä¸Šç­‰å¾…10åˆ†é’Ÿç›´åˆ°addonå‡çº§æˆåŠŸï¼Œè‹¥è¶…è¿‡10åˆ†é’ŸæœªæˆåŠŸï¼Œå°†æ ‡è®°è¯¥é›†ç¾¤å‡çº§çŠ¶æ€ä¸ºtimeoutã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>progressive</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>maxConcurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>progressDeadline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;10m&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>MaxFailures</li></ul><p><code>MaxFailures</code>å®šä¹‰äº†å¯ä»¥å®¹å¿çš„å‡çº§å¤±è´¥çš„é›†ç¾¤æ•°é‡ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæ•°å€¼æˆ–è€…ç™¾åˆ†æ¯”ã€‚é›†ç¾¤çŠ¶æ€ä¸ºfailedæˆ–è€…timeoutå‡è§†ä¸ºå‡çº§å¤±è´¥ï¼Œå¤±è´¥çš„é›†ç¾¤è¶…è¿‡<code>MaxFailures</code>åå°†åœæ­¢å‡çº§ã€‚
å¦‚ä¸‹ä¾‹å­ä¸­ï¼Œå½“æœ‰3ä¸ªaddonå‡çº§å¤±è´¥æˆ–è€…è¶…è¿‡10åˆ†é’Ÿæœªå‡çº§æˆåŠŸï¼Œå°†åœæ­¢å‡çº§ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterManagementAddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-serviceaccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addon.open-cluster-management.io/lifecycle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addon-manager&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>supportedConfigs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>installStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aws-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rolloutStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressive</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>progressive</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mandatoryDecisionGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>groupName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;canary&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>maxConcurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>maxFailures</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>progressDeadline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;10m&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placements</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=å°ç»“>å°ç»“</h2><p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Open Cluster Management ä»¥ GitOps æ–¹å¼åº”å¯¹å¤šé›†ç¾¤ç¯å¢ƒä¸‹å·¥å…·é“¾çš„å‡çº§æŒ‘æˆ˜ã€‚OCM æä¾›äº†åŸºäº Kubernetes çš„è·¨å¤šé›†ç¾¤å’Œå¤šäº‘çš„ç®¡ç†å¹³å°ï¼Œé€šè¿‡ Add-on æ’ä»¶å’Œ Placement APIï¼Œä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿä¼˜é›…ã€å¹³æ»‘åœ°å‡çº§æ•´ä¸ªå·¥å…·é“¾ã€‚åŒæ—¶ï¼ŒOCM å°† add-on å‡çº§è§†ä¸ºé…ç½®æ–‡ä»¶çš„å˜æ›´ï¼Œä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿåˆ©ç”¨ Kustomize æˆ– GitOps å®ç°è·¨é›†ç¾¤çš„æ— ç¼æ»šåŠ¨/é‡‘ä¸é›€å‡çº§ã€‚æ­¤å¤–ï¼ŒOCM è¿˜æä¾›äº†å¤šç§å‡çº§ç­–ç•¥ï¼ŒåŒ…æ‹¬å…¨éƒ¨å‡çº§(All)ï¼ŒæŒ‰é›†ç¾¤æ¸è¿›å‡çº§(Progressive Per Cluster)å’ŒæŒ‰é›†ç¾¤ç»„æ¸è¿›å‡çº§(Progressive Per Group)ï¼Œä»¥æ»¡è¶³ä¸åŒçš„å‡çº§éœ€æ±‚ã€‚</p><h2 id=æœªæ¥è®¡åˆ’>æœªæ¥è®¡åˆ’</h2><p>åœ¨ç¤¾åŒºä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨è®¡åˆ’å®ç°<a href=https://github.com/open-cluster-management-io/api/pull/281>RolloutConfig</a>ä»¥æä¾›æ›´ç»†ç²’åº¦çš„ rollout é…ç½®ï¼Œæ¯”å¦‚ MinSuccessTime, ProgressDeadline, MaxFailuresï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥å®šä¹‰åœ¨å¤±è´¥æƒ…å†µä¸‹çš„å‡çº§è¡Œä¸ºï¼Œè¿™å°†ä¸ºå¤šé›†ç¾¤ä¸‹çš„å‡çº§æä¾›æ›´å¤šçš„å¯æ“ä½œç©ºé—´ã€‚</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e0d11ba97d8228bd67e6046bda354da2>è¯¦è§£OCM add-onæ’ä»¶</h1><div class="td-byline mb-4">By <b>æ®·æ™ºä¼Ÿ <a href=https://github.com/zhiweiyin318>@zhiweiyin318</a></b> |
<time datetime=2023-05-24 class=text-body-secondary>Wednesday, May 24, 2023</time></div><h2 id=ocm-add-onæ’ä»¶æ¦‚è¿°>OCM add-onæ’ä»¶æ¦‚è¿°</h2><p>OCM ï¼ˆopen-cluster-managementï¼‰æ˜¯ä¸€ä¸ªä¸“æ³¨äºKubernetesåº”ç”¨è·¨å¤šé›†ç¾¤å’Œå¤šäº‘çš„ç®¡ç†å¹³å°ï¼Œ
æä¾›äº†é›†ç¾¤çš„æ³¨å†Œï¼Œåº”ç”¨å’Œè´Ÿè½½çš„åˆ†å‘ï¼Œè°ƒåº¦ç­‰åŸºç¡€åŠŸèƒ½ã€‚Add-onæ’ä»¶æ˜¯OCMæä¾›çš„ä¸€ç§åŸºäºåŸºç¡€ç»„å»º
çš„æ‰©å±•æœºåˆ¶ï¼Œå¯ä»¥è®©Kubernetesç”Ÿæ€çš„åº”ç”¨å¾ˆå®¹æ˜“è¿ç§»åˆ°OCMå¹³å°ä¸Šï¼Œæ‹¥æœ‰è·¨å¤šé›†ç¾¤å¤šäº‘çš„ç¼–æ’å’Œè°ƒåº¦çš„èƒ½åŠ›ã€‚</p><p>åœ¨OCMå¹³å°ä¸Šï¼Œadd-onæ’ä»¶å¯ä»¥å®ç°ä¸åŒè¢«ç®¡ç†é›†ç¾¤ï¼ˆSpokeï¼‰ä¸Šåº”ç”¨çš„ä¸åŒçš„é…ç½®ï¼Œä¹Ÿå¯ä»¥å®ç°ä»æ§åˆ¶é¢ï¼ˆHubï¼‰
è·å–æ•°æ®åˆ°Spokeé›†ç¾¤ä¸Šç­‰åŠŸèƒ½ã€‚æ¯”å¦‚ï¼šä½ å¯ä»¥ä½¿ç”¨<a href=https://github.com/open-cluster-management-io/managed-serviceaccount>managed-serviceaccount</a>
add-onæ’ä»¶åœ¨Spokeé›†ç¾¤ä¸Šå°†æŒ‡å®šçš„ServiceaCountä¿¡æ¯è¿”å›ç»™Hubé›†ç¾¤ï¼Œå¯ä»¥ä½¿ç”¨<a href=https://github.com/open-cluster-management-io/cluster-proxy>cluster-proxy</a>
add-onæ’ä»¶å»ºç«‹ä¸€ä¸ªä»spokeåˆ°hubçš„åå‘ä»£ç†é€šé“ã€‚</p><p>ç°é˜¶æ®µOCMç¤¾åŒºå·²ç»æœ‰çš„ä¸€äº›add-onï¼š</p><ul><li><a href=https://open-cluster-management.io/zh/getting-started/integration/app-lifecycle/>Application lifecycle management</a>
add-onæ’ä»¶æä¾›äº†ä¸€å¥—é€šè¿‡Subscriptionsè®¢é˜…channelï¼Œå°†githubä»“åº“ï¼ŒHelm releaseæˆ–è€…å¯¹è±¡å­˜å‚¨ä»“åº“çš„åº”ç”¨åˆ†å‘åˆ°æŒ‡å®šSpokeé›†ç¾¤ä¸Šçš„æœºåˆ¶ã€‚</li><li><a href=https://open-cluster-management.io/getting-started/integration/cluster-proxy/>Cluster proxy</a> add-onæ’ä»¶é€šè¿‡åå‘ä»£ç†é€šé“æä¾›äº†Hubå’ŒSpokeé›†ç¾¤ä¹‹é—´L4ç½‘ç»œè¿æ¥ã€‚</li><li><a href=https://open-cluster-management.io/getting-started/integration/managed-serviceaccount/>Managed service account</a>
add-onæ’ä»¶å¯ä»¥è®©Hubé›†ç¾¤ç®¡ç†å‘˜å¾ˆå®¹æ˜“ç®¡ç†Spokeé›†ç¾¤ä¸Šserviceaccountã€‚</li><li><a href=https://open-cluster-management.io/getting-started/integration/policy-framework/>Policy framework</a> å’Œ
<a href=https://open-cluster-management.io/getting-started/integration/policy-controllers/>Policy controllers</a>
add-onæ’ä»¶å¯ä»¥è®©Hubé›†ç¾¤ç®¡ç†å‘˜å¾ˆè½»æ¾ä¸ºSpokeé›†ç¾¤éƒ¨ç½²å®‰å…¨ç›¸å…³çš„policyç­–ç•¥ã€‚</li><li><a href=https://github.com/stolostron/submariner-addon>Submarine Addon</a> add-onæ’ä»¶å¯ä»¥è®©<a href=https://github.com/submariner-io/submariner>Submarine</a>
å’ŒOCMæ–¹ä¾¿é›†æˆï¼Œä¸ºè¢«ç®¡ç†é›†ç¾¤æä¾›è·¨é›†ç¾¤çš„Podå’ŒServiceç½‘ç»œäº’ç›¸è®¿é—®çš„èƒ½åŠ›ã€‚</li><li><a href=https://github.com/stolostron/multicluster-mesh-addon>Multicluster Mesh Addon</a> add-onæ’ä»¶ä¸ºOCMè¢«ç®¡ç†é›†ç¾¤æä¾›äº†è·¨é›†ç¾¤Service MeshæœåŠ¡ã€‚</li></ul><p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»add-onæ’ä»¶çš„å®ç°æœºåˆ¶ã€‚</p><h2 id=ocm-add-on-æ’ä»¶å®ç°æœºåˆ¶>OCM add-on æ’ä»¶å®ç°æœºåˆ¶</h2><p>é€šå¸¸æƒ…å†µä¸‹ä¸€ä¸ªadd-onæ’ä»¶åŒ…å«2éƒ¨åˆ†ç»„æˆï¼š</p><ol><li><code>Add-on Agent</code> æ˜¯è¿è¡Œåœ¨Spokeé›†ç¾¤ä¸Šçš„ä»»ä½•Kubernetesèµ„æºï¼Œæ¯”å¦‚å¯ä»¥æ˜¯ä¸€ä¸ªæœ‰è®¿é—®Hubæƒé™çš„Podï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªOperatorï¼Œç­‰ç­‰ã€‚</li><li><code>Add-on Manager</code> æ˜¯è¿è¡Œä¸­Hubé›†ç¾¤ä¸Šçš„ä¸€ä¸ªKubernetesæ§åˆ¶å™¨ã€‚è¿™ä¸ªæ§åˆ¶å™¨å¯ä»¥é€šè¿‡<a href=https://open-cluster-management.io/concepts/manifestwork/>ManifestWork</a>
æ¥ç»™ä¸åŒSpokeé›†ç¾¤éƒ¨ç½²åˆ†å‘<code>Add-on Agent</code>æ‰€éœ€è¦çš„Kubernetesèµ„æº, ä¹Ÿå¯ä»¥ç®¡ç†<code>Add-on Agent</code>æ‰€éœ€è¦çš„æƒé™ç­‰ã€‚</li></ol><p>åœ¨OCM Hubé›†ç¾¤ä¸Šï¼Œå…³äºadd-onæ’ä»¶æœ‰2ä¸ªä¸»è¦çš„APIï¼š</p><ol><li><code>ClusterManagementAddOn</code>: è¿™æ˜¯ä¸€ä¸ªcluster-scopedçš„APIï¼Œæ¯ä¸ªadd-onæ’ä»¶å¿…é¡»åˆ›å»ºä¸€ä¸ªåŒåçš„å®ä¾‹ç”¨æ¥æè¿°add-onæ’ä»¶çš„åå­—
å’Œæè¿°ä¿¡æ¯ï¼Œä»¥åŠé…ç½®ï¼Œå®‰è£…éƒ¨ç½²ç­–ç•¥ç­‰ã€‚</li><li><code>ManagedClusterAddOn</code>: è¿™æ˜¯ä¸€ä¸ªnamespace-scopedçš„APIï¼Œéƒ¨ç½²åˆ°spokeé›†ç¾¤çš„namespaceä¸‹çš„å’Œadd-onåŒåçš„å®ä¾‹ç”¨æ¥è§¦å‘
<code>Add-on Agent</code>å®‰è£…éƒ¨ç½²åˆ°è¯¥Spokeé›†ç¾¤ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªAPIè·å–è¿™ä¸ªadd-onæ’ä»¶çš„agentçš„å¥åº·çŠ¶æ€ä¿¡æ¯ã€‚</li></ol><p>Add-on æ’ä»¶æ¶æ„å¦‚ä¸‹ï¼š</p><div style=text-align:center;padding:20px><img src=./assets/addon-architecture.png alt="Addon Architecture" style="margin:0 auto;width:80%"></div><p>åˆ›å»ºï¼š</p><p><code>Add-on Manager</code> ç›‘æ§<code>managedClusterAddOn</code> æ¥åˆ›å»º<code>manifestWork</code>æŠŠ<code>Add-on Agent</code>éƒ¨ç½²åˆ°Spokeé›†ç¾¤ä¸Šï¼Œä¹Ÿå¯ä»¥æ ¹æ®
é…ç½®çš„éƒ¨ç½²ç­–ç•¥åªå°†agentéƒ¨ç½²åˆ°ç­–ç•¥é€‰ä¸­çš„é›†ç¾¤ä¸Šã€‚</p><p>æ³¨å†Œï¼š</p><p>å¦‚æœ<code>Add-on Agent</code> éœ€è¦è®¿é—®Hubé›†ç¾¤ï¼Œ<code>registration-agent</code>ä¼šæ ¹æ®<code>managedClusterAddOn</code> ä¸­çš„æ³¨å†Œä¿¡æ¯æ¥å‘Hubé›†ç¾¤
å‘èµ·CSRè¯·æ±‚æ¥ç”³è¯·è®¿é—®Hubé›†ç¾¤çš„æƒé™ï¼Œ<code>Add-on Manager</code> æ ¹æ®è‡ªå®šä¹‰çš„approveç­–ç•¥æ¥æ£€æŸ¥CSRè¯·æ±‚ï¼Œapproveåï¼Œåˆ›å»ºå¯¹åº”çš„RBAC
æƒé™ç»™agentï¼Œ<code>registration-agent</code> ä¼šç”Ÿæˆä¸€ä¸ªå«æœ‰æŒ‡å®šæƒé™çš„kubeconfig secretï¼Œ agentå¯ä»¥é€šè¿‡è¿™ä¸ªsecretæ¥è®¿é—®Hubé›†ç¾¤ã€‚</p><p>åŸç”ŸKubernetes CSRåªæ”¯æŒ<code>kubernetes.io/kube-apiserver-client</code>,<code>kubernetes.io/kube-apiserver-client-kubelet</code>
å’Œ<code>kubernetes.io/kubelet-serving</code> è¿™å‡ ç§ç­¾åè€…ï¼ˆsignerï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›è®©ç”¨æˆ·è‡ªå®šä¹‰è¯ä¹¦å’Œç­¾åè€…æ¥è®¿é—®ékube-apiserverçš„æœåŠ¡ï¼Œ
åœ¨<code>Add-on Manager</code>ä¸Šå¯ä»¥è‡ªå®šä¹‰éªŒè¯ç­¾åè€…å’Œè¯ä¹¦æ˜¯å¦æ­£ç¡®æ¥å®Œæˆadd-onçš„æ³¨å†Œã€‚</p><p>å¥åº·æ£€æŸ¥ï¼š</p><p><code>Add-on Agent</code>å¯ä»¥é€šè¿‡<code>addon-framework</code>æä¾›çš„leaseåŠŸèƒ½åœ¨Spokeé›†ç¾¤ä¸Šç»´æŠ¤ä¸€ä¸ªleaseï¼Œ<code>registration-agent</code> ç›‘æ§è¿™ä¸ªLeaseï¼Œ
å¹¶é€šè¿‡LeaseçŠ¶æ€åˆ¤æ–­Agentæ˜¯å¦å¥åº·ï¼Œå¹¶æ›´æ–°åˆ°Hubé›†ç¾¤çš„<code>managedClusterAddOn</code>çš„<code>Available</code>çŠ¶æ€ä¸­ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–è‡ªå®šä¹‰æ–¹å¼
æ¥è¿›è¡Œagentçš„å¥åº·æ£€æŸ¥ï¼Œæ¯”å¦‚é€šè¿‡Add-on ManifestWorkä¸­æŸä¸ªèµ„æºçš„å­—æ®µæ¥åˆ¤æ–­agentæ˜¯å¦å¥åº·ã€‚</p><p>å¼€å‘ï¼š</p><p>OCM ç¤¾åŒºæä¾›äº†ä¸€ä¸ª<a href=https://github.com/open-cluster-management-io/addon-framework>addon-framework</a>çš„åº“ï¼Œ
å¯ä»¥æ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿå¼€å‘è‡ªå·±çš„add-onæ’ä»¶Managerï¼Œä¹Ÿå¯ä»¥å°†è‡ªå·±çš„Kubernetnes åº”ç”¨é€šè¿‡addon-frameworkä¾¿æ·çš„ä»¥add-onæ’ä»¶çš„
å½¢å¼è¿ç§»åˆ°OCMå¤šé›†ç¾¤ä¸Šã€‚</p><p>å¼€å‘è€…å°†è‡ªå·±çš„Agentä¾§è¦éƒ¨ç½²çš„èµ„æºä»¥Helm Chartæˆ–è€…Go Templateçš„å½¢å¼ç›´æ¥æ‹·è´åˆ°å·¥ç¨‹ç›®å½•ï¼Œé€šè¿‡è°ƒç”¨<a href=https://github.com/open-cluster-management-io/addon-framework/blob/main/pkg/addonfactory/addonfactory.go>addonfactory</a>å°±å¯ä»¥å®Œæˆæ•´ä¸ªadd-onæ³¨å†Œï¼Œé…ç½®ï¼Œå¥åº·æ£€æŸ¥ç­‰æ‰€æœ‰åŠŸèƒ½ã€‚è¯¦ç»†è¯·
å‚è€ƒ<a href=https://open-cluster-management.io/developer-guides/addon/>add-on å¼€å‘æŒ‡å¼•</a>.</p><h2 id=ä¾‹å­>ä¾‹å­</h2><p>æˆ‘ä»¬ä»¥<code>addon-framework</code>ä¸­çš„<a href=https://github.com/open-cluster-management-io/addon-framework/tree/main/examples>helloworldhelm</a>
add-onæ’ä»¶æ¥ä¸¾ä¾‹ã€‚ è¿™ä¸ªadd-onæ’ä»¶ä¾‹å­æ˜¯å°†Hubé›†ç¾¤ä¸Šé›†ç¾¤namespaceä¸‹çš„configmapåŒæ­¥åˆ°Spokeé›†ç¾¤ä¸Šã€‚</p><p>é¦–å…ˆæˆ‘ä»¬ç”¨KinDåˆ›å»º2ä¸ªé›†ç¾¤ï¼Œä¸€ä¸ªå½“Hubé›†ç¾¤å®‰è£…OCMï¼Œå¹¶å°†å¦ä¸€ä¸ªä½œä¸ºSpokeé›†ç¾¤ï¼Œä»¥cluster1çš„åå­—æ³¨å†Œåˆ°Hubé›†ç¾¤ã€‚
å¯ä»¥å‚è€ƒ<a href=https://open-cluster-management.io/zh//getting-started/>OCMå®‰è£…</a>ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get mcl
</span></span><span style=display:flex><span>NAME       HUB ACCEPTED   MANAGED CLUSTER URLS   JOINED   AVAILABLE   AGE
</span></span><span style=display:flex><span>cluster1   <span style=color:#204a87>true</span>           https://localhost      True     True        17s
</span></span></code></pre></div><p>ç„¶ååœ¨Hubé›†ç¾¤ä¸Šå®‰è£…<code>helloworldhelm</code> add-onæ’ä»¶çš„<code>Add-on Manager</code>æ§åˆ¶å™¨ã€‚ å…·ä½“æ­¥éª¤å‚è€ƒ<a href=https://github.com/open-cluster-management-io/addon-framework/tree/main/examples>éƒ¨ç½²helloworldhelm add-on</a>ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get deployments.apps -n open-cluster-management helloworld-controller
</span></span><span style=display:flex><span>NAME                        READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>helloworldhelm-controller   1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           50s
</span></span></code></pre></div><p>åœ¨Hubé›†ç¾¤ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>helloworldhelm</code> add-onæ’ä»¶çš„<code>ClusterManagementAddOn</code>ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get clustermanagementaddons.addon.open-cluster-management.io helloworldhelm -o yaml
</span></span><span style=display:flex><span>apiVersion: addon.open-cluster-management.io/v1alpha1
</span></span><span style=display:flex><span>kind: ClusterManagementAddOn
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  creationTimestamp: <span style=color:#4e9a06>&#34;2023-05-28T14:12:32Z&#34;</span>
</span></span><span style=display:flex><span>  generation: <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>  name: helloworldhelm
</span></span><span style=display:flex><span>  resourceVersion: <span style=color:#4e9a06>&#34;457615&#34;</span>
</span></span><span style=display:flex><span>  uid: 29ac6292-7346-4bc9-8013-fd90f40589d6
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  addOnMeta:
</span></span><span style=display:flex><span>    description: helloworldhelm is an example addon created by helm chart
</span></span><span style=display:flex><span>    displayName: helloworldhelm
</span></span><span style=display:flex><span>  installStrategy:
</span></span><span style=display:flex><span>    type: Manual
</span></span><span style=display:flex><span>  supportedConfigs:
</span></span><span style=display:flex><span>  - group: addon.open-cluster-management.io
</span></span><span style=display:flex><span>    resource: addondeploymentconfigs
</span></span><span style=display:flex><span>  - group: <span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span>    resource: configmaps
</span></span></code></pre></div><p>ç»™cluster1 é›†ç¾¤ä¸Šéƒ¨ç½²<code>helloworldhelm</code> add-on, agentéƒ¨ç½²åˆ°Spokeé›†ç¾¤çš„<code>open-cluster-management-agent-addon</code> namespaceã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ clusteradm addon <span style=color:#204a87>enable</span> --names helloworldhelm --namespace open-cluster-management-agent-addon --clusters cluster1
</span></span></code></pre></div><p>æˆ‘ä»¬çœ‹åˆ°Hubé›†ç¾¤ä¸Šcluster1çš„namespaceä¸‹éƒ¨ç½²äº†ä¸€ä¸ª<code>managedClusterAddon</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get managedclusteraddons.addon.open-cluster-management.io -n cluster1 helloworldhelm -o yaml
</span></span><span style=display:flex><span>apiVersion: addon.open-cluster-management.io/v1alpha1
</span></span><span style=display:flex><span>kind: ManagedClusterAddOn
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  creationTimestamp: <span style=color:#4e9a06>&#34;2023-05-28T14:13:56Z&#34;</span>
</span></span><span style=display:flex><span>  finalizers:
</span></span><span style=display:flex><span>  - addon.open-cluster-management.io/addon-pre-delete
</span></span><span style=display:flex><span>  generation: <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>  name: helloworldhelm
</span></span><span style=display:flex><span>  namespace: cluster1
</span></span><span style=display:flex><span>  ownerReferences:
</span></span><span style=display:flex><span>  - apiVersion: addon.open-cluster-management.io/v1alpha1
</span></span><span style=display:flex><span>    blockOwnerDeletion: <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>    controller: <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>    kind: ClusterManagementAddOn
</span></span><span style=display:flex><span>    name: helloworldhelm
</span></span><span style=display:flex><span>    uid: 29ac6292-7346-4bc9-8013-fd90f40589d6
</span></span><span style=display:flex><span>  resourceVersion: <span style=color:#4e9a06>&#34;458003&#34;</span>
</span></span><span style=display:flex><span>  uid: 84ceac57-3a7d-442f-bc28-d9828023d880
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  installNamespace: open-cluster-management-agent-addon
</span></span><span style=display:flex><span>status:
</span></span><span style=display:flex><span>  conditions:
</span></span><span style=display:flex><span>  - lastTransitionTime: <span style=color:#4e9a06>&#34;2023-05-28T14:13:57Z&#34;</span>
</span></span><span style=display:flex><span>    message: Registration of the addon agent is configured
</span></span><span style=display:flex><span>    reason: SetPermissionApplied
</span></span><span style=display:flex><span>    status: <span style=color:#4e9a06>&#34;True&#34;</span>
</span></span><span style=display:flex><span>    type: RegistrationApplied
</span></span><span style=display:flex><span>  - lastTransitionTime: <span style=color:#4e9a06>&#34;2023-05-28T14:13:57Z&#34;</span>
</span></span><span style=display:flex><span>    message: manifests of addon are applied successfully
</span></span><span style=display:flex><span>    reason: AddonManifestApplied
</span></span><span style=display:flex><span>    status: <span style=color:#4e9a06>&#34;True&#34;</span>
</span></span><span style=display:flex><span>    type: ManifestApplied
</span></span><span style=display:flex><span>  - lastTransitionTime: <span style=color:#4e9a06>&#34;2023-05-28T14:13:57Z&#34;</span>
</span></span><span style=display:flex><span>    message: client certificate rotated starting from 2023-05-28 14:08:57 +0000 UTC
</span></span><span style=display:flex><span>      to 2024-05-27 14:08:57 +0000 UTC
</span></span><span style=display:flex><span>    reason: ClientCertificateUpdated
</span></span><span style=display:flex><span>    status: <span style=color:#4e9a06>&#34;True&#34;</span>
</span></span><span style=display:flex><span>    type: ClusterCertificateRotated
</span></span><span style=display:flex><span>  - lastTransitionTime: <span style=color:#4e9a06>&#34;2023-05-28T14:15:04Z&#34;</span>
</span></span><span style=display:flex><span>    message: helloworldhelm add-on is available.
</span></span><span style=display:flex><span>    reason: ManagedClusterAddOnLeaseUpdated
</span></span><span style=display:flex><span>    status: <span style=color:#4e9a06>&#34;True&#34;</span>
</span></span><span style=display:flex><span>    type: Available
</span></span><span style=display:flex><span>  namespace: open-cluster-management-agent-addon
</span></span><span style=display:flex><span>  registrations:
</span></span><span style=display:flex><span>  - signerName: kubernetes.io/kube-apiserver-client
</span></span><span style=display:flex><span>    subject:
</span></span><span style=display:flex><span>      groups:
</span></span><span style=display:flex><span>      - system:open-cluster-management:cluster:cluster1:addon:helloworldhelm
</span></span><span style=display:flex><span>      - system:open-cluster-management:addon:helloworldhelm
</span></span><span style=display:flex><span>      - system:authenticated
</span></span><span style=display:flex><span>      user: system:open-cluster-management:cluster:cluster1:addon:helloworldhelm:agent:8xz2x
</span></span><span style=display:flex><span>  supportedConfigs:
</span></span><span style=display:flex><span>  - group: <span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span>    resource: configmaps
</span></span><span style=display:flex><span>  - group: addon.open-cluster-management.io
</span></span><span style=display:flex><span>    resource: addondeploymentconfigs
</span></span></code></pre></div><p>åœ¨Hubé›†ç¾¤ä¸Šçš„cluster1 namespaceä¸‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°éƒ¨ç½²add-on agentå¯¹åº”çš„<code>manifestWork</code>ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get manifestwork -n cluster1
</span></span><span style=display:flex><span>NAME                            AGE
</span></span><span style=display:flex><span>addon-helloworldhelm-deploy-0   7m18s
</span></span></code></pre></div><p>åœ¨Spokeé›†ç¾¤cluster1ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°agentéƒ¨ç½²åœ¨äº†<code>open-cluster-management-agent-addon</code> namespaceä¸‹,
agenté€šè¿‡ç»‘å®šhubçš„kubeconfigæ¥è®¿é—®HubåŒæ­¥configmapã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get deployments.apps -n open-cluster-management-agent-addon
</span></span><span style=display:flex><span>NAME                   READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>helloworldhelm-agent   1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           8m17s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl get secret -n open-cluster-management-agent-addon
</span></span><span style=display:flex><span>NAME                                  TYPE                                  DATA   AGE
</span></span><span style=display:flex><span>helloworldhelm-hub-kubeconfig         Opaque                                <span style=color:#0000cf;font-weight:700>3</span>      8m17s
</span></span></code></pre></div><h2 id=ocm-add-onæœ€æ–°çš„æ”¹è¿›å’Œè®¡åˆ’>OCM add-onæœ€æ–°çš„æ”¹è¿›å’Œè®¡åˆ’</h2><p>åœ¨æœ€æ–°å‘å¸ƒçš„OCM v0.11.0ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å¯¹add-onè¿›è¡Œäº†å¾ˆå¤šåŠŸèƒ½çš„å¢å¼ºï¼š</p><ol><li>åœ¨Hubé›†ç¾¤ä¸Šæœ‰ä¸“é—¨çš„<a href=https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/12-addon-manager>addon-manager</a>
ç»„å»ºæ¥ç®¡ç†add-onæ’ä»¶çš„é…ç½®å’Œç”Ÿå‘½å‘¨æœŸã€‚</li><li>ç‰¹åˆ«å¢å¼ºäº†<a href=https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/81-addon-lifecycle>add-onç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†</a>ï¼Œå‡çº§äº†<code>ClusterManagementAddon</code> å’Œ <code>ManagedClusterAddOn</code>è¿™ä¸¤ä¸ªAPIï¼Œ
ç”¨æˆ·å¯ä»¥é€šè¿‡å’Œ<a href=https://github.com/open-cluster-management-io/placement>Placement</a>ç»“åˆå¯¹æŒ‡å®šé›†ç¾¤ä¸Šçš„add-onè¿›è¡Œæ»šåŠ¨å‡çº§å’Œé‡‘ä¸é›€å‡çº§ã€‚</li><li>æˆ‘ä»¬è¿˜åœ¨è®¾è®¡ä¸€ç§æ–°çš„add-on API <a href=https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/82-addon-template>AddonTemplate</a> æ¥è®©ç”¨æˆ·ä¸ç”¨è¿›è¡Œä»£ç å¼€å‘å°±å¯ä»¥è½»æ¾å®ç°è‡ªå·±çš„add-onæ’ä»¶çš„éƒ¨ç½²å®‰è£…ã€‚</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-55e775ad1f48aade31a37cf5766a8d8f>ä½¿ç”¨OCMè®©å¤šé›†ç¾¤è°ƒåº¦æ›´å…·å¯æ‰©å±•æ€§</h1><div class="td-byline mb-4">By <b>éƒé’ <a href=https://github.com/haoqing0110>@haoqing0110</a></b> |
<time datetime=2023-05-10 class=text-body-secondary>Wednesday, May 10, 2023</time></div><h2 id=èƒŒæ™¯é—®é¢˜>èƒŒæ™¯é—®é¢˜</h2><p>OCM Placement API å¯ä»¥åŠ¨æ€çš„åœ¨å¤šé›†ç¾¤ç¯å¢ƒä¸­é€‰æ‹©ä¸€ç»„æ‰˜ç®¡é›†ç¾¤<code>ManagedCluster</code>ï¼Œä»¥ä¾¿å°†å·¥ä½œè´Ÿè½½éƒ¨ç½²åˆ°è¿™äº›é›†ç¾¤ä¸Šã€‚</p><p>åœ¨ä¸Šä¸€ç¯‡<a href=https://mp.weixin.qq.com/s/_k2MV4b3hfTrLUCCOKOG8g>CNCF æ²™ç®±é¡¹ç›® OCM Placement å¤šé›†ç¾¤è°ƒåº¦æŒ‡å—</a>ä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†ä»‹ç»äº† Placement çš„åŸºæœ¬æ¦‚å¿µï¼Œæä¾›çš„è°ƒåº¦åŠŸèƒ½ä»¥åŠè°ƒåº¦æµç¨‹ã€‚åŒæ—¶è¿˜é€šè¿‡ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨ä¸åŒçš„åº”ç”¨åœºæ™¯ä¸‹ä½¿ç”¨ Placement APIã€‚å»ºè®®é¦–æ¬¡æ¥è§¦ Placement çš„è¯»è€…å…ˆé˜…è¯»æ­¤æ–‡ã€‚</p><p>Placement æä¾›äº†é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨<code>labelSelector</code>æˆ–å£°æ˜é€‰æ‹©å™¨<code>claimSelector</code>è¿‡æ»¤é›†ç¾¤ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†ä¸€äº›å†…ç½®çš„ä¼˜é€‰å™¨<code>prioritizer</code>ï¼Œå¯å¯¹è¿‡æ»¤åçš„é›†ç¾¤è¿›è¡Œæ‰“åˆ†æ’åºå’Œä¼˜å…ˆé€‰æ‹©ã€‚
å†…ç½®çš„<code>prioritizer</code>ä¸­åŒ…æ‹¬äº†æœ€å¤§å¯åˆ†é… CPU èµ„æº(ResourceAllocatableCPU)å’Œæœ€å¤§å¯åˆ†é…å†…å­˜èµ„æº(ResourceAllocatableMemory)ï¼Œå®ƒä»¬æä¾›äº†æ ¹æ®é›†ç¾¤çš„å¯åˆ†é… CPU å’Œå†…å­˜è¿›è¡Œè°ƒåº¦çš„èƒ½åŠ›ã€‚ä½†æ˜¯ï¼Œç”±äºé›†ç¾¤çš„"AllocatableCPU"å’Œ"AllocatableMemory"æ˜¯é™æ€å€¼ï¼Œå³ä½¿"é›†ç¾¤èµ„æºä¸è¶³"ï¼Œå®ƒä»¬ä¹Ÿä¸ä¼šæ”¹å˜ã€‚è¿™å¯¼è‡´åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿™ä¸¤ä¸ª<code>prioritizer</code>ä¸èƒ½æ»¡è¶³åŸºäºå®æ—¶å¯ç”¨ CPU æˆ–å†…å­˜è¿›è¡Œè°ƒåº¦çš„éœ€æ±‚ã€‚æ­¤å¤–ï¼Œä½¿ç”¨è€…è¿˜å¯èƒ½éœ€è¦æ ¹æ®ä»é›†ç¾¤ä¸­è·å–çš„èµ„æºç›‘æ§æ•°æ®è¿›è¡Œè°ƒåº¦ï¼Œè¿™äº›éƒ½æ˜¯å†…ç½®çš„<code>prioritizer</code>æ— æ³•æ»¡è¶³çš„éœ€æ±‚ã€‚</p><p>ä»¥ä¸Šè¿™äº›éœ€æ±‚è¦æ±‚ Placement èƒ½å¤Ÿæ›´çµæ´»çš„æ ¹æ®ç¬¬ä¸‰æ–¹æ•°æ®æ¥è¿›è¡Œè°ƒåº¦ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ç§æ›´å…·æ‰©å±•æ€§çš„æ–¹å¼æ¥æ”¯æŒåŸºäºç¬¬ä¸‰æ–¹æ•°æ®çš„è°ƒåº¦ï¼Œä½¿ç”¨è€…å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„åˆ†æ•°æ¥é€‰æ‹©é›†ç¾¤ã€‚</p><p>æœ¬æ–‡å°†ä»‹ç» OCM æ˜¯å¦‚ä½•è®©å¤šé›†ç¾¤è°ƒåº¦æ›´å…·å¯æ‰©å±•æ€§ï¼Œå¹¶é€šè¿‡å®ä¾‹å±•ç¤ºå¦‚ä½•å®ç°ä¸€ä¸ªç¬¬ä¸‰æ–¹æ•°æ®æ§åˆ¶å™¨<code>controller</code>æ¥æ‰©å±• OCM çš„å¤šé›†ç¾¤è°ƒåº¦åŠŸèƒ½ã€‚</p><h2 id=ocm-å¦‚ä½•è®©è°ƒåº¦å…·æœ‰å¯æ‰©å±•æ€§>OCM å¦‚ä½•è®©è°ƒåº¦å…·æœ‰å¯æ‰©å±•æ€§</h2><p>ä¸ºäº†å®ç°åŸºäºç¬¬ä¸‰æ–¹æ•°æ®çš„è°ƒåº¦ï¼ŒOCM å¼•å…¥äº† API <code>AddOnPlacementScore</code>ï¼Œå®ƒæ”¯æŒå­˜å‚¨è‡ªå®šä¹‰çš„é›†ç¾¤åˆ†æ•°ï¼Œä½¿ç”¨è€…å¯ä»¥åœ¨ Placement ä¸­æŒ‡å®šä½¿ç”¨æ­¤åˆ†æ•°é€‰æ‹©é›†ç¾¤ã€‚</p><p>å¦‚ä¸‹æ˜¯ä¸€ä¸ª<code>AddOnPlacementScore</code>çš„ä¾‹å­ï¼Œæ›´å¤šå…³äº API çš„ç»†èŠ‚å¯è®¿é—®<a href=https://github.com/open-cluster-management-io/api/blob/main/cluster/v1alpha1/types_addonplacementscore.go title=types_addonplacementscore.go>types_addonplacementscore.go</a>ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnPlacementScore</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2021-10-28T08:31:39Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnPlacementScore updated successfully</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnPlacementScoreUpdated</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOnPlacementScoreUpdated</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>validUntil</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2021-10-29T18:31:39Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>scores</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;cpuAvailable&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>66</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;memAvailable&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>55</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><code>AddOnPlacementScore</code>çš„ä¸»è¦å†…å®¹éƒ½åœ¨<code>status</code>ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›ä½¿ç”¨è€…æ›´æ–°å®ƒã€‚<code>AddOnPlacementScore</code>çš„ç”Ÿå‘½å‘¨æœŸç»´æŠ¤åŠ<code>scores</code>çš„æ›´æ–°åº”è¯¥ç”±ç¬¬ä¸‰æ–¹<code>controller</code>è´Ÿè´£ã€‚</p><ul><li><code>conditions</code>åŒ…æ‹¬äº†èµ„æºä¸åŒçš„æ¡ä»¶çŠ¶æ€ã€‚</li><li><code>scores</code>æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒ…å«äº†ä¸€ç»„åˆ†æ•°çš„åç§°å’Œå€¼ã€‚åœ¨ä¸Šä¾‹ä¸­ï¼Œ<code>scores</code>åŒ…å«äº†è‡ªå®šä¹‰åˆ†æ•° cpuAvailable å’Œ memAvailableã€‚</li><li><code>validUntil</code>å®šä¹‰äº†<code>scores</code>çš„æœ‰æ•ˆæ—¶é—´ã€‚åœ¨æ­¤æ—¶é—´ä¹‹åï¼Œåˆ†æ•°è¢« Placement è§†ä¸ºæ— æ•ˆï¼Œnil ä»£è¡¨æ°¸ä¸è¿‡æœŸã€‚controller éœ€è¦åœ¨æ›´æ–° score æ—¶æ›´æ–°æ­¤å­—æ®µï¼Œä¿è¯åˆ†æ•°æ˜¯æœ€æ–°çŠ¶æ€ã€‚</li></ul><p>ä½œä¸ºä½¿ç”¨è€…ï¼Œéœ€è¦çŸ¥é“<code>AddOnPlacementScore</code>çš„èµ„æºåç§°<code>default</code>å’Œ<code>socre</code>åç§°<code>cpuAvailable</code> <code>memAvailable</code>ã€‚ä¹‹åå¯åœ¨ Placement ä¸­æŒ‡å®šç”¨æ­¤åˆ†æ•°é€‰æ‹©é›†ç¾¤ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„ Placement æƒ³è¦é€‰æ‹©å…·æœ‰æœ€é«˜<code>cpuAvailable</code>åˆ†æ•°çš„å‰ 3 ä¸ªé›†ç¾¤ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.open-cluster-management.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ns1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>prioritizerPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exact</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>configurations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>scoreCoordinate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddOn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>addOn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>resourceName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>scoreName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cpuAvailable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><a href=https://github.com/open-cluster-management-io/enhancements/blob/main/enhancements/sig-architecture/32-extensiblescheduling/32-extensiblescheduling.md title=32-extensiblescheduling>32-extensiblescheduling</a>åŒ…å«äº†å…³äºæ­¤è®¾è®¡çš„è¯¦ç»†å†…å®¹ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå°†ç”¨ä¸€ä¸ªç¤ºä¾‹å±•ç¤ºå¦‚ä½•å®ç°ä¸€ä¸ª controller æ¥æ›´æ–°<code>score</code>ï¼Œå¹¶ä½¿ç”¨æ­¤<code>score</code>é€‰æ‹©é›†ç¾¤ã€‚</p><h2 id=ç¤ºä¾‹>ç¤ºä¾‹</h2><p>ç¤ºä¾‹ä»£ç ä½äº GitHub ä»“åº“<a href=https://github.com/open-cluster-management-io/addon-contrib/tree/main/resource-usage-collect-addon title=resource-usage-collect-addon>resource-usage-collect-addon</a>ã€‚å®ƒæä¾›çš„åˆ†æ•°å¯å®æ—¶åæ˜ é›†ç¾¤çš„ CPU å’Œå†…å­˜åˆ©ç”¨ç‡ã€‚</p><p>ç¤ºä¾‹ä½¿ç”¨ OCM <a href=https://github.com/open-cluster-management-io/addon-framework title=addon-framework>addon-framework</a> è¿›è¡Œå¼€å‘ï¼Œå®ƒå¯ä»¥ä½œä¸ºä¸€ä¸ª addon æ’ä»¶è¢«å®‰è£…åˆ°æ¯ä¸ª<code>ManagedCluster</code>ä¸Šï¼Œå¹¶å°†é›†ç¾¤çš„<code>score</code>æ›´æ–°åˆ°å¯¹åº”çš„<code>AddOnPlacementScore</code>ä¸­ã€‚ï¼ˆæœ¬æ–‡ä¸æ¶‰åŠ addon å¼€å‘ç»†èŠ‚ï¼Œè¯¦ç»†å†…å®¹å¯å‚è€ƒ<a href=https://open-cluster-management.io/developer-guides/addon/ title=add-onå¼€å‘æŒ‡å—>add-on å¼€å‘æŒ‡å—</a>ã€‚ï¼‰</p><p>resource-usage-collect addon éµå¾ª<code>hub-agent</code>çš„æ¶æ„ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img src=/blog/2023/%E4%BD%BF%E7%94%A8ocm%E8%AE%A9%E5%A4%9A%E9%9B%86%E7%BE%A4%E8%B0%83%E5%BA%A6%E6%9B%B4%E5%85%B7%E5%8F%AF%E6%89%A9%E5%B1%95%E6%80%A7/assets/extend-multicluster-scheduling-capabilities.png alt></p><p>resource-usage-collect addon åŒ…æ‹¬äº†ä¸€ä¸ª hub ä¸Šçš„ manager å’Œ managed cluster ä¸Šçš„ agentï¼ˆç»¿è‰²éƒ¨åˆ†ï¼‰ã€‚</p><p>å·¥ä½œæµç¨‹ä¸ºï¼š</p><ul><li>hub ä¸Šè¿è¡Œ addon çš„ managerï¼Œå®ƒè´Ÿè´£åœ¨ hub ä¸Šä¸ºæ¯ä¸ª agent åˆ›å»ºéƒ¨ç½²æ‰€éœ€çš„<code>ManifestWork</code>ã€‚</li><li>åœ¨æ¯ä¸ª managed cluster ä¸Šï¼Œwork agent è´Ÿè´£ç›‘æ§ hub ä¸Šçš„<code>ManifestWork</code>å¹¶åœ¨ managed cluster ä¸Šå®‰è£… agentã€‚</li><li>agent æ˜¯ addon çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒè´Ÿè´£ä¸ºæ¯ä¸ª managed cluster åˆ›å»º<code>AddonPlacementScore</code>ï¼Œå¹¶æ¯ 60 ç§’åˆ·æ–°ä¸€æ¬¡<code>scores</code>å’Œ<code>validUntil</code>ã€‚</li><li>å½“<code>AddonPlacementScore</code>åˆ›å»ºå®Œæˆï¼Œç”¨æˆ·ä¾¿å¯ä»¥åœ¨<code>Placement</code>ä¸­æŒ‡å®š<code>AddOnPlacementScore</code>çš„èµ„æºåç§°å’Œ<code>score</code>åç§°ï¼Œæ ¹æ®åˆ†æ•°æ¥é€‰æ‹©é›†ç¾¤ã€‚</li><li>Placement controller ä¼šåœ¨æ¯ä¸ªé›†ç¾¤çš„å‘½åç©ºé—´ä¸­è·å–<code>AddOnPlacementScore</code>èµ„æºï¼Œåœ¨<code>scores</code>åˆ—è¡¨ä¸­è¯»å–åˆ†æ•°ï¼Œå¹¶ä½¿ç”¨è¯¥åˆ†æ•°å¯¹é›†ç¾¤è¿›è¡Œæ‰“åˆ†æ’åºã€‚</li></ul><p>ä¸Šè¿°æ˜¯<code>AddonPlacementScore</code>å’Œ placement controller çš„å·¥ä½œæµç¨‹ï¼Œéå¸¸å®¹æ˜“ç†è§£ã€‚ä¸‹é¢æˆ‘ä»¬æ¥è¯•ç€è¿è¡Œæ ·ä¾‹ä»£ç ã€‚</p><p><strong>å‡†å¤‡ OCM ç¯å¢ƒï¼ˆåŒ…å« 2 ä¸ª<code>ManagedCluster</code>ï¼‰</strong></p><ol><li>è¿è¡Œ<a href=https://github.com/open-cluster-management-io/OCM/tree/main/solutions/setup-dev-environment title="setup dev environment by kind">setup dev environment by kind</a>å‡†å¤‡ç¯å¢ƒã€‚</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -sSL https://raw.githubusercontent.com/open-cluster-management-io/OCM/main/solutions/setup-dev-environment/local-up.sh <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><ol start=2><li>ç¡®è®¤ä¸¤ä¸ª<code>ManagedCluster</code>å’Œä¸€ä¸ªé»˜è®¤çš„<code>ManagedClusterSet</code>åˆ›å»ºå®Œæˆã€‚</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ clusteradm get clusters
</span></span><span style=display:flex><span>NAME       ACCEPTED   AVAILABLE   CLUSTERSET   CPU   MEMORY       KUBERENETES VERSION
</span></span><span style=display:flex><span>cluster1   <span style=color:#204a87>true</span>       True        default      <span style=color:#0000cf;font-weight:700>24</span>    49265496Ki   v1.23.4
</span></span><span style=display:flex><span>cluster2   <span style=color:#204a87>true</span>       True        default      <span style=color:#0000cf;font-weight:700>24</span>    49265496Ki   v1.23.4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ clusteradm get clustersets
</span></span><span style=display:flex><span>NAME      BOUND NAMESPACES   STATUS
</span></span><span style=display:flex><span>default                      <span style=color:#0000cf;font-weight:700>2</span> ManagedClusters selected
</span></span></code></pre></div><ol start=3><li>å°†é»˜è®¤<code>ManagedClusterSet</code>ç»‘å®šåˆ° default<code>Namespace</code>ã€‚</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>clusteradm clusterset <span style=color:#204a87>bind</span> default --namespace default
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ clusteradm get clustersets
</span></span><span style=display:flex><span>NAME      BOUND NAMESPACES   STATUS
</span></span><span style=display:flex><span>default   default            <span style=color:#0000cf;font-weight:700>2</span> ManagedClusters selected
</span></span></code></pre></div><p><strong>å®‰è£… resource-usage-collect addon</strong></p><ol><li>ä¸‹è½½æºä»£ç ã€‚</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone git@github.com:open-cluster-management-io/addon-contrib.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> addon-contrib/resource-usage-collect-addon
</span></span></code></pre></div><ol start=2><li>ç¼–è¯‘å®¹å™¨é•œåƒã€‚</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Set image name, this is an optional step.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>IMAGE_NAME</span><span style=color:#ce5c00;font-weight:700>=</span>quay.io/haoqing/resource-usage-collect-addon:latest
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Build image</span>
</span></span><span style=display:flex><span>make images
</span></span></code></pre></div><p>å¦‚æœä½ ä½¿ç”¨äº† kindï¼Œéœ€è¦æ‰‹å·¥å°†é•œåƒåŠ è½½åˆ° kind ç¯å¢ƒä¸­ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kind load docker-image <span style=color:#000>$IMAGE_NAME</span> --name &lt;cluster_name&gt; <span style=color:#8f5902;font-style:italic># kind load docker-image $IMAGE_NAME --name hub</span>
</span></span></code></pre></div><ol start=3><li>éƒ¨ç½² resource-usage-collect addonã€‚</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make deploy
</span></span></code></pre></div><ol start=4><li>éªŒè¯å®‰è£…æˆåŠŸã€‚</li></ol><p>åœ¨ hub é›†ç¾¤ä¸Š, éªŒè¯ resource-usage-collect-controller pod è¿è¡ŒæˆåŠŸã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get pods -n open-cluster-management <span style=color:#000;font-weight:700>|</span> grep resource-usage-collect-controller
</span></span><span style=display:flex><span>resource-usage-collect-controller-55c58bbc5-t45dh   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          71s
</span></span></code></pre></div><p>åœ¨ hub é›†ç¾¤ä¸Š, éªŒè¯æ¯ä¸ª managed cluster ç”Ÿæˆäº†å¯¹åº”çš„<code>AddonPlacementScore</code>ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get addonplacementscore -A
</span></span><span style=display:flex><span>NAMESPACE   NAME                   AGE
</span></span><span style=display:flex><span>cluster1    resource-usage-score   3m23s
</span></span><span style=display:flex><span>cluster2    resource-usage-score   3m24s
</span></span></code></pre></div><p><code>AddonPlacementScore</code>çš„ status ä¸­åº”è¯¥åŒ…å«äº†å¦‚ä¸‹çš„åˆ†æ•°ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get addonplacementscore -n cluster1 resource-usage-score -oyaml
</span></span><span style=display:flex><span>apiVersion: cluster.open-cluster-management.io/v1alpha1
</span></span><span style=display:flex><span>kind: AddOnPlacementScore
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  creationTimestamp: <span style=color:#4e9a06>&#34;2022-08-08T06:46:04Z&#34;</span>
</span></span><span style=display:flex><span>  generation: <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>  name: resource-usage-score
</span></span><span style=display:flex><span>  namespace: cluster1
</span></span><span style=display:flex><span>  resourceVersion: <span style=color:#4e9a06>&#34;3907&#34;</span>
</span></span><span style=display:flex><span>  uid: 6c4280e4-38be-4d45-9c73-c18c84799781
</span></span><span style=display:flex><span>status:
</span></span><span style=display:flex><span>  scores:
</span></span><span style=display:flex><span>  - name: cpuAvailable
</span></span><span style=display:flex><span>    value: <span style=color:#0000cf;font-weight:700>12</span>
</span></span><span style=display:flex><span>  - name: memAvailable
</span></span><span style=display:flex><span>    value: <span style=color:#0000cf;font-weight:700>4</span>
</span></span></code></pre></div><p>å¦‚æœ<code>AddonPlacementScore</code>æ²¡æœ‰ç”Ÿæˆæˆ–è€… status ä¸­æ²¡æœ‰åˆ†æ•°ï¼Œå¯ä»¥ç™»é™†åˆ° managed cluster ä¸Šï¼Œæ£€æŸ¥ resource-usage-collect-agent pod æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get pods -n default <span style=color:#000;font-weight:700>|</span> grep resource-usage-collect-agent
</span></span><span style=display:flex><span>resource-usage-collect-agent-5b85cbf848-g5kqm   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          2m
</span></span></code></pre></div><p><strong>é€šè¿‡è‡ªå®šä¹‰åˆ†æ•°é€‰æ‹©é›†ç¾¤</strong></p><p>å¦‚æœä¸Šè¿°æ­¥éª¤è¿è¡Œæ­£å¸¸ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥è¯•ç€åˆ›å»ºä¸€ä¸ª<code>Placement</code>å¹¶é€šè¿‡è‡ªå®šä¹‰åˆ†æ•°é€‰æ‹©é›†ç¾¤ã€‚</p><ol><li>åˆ›å»ºä¸€ä¸ª<code>Placement</code>é€‰æ‹©å…·æœ‰æœ€é«˜ cpuAvailable åˆ†æ•°çš„é›†ç¾¤ã€‚</li></ol><p>å½“<code>scoreCoordinate</code>çš„ç±»å‹<code>type</code>å®šä¹‰ä¸º<code>AddOn</code>æ—¶ï¼Œplacement controller ä¼šåœ¨æ¯ä¸ªé›†ç¾¤çš„å‘½åç©ºé—´ä¸­è·å–åç§°ä¸º<code>resource-usage-score</code>çš„<code>AddOnPlacementScore</code>èµ„æºï¼Œåœ¨<code>scores</code>åˆ—è¡¨ä¸­è¯»å–åˆ†æ•°<code>cpuAvailable</code>ï¼Œå¹¶ä½¿ç”¨è¯¥åˆ†æ•°å¯¹é›†ç¾¤è¿›è¡Œæ‰“åˆ†æ’åºã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: cluster.open-cluster-management.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Placement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: placement1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: default
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  numberOfClusters: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  clusterSets:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - default
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  prioritizerPolicy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    mode: Exact
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    configurations:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      - scoreCoordinate:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          type: AddOn
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          addOn:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            resourceName: resource-usage-score
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            scoreName: cpuAvailable
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        weight: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><ol start=2><li>éªŒè¯<code>PlacementDecision</code>ã€‚</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl describe placementdecision -n default <span style=color:#000;font-weight:700>|</span> grep Status -A <span style=color:#0000cf;font-weight:700>3</span>
</span></span><span style=display:flex><span>Status:
</span></span><span style=display:flex><span>  Decisions:
</span></span><span style=display:flex><span>    Cluster Name:  cluster1
</span></span><span style=display:flex><span>    Reason:
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ° Cluster1 è¢«é€‰ä¸­ï¼Œå‡ºç°åœ¨<code>PlacementDecision</code>çš„ç»“æœä¸­ã€‚</p><p>è¿è¡Œå¦‚ä¸‹å‘½ä»¤è·å–<code>AddonPlacementScore</code>çš„è‡ªå®šä¹‰åˆ†æ•°ã€‚å¯ä»¥çœ‹åˆ°"cpuAvailable"çš„åˆ†æ•°æ˜¯ 12ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get addonplacementscore -A -o<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{range .items[*]}{.metadata.namespace}{&#34;\t&#34;}{.status.scores}{&#34;\n&#34;}{end}&#39;</span>
</span></span><span style=display:flex><span>cluster1        <span style=color:#ce5c00;font-weight:700>[{</span><span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;cpuAvailable&#34;</span>,<span style=color:#4e9a06>&#34;value&#34;</span>:12<span style=color:#ce5c00;font-weight:700>}</span>,<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;memAvailable&#34;</span>,<span style=color:#4e9a06>&#34;value&#34;</span>:4<span style=color:#ce5c00;font-weight:700>}]</span>
</span></span><span style=display:flex><span>cluster2        <span style=color:#ce5c00;font-weight:700>[{</span><span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;cpuAvailable&#34;</span>,<span style=color:#4e9a06>&#34;value&#34;</span>:12<span style=color:#ce5c00;font-weight:700>}</span>,<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;memAvailable&#34;</span>,<span style=color:#4e9a06>&#34;value&#34;</span>:4<span style=color:#ce5c00;font-weight:700>}]</span>
</span></span></code></pre></div><p>åœ¨<code>Placement</code>çš„ events ä¹Ÿå¯ä»¥çœ‹åˆ°é›†ç¾¤çš„åˆ†æ•°æ˜¯ 12 åˆ†ã€‚è¿™è¡¨æ˜è‡ªå®šä¹‰åˆ†æ•°è¢«ç›´æ¥ç”¨äºå¯¹é›†ç¾¤è¿›è¡Œæ‰“åˆ†å’Œæ’åºã€‚ç”±äºä¸Šè¿° placement ä¸­ numberOfClusters å®šä¹‰ä¸º 1ï¼Œæœ€ç»ˆåªæœ‰ cluster1 è¢«é€‰ä¸­ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl describe placement -n default placement1 <span style=color:#000;font-weight:700>|</span> grep Events -A <span style=color:#0000cf;font-weight:700>10</span>
</span></span><span style=display:flex><span>Events:
</span></span><span style=display:flex><span>  Type    Reason          Age   From                 Message
</span></span><span style=display:flex><span>  ----    ------          ----  ----                 -------
</span></span><span style=display:flex><span>  Normal  DecisionCreate  50s   placementController  Decision placement1-decision-1 is created with placement placement1 in namespace default
</span></span><span style=display:flex><span>  Normal  DecisionUpdate  50s   placementController  Decision placement1-decision-1 is updated with placement placement1 in namespace default
</span></span><span style=display:flex><span>  Normal  ScoreUpdate     50s   placementController  cluster1:12 cluster2:12
</span></span></code></pre></div><h2 id=å¦‚ä½•å®ç°è‡ªå®šä¹‰åˆ†æ•°æ§åˆ¶å™¨>å¦‚ä½•å®ç°è‡ªå®šä¹‰åˆ†æ•°æ§åˆ¶å™¨</h2><p>ç°åœ¨ä½ å·²ç»çŸ¥é“äº†å¦‚ä½•å®‰è£… resource-usage-collect addon å¹¶ä½¿ç”¨è‡ªå®šä¹‰åˆ†æ•°æ¥é€‰æ‹©ç¾¤é›†ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£åœ¨å®ç°è‡ªå®šä¹‰åˆ†æ•°æ§åˆ¶å™¨<code>controller</code>æ—¶éœ€è¦è€ƒè™‘çš„ä¸€äº›å…³é”®ç‚¹ã€‚</p><h3 id=1-åœ¨å“ªé‡Œè¿è¡Œè‡ªå®šä¹‰åˆ†æ•°æ§åˆ¶å™¨-controller>1. åœ¨å“ªé‡Œè¿è¡Œè‡ªå®šä¹‰åˆ†æ•°æ§åˆ¶å™¨ (controller)</h3><p>Controller å¯ä»¥åœ¨ hub é›†ç¾¤æˆ– managed cluster ä¸Šè¿è¡Œã€‚å¯ä»¥ç»“åˆå…·ä½“çš„ä½¿ç”¨åœºæ™¯ï¼Œé€‰æ‹©å°† controller è¿è¡Œåœ¨ä½•å¤„ã€‚</p><p>æ¯”å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œè‡ªå®šä¹‰åˆ†æ•°æ§åˆ¶å™¨<code>controller</code>æ˜¯ä½¿ç”¨ addon-famework å¼€å‘çš„ï¼Œå®ƒéµå¾ª hub-agent æ¶æ„ã€‚resource-usage-collect-agent çœŸæ­£è¿è¡Œè‡ªå®šä¹‰åˆ†æ•°ç¨‹åºï¼Œå®ƒå®‰è£…åœ¨æ¯ä¸ª managed cluster ä¸Šï¼Œè·å– managed cluster çš„å¯ç”¨ CPU å’Œå†…å­˜ï¼Œè®¡ç®—åˆ†æ•°ï¼Œå¹¶å°†å…¶æ›´æ–°åˆ°<code>AddonPlacementScore</code>ä¸­ã€‚resource-usage-collect-controller åªè´Ÿè´£å®‰è£…ä»£ç† agentã€‚</p><p>åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæƒ³ä½¿ç”¨ Thanos ä¸­çš„æŒ‡æ ‡ä¸ºæ¯ä¸ª managed cluster è®¡ç®—å¾—åˆ†ï¼Œåˆ™è‡ªå®šä¹‰åˆ†æ•°æ§åˆ¶å™¨<code>controller</code>éœ€è¦æ”¾ç½®åœ¨ hub ä¸Šï¼Œå› ä¸º Thanos æœ‰ä»æ¯ä¸ª managed cluster æ”¶é›†çš„æ‰€æœ‰æŒ‡æ ‡ã€‚</p><h3 id=2-å¦‚ä½•ç»´æŠ¤addonplacementscoreçš„ç”Ÿå‘½å‘¨æœŸ>2. å¦‚ä½•ç»´æŠ¤<code>AddOnPlacementScore</code>çš„ç”Ÿå‘½å‘¨æœŸ</h3><p>åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œç»´æŠ¤<code>AddonPlacementScore</code>çš„ä»£ç ä½äº<a href=https://github.com/open-cluster-management-io/addon-contrib/blob/main/resource-usage-collect-addon/pkg/addon/agent/agent.go title=pkg/addon/agent/agent.go>pkg/addon/agent/agent.go</a>ä¸­ã€‚</p><ul><li><p>ä½•æ—¶åˆ›å»º<code>AddonPlacementScore</code>ï¼Ÿ</p><p><code>AddonPlacementScore</code>å¯ä»¥åœ¨ managed cluster åˆ›å»ºå®Œæˆååˆ›å»ºï¼Œæˆ–è€…æŒ‰éœ€åˆ›å»ºä»¥å‡å°‘ hub ä¸Šçš„ resourceã€‚</p><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œaddon åœ¨ managed cluster åˆ›å»ºå®Œæˆåï¼Œä¸ºæ¯ä¸ª managed cluster åˆ›å»ºå¯¹åº”çš„<code>AddonPlacementScore</code>ï¼Œå¹¶ä¸”ç”Ÿæˆåˆå§‹åˆ†æ•°ã€‚</p></li><li><p>ä½•æ—¶æ›´æ–°<code>AddonPlacementScore</code>ï¼Ÿ</p><p>å¯ä»¥åœ¨ç›‘è§†æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶æ›´æ–°åˆ†æ•°ï¼Œæˆ–è€…è‡³å°‘åœ¨<code>ValidUntil</code>åˆ°æœŸä¹‹å‰æ›´æ–°åˆ†æ•°ã€‚
æˆ‘ä»¬å»ºè®®åœ¨æ›´æ–°åˆ†æ•°æ—¶è®¾ç½®<code>ValidUntil</code>ï¼Œä»¥ä¾¿ placement controller å¯ä»¥çŸ¥é“åˆ†æ•°æ˜¯å¦ä»ç„¶æœ‰æ•ˆï¼Œé˜²æ­¢åˆ†æ•°é•¿æ—¶é—´æœªèƒ½æ›´æ–°çš„æƒ…å†µã€‚</p><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œé™¤äº†æ¯ 60 ç§’é‡æ–°è®¡ç®—å’Œæ›´æ–°åˆ†æ•°å¤–ï¼Œå½“ managed cluster ä¸­çš„èŠ‚ç‚¹æˆ– Pod èµ„æºå‘ç”Ÿæ›´æ”¹æ—¶ï¼Œä¹Ÿå°†è§¦å‘æ›´æ–°ã€‚</p></li></ul><h3 id=3-å¦‚ä½•è®¡ç®—åˆ†æ•°>3. å¦‚ä½•è®¡ç®—åˆ†æ•°</h3><p>è®¡ç®—åˆ†æ•°çš„ä»£ç ä½äº<a href=https://github.com/open-cluster-management-io/addon-contrib/blob/main/resource-usage-collect-addon/pkg/addon/agent/calculate.go title=pkg/addon/agent/calculate.go>pkg/addon/agent/calculate.go</a>ã€‚æœ‰æ•ˆçš„å¾—åˆ†å¿…é¡»åœ¨-100 è‡³ 100 çš„èŒƒå›´å†…ï¼Œä½ éœ€è¦åœ¨å°†åˆ†æ•°æ›´æ–°åˆ°<code>AddOnPlacementScore</code>ä¹‹å‰å°†å…¶å½’ä¸€åŒ–ã€‚åœ¨å½’ä¸€åŒ–åˆ†æ•°æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹æƒ…å†µã€‚</p><ul><li><p>åˆ†æ•°æä¾›ç¨‹åºçŸ¥é“è‡ªå®šä¹‰åˆ†æ•°çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡å…¬å¼è½»æ¾å®ç°å¹³æ»‘æ˜ å°„ã€‚å‡è®¾å®é™…å€¼ä¸º Xï¼Œå¹¶ä¸” X åœ¨é—´éš”[minï¼Œmax]ä¸­ï¼Œåˆ™å¾—åˆ†=200 *ï¼ˆx-minï¼‰/ï¼ˆmax-minï¼‰-100</p></li><li><p>åˆ†æ•°æä¾›ç¨‹åºä¸çŸ¥é“è‡ªå®šä¹‰åˆ†æ•°çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦è‡ªå·±è®¾ç½®æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œåˆ™æ— æ³•å°†å•ä¸ªå€¼ X æ˜ å°„åˆ°èŒƒå›´[-100,100]ã€‚
ç„¶åï¼Œå½“ X å¤§äºæ­¤æœ€å¤§å€¼æ—¶ï¼Œå¯ä»¥è®¤ä¸ºç¾¤é›†è¶³å¤Ÿå¥åº·å¯ä»¥éƒ¨ç½²åº”ç”¨ç¨‹åºï¼Œå¯ä»¥å°†åˆ†æ•°è®¾ç½®ä¸º 100ã€‚å¦‚æœ X å°äºæœ€å°å€¼ï¼Œåˆ™å¯ä»¥å°†åˆ†æ•°è®¾ç½®ä¸º-100ã€‚</p><pre tabindex=0><code>if X &gt;= max
  score = 100
if X &lt;= min
  score = -100
</code></pre></li></ul><p>åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œè¿è¡Œåœ¨æ¯ä¸ªæ‰˜ç®¡ç¾¤é›†ä¸Šçš„ resource-usage-collect-agent æ²¡æœ‰å…¨å±€è§†è§’ï¼Œæ— æ³•çŸ¥é“æ‰€æœ‰ç¾¤é›†çš„ CPU/å†…å­˜ä½¿ç”¨ç‡çš„æœ€å¤§å€¼/æœ€å°å€¼ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ä»£ç ä¸­æ‰‹åŠ¨å°†æœ€å¤§å€¼è®¾ç½®ä¸º<code>MAXCPUCOUNT</code>å’Œ<code>MAXMEMCOUNT</code>ï¼Œæœ€å°å€¼è®¾ç½®ä¸º 0ã€‚åˆ†æ•°è®¡ç®—å…¬å¼å¯ä»¥ç®€åŒ–ä¸ºï¼š<code>score = x / max * 100</code>ã€‚</p><h2 id=æ€»ç»“>æ€»ç»“</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä»€ä¹ˆæ˜¯OCMçš„å¯æ‰©å±•è°ƒåº¦ï¼Œå¹¶ä½¿ç”¨ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å®ç°è‡ªå®šä¹‰åˆ†æ•°æ§åˆ¶å™¨ã€‚æ­¤å¤–ï¼Œæœ¬æ–‡åˆ—å‡ºäº†å¼€å‘è€…åœ¨å®ç°ç¬¬ä¸‰æ–¹åˆ†æ•°æ§åˆ¶å™¨æ—¶éœ€è¦è€ƒè™‘çš„3ä¸ªå…³é”®ç‚¹ã€‚å¸Œæœ›é˜…è¯»æœ¬æ–‡åï¼Œæ‚¨å¯ä»¥æ¸…æ¥šåœ°äº†è§£åˆ°å¦‚ä½•ä½¿ç”¨OCM æ¥æ‰©å±•å¤šé›†ç¾¤è°ƒåº¦èƒ½åŠ›ã€‚</p></div><div class=td-content style=page-break-before:always><h1 id=pg-db74eba3bd0537bd15014d1f4d2d9218>How to distribute workloads using Open Cluster Management</h1><div class="td-byline mb-4">By <b>Tomer Figenblat</b> |
<time datetime=2023-01-19 class=text-body-secondary>Thursday, January 19, 2023</time></div><p>Read more at <a href=https://developers.redhat.com/articles/2023/01/19/how-distribute-workloads-using-open-cluster-management>Red Hat Developers</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-da1547e89e69281e8c02839ca9ab63b2>KubeCon NA 2022 - OCM Multicluster App & Config Management</h1><div class="td-byline mb-4"><time datetime=2022-10-26 class=text-body-secondary>Wednesday, October 26, 2022</time></div><p>Read more at <a href=/kubecon-na-2022-ocm-multicluster-app-and-config-management.pdf>KubeCon NA 2022 - OCM Multicluster App & Config Management</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e9ac27c25f598dce5dca326a80b63c85>KubeCon NA 2022 - OCM Workload distribution with Placement API</h1><div class="td-byline mb-4"><time datetime=2022-10-26 class=text-body-secondary>Wednesday, October 26, 2022</time></div><p>Read more at <a href=/kubecon-na-2022-ocm-workload-distribution-with-placement-api.pdf>KubeCon NA 2022 - OCM Workload distribution with Placement API</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8d8f585bf45ed3f61f5980b5e6e87979>Karmada and Open Cluster Management: two new approaches to the multicluster fleet management challenge</h1><div class="td-byline mb-4"><time datetime=2022-09-26 class=text-body-secondary>Monday, September 26, 2022</time></div><p>Read more at <a href=https://www.cncf.io/blog/2022/09/26/karmada-and-open-cluster-management-two-new-approaches-to-the-multicluster-fleet-management-challenge/>CNCF Blog</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e9ba9d2c68d5ccd206616e82b5f6e9da>Extending the Multicluster Scheduling Capabilities with Open Cluster Management Placement</h1><div class="td-byline mb-4">By <b>Qing Hao <a href=https://github.com/haoqing0110>@haoqing0110</a></b> |
<time datetime=2022-09-15 class=text-body-secondary>Thursday, September 15, 2022</time></div><p>Read more at <a href=https://cloud.redhat.com/blog/extending-the-multicluster-scheduling-capabilities-with-open-cluster-management-placement>Red Hat Cloud Blog</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-bdb85c652c92f04d83fafe1d6d09f3ba>è¯¦è§£ocm klusterletç§˜é’¥ç®¡ç†æœºåˆ¶</h1><div class="td-byline mb-4">By <b>é‚±è§ <a href=https://github.com/qiujian16>@qiujian16</a></b> |
<time datetime=2022-04-25 class=text-body-secondary>Monday, April 25, 2022</time></div><h2 id=æ¦‚è¿°>æ¦‚è¿°</h2><p>åœ¨<code>open-cluster-management</code>ä¸­ï¼Œä¸ºäº†ä½¿æ§åˆ¶é¢æœ‰æ›´å¥½çš„å¯æ‰©å±•æ€§ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<code>hub-spoke</code>çš„æ¶æ„ï¼šå³é›†ä¸­çš„æ§åˆ¶é¢ï¼ˆhubåª
è´Ÿè´£å¤„ç†æ§åˆ¶é¢çš„èµ„æºå’Œæ•°æ®è€Œæ— éœ€è®¿é—®è¢«ç®¡ç†çš„é›†ç¾¤ï¼›æ¯ä¸ªè¢«ç®¡ç†é›†ç¾¤ï¼ˆspokeï¼‰è¿è¡Œä¸€ä¸ªç§°ä¸º<code>klusterlet</code>çš„agentè®¿é—®æ§åˆ¶é¢è·å–
éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<code>klusterlet</code>éœ€è¦æ‹¥æœ‰è®¿é—®<code>hub</code>é›†ç¾¤çš„ç§˜é’¥æ‰èƒ½å’Œ<code>hub</code>å®‰å…¨é€šä¿¡ã€‚ç¡®ä¿ç§˜é’¥çš„å®‰å…¨æ€§æ˜¯éå¸¸é‡è¦çš„ï¼Œ
å› ä¸ºå¦‚æœè¿™ä¸ªç§˜é’¥è¢«æ³„éœ²çš„è¯æœ‰å¯èƒ½å¯¼è‡´å¯¹hubé›†ç¾¤çš„æ¶æ„è®¿é—®æˆ–è€…çªƒå–æ•æ„Ÿä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯å½“<code>ocm</code>çš„è¢«ç®¡ç†é›†ç¾¤åˆ†å¸ƒåœ¨ä¸åŒçš„å…¬æœ‰äº‘ä¸­çš„æ—¶å€™ã€‚
ä¸ºäº†ä¿è¯ç§˜é’¥çš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬éœ€è¦æ»¡è¶³ä¸€äº›ç‰¹å®šçš„éœ€æ±‚ï¼š</p><ol><li>å°½é‡é¿å…ç§˜é’¥åœ¨å…¬æœ‰ç½‘ç»œä¸­çš„ä¼ è¾“</li><li>ç§˜é’¥çš„åˆ·æ–°å’ŒåºŸé™¤</li><li>ç»†ç²’åº¦çš„æƒé™æ§åˆ¶</li></ol><p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»<code>ocm</code>æ˜¯å¦‚ä½•å®ç°ç§˜é’¥çš„ç®¡ç†æ¥ä¿è¯æ§åˆ¶é¢æ¿å’Œè¢«ç®¡ç†é›†ç¾¤ä¹‹é—´çš„å®‰å…¨è®¿é—®çš„ã€‚</p><h2 id=æ¶æ„å’Œæœºåˆ¶>æ¶æ„å’Œæœºåˆ¶</h2><p>åœ¨ocmä¸­æˆ‘ä»¬é‡‡ç”¨äº†ä»¥ä¸‹å‡ ä¸ªæœºåˆ¶æ¥ç¡®ä¿æ§åˆ¶é¢å’Œè¢«ç®¡ç†é›†ç¾¤ä¹‹é—´è®¿é—®çš„å®‰å…¨æ€§ï¼š</p><ol><li>åŸºäº<code>CertificateSigniningRequest</code>çš„mutual tls</li><li>åŒå‘æ¡æ‰‹åè®®å’ŒåŠ¨æ€<code>klusterlet</code>ID</li><li>è®¤è¯å’Œæˆæƒçš„åˆ†ç¦»</li></ol><h3 id=åŸºäºcertificatesigniningrequestçš„mutual-tls>åŸºäº<code>CertificateSigniningRequest</code>çš„mutual tls</h3><p>ä½¿ç”¨<code>kubernetes</code>çš„<code>CertificateSigniningRequest</code>ï¼ˆ<a href=https://kubernetes.io/docs/reference/access-authn-authz/certificate-signing-requests/>CSR</a>ï¼‰APIå¯ä»¥æ–¹ä¾¿çš„ç”Ÿæˆå®¢æˆ·è®¤è¯è¯ä¹¦ã€‚è¿™ä¸ªæœºåˆ¶å¯ä»¥è®©<code>klusterlet</code>åœ¨ç¬¬ä¸€æ¬¡
å¯åŠ¨è®¿é—®<code>hub</code>é›†ç¾¤æ—¶ä½¿ç”¨ä¸€ä¸ªæƒé™å¾ˆå°çš„ç§˜é’¥æ¥åˆ›å»ºCSRã€‚å½“CSRè¿”å›äº†ç”Ÿæˆçš„è¯ä¹¦åï¼Œ<code>klusterlet</code>å°±å¯ä»¥ç”¨åç»­ç”Ÿæˆçš„å¸¦æœ‰æ›´å¤§è®¿é—®æƒé™çš„
è¯ä¹¦æ¥è®¿é—®<code>hub</code>é›†ç¾¤ã€‚åœ¨ä½¿ç”¨csrçš„è¿‡ç¨‹ä¸­ï¼Œ<code>klusterlet</code>çš„ç§é’¥ä¸ä¼šåœ¨ç½‘ç»œä¸­ä¼ è¾“è€Œæ˜¯ä¸€ç›´ä¿å­˜åœ¨è¢«ç®¡ç†é›†ç¾¤ä¸­ï¼›åªæœ‰CSRçš„å…¬é’¥å’Œåˆå§‹é˜¶æ®µéœ€è¦çš„
å°æƒé™ç§˜é’¥ï¼ˆbootstrap secretï¼‰ä¼šåœ¨ä¸åŒé›†ç¾¤é—´ä¼ è¾“ã€‚è¿™å°±æœ€å¤§ç¨‹åº¦çš„ä¿è¯ç§˜é’¥ä¸ä¼šåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«æ³„éœ²å‡ºå»ã€‚</p><h3 id=åŒå‘æ¡æ‰‹åè®®å’ŒåŠ¨æ€klusterletid>åŒå‘æ¡æ‰‹åè®®å’ŒåŠ¨æ€<code>klusterlet</code>ID</h3><p>é‚£ä¹ˆå¦‚æœåˆå§‹é˜¶æ®µçš„bootstrap secretè¢«æ³„éœ²äº†ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿè¿™å°±ç‰µæ¶‰åˆ°OCMä¸­çš„åŒå‘æ¡æ‰‹åè®®ã€‚å½“è¢«ç®¡ç†é›†ç¾¤ä¸­çš„<code>klusterlet</code>ä½¿ç”¨bootstrap secret
å‘èµ·äº†ç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™, hubé›†ç¾¤ä¸ä¼šç«‹åˆ»ä¸ºè¿™ä¸ªè¯·æ±‚åˆ›å»ºå®¢æˆ·è¯ä¹¦å’Œå¯¹åº”çš„è®¿é—®æƒé™ã€‚è¿™ä¸ªè¯·æ±‚å°†å¤„åœ¨<code>Pending</code>çŠ¶æ€ï¼Œç›´åˆ°hubé›†ç¾¤æ‹¥æœ‰ç‰¹å®šç®¡ç†æƒé™çš„ç®¡ç†å‘˜
åŒæ„äº†<code>klusterlet</code>çš„æ¥å…¥è¯·æ±‚åï¼Œå®¢æˆ·è¯ä¹¦å’Œç‰¹å®šæƒé™æ‰ä¼šè¢«åˆ›å»ºå‡ºæ¥ã€‚è¿™ä¸ªè¯·æ±‚ä¸­åŒ…å«äº†<code>klusterlet</code>å¯åŠ¨é˜¶æ®µç”Ÿæˆçš„åŠ¨æ€IDï¼Œç®¡ç†å‘˜éœ€è¦ç¡®ä¿è¿™ä¸ªIDå’Œè¢«
ç®¡ç†é›†ç¾¤ä¸Š<code>klusterlet</code>çš„IDä¸€è‡´æ‰èƒ½åŒæ„<code>klusterlet</code>çš„æ¥å…¥ã€‚è¿™ä¹Ÿå°±ç¡®ä¿äº†å¦‚æœbootstrap secretè¢«ä¸æ…æ³„éœ²åï¼ŒCSRä¹Ÿä¸ä¼šè¢«ç®¡ç†å‘˜è½»æ˜“çš„æ¥å—ã€‚</p><p><code>klusterlet</code>ä½¿ç”¨çš„å®¢æˆ·è¯ä¹¦æ˜¯æœ‰è¿‡æœŸæ—¶é—´çš„ï¼Œ<code>klusterlet</code>éœ€è¦åœ¨è¯ä¹¦è¿‡æœŸä¹‹å‰ä½¿ç”¨ç°æœ‰çš„å®¢æˆ·è¯ä¹¦å‘èµ·æ–°çš„<code>CSR</code>è¯·æ±‚æ¥è·å–æ–°çš„å®¢æˆ·è¯ä¹¦ã€‚<code>hub</code>é›†ç¾¤ä¼šæ£€éªŒ
æ›´æ–°è¯ä¹¦çš„<code>CSR</code>è¯·æ±‚æ˜¯å¦åˆæ³•å¹¶è‡ªåŠ¨ç­¾ç½²æ–°çš„å®¢æˆ·è¯ä¹¦ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ç”±äº<code>klusterlet</code>ä½¿ç”¨äº†åŠ¨æ€IDçš„æœºåˆ¶ï¼Œåªæœ‰<code>klusterlet</code>æœ¬èº«å‘èµ·çš„<code>CSR</code>è¯·æ±‚æ‰ä¼š
è¢«è‡ªåŠ¨ç­¾ç½²ã€‚å¦‚æœ<code>klusterlet</code>åœ¨é›†ç¾¤ä¸­è¢«å¸è½½ç„¶åé‡æ–°éƒ¨ç½²åï¼Œå®ƒå¿…é¡»é‡æ–°ä½¿ç”¨bootstrap secretæµç¨‹æ¥è·å–å®¢æˆ·è¯ä¹¦ã€‚</p><h3 id=è®¤è¯å’Œæˆæƒçš„åˆ†ç¦»>è®¤è¯å’Œæˆæƒçš„åˆ†ç¦»</h3><p>åœ¨<code>klusterlet</code>çš„<code>CSR</code>è¯·æ±‚è¢«æ¥å—åï¼Œå®ƒè·å¾—äº†è¢«<code>hub</code>é›†ç¾¤è®¤è¯é€šè¿‡çš„å®¢æˆ·è¯ä¹¦ï¼Œä½†æ˜¯å®ƒåœ¨è¿™ä¸ªæ—¶å€™è¿˜æ²¡æœ‰å¯¹<code>hub</code>é›†ç¾¤ä¸Šç‰¹å®šèµ„æºè®¿é—®çš„æƒé™ã€‚
<code>ocm</code>ä¸­è¿˜æœ‰ä¸€ä¸ªå•ç‹¬çš„æˆæƒæµç¨‹ã€‚æ¯ä¸ªè¢«ç®¡ç†é›†ç¾¤çš„<code>klusterlet</code>æ—¶å€™æœ‰æƒé™è®¿é—®<code>hub</code>é›†ç¾¤çš„ç‰¹å®šèµ„æºæ˜¯è¢«å¯¹åº”<code>ManagedCluster</code>APIä¸Šçš„
<code>hubAcceptsClient</code>åŸŸæ¥æ§åˆ¶çš„ã€‚åªæœ‰å½“è¿™ä¸ªåŸŸè¢«ç½®ä½<code>true</code>æ—¶ï¼Œ<code>hub</code>é›†ç¾¤çš„æ§åˆ¶å™¨æ‰ä¼šä¸ºå¯¹åº”<code>klusterlet</code>èµ‹äºˆæƒé™ã€‚è€Œè®¾ç½®è¿™ä¸ªåŸŸéœ€è¦ç”¨æˆ·
åœ¨<code>hub</code>é›†ç¾¤ä¸­å¯¹<code>managedcluster/accept</code>å…·æœ‰<code>update</code>æƒé™æ‰å¯ä»¥ã€‚å¦‚ä¸‹é¢çš„<code>clusterrole</code>çš„ä¾‹å­è¡¨ç¤ºç”¨æˆ·åªèƒ½å¯¹<code>cluster1</code>è¿™ä¸ª
<code>ManagedCluster</code>ä¸Šçš„<code>klusterlet</code>èµ‹äºˆæƒé™ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management:hub</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;register.open-cluster-management.io&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;managedclusters/accept&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;update&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceNames</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;cluster1&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>å°†è®¤è¯å’Œæˆæƒçš„æµç¨‹åˆ†å¼€çš„åŸå› æ˜¯é€šå¸¸æƒ…å†µä¸‹<code>hub</code>é›†ç¾¤å…·æœ‰<code>approve CSR</code>æƒé™çš„ç”¨æˆ·å’Œ"å…è®¸klusterletæ¥å…¥hub"é›†ç¾¤çš„ç”¨æˆ·å¹¶ä¸å®Œå…¨ä¸€è‡´ã€‚ä»¥ä¸Š
æœºåˆ¶å°±å¯ä»¥ä¿è¯å³ä½¿ç”¨æˆ·æ‹¥æœ‰<code>approve CSR</code>çš„æƒé™ä¹Ÿä¸èƒ½ç»™ä»»æ„çš„<code>klusterlet</code>èµ‹äºˆæ¥å…¥<code>hub</code>é›†ç¾¤çš„æƒé™ã€‚</p><h2 id=å®ç°ç»†èŠ‚>å®ç°ç»†èŠ‚</h2><p>æ‰€æœ‰è®¤è¯æˆæƒå’Œç§˜é’¥ç®¡ç†çš„ä»£ç å®ç°éƒ½åœ¨<a href=https://github.com/open-cluster-management-io/ocm/tree/main/cmd/registration>registration</a>ç»„ä»¶ä¸­ã€‚å¤§æ¦‚çš„æµç¨‹
å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src=/blog/2022/%E8%AF%A6%E8%A7%A3ocm-klusterlet%E7%A7%98%E9%92%A5%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6/assets/registration-process.png alt></p><p>å½“<code>registration-agent</code>åœ¨è¢«ç®¡ç†é›†ç¾¤ä¸­å¯åŠ¨åï¼Œä¼šé¦–å…ˆåœ¨è‡ªå·±çš„<code>namespace</code>é‡ŒæŸ¥æ‰¾æ˜¯å¦æœ‰<code>hub-kubeconfig</code>çš„ç§˜é’¥å¹¶éªŒè¯è¿™ä¸ªç§˜é’¥æ˜¯å¦åˆæ³•ã€‚
å¦‚æœä¸å­˜åœ¨æˆ–è€…ä¸åˆæ³•ï¼Œ<code>registration-agent</code>å°±è¿›å…¥äº†bootstrapæµç¨‹ï¼Œå®ƒä¼šé¦–å…ˆäº§ç”Ÿä¸€ä¸ªåŠ¨æ€çš„<code>agent ID</code>, ç„¶åä½¿ç”¨ä¸€ä¸ªæ›´å°æƒé™çš„
<code>bootstrap-kubeconfig</code>æ¥åˆ›å»ºclientå’Œinformerï¼Œæ¥ä¸‹æ¥å¯åŠ¨ä¸€ä¸ª<code>ClientCertForHubController</code>çš„goroutineã€‚è¿™ä¸ªcontrollerä¼šåœ¨hubé›†ç¾¤
åˆ›å»ºCSR,ç­‰å¾…CSRä¸­ç­¾ç½²çš„è¯ä¹¦å¹¶æœ€ç»ˆæŠŠè¯ä¹¦å’Œç§é’¥åšä¸ºåä¸º<code>hub-kubeconfig</code>çš„ç§˜é’¥æŒä¹…åŒ–åœ¨è¢«ç®¡ç†é›†ç¾¤ä¸­ã€‚agentæ¥ç€æŒç»­ç›‘æ§<code>hub-kubeconfig</code>
è¿™ä¸ªç§˜é’¥æ˜¯å¦å·²ç»è¢«æŒä¹…åŒ–ã€‚å½“agentå‘ç°<code>hub-kubeconfig</code>åˆ™æ„å‘³ç€agentå·²ç»è·å–åˆ°äº†å¯ä»¥è®¿é—®<code>hub</code>é›†ç¾¤çš„å®¢æˆ·è¯ä¹¦ï¼Œagentå°±ä¼šåœæ‰ä¹‹å‰çš„controllerå¹¶
é€€å‡ºbootstrapæµç¨‹ã€‚æ¥ä¸‹æ¥agentä¼šé‡æ–°ç”¨<code>hub-kubeconfig</code>åˆ›å»ºclientå’Œinformerï¼Œå¹¶å¯åŠ¨ä¸€ä¸ªæ–°çš„<code>ClientCertForHubController</code>çš„goroutine
æ¥å®šæœŸåˆ·æ–°å®¢æˆ·è¯ä¹¦ã€‚</p><p>åœ¨hubé›†ç¾¤ä¸­çš„<code>registration-controller</code>ä¼šå¯åŠ¨<code>CSRApprovingController</code>ç”¨æ¥è´Ÿè´£æ£€æŸ¥<code>klusterlet</code>å‘èµ·çš„CSRè¯·æ±‚æ˜¯å¦å¯ä»¥è‡ªåŠ¨ç­¾å‘ï¼›ä»¥åŠ
<code>managedClusterController</code>ç”¨æ¥æ£€æŸ¥å¯¹åº”<code>ManagedCluster</code>ä¸Šçš„<code>hubAccepctsClient</code>åŸŸæ˜¯å¦è¢«è®¾ç½®å¹¶åœ¨<code>hub</code>é›†ç¾¤ä¸­åˆ›å»ºç›¸åº”çš„æƒé™ã€‚</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e47cc96fd834566eec3252a197439295>é€šè¿‡OCMè®¿é—®ä¸åŒVPCä¸‹çš„é›†ç¾¤</h1><div class="td-byline mb-4">By <b>è–›æ˜­ <a href=https://github.com/xuezhaojun>@xuezhaojun</a></b> |
<time datetime=2022-04-20 class=text-body-secondary>Wednesday, April 20, 2022</time></div><h2 id=é—®é¢˜èƒŒæ™¯>é—®é¢˜èƒŒæ™¯</h2><p>å½“æˆ‘ä»¬æ‹¥æœ‰å¤šä¸ªé›†ç¾¤æ—¶ï¼Œä¸€ä¸ªå¾ˆå¸¸è§çš„éœ€æ±‚æ˜¯ï¼šä¸åŒçš„ç”¨æˆ·å¸Œæœ›èƒ½è®¿é—®ä½äºä¸åŒVPCä¸‹çš„é›†ç¾¤ã€‚æ¯”å¦‚ï¼Œå¼€å‘äººå‘˜å¸Œæœ›èƒ½å¤Ÿåœ¨æµ‹è¯•é›†ç¾¤éƒ¨ç½²åº”ç”¨ï¼Œæˆ–è€…è¿ç»´äººå‘˜å¸Œæœ›èƒ½å¤Ÿåœ¨ç”Ÿäº§é›†ç¾¤ä¸Šè¿›è¡Œæ•…éšœæ’æŸ¥ã€‚</p><p>ä½œä¸ºå¤šä¸ªé›†ç¾¤çš„ç®¡ç†å‘˜ï¼Œä¸ºäº†å®ç°è¯¥éœ€æ±‚ï¼Œéœ€è¦åœ¨å„ä¸ªé›†ç¾¤ä¸ºç”¨æˆ·ï¼š</p><ol><li>ç»‘å®šRoleã€‚</li><li>æä¾›è®¿é—®é…ç½®ï¼ˆè¯ä¹¦æˆ–Tokenï¼‰ã€‚</li><li>æä¾›è®¿é—®å…¥å£ã€‚</li></ol><p>ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>ç½‘ç»œéš”ç¦»ï¼šé›†ç¾¤ä½äºç§æœ‰æ•°æ®ä¸­å¿ƒï¼Œé‚£ä¹ˆç®¡ç†å‘˜å°±éœ€è¦ä¸ºé›†ç¾¤ç”¨æˆ·è¿›è¡Œç‰¹æ®Šçš„ç½‘ç»œé…ç½®ï¼Œæ¯”å¦‚å»ºç«‹VPNæˆ–è€…è·³æ¿æœºã€‚</li><li>ç½‘ç»œå®‰å…¨ï¼šä¸ºç”¨æˆ·æš´éœ²çš„é›†ç¾¤ç«¯å£ï¼Œä¼šå¢åŠ é›†ç¾¤çš„å®‰å…¨é£é™©ã€‚</li><li>é…ç½®è¿‡æœŸï¼šè¯ä¹¦ä¸­çš„ç§˜é’¥å’ŒTokenéƒ½æœ‰è¿‡æœŸæ—¶é—´ï¼Œç®¡ç†å‘˜éœ€è¦å®šæœŸä¸ºç”¨æˆ·åšé…ç½®æ›´æ–°ã€‚</li></ul><p>è€Œé€šè¿‡å®‰è£…OCMä»¥åŠcluster-proxyï¼Œmanaged-serviceaccountä¸¤ä¸ªæ’ä»¶ï¼Œç®¡ç†å‘˜åˆ™å¯ä»¥åœ¨ä¸æš´éœ²é›†ç¾¤ç«¯å£çš„æƒ…å†µä¸‹ï¼Œä¸ºä¸åŒç”¨æˆ·æä¾›ç»Ÿä¸€è®¿é—®å…¥å£ï¼Œå¹¶æ–¹ä¾¿åœ°ç®¡ç†ä¸åŒç”¨æˆ·çš„è®¿é—®æƒé™ã€‚</p><h2 id=åŸºæœ¬æ¦‚å¿µ>åŸºæœ¬æ¦‚å¿µ</h2><p>ä»¥ä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è§£é‡ŠOCMä»¥åŠcluster-proxyï¼Œmanaged-serviceaccountçš„åŸºæœ¬æ¦‚å¿µã€‚</p><p>å‡è®¾æˆ‘ä»¬æœ‰3ä¸ªé›†ç¾¤ï¼Œåˆ†åˆ«ä½äºä¸¤ä¸ªä¸åŒçš„VPCä¸­ï¼Œå…¶ä¸­VPC-1ä¸­çš„é›†ç¾¤å¯ä»¥è¢«æ‰€æœ‰ç”¨æˆ·è®¿é—®ï¼Œè€ŒVPC-2ä¸­çš„2ä¸ªé›†ç¾¤åªèƒ½è¢«ç®¡ç†å‘˜è®¿é—®ã€‚</p><p>ç®¡ç†å‘˜å¸Œæœ›é€šè¿‡VPC-1ä¸­çš„é›†ç¾¤ï¼ˆåæ–‡ç§°â€œç®¡ç†é›†ç¾¤â€ï¼‰ä¸ºç”¨æˆ·æä¾›ç»Ÿä¸€çš„è®¿é—®å…¥å£ï¼Œä½¿ç”¨æˆ·å¯ä»¥è®¿é—®VPC-2ä¸­çš„é›†ç¾¤ï¼ˆåæ–‡ç§°â€œå—ç®¡é›†ç¾¤â€ï¼‰ã€‚</p><p><img src=/blog/2022/%E9%80%9A%E8%BF%87ocm%E8%AE%BF%E9%97%AE%E4%B8%8D%E5%90%8Cvpc%E4%B8%8B%E7%9A%84%E9%9B%86%E7%BE%A4/assets/diagram-1.png alt></p><h3 id=ocmæ˜¯ä»€ä¹ˆ>OCMæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>OCM å…¨ç§°ä¸º Open Cluster Managementï¼Œæ—¨åœ¨è§£å†³å¤šé›†ç¾¤åœºæ™¯ä¸‹çš„é›†ç¾¤æ³¨å†Œç®¡ç†ï¼Œå·¥ä½œè´Ÿè½½åˆ†å‘ï¼Œä»¥åŠåŠ¨æ€çš„èµ„æºé…ç½®ç­‰åŠŸèƒ½ã€‚</p><p>å®‰è£…OCMä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å°†å—ç®¡é›†ç¾¤æ³¨å†ŒåŠ å…¥ç®¡ç†é›†ç¾¤ï¼Œå®Œæˆæ³¨å†Œåï¼Œåœ¨ç®¡ç†é›†ç¾¤ä¸­ä¼šåˆ›å»ºä¸€ä¸ªä¸å—ç®¡é›†ç¾¤æ³¨å†Œåç›¸åŒçš„å‘½åç©ºé—´ã€‚æ¯”å¦‚ï¼Œå—ç®¡é›†ç¾¤ä»¥cluster1æ³¨å†Œåˆ°ç®¡ç†é›†ç¾¤ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹åº”åˆ›å»ºä¸€ä¸ªåä¸ºcluster1çš„å‘½åç©ºé—´ã€‚åœ¨ç®¡ç†é›†ç¾¤ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›ä¸åŒçš„å‘½ä»¤ç©ºé—´æ¥åŒºåˆ†å¤šä¸ªå—ç®¡é›†ç¾¤çš„èµ„æºã€‚</p><p>æ³¨å†Œè¿‡ç¨‹ä¸è¦æ±‚å—ç®¡é›†ç¾¤å‘ç®¡ç†é›†ç¾¤æš´éœ²è®¿é—®æ¥å£ã€‚</p><p><img src=/blog/2022/%E9%80%9A%E8%BF%87ocm%E8%AE%BF%E9%97%AE%E4%B8%8D%E5%90%8Cvpc%E4%B8%8B%E7%9A%84%E9%9B%86%E7%BE%A4/assets/diagram-2.png alt></p><p>æ›´å¤šæœ‰å…³äºOCMçš„æ¶æ„ç»†èŠ‚ï¼Œè¯·å‚è€ƒ<a href=https://open-cluster-management.io/docs/concepts/architecture/>å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><h3 id=cluster-proxyæ˜¯ä»€ä¹ˆ>cluster-proxyæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>cluster-proxyæ˜¯ä½¿ç”¨OCMçš„<a href=https://github.com/open-cluster-management-io/addon-framework>addon-framework</a>å®ç°çš„ä¸€ä¸ªåŸºäº <a href=https://github.com/kubernetes-sigs/apiserver-network-proxy>apiserver-network-proxy</a>ï¼ˆåæ–‡ç®€å†™ä¸ºï¼šANPï¼‰çš„æ’ä»¶ã€‚æ’ä»¶å®‰è£…åï¼Œä¼šåœ¨ç®¡ç†é›†ç¾¤ä¸Šå®‰è£…ANPçš„ç»„ä»¶proxy-serverï¼Œåœ¨å—ç®¡é›†ç¾¤ä¸Šå®‰è£…ANPçš„ç»„ä»¶proxy-agentã€‚</p><p>æ¥ç€proxy-agenté€šè¿‡ç®¡ç†é›†ç¾¤ä¸Šæš´éœ²çš„ç«¯å£ï¼Œå‘proxy-serverå‘é€æ³¨å†Œè¯·æ±‚ï¼Œå¹¶å»ºç«‹ä¸€æ¡å…¨åŒå·¥é€šä¿¡çš„GRPCç®¡é“ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œcluster-proxyå»ºç«‹çš„GRPCé€šé“åªæ˜¯ä¿è¯äº†ç®¡ç†é›†ç¾¤åˆ°è¢«ç®¡ç†é›†ç¾¤çš„ç½‘ç»œè¿é€šæ€§ï¼Œå¦‚æœç”¨æˆ·æƒ³è®¿é—®è¢«ç®¡ç†é›†ç¾¤çš„APIServeræˆ–è€…å…¶ä»–æœåŠ¡ï¼Œä»éœ€è¦ä»è¢«ç®¡ç†é›†ç¾¤è·å¾—ç›¸åº”çš„è®¤è¯ç§˜é’¥å’Œæƒé™ã€‚</p><p><img src=/blog/2022/%E9%80%9A%E8%BF%87ocm%E8%AE%BF%E9%97%AE%E4%B8%8D%E5%90%8Cvpc%E4%B8%8B%E7%9A%84%E9%9B%86%E7%BE%A4/assets/diagram-3.png alt></p><p>æ›´å¤šæœ‰å…³cluster-proxyçš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒ<a href=https://open-cluster-management.io/docs/getting-started/integration/cluster-proxy/>å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><h3 id=managed-serviceaccountæ˜¯ä»€ä¹ˆ>managed-serviceaccountæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>Managed-serviceaccountï¼ˆåæ–‡ç®€å†™ä¸ºï¼šMSAï¼‰ä¹Ÿæ˜¯åˆ©ç”¨OCMçš„<a href=https://github.com/open-cluster-management-io/addon-framework>addon-framework</a>å®ç°çš„æ’ä»¶ã€‚</p><p>å®‰è£…è¯¥æ’ä»¶åï¼Œå¯ä»¥åœ¨ç®¡ç†é›†ç¾¤ä¸Šé…ç½®<code>ManagedServiceAcccount</code>çš„CRï¼Œæ’ä»¶ä¼šæ ¹æ®æ­¤CRçš„<code>spec</code>é…ç½®ï¼Œåœ¨ç›®æ ‡å—ç®¡é›†ç¾¤çš„<code>open-cluster-management-managed-serviceaccount</code>å‘½åç©ºé—´å†…ï¼Œåˆ›å»ºä¸€ä¸ªä¸CRåŒåçš„<code>ServiceAccount</code>ã€‚</p><p>æ¥ç€æ’ä»¶ä¼šå°†æ­¤<code>ServiceAccount</code>ç”Ÿæˆçš„å¯¹åº”tokenæ•°æ®åŒæ­¥å›ç®¡ç†é›†ç¾¤ï¼Œå¹¶åœ¨å—ç®¡é›†ç¾¤çš„å‘½ä»¤ç©ºé—´ä¸­åˆ›å»ºä¸€ä¸ªåŒåçš„<code>Secret</code>ï¼Œç”¨äºä¿å­˜è¯¥tokenã€‚æ•´ä¸ªtokençš„æ•°æ®åŒæ­¥éƒ½æ˜¯åœ¨OCMæä¾›çš„MTLSè¿æ¥ä¸­è¿›è¡Œï¼Œä»è€Œç¡®ä¿tokenä¸ä¼šè¢«ç¬¬ä¸‰æ–¹æ¢æŸ¥åˆ°ã€‚</p><p>ç”±æ­¤é›†ç¾¤ç®¡ç†å‘˜å¯ä»¥åœ¨hubä¸Šé€šè¿‡MSAæ¥è·å¾—è®¿é—®è¢«ç®¡ç†é›†ç¾¤APIServerçš„tokenã€‚å½“ç„¶è¿™ä¸ªtokenç°åœ¨è¿˜æ²¡æœ‰è¢«èµ‹äºˆæƒé™ï¼Œåªè¦ç®¡ç†å‘˜ä¸ºè¯¥tokenç»‘å®šç›¸åº”çš„Roleï¼Œå°±å¯ä»¥å®ç°è®¿é—®è¢«ç®¡ç†é›†ç¾¤çš„æƒé™æ§åˆ¶ã€‚</p><p><img src=/blog/2022/%E9%80%9A%E8%BF%87ocm%E8%AE%BF%E9%97%AE%E4%B8%8D%E5%90%8Cvpc%E4%B8%8B%E7%9A%84%E9%9B%86%E7%BE%A4/assets/diagram-4.png alt></p><p>æ›´å¤šæœ‰å…³managed-serviceaccountçš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒ<a href=https://open-cluster-management.io/docs/getting-started/integration/managed-serviceaccount/>å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><h2 id=æ ·ä¾‹>æ ·ä¾‹</h2><p>æ¥ä¸‹æ¥é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨OCMï¼Œcluster-proxyï¼Œmanaged-serviceaccountæ¥å®ç°è·¨VPCè®¿é—®é›†ç¾¤ã€‚</p><p>é¦–å…ˆä»ç®¡ç†å‘˜è§†è§’ï¼Œæˆ‘ä»¬é€šè¿‡è„šæœ¬å¿«é€Ÿåˆ›å»ºä¸€ä¸ªåŸºäº<a href=https://kind.sigs.k8s.io/>kind</a>çš„å¤šé›†ç¾¤ç¯å¢ƒï¼Œå…¶ä¸­å…·æœ‰ä¸€ä¸ªç®¡ç†é›†ç¾¤ï¼ˆhubï¼‰ï¼Œä»¥åŠä¸¤ä¸ªå—ç®¡é›†ç¾¤ï¼ˆcluster1, cluster2ï¼‰ã€‚å¹¶ä¸” cluster1, cluster2 ä¼šé€šè¿‡ OCM æ³¨å†Œåˆ°äº† hubã€‚</p><p>è¯¥è„šæœ¬è¿˜ä¼šä¸ºæˆ‘ä»¬å®‰è£…OCMçš„CLIå·¥å…·<a href=https://github.com/open-cluster-management-io/clusteradm>clusteradm</a>ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -L &lt;https://raw.githubusercontent.com/open-cluster-management-io/OCM/main/solutions/setup-dev-environment/local-up.sh&gt; <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><p>ç„¶åï¼Œç®¡ç†å‘˜è¿˜éœ€è¦å®‰è£…ä¸¤ä¸ªæ’ä»¶ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># å®‰è£… cluster-proxy</span>
</span></span><span style=display:flex><span>helm install <span style=color:#4e9a06>\\</span>
</span></span><span style=display:flex><span>    -n open-cluster-management-addon --create-namespace <span style=color:#4e9a06>\\</span>
</span></span><span style=display:flex><span>    cluster-proxy ocm/cluster-proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># å®‰è£… managed-service</span>
</span></span><span style=display:flex><span>helm install <span style=color:#4e9a06>\\</span>
</span></span><span style=display:flex><span>    -n open-cluster-management-addon --create-namespace <span style=color:#4e9a06>\\</span>
</span></span><span style=display:flex><span>    managed-serviceaccount ocm/managed-serviceaccount
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># éªŒè¯ cluster-proxy å·²å®‰è£…</span>
</span></span><span style=display:flex><span>clusteradm get addon cluster-proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># éªŒè¯ managed-serviceaccount å·²å®‰è£…</span>
</span></span><span style=display:flex><span>clusteradm get addon managed-serviceaccount
</span></span></code></pre></div><p>å®Œæˆå®‰è£…åï¼Œç®¡ç†å‘˜å¸Œæœ›ç»™ç”¨æˆ·èƒ½å¤Ÿè®¿é—®cluster1ï¼Œä»–éœ€è¦é€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªåœ¨hubçš„å‘½ä»¤ç©ºé—´cluster1ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªMSAçš„CRï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f - <span style=color:#4e9a06>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: authentication.open-cluster-management.io/v1alpha1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ManagedServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: dep
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: cluster1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  rotation: {}
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># æ£€æŸ¥Tokenæ˜¯å¦å·²åŒæ­¥å›ç®¡ç†é›†ç¾¤hubï¼Œå¹¶ä¿å­˜ä¸ºåä¸ºdepçš„Secret</span>
</span></span><span style=display:flex><span>kubectl get secret -n cluster1
</span></span><span style=display:flex><span>NAME                  TYPE                                  DATA   AGE
</span></span><span style=display:flex><span>default-token-r89gs   kubernetes.io/service-account-token   <span style=color:#0000cf;font-weight:700>3</span>      6d22h
</span></span><span style=display:flex><span>dep                   Opaque                                <span style=color:#0000cf;font-weight:700>2</span>      6d21h
</span></span></code></pre></div><p>æ¥ç€ï¼Œç®¡ç†å‘˜éœ€è¦é€šè¿‡OCMçš„<a href=https://open-cluster-management.io/docs/concepts/work-distribution/manifestwork/>Manifestwork</a>, å³å·¥ä½œè´Ÿè½½åˆ†å‘åŠŸèƒ½ï¼Œåœ¨cluster1ä¸Šåˆ›å»ºä¸€ä¸ª<code>ClusterRole</code>ï¼Œç»™depç»‘å®šäº†cluster1ä¸Šçš„å¯¹åº”æƒé™ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># åˆ›å»ºClusterRole, ä»…å…·æœ‰æ“ä½œDeploymentçš„æƒé™</span>
</span></span><span style=display:flex><span>clusteradm create work dep-role --cluster cluster1 -f - <span style=color:#4e9a06>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ClusterRole
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: dep-role
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>rules:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>- apiGroups: [&#34;apps&#34;]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  resources: [&#34;deployments&#34;]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  verbs: [&#34;get&#34;, &#34;watch&#34;, &#34;list&#34;, &#34;create&#34;, &#34;update&#34;, &#34;patch&#34;, &#34;delete&#34;]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ç»‘å®šClusterRole</span>
</span></span><span style=display:flex><span>clusteradm create work dep-rolebinding --cluster cluster1 -f - <span style=color:#4e9a06>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ClusterRoleBinding
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: dep-rolebinding
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>roleRef:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  apiGroup: rbac.authorization.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  kind: ClusterRole
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: dep-role
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>subjects:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    name: dep
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    namespace: open-cluster-management-managed-serviceaccount
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>å®Œæˆä¹‹åï¼Œç”¨æˆ·ä¾¿å¯ä»¥é€šè¿‡cluteradmï¼Œæ¥æ“ä½œcluster1ä¸Š<code>Deployments</code>äº†ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>clusteradm proxy kubectl --cluster<span style=color:#ce5c00;font-weight:700>=</span>cluster1 --sa<span style=color:#ce5c00;font-weight:700>=</span>dep -i
</span></span><span style=display:flex><span>Please enter the kubectl <span style=color:#204a87>command</span> and use <span style=color:#4e9a06>&#34;exit&#34;</span> to quit the interactive mode
</span></span><span style=display:flex><span>kubectl&gt; get deployments -A
</span></span><span style=display:flex><span>NAMESPACE                                        NAME                                 READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>kube-system                                      coredns                              2/2     <span style=color:#0000cf;font-weight:700>2</span>            <span style=color:#0000cf;font-weight:700>2</span>           20d
</span></span><span style=display:flex><span>local-path-storage                               local-path-provisioner               1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           20d
</span></span><span style=display:flex><span>open-cluster-management-agent                    klusterlet-registration-agent        1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           20d
</span></span><span style=display:flex><span>open-cluster-management-agent                    klusterlet-work-agent                1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           20d
</span></span><span style=display:flex><span>open-cluster-management-cluster-proxy            cluster-proxy-proxy-agent            3/3     <span style=color:#0000cf;font-weight:700>3</span>            <span style=color:#0000cf;font-weight:700>3</span>           20d
</span></span><span style=display:flex><span>open-cluster-management-managed-serviceaccount   managed-serviceaccount-addon-agent   1/1     <span style=color:#0000cf;font-weight:700>1</span>            <span style=color:#0000cf;font-weight:700>1</span>           20d
</span></span><span style=display:flex><span>open-cluster-management                          klusterlet                           3/3     <span style=color:#0000cf;font-weight:700>3</span>            <span style=color:#0000cf;font-weight:700>3</span>           20d
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ç”¨æˆ·æ²¡æœ‰æƒé™è®¿é—®cluster1ä¸Šçš„podsï¼Œè¯·æ±‚è¢«æ‹’ç»</span>
</span></span><span style=display:flex><span>kubectl&gt; get pods -A
</span></span><span style=display:flex><span>Error from server <span style=color:#ce5c00;font-weight:700>(</span>Forbidden<span style=color:#ce5c00;font-weight:700>)</span>: pods is forbidden: User <span style=color:#4e9a06>&#34;system:serviceaccount:open-cluster-management-managed-serviceaccount:dep&#34;</span> cannot list resource <span style=color:#4e9a06>&#34;pods&#34;</span> in API group <span style=color:#4e9a06>&#34;&#34;</span> at the cluster scope
</span></span></code></pre></div><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸ºä½¿ç”¨<code>clusteradm</code>è®¿é—®cluster1, è¿˜éœ€è¦ä¸ºç”¨æˆ·é…ç½®äº†ä»¥ä¸‹æƒé™ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># è·å–MSAçš„token</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Role</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;secrets&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;get&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;authentication.open-cluster-management.io&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;managedserviceaccounts&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;get&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># é€šè¿‡portforwardçš„åœ¨æœ¬åœ°æ˜ å°„cluster-proxyçš„Service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Role</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user-cluster-proxy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>open-cluster-management-cluster-proxy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;pods&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;get&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;list&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;pods/portforward&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;create&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># è¿è¡Œå‘½ä»¤å‰å¯¹ç›¸å…³Resourceè¿›è¡Œæ£€æŸ¥</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rbac.authorization.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;cluster.open-cluster-management.io&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;managedclusters&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;get, &#34;</span><span style=color:#000>list&#34;]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;addon.open-cluster-management.io&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;clustermanagementaddons&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;get&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>apiGroups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;proxy.open-cluster-management.io&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;managedproxyconfigurations&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>verbs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;get&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=æ€»ç»“>æ€»ç»“</h2><p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨OCMæ¥ä¸ºç”¨æˆ·æä¾›è®¿é—®ä¸åŒVPCä¸‹é›†ç¾¤çš„åŠŸèƒ½ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œç®¡ç†å‘˜ä¸å†éœ€è¦å¯¹é›†ç¾¤ç½‘ç»œè¿›è¡Œç‰¹æ®Šé…ç½®ï¼Œä¹Ÿä¸å†éœ€è¦ä¸ºç”¨æˆ·æä¾›å’Œç»´æŠ¤å¤šä¸ªé›†ç¾¤çš„è®¿é—®å‡­è¯ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½é€šè¿‡ç»Ÿä¸€çš„è®¿é—®æ¥å£è®¿é—®å„ä¸ªé›†ç¾¤ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œæ˜“ç”¨æ€§ã€‚</p><p>ç›®å‰ï¼ŒOCMçš„<code>cluster-proxy</code>å’Œ<code>managed-serviceaccount</code>åŠŸèƒ½è¿˜å¤„äºåˆæœŸé˜¶æ®µï¼Œæœªæ¥æˆ‘ä»¬è¿˜ä¸æ–­çš„å®Œå–„å…¶åŠŸèƒ½ï¼Œæ¬¢è¿å¤§å®¶è¯•ç”¨å¹¶æå‡ºå®è´µçš„æ„è§å’Œå»ºè®®ã€‚</p></div><div class=td-content style=page-break-before:always><h1 id=pg-859fbabac8a015dfbf92d10a8e7bb555>Using the Open Cluster Management Placement for Multicluster Scheduling</h1><div class="td-byline mb-4"><time datetime=2022-01-12 class=text-body-secondary>Wednesday, January 12, 2022</time></div><p>Read more at <a href=https://cloud.redhat.com/blog/using-the-open-cluster-management-placement-for-multicluster-scheduling>Red Hat Cloud Blog</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-25491c199a7bdd0dd25b1cfd2cf2e8b9>Using the Open Cluster Management Add-on Framework to Develop a Managed Cluster Add-on</h1><div class="td-byline mb-4"><time datetime=2021-10-12 class=text-body-secondary>Tuesday, October 12, 2021</time></div><p>Read more at <a href=https://cloud.redhat.com/blog/using-the-open-cluster-management-add-on-framework-to-develop-a-managed-cluster-add-on>Red Hat Cloud Blog</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-31ca460fc70daa6787626171e94fab9d>The Next Kubernetes Frontier: Multicluster Management</h1><div class="td-byline mb-4"><time datetime=2021-09-22 class=text-body-secondary>Wednesday, September 22, 2021</time></div><p>Read more at <a href=https://containerjournal.com/features/the-next-kubernetes-frontier-multicluster-management/>Container Journal</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-2ef5f25ba0914032b30232b4e7d0d126>Put together a user walk through for the basic Open Cluster Management API using `kind`, `olm`, and other open source technologies</h1><div class="td-byline mb-4">By <b>Michael Elder</b> |
<time datetime=2021-05-24 class=text-body-secondary>Monday, May 24, 2021</time></div><p>Read more at <a href=https://github.com/mdelder/open-cluster-management-getting-started>GitHub</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8b452ffcb42621d1af16a8aff31733d8>Setting up Open Cluster Management the hard way</h1><div class=lead>A guide to setting up Open Cluster Management manually for a deeper understanding of its components.</div><div class="td-byline mb-4"><time datetime=2021-04-22 class=text-body-secondary>Thursday, April 22, 2021</time></div><p>Read more at <a href=https://github.com/sdminonne/ocm-the-hard-way>Setting up Open Cluster Management the hard way</a>.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Slack aria-label=Slack><a target=_blank rel=noopener href=https://kubernetes.slack.com/channels/open-cluster-mgmt aria-label=Slack><i class="fab fa-slack"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Youtube aria-label=Youtube><a target=_blank rel=noopener href=https://www.youtube.com/c/OpenClusterManagement aria-label=Youtube><i class="fab fa-youtube"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Calendar aria-label=Calendar><a target=_blank rel=noopener href="https://calendar.google.com/calendar/u/0/embed?src=openclustermanagement@gmail.com" aria-label=Calendar><i class="fa fa-calendar"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/open-cluster-management-io aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Mail Group" aria-label="Mail Group"><a target=_blank rel=noopener href=https://groups.google.com/g/open-cluster-management aria-label="Mail Group"><i class="fa fa-envelope"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2020&ndash;2025
<span class=td-footer__authors>Open Cluster Management Authors. The Linux FoundationÂ® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href=https://www.linuxfoundation.org/trademark-usage/>Trademark Usage</a> | Powered by <a href=https://www.netlify.com/>Netlify</a></span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.236823df4a87a3f7f23385b72b3d839e2bc6a3927ca499704abf5d4972205f99.js integrity="sha256-I2gj30qHo/fyM4W3Kz2DnivGo5J8pJlwSr9dSXIgX5k=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>