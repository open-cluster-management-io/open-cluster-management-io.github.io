<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"/>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css"/>
  <link rel="stylesheet" href="/main.css"/>
  <link rel="shortcut icon" type="image/svg" href="/ocm.svg">
  <title>Open Cluster Management</title>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1PXKZXT157"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1PXKZXT157');
  </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">




<input id="current-lang" type="hidden" value="en">

<header class="navbar navbar-expand-lg navbar-dark bd-navbar">
  <nav class="navbar navbar-expand-lg navbar-dark py-3 fixed-top">
    <div class="container-fluid flex-wrap flex-lg-nowrap">
      <a href="/" class="navbar-brand">
        <img src="/ocm.svg" alt="" width="30" height="24" class="align-text-top">
        <span>Open Cluster Management</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navmenu">
        <ul class="navbar-nav ms-auto ">
          <li class="nav-item pe-2">
            <a href="/community" class="nav-link text-light">Community</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/contribute" class="nav-link text-light">Contribute</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/concepts" class="nav-link text-light">Document</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/blog" class="nav-link text-light">Blog</a>
          </li>
          <li class="nav-item dropdown pe-2">
            
            <a class="nav-link dropdown-toggle text-light" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">English</a>
            

            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              
              <li><a class="dropdown-item" href="#" id="to-zh">中文</a></li>
              
            </ul>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://www.youtube.com/c/OpenClusterManagement" target="_blank" aria-label="youtube">
                <i class="bi bi-youtube"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://github.com/open-cluster-management-io" target="_blank" aria-label="github">
              <i class="bi bi-github"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://kubernetes.slack.com/channels/open-cluster-mgmt" target="_blank" aria-label="slack">
              <i class="bi bi-slack"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>
</div>
        <div class="row subject-padding">
            <div class="col-lg-2 col-md-3 padding-none sidebar-bgc">




<div class="sidebar-toggle sidebar-toggle-sm">
    <button type="button" id="sidebarToggle" class="btn btn-info">
        <i class="bi bi-list"></i>
    </button>
</div>
<nav id="sidebar" class="sidebar-hide-sm">
    <ul class="components">
        <li id="concepts">
            <a class="navlink" href="/concepts">Concepts</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/concepts/architecture">Architecture</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/clusterclaim">ClusterClaim</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/managedcluster">ManagedCluster</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/managedclusterset">ManagedClusterSet</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/placement">Placement</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/manifestwork">ManifestWork</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/manifestworkreplicaset">ManifestWorkReplicaSet</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/addon">Add-ons</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/policy">Policy</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/multicluster-controlplane">Multicluster Control Plane</a>
                </li>
            </ul>
        </li>
        <li id="getting-started">
            <a class="navlink" href="/getting-started">Getting Started</a>
            <ul class="collapse show">
                <li>
                    <a class="navlink" href="/getting-started/quick-start">Quick Start</a>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/installation">Installation</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/getting-started/installation/start-the-control-plane">Start the Control Plane</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/installation/register-a-cluster">Register a Cluster</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/integration">Add-ons and Integrations</a>
                    <ul class="collapse ">
                        <li>
                            <a class="navlink" href="/getting-started/integration/app-lifecycle">Application lifecycle management</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/cluster-proxy">Cluster proxy</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/policy-framework">Policy framework</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/policy-controllers">Policy controllers</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/managed-serviceaccount">Managed service account</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/administration">Administration</a>
                    <ul class="collapse ">
                        <li>
                            <a class="navlink" href="/getting-started/administration/upgrading">Upgrading</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/administration/monitoring">Monitoring</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </li>
        <li id="developer-guides">
            <a class="navlink" href="/developer-guides">Developer Guides</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/developer-guides/addon">Add-on Developer Guide</a>
                </li>
                <li>
                    <a class="navlink" href="/developer-guides/vscode-extension">VScode Extension</a>
                </li>
            </ul>
        </li>
        <li id="scenarios">
            <a class="navlink" href="/scenarios">Scenarios</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/scenarios/deploy-kubernetes-resources">Deploy Kubernetes Resources</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/distribute-workload-with-placement">Distribute Workload With Placement</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/migrate-workload-with-placement">Migrate Workload With Placement</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/extend-multicluster-scheduling-capabilities">Extend Multicluster Scheduling Capabilities</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/extending-managed-clusters">Extend Managed Clusters</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/integration-with-argocd">Integration with Argo CD</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/manage-cluster-with-multiple-hubs">Manage a cluster with multiple hubs</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/pushing-kube-api-requests">Pushing Kube API Requests to the Managed Clusters</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/register-cluster-through-proxy">Register a cluster to hub through proxy server</a>
                </li>
            </ul>
        </li>
        <li id="community">
            <a class="navlink" href="/community">Community</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/community/releases">Releases</a>
                </li>
                <li >
                    <a class="navlink" href="/community/roadmap">Roadmap</a>
                </li>
            </ul>
        </li>
        <li id="contribute">
            <a class="navlink" href="/contribute">Contribute</a>
        </li>
        <li id="blog">
            <a class="navlink" href="/blog">Blog</a>
        </li>
        <li style="padding-top: 10px; border-top: 2px solid #448a78;">
            <a class="navlink resource" href="https://github.com/open-cluster-management-io" target="_blank"><i class="bi bi-github"></i><span style="padding-left: 10px;">GitHub</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://kubernetes.slack.com/channels/open-cluster-mgmt" target="_blank"><i class="bi bi-slack"></i><span style="padding-left: 10px;">Slack</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://www.youtube.com/c/OpenClusterManagement" target="_blank"><i class="bi bi-youtube"></i><span style="padding-left: 10px;">YouTube</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://groups.google.com/g/open-cluster-management" target="_blank"><i class="bi bi-envelope-fill"></i><span style="padding-left: 10px;">Mailing group</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://calendar.google.com/calendar/u/0/embed?src=openclustermanagement@gmail.com" target="_blank"><i class="bi bi-calendar-event-fill"></i><span style="padding-left: 10px;">Community meetings</span></a>
        </li>
    </ul>
</nav>
<script type="text/javascript" src="/sidebar.js"></script>
</div>
            <div class="col-lg-10 col-md-9 padding-none">
<div id="content">
    <h1>Register a cluster</h1>
    <p>After the cluster manager is installed on the hub cluster, you need to install the klusterlet agent on another cluster so that it can be registered and managed by the hub cluster.</p>
<!-- spellchecker-disable -->



  <div class="gdoc-toc gdoc-toc__level--6"><nav id="TableOfContents"><ul>
        <li><a href="#prerequisite">Prerequisite</a></li>
        <li><a href="#install-clusteradm-cli-tool">Install clusteradm CLI tool</a></li>
        <li><a href="#bootstrap-a-klusterlet">Bootstrap a klusterlet</a>
          <ul>
            <li><a href="#bootstrap-a-klusterlet-in-hosted-modeoptional">Bootstrap a klusterlet in hosted mode(Optional)</a></li>
            <li><a href="#bootstrap-a-klusterlet-in-singleton-mode">Bootstrap a klusterlet in singleton mode</a></li>
          </ul>
        </li>
        <li><a href="#accept-the-join-request-and-verify">Accept the join request and verify</a></li>
        <li><a href="#apply-a-manifestwork">Apply a Manifestwork</a>
          <ul>
            <li><a href="#troubleshooting">Troubleshooting</a></li>
          </ul>
        </li>
        <li><a href="#detach-the-cluster-from-hub">Detach the cluster from hub</a></li>
      </ul></nav><hr></div>


<!-- spellchecker-enable -->
<h2 id="prerequisite">Prerequisite</h2>
<ul>
<li>The managed clusters should be <code>v1.11+</code>.</li>
<li>Ensure <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl">kubectl</a> and <a href="https://kubectl.docs.kubernetes.io/installation/kustomize/">kustomize</a> are installed.</li>
</ul>
<h2 id="install-clusteradm-cli-tool">Install clusteradm CLI tool</h2>
<p>It&rsquo;s recommended to run the following command to download and install <strong>the
latest release</strong> of the <code>clusteradm</code> command-line tool:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">curl -L https://raw.githubusercontent.com/open-cluster-management-io/clusteradm/main/install.sh | bash
</code></pre></div><p>You can also install <strong>the latest development version</strong> (main branch) by running:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># Installing clusteradm to $GOPATH/bin/</span>
GO111MODULE<span style="color:#f92672">=</span>off go get -u open-cluster-management.io/clusteradm/...
</code></pre></div><h2 id="bootstrap-a-klusterlet">Bootstrap a klusterlet</h2>
<p>Before actually installing the OCM components into your clusters, export
the following environment variables in your terminal before running our
command-line tool <code>clusteradm</code> so that it can correctly discriminate the managed cluster:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell"><span style="color:#75715e"># The context name of the clusters in your kubeconfig</span>
export CTX_HUB_CLUSTER<span style="color:#f92672">=</span>&lt;your hub cluster context&gt;
export CTX_MANAGED_CLUSTER<span style="color:#f92672">=</span>&lt;your managed cluster context&gt;
</code></pre></div><p>Copy the previously generated command &ndash; <code>clusteradm join</code>, and add the arguments respectively based
on the different distribution.</p>
<p><strong>NOTE</strong>: If there is no configmap <code>kube-root-ca.crt</code> in kube-public namespace of the hub cluster,
the flag &ndash;ca-file should be set to provide a valid hub ca file to help set
up the external client.</p>
<ul class="nav nav-tabs" id="clusteradm-join" role="tablist"><li class="nav-item">
			<button data-bs-toggle="tab" data-bs-target="#clusteradm-join-0" class="nav-link active" id="clusteradm-join-0-tab" role="tab" aria-controls="clusteradm-join-0" aria-selected="true">kind</button>
		</li>
	  
		<li class="nav-item">
			<button data-bs-toggle="tab" data-bs-target="#clusteradm-join-1" class="nav-link" id="clusteradm-join-1-tab" role="tab" aria-controls="clusteradm-join-1">k3s, openshift 4.X</button>
		</li></ul>
<div class="tab-content" id="clusteradm-join"><div id="clusteradm-join-0" class="tab-pane fade show active" role="tabpanel" aria-labelledby="clusteradm-join-0-tab">

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># NOTE: For KinD clusters use the parameter: --force-internal-endpoint-lookup</span>
clusteradm join <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --hub-token &lt;your token data&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --hub-apiserver &lt;your hub cluster endpoint&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --wait <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --cluster-name <span style="color:#e6db74">&#34;cluster1&#34;</span> <span style="color:#ae81ff">\ </span>   <span style="color:#75715e"># Or other arbitrary unique name</span>
    --force-internal-endpoint-lookup <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --context <span style="color:#e6db74">${</span>CTX_MANAGED_CLUSTER<span style="color:#e6db74">}</span>
</code></pre></div></div>
  <div id="clusteradm-join-1" class="tab-pane fade" role="tabpanel" aria-labelledby="clusteradm-join-1-tab">

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">clusteradm join <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --hub-token &lt;your token data&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --hub-apiserver &lt;your hub cluster endpoint&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --wait <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --cluster-name <span style="color:#e6db74">&#34;cluster1&#34;</span> <span style="color:#ae81ff">\ </span>  <span style="color:#75715e"># Or other arbitrary unique name</span>
    --context <span style="color:#e6db74">${</span>CTX_MANAGED_CLUSTER<span style="color:#e6db74">}</span>
</code></pre></div></div></div>

<h3 id="bootstrap-a-klusterlet-in-hosted-modeoptional">Bootstrap a klusterlet in hosted mode(Optional)</h3>
<p>Using the above command, the klusterlet components(registration-agent and work-agent) will be deployed on the managed
cluster, it is mandatory to expose the hub cluster to the managed cluster. We provide an option for running the
klusterlet components outside the managed cluster, for example, on the hub cluster(hosted mode).</p>
<p>The hosted mode deploying is till in experimental stage, consider to use it only when:</p>
<ul>
<li>want to reduce the footprints of the managed cluster.</li>
<li>do not want to expose the hub cluster to the managed cluster directly</li>
</ul>
<p>In hosted mode, the cluster where the klusterlet is running is called the hosting cluster. Running the following command
to the hosting cluster to register the managed cluster to the hub.</p>
<ul class="nav nav-tabs" id="clusteradm-join" role="tablist"><li class="nav-item">
			<button data-bs-toggle="tab" data-bs-target="#clusteradm-join-0" class="nav-link active" id="clusteradm-join-0-tab" role="tab" aria-controls="clusteradm-join-0" aria-selected="true">kind</button>
		</li>
	  
		<li class="nav-item">
			<button data-bs-toggle="tab" data-bs-target="#clusteradm-join-1" class="nav-link" id="clusteradm-join-1-tab" role="tab" aria-controls="clusteradm-join-1">k3s, openshift 4.X</button>
		</li></ul>
<div class="tab-content" id="clusteradm-join"><div id="clusteradm-join-0" class="tab-pane fade show active" role="tabpanel" aria-labelledby="clusteradm-join-0-tab">

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># NOTE for KinD clusters:</span>
<span style="color:#75715e">#  1. hub is KinD, use the parameter: --force-internal-endpoint-lookup</span>
<span style="color:#75715e">#  2. managed is Kind, --managed-cluster-kubeconfig should be internal: `kind get kubeconfig --name managed --internal`</span>
clusteradm join <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --hub-token &lt;your token data&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --hub-apiserver &lt;your hub cluster endpoint&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --wait <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --cluster-name <span style="color:#e6db74">&#34;cluster1&#34;</span> <span style="color:#ae81ff">\ </span>   <span style="color:#75715e"># Or other arbitrary unique name</span>
    --mode hosted <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --managed-cluster-kubeconfig &lt;your managed cluster kubeconfig&gt; <span style="color:#ae81ff">\ </span>   <span style="color:#75715e"># Should be an internal kubeconfig</span>
    --force-internal-endpoint-lookup <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --context &lt;your hosting cluster context&gt;
</code></pre></div></div>
  <div id="clusteradm-join-1" class="tab-pane fade" role="tabpanel" aria-labelledby="clusteradm-join-1-tab">

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">clusteradm join <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --hub-token &lt;your token data&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --hub-apiserver &lt;your hub cluster endpoint&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --wait <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --cluster-name <span style="color:#e6db74">&#34;cluster1&#34;</span> <span style="color:#ae81ff">\ </span>   <span style="color:#75715e"># Or other arbitrary unique name</span>
    --mode hosted <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --managed-cluster-kubeconfig &lt;your managed cluster kubeconfig&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --context &lt;your hosting cluster context&gt;
</code></pre></div></div></div>

<h3 id="bootstrap-a-klusterlet-in-singleton-mode">Bootstrap a klusterlet in singleton mode</h3>
<p>To reduce the footprint of agent in the managed cluster, singleton mode is introduced since <code>v0.12.0</code>.
In the singleton mode, the work and registration agent will be run as a single pod in the managed
cluster.</p>
<p><strong>Note:</strong> to run klusterlet in singleton mode, you must have a clusteradm version equal or higher than
<code>v0.12.0</code></p>
<ul class="nav nav-tabs" id="clusteradm-join" role="tablist"><li class="nav-item">
			<button data-bs-toggle="tab" data-bs-target="#clusteradm-join-0" class="nav-link active" id="clusteradm-join-0-tab" role="tab" aria-controls="clusteradm-join-0" aria-selected="true">kind</button>
		</li>
	  
		<li class="nav-item">
			<button data-bs-toggle="tab" data-bs-target="#clusteradm-join-1" class="nav-link" id="clusteradm-join-1-tab" role="tab" aria-controls="clusteradm-join-1">k3s, openshift 4.X</button>
		</li></ul>
<div class="tab-content" id="clusteradm-join"><div id="clusteradm-join-0" class="tab-pane fade show active" role="tabpanel" aria-labelledby="clusteradm-join-0-tab">

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># NOTE: For KinD clusters use the parameter: --force-internal-endpoint-lookup</span>
clusteradm join <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --hub-token &lt;your token data&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --hub-apiserver &lt;your hub cluster endpoint&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --wait <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --cluster-name <span style="color:#e6db74">&#34;cluster1&#34;</span> <span style="color:#ae81ff">\ </span>   <span style="color:#75715e"># Or other arbitrary unique name</span>
    --singleton <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --force-internal-endpoint-lookup <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --context <span style="color:#e6db74">${</span>CTX_MANAGED_CLUSTER<span style="color:#e6db74">}</span>
</code></pre></div></div>
  <div id="clusteradm-join-1" class="tab-pane fade" role="tabpanel" aria-labelledby="clusteradm-join-1-tab">

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">clusteradm join <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --hub-token &lt;your token data&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --hub-apiserver &lt;your hub cluster endpoint&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --wait <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --cluster-name <span style="color:#e6db74">&#34;cluster1&#34;</span> <span style="color:#ae81ff">\ </span>  <span style="color:#75715e"># Or other arbitrary unique name</span>
    --singleton <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --context <span style="color:#e6db74">${</span>CTX_MANAGED_CLUSTER<span style="color:#e6db74">}</span>
</code></pre></div></div></div>

<h2 id="accept-the-join-request-and-verify">Accept the join request and verify</h2>
<p>After the OCM agent is running on your managed cluster, it will be sending a &ldquo;handshake&rdquo; to your
hub cluster and waiting for an approval from the hub cluster admin. In this section, we will walk
through accepting the registration requests from the prespective of an OCM&rsquo;s hub admin.</p>
<ol>
<li>
<p>Wait for the creation of the CSR object which will be created by your managed
clusters&rsquo; OCM agents on the hub cluster:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">kubectl get csr -w --context <span style="color:#e6db74">${</span>CTX_HUB_CLUSTER<span style="color:#e6db74">}</span> | grep cluster1  <span style="color:#75715e"># or the previously chosen cluster name</span>
</code></pre></div><p>An example of a pending CSR request is shown below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">cluster1-tqcjj   33s   kubernetes.io/kube-apiserver-client   system:serviceaccount:open-cluster-management:cluster-bootstrap   Pending
</code></pre></div></li>
<li>
<p>Accept the join request using the <code>clusteradm</code> tool:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">clusteradm accept --clusters cluster1 --context <span style="color:#e6db74">${</span>CTX_HUB_CLUSTER<span style="color:#e6db74">}</span>
</code></pre></div><p>After running the <code>accept</code> command, the CSR from your managed cluster
named &ldquo;cluster1&rdquo; will be approved. Additionally, it will instruct
the OCM hub control plane to setup related objects (such as a namespace
named &ldquo;cluster1&rdquo; in the hub cluster) and RBAC permissions automatically.</p>
</li>
<li>
<p>Verify the installation of the OCM agents on your managed cluster by running:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl -n open-cluster-management-agent get pod --context <span style="color:#e6db74">${</span>CTX_MANAGED_CLUSTER<span style="color:#e6db74">}</span>
NAME                                             READY   STATUS    RESTARTS   AGE
klusterlet-registration-agent-598fd79988-jxx7n   1/1     Running   <span style="color:#ae81ff">0</span>          19d
klusterlet-work-agent-7d47f4b5c5-dnkqw           1/1     Running   <span style="color:#ae81ff">0</span>          19d
</code></pre></div></li>
<li>
<p>Verify that the <code>cluster1</code> <code>ManagedCluster</code> object was created successfully by running:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">kubectl get managedcluster --context <span style="color:#e6db74">${</span>CTX_HUB_CLUSTER<span style="color:#e6db74">}</span>
</code></pre></div><p>Then you should get a result that resembles the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">NAME       HUB ACCEPTED   MANAGED CLUSTER URLS      JOINED   AVAILABLE   AGE
cluster1   true           &lt;your endpoint&gt;           True     True        5m23s
</code></pre></div></li>
</ol>
<p>If the managed cluster status is not true, refer to <a href="#troubleshooting">Troubleshooting</a> to debug on your cluster.</p>
<h2 id="apply-a-manifestwork">Apply a Manifestwork</h2>
<p>After the managed cluster is registered, test that you can deploy a pod to the managed cluster from the hub cluster. Create a <code>manifest-work.yaml</code> as shown in this example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: work.open-cluster-management.io/v1
<span style="color:#66d9ef">kind</span>: ManifestWork
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: mw<span style="color:#ae81ff">-01</span>
  <span style="color:#66d9ef">namespace</span>: ${MANAGED_CLUSTER_NAME}
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">workload</span>:
    <span style="color:#66d9ef">manifests</span>:
      - <span style="color:#66d9ef">apiVersion</span>: v1
        <span style="color:#66d9ef">kind</span>: Pod
        <span style="color:#66d9ef">metadata</span>:
          <span style="color:#66d9ef">name</span>: hello
          <span style="color:#66d9ef">namespace</span>: default
        <span style="color:#66d9ef">spec</span>:
          <span style="color:#66d9ef">containers</span>:
            - <span style="color:#66d9ef">name</span>: hello
              <span style="color:#66d9ef">image</span>: busybox
              <span style="color:#66d9ef">command</span>: [<span style="color:#e6db74">&#34;sh&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>, <span style="color:#e6db74">&#39;echo &#34;Hello, Kubernetes!&#34; &amp;&amp; sleep 3600&#39;</span>]
          <span style="color:#66d9ef">restartPolicy</span>: OnFailure
</code></pre></div><p>Apply the yaml file to the hub cluster.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">kubectl apply -f manifest-work.yaml --context <span style="color:#e6db74">${</span>CTX_HUB_CLUSTER<span style="color:#e6db74">}</span>
</code></pre></div><p>Verify that the <code>manifestwork</code> resource was applied to the hub.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">kubectl -n <span style="color:#e6db74">${</span>MANAGED_CLUSTER_NAME<span style="color:#e6db74">}</span> get manifestwork/mw-01 --context <span style="color:#e6db74">${</span>CTX_HUB_CLUSTER<span style="color:#e6db74">}</span> -o yaml
</code></pre></div><p>Check on the managed cluster and see the <em>hello</em> Pod has been deployed from the hub cluster.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">$ kubectl -n default get pod --context <span style="color:#e6db74">${</span>CTX_MANAGED_CLUSTER<span style="color:#e6db74">}</span>
NAME    READY   STATUS    RESTARTS   AGE
hello   1/1     Running   <span style="color:#ae81ff">0</span>          108s
</code></pre></div><h3 id="troubleshooting">Troubleshooting</h3>
<ul>
<li>
<p><strong>If the managed cluster status is not true.</strong></p>
<p>For example, the result below is shown when checking managedcluster.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">$ kubectl get managedcluster --context <span style="color:#e6db74">${</span>CTX_HUB_CLUSTER<span style="color:#e6db74">}</span>
NAME                   HUB ACCEPTED   MANAGED CLUSTER URLS   JOINED   AVAILABLE   AGE
<span style="color:#e6db74">${</span>MANAGED_CLUSTER_NAME<span style="color:#e6db74">}</span> true           https://localhost               Unknown     46m
</code></pre></div><p>There are many reasons for this problem. You can use the commands below to get more debug info. If the provided info doesn&rsquo;t help, please log an issue to us.</p>
<p>On the hub cluster, check the managedcluster status.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">kubectl get managedcluster <span style="color:#e6db74">${</span>MANAGED_CLUSTER_NAME<span style="color:#e6db74">}</span> --context <span style="color:#e6db74">${</span>CTX_HUB_CLUSTER<span style="color:#e6db74">}</span> -o yaml
</code></pre></div><p>On the hub cluster, check the lease status.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">kubectl get lease -n <span style="color:#e6db74">${</span>MANAGED_CLUSTER_NAME<span style="color:#e6db74">}</span> --context <span style="color:#e6db74">${</span>CTX_HUB_CLUSTER<span style="color:#e6db74">}</span>
</code></pre></div><p>On the managed cluster, check the klusterlet status.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">kubectl get klusterlet -o yaml --context <span style="color:#e6db74">${</span>CTX_MANAGED_CLUSTER<span style="color:#e6db74">}</span>
</code></pre></div></li>
</ul>
<h2 id="detach-the-cluster-from-hub">Detach the cluster from hub</h2>
<p>Remove the resources generated when registering with the hub cluster.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">clusteradm unjoin --cluster-name <span style="color:#e6db74">&#34;cluster1&#34;</span> --context <span style="color:#e6db74">${</span>CTX_MANAGED_CLUSTER<span style="color:#e6db74">}</span>
</code></pre></div><p>Check the installation of the OCM agent is removed from the managed cluster.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">kubectl -n open-cluster-management-agent get pod --context <span style="color:#e6db74">${</span>CTX_MANAGED_CLUSTER<span style="color:#e6db74">}</span>
No resources found in open-cluster-management-agent namespace.
</code></pre></div><p>Check the klusterlet is removed from the managed cluster.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">kubectl get klusterlet --context <span style="color:#e6db74">${</span>CTX_MANAGED_CLUSTER<span style="color:#e6db74">}</span>
error: the server doesn<span style="color:#960050;background-color:#1e0010">&#39;</span>t have a resource type <span style="color:#e6db74">&#34;klusterlet
</span></code></pre></div>
</div>
<script type="text/javascript" src="/clipboard-copy.js"></script>
</div>
        </div>
        <div class="row"><nav class="ocm navbar navbar-expand-lg navbar-dark py-3">
  <div class="container-fluid flex-wrap flex-md-nowrap">
    <div class="text-light">&copy; 2024 Open Cluster Management Authors. The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href="https://www.linuxfoundation.org/trademark-usage/" target="_blank" style="color: #f8f9fa;">Trademark Usage</a></div>
  </div>
</nav>
<script type="text/javascript" src="/lang.js"></script>
</div>
    </div>
</body>
</html>
