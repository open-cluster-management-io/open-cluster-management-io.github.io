<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"/>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css"/>
  <link rel="stylesheet" href="/main.css"/>
  <link rel="shortcut icon" type="image/svg" href="/ocm.svg">
  <title>Open Cluster Management</title>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1PXKZXT157"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1PXKZXT157');
  </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">




<input id="current-lang" type="hidden" value="en">

<header class="navbar navbar-expand-lg navbar-dark bd-navbar">
  <nav class="navbar navbar-expand-lg navbar-dark py-3 fixed-top">
    <div class="container-fluid flex-wrap flex-lg-nowrap">
      <a href="/" class="navbar-brand">
        <img src="/ocm.svg" alt="" width="30" height="24" class="align-text-top">
        <span>Open Cluster Management</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navmenu">
        <ul class="navbar-nav ms-auto ">
          <li class="nav-item pe-2">
            <a href="/community" class="nav-link text-light">Community</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/contribute" class="nav-link text-light">Contribute</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/concepts" class="nav-link text-light">Document</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/blog" class="nav-link text-light">Blog</a>
          </li>
          <li class="nav-item dropdown pe-2">
            
            <a class="nav-link dropdown-toggle text-light" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">English</a>
            

            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              
              <li><a class="dropdown-item" href="#" id="to-zh">中文</a></li>
              
            </ul>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://www.youtube.com/c/OpenClusterManagement" target="_blank" aria-label="youtube">
                <i class="bi bi-youtube"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://github.com/open-cluster-management-io" target="_blank" aria-label="github">
              <i class="bi bi-github"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://kubernetes.slack.com/channels/open-cluster-mgmt" target="_blank" aria-label="slack">
              <i class="bi bi-slack"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>
</div>
        <div class="row subject-padding">
            <div class="col-lg-2 col-md-3 padding-none sidebar-bgc">




<div class="sidebar-toggle sidebar-toggle-sm">
    <button type="button" id="sidebarToggle" class="btn btn-info">
        <i class="bi bi-list"></i>
    </button>
</div>
<nav id="sidebar" class="sidebar-hide-sm">
    <ul class="components">
        <li id="concepts">
            <a class="navlink" href="/concepts">Concepts</a>
            <ul class="collapse show">
                <li>
                    <a class="navlink" href="/concepts/architecture">Architecture</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/clusterclaim">ClusterClaim</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/managedcluster">ManagedCluster</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/managedclusterset">ManagedClusterSet</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/placement">Placement</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/manifestwork">ManifestWork</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/manifestworkreplicaset">ManifestWorkReplicaSet</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/addon">Add-ons</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/policy">Policy</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/multicluster-controlplane">Multicluster Control Plane</a>
                </li>
            </ul>
        </li>
        <li id="getting-started">
            <a class="navlink" href="/getting-started">Getting Started</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/getting-started/quick-start">Quick Start</a>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/installation">Installation</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/getting-started/installation/start-the-control-plane">Start the Control Plane</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/installation/register-a-cluster">Register a Cluster</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/integration">Add-ons and Integrations</a>
                    <ul class="collapse ">
                        <li>
                            <a class="navlink" href="/getting-started/integration/app-lifecycle">Application lifecycle management</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/cluster-proxy">Cluster proxy</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/policy-framework">Policy framework</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/policy-controllers">Policy controllers</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/managed-serviceaccount">Managed service account</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/administration">Administration</a>
                    <ul class="collapse ">
                        <li>
                            <a class="navlink" href="/getting-started/administration/upgrading">Upgrading</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/administration/monitoring">Monitoring</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </li>
        <li id="developer-guides">
            <a class="navlink" href="/developer-guides">Developer Guides</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/developer-guides/addon">Add-on Developer Guide</a>
                </li>
                <li>
                    <a class="navlink" href="/developer-guides/vscode-extension">VScode Extension</a>
                </li>
            </ul>
        </li>
        <li id="scenarios">
            <a class="navlink" href="/scenarios">Scenarios</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/scenarios/deploy-kubernetes-resources">Deploy Kubernetes Resources</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/distribute-workload-with-placement">Distribute Workload With Placement</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/migrate-workload-with-placement">Migrate Workload With Placement</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/extend-multicluster-scheduling-capabilities">Extend Multicluster Scheduling Capabilities</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/extending-managed-clusters">Extend Managed Clusters</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/integration-with-argocd">Integration with Argo CD</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/manage-cluster-with-multiple-hubs">Manage a cluster with multiple hubs</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/pushing-kube-api-requests">Pushing Kube API Requests to the Managed Clusters</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/register-cluster-through-proxy">Register a cluster to hub through proxy server</a>
                </li>
            </ul>
        </li>
        <li id="community">
            <a class="navlink" href="/community">Community</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/community/releases">Releases</a>
                </li>
                <li >
                    <a class="navlink" href="/community/roadmap">Roadmap</a>
                </li>
            </ul>
        </li>
        <li id="contribute">
            <a class="navlink" href="/contribute">Contribute</a>
        </li>
        <li id="blog">
            <a class="navlink" href="/blog">Blog</a>
        </li>
        <li style="padding-top: 10px; border-top: 2px solid #448a78;">
            <a class="navlink resource" href="https://github.com/open-cluster-management-io" target="_blank"><i class="bi bi-github"></i><span style="padding-left: 10px;">GitHub</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://kubernetes.slack.com/channels/open-cluster-mgmt" target="_blank"><i class="bi bi-slack"></i><span style="padding-left: 10px;">Slack</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://www.youtube.com/c/OpenClusterManagement" target="_blank"><i class="bi bi-youtube"></i><span style="padding-left: 10px;">YouTube</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://groups.google.com/g/open-cluster-management" target="_blank"><i class="bi bi-envelope-fill"></i><span style="padding-left: 10px;">Mailing group</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://calendar.google.com/calendar/u/0/embed?src=openclustermanagement@gmail.com" target="_blank"><i class="bi bi-calendar-event-fill"></i><span style="padding-left: 10px;">Community meetings</span></a>
        </li>
    </ul>
</nav>
<script type="text/javascript" src="/sidebar.js"></script>
</div>
            <div class="col-lg-10 col-md-9 padding-none">
<div id="content">
    <h1>Placement</h1>
    <!-- spellchecker-disable -->



  <div class="gdoc-toc gdoc-toc__level--6"><nav id="TableOfContents"><ul>
        <li><a href="#overall">Overall</a></li>
        <li><a href="#select-clusters-in-managedclusterset">Select clusters in ManagedClusterSet</a>
          <ul>
            <li><a href="#predicates">Predicates</a>
              <ul>
                <li><a href="#labelclaim-selection">Label/Claim selection</a></li>
                <li><a href="#taintstolerations">Taints/Tolerations</a></li>
              </ul>
            </li>
            <li><a href="#prioritizers">Prioritizers</a>
              <ul>
                <li><a href="#score-based-prioritizer">Score-based prioritizer</a></li>
                <li><a href="#extensible-scheduling">Extensible scheduling</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#placementdecisions">PlacementDecisions</a>
          <ul>
            <li><a href="#decision-strategy">Decision strategy</a></li>
            <li><a href="#rollout-strategy">Rollout Strategy</a></li>
          </ul>
        </li>
        <li><a href="#troubleshooting">Troubleshooting</a>
          <ul>
            <li><a href="#check-the-placement-conditions">Check the <code>Placement</code> conditions</a></li>
            <li><a href="#check-the-placement-events">Check the <code>Placement</code> events</a></li>
            <li><a href="#debug">Debug</a></li>
          </ul>
        </li>
        <li><a href="#future-work">Future work</a></li>
      </ul></nav><hr></div>


<!-- spellchecker-enable -->
<p><strong>API-CHANGE NOTE</strong>:</p>
<p>The <code>Placement</code> and <code>PlacementDecision</code> API v1alpha1 version will no longer be served in OCM v0.9.0.</p>
<ul>
<li>Migrate manifests and API clients to use the <code>Placement</code> and <code>PlacementDecision</code> API v1beta1 version, available since OCM v0.7.0.</li>
<li>All existing persisted objects are accessible via the new API.</li>
<li>Notable changes:
<ul>
<li>The field <code>spec.prioritizerPolicy.configurations.name</code> in <code>Placement</code> API v1alpha1 is removed and replaced by
<code>spec.prioritizerPolicy.configurations.scoreCoordinate.builtIn</code> in v1beta1.</li>
</ul>
</li>
</ul>
<h2 id="overall">Overall</h2>
<p><code>Placement</code> concept is used to dynamically select a set of <a href="../managedcluster">managedClusters</a>
in one or multiple <a href="../managedclusterset">ManagedClusterSet</a> so that higher level
users can either replicate Kubernetes resources to the member clusters or run
their advanced workload i.e. <strong>multi-cluster scheduling</strong>.</p>
<p>The &ldquo;input&rdquo; and &ldquo;output&rdquo; of the scheduling process are decoupled into two
separated Kubernetes API <code>Placement</code> and <code>PlacementDecision</code>. As is shown in
the following picture, we prescribe the scheduling policy in the spec of
<code>Placement</code> API and the placement controller in the hub will help us to
dynamically select a slice of managed clusters from the given cluster sets.
The selected clusters will be listed in <code>PlacementDecision</code>.</p>
<div style="text-align: center; padding: 20px;">
   <img src="/placement-explain.png" alt="Placement" style="margin: 0 auto; width: 60%">
</div>
<p>Following the architecture of Kubernetes&rsquo; original scheduling framework, the
multi-cluster scheduling is logically divided into two phases internally:</p>
<ul>
<li><strong>Predicate</strong>: Hard requirements for the selected clusters.</li>
<li><strong>Prioritize</strong>: Rank the clusters by the soft requirements and select a subset
among them.</li>
</ul>
<h2 id="select-clusters-in-managedclusterset">Select clusters in ManagedClusterSet</h2>
<p>By following <a href="../managedclusterset">the previous section</a> about
<code>ManagedClusterSet</code>, now we&rsquo;re supposed to have one or multiple valid cluster
sets in the hub clusters. Then we can move on and create a placement in the
&ldquo;workspace namespace&rdquo; by specifying <code>predicates</code> and <code>prioritizers</code> in the
<code>Placement</code> API to define our own multi-cluster scheduling policy.</p>
<h3 id="predicates">Predicates</h3>
<h4 id="labelclaim-selection">Label/Claim selection</h4>
<p>In the <code>predicates</code> section, you can select clusters by labels or <a href="../clusterclaim">clusterClaims</a>.
For instance, you can select 3 clusters with label <code>purpose=test</code> and
clusterClaim <code>platform.open-cluster-management.io=aws</code> as seen in the following
examples:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: cluster.open-cluster-management.io/v1beta1
<span style="color:#66d9ef">kind</span>: Placement
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: placement1
  <span style="color:#66d9ef">namespace</span>: default
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">numberOfClusters</span>: <span style="color:#ae81ff">3</span>
  <span style="color:#66d9ef">clusterSets</span>:
    - prod
  <span style="color:#66d9ef">predicates</span>:
    - <span style="color:#66d9ef">requiredClusterSelector</span>:
        <span style="color:#66d9ef">labelSelector</span>:
          <span style="color:#66d9ef">matchLabels</span>:
            <span style="color:#66d9ef">purpose</span>: test
        <span style="color:#66d9ef">claimSelector</span>:
          <span style="color:#66d9ef">matchExpressions</span>:
            - <span style="color:#66d9ef">key</span>: platform.open-cluster-management.io
              <span style="color:#66d9ef">operator</span>: In
              <span style="color:#66d9ef">values</span>:
                - aws
</code></pre></div><p>Note that the distinction between label-selecting and claim-selecting is
elaborated in <a href="https://open-cluster-management.io/scenarios/extending-managed-clusters/">this page</a>
about how to extend attributes for the managed clusters.</p>
<h4 id="taintstolerations">Taints/Tolerations</h4>
<p>To support filtering unhealthy/not-reporting clusters and keep workloads from
being placed in unhealthy or unreachable clusters, we introduce the similar
concept of taint/toleration in Kubernetes. It also allows user to add a
customized taint to deselect a cluster from placement. This is useful when the
user wants to set a cluster to maintenance mode and evict workload from this
cluster.</p>
<p>In OCM, Taints and Tolerations work together to allow users to control the
selection of managed clusters more flexibly.</p>
<p><a href="../managedcluster/#cluster-taints-and-tolerations">Taints</a> are properties of
ManagedClusters, they allow a Placement to repel a set of ManagedClusters in
predicates stage.</p>
<p>Tolerations are applied to Placements, and allow Placements to select
ManagedClusters with matching taints.</p>
<p>The following example shows how to tolerate clusters with taints.</p>
<ul>
<li>
<p>Tolerate clusters with taint</p>
<p>Suppose your managed cluster has taint added as below.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: cluster.open-cluster-management.io/v1
<span style="color:#66d9ef">kind</span>: ManagedCluster
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: cluster1
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">hubAcceptsClient</span>: <span style="color:#66d9ef">true</span>
  <span style="color:#66d9ef">taints</span>:
    - <span style="color:#66d9ef">effect</span>: NoSelect
      <span style="color:#66d9ef">key</span>: gpu
      <span style="color:#66d9ef">value</span>: <span style="color:#e6db74">&#34;true&#34;</span>
      <span style="color:#66d9ef">timeAdded</span>: <span style="color:#e6db74">&#39;2022-02-21T08:11:06Z&#39;</span>
</code></pre></div><p>By default, the placement won’t select this cluster unless you define tolerations.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: cluster.open-cluster-management.io/v1beta1
<span style="color:#66d9ef">kind</span>: Placement
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: placement1
  <span style="color:#66d9ef">namespace</span>: ns1
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">tolerations</span>:
    - <span style="color:#66d9ef">key</span>: gpu
      <span style="color:#66d9ef">value</span>: <span style="color:#e6db74">&#34;true&#34;</span>
      <span style="color:#66d9ef">operator</span>: Equal
</code></pre></div><p>With the above tolerations defined, cluster1 could be selected by placement
because of the <code>key: gpu</code> and <code>value: &quot;true&quot;</code> match.</p>
</li>
<li>
<p>Tolerate clusters with taint for a period of time</p>
<p><code>TolerationSeconds</code> represents the period of time the toleration tolerates the
taint. It could be used for the case like, when a managed cluster gets offline,
users can make applications deployed on this cluster to be transferred to
another available managed cluster after a tolerated time.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: cluster.open-cluster-management.io/v1
<span style="color:#66d9ef">kind</span>: ManagedCluster
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: cluster1
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">hubAcceptsClient</span>: <span style="color:#66d9ef">true</span>
  <span style="color:#66d9ef">taints</span>:
    - <span style="color:#66d9ef">effect</span>: NoSelect
      <span style="color:#66d9ef">key</span>: cluster.open-cluster-management.io/unreachable
      <span style="color:#66d9ef">timeAdded</span>: <span style="color:#e6db74">&#39;2022-02-21T08:11:06Z&#39;</span>
</code></pre></div><p>If define a placement with <code>TolerationSeconds</code> as below, then the workload will
be transferred to another available managed cluster after 5 minutes.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: cluster.open-cluster-management.io/v1alpha1
<span style="color:#66d9ef">kind</span>: Placement
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: placement1
  <span style="color:#66d9ef">namespace</span>: ns1
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">tolerations</span>:
    - <span style="color:#66d9ef">key</span>: cluster.open-cluster-management.io/unreachable
      <span style="color:#66d9ef">operator</span>: Exists
      <span style="color:#66d9ef">tolerationSeconds</span>: <span style="color:#ae81ff">300</span>
</code></pre></div></li>
</ul>
<p>In <code>tolerations</code> section, it includes the
following fields:</p>
<ul>
<li><strong>Key</strong> (optional). Key is the taint key that the toleration applies to.</li>
<li><strong>Value</strong> (optional). Value is the taint value the toleration matches to.</li>
<li><strong>Operator</strong> (optional). Operator represents a key&rsquo;s relationship to the
value. Valid operators are <code>Exists</code> and <code>Equal</code>. Defaults to <code>Equal</code>. A
toleration &ldquo;matches&rdquo; a taint if the keys are the same and the effects are the
same, and the operator is:
<ul>
<li><code>Equal</code>. The operator is Equal and the values are equal.</li>
<li><code>Exists</code>. Exists is equivalent to wildcard for value, so that a placement
can tolerate all taints of a particular category.</li>
</ul>
</li>
<li><strong>Effect</strong> (optional). Effect indicates the taint effect to match. Empty means
match all taint effects. When specified, allowed values are <code>NoSelect</code>,
<code>PreferNoSelect</code> and <code>NoSelectIfNew</code>. (<code>PreferNoSelect</code> is not implemented yet,
currently clusters with effect <code>PreferNoSelect</code> will always be selected.)</li>
<li><strong>TolerationSeconds</strong> (optional). TolerationSeconds represents the period of
time the toleration (which must be of effect <code>NoSelect</code>/<code>PreferNoSelect</code>,
otherwise this field is ignored) tolerates the taint. The default value is nil,
which indicates it tolerates the taint forever. The start time of counting the
TolerationSeconds should be the <code>TimeAdded</code> in Taint, not the cluster scheduled
time or <code>TolerationSeconds</code> added time.</li>
</ul>
<h3 id="prioritizers">Prioritizers</h3>
<h4 id="score-based-prioritizer">Score-based prioritizer</h4>
<p>In <code>prioritizerPolicy</code> section, you can define the policy of prioritizers.</p>
<p>The following example shows how to select clusters with prioritizers.</p>
<ul>
<li>
<p>Select a cluster with the largest allocatable memory.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: cluster.open-cluster-management.io/v1beta1
<span style="color:#66d9ef">kind</span>: Placement
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: placement1
  <span style="color:#66d9ef">namespace</span>: ns1
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">numberOfClusters</span>: <span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">prioritizerPolicy</span>:
    <span style="color:#66d9ef">configurations</span>:
      - <span style="color:#66d9ef">scoreCoordinate</span>:
          <span style="color:#66d9ef">builtIn</span>: ResourceAllocatableMemory
</code></pre></div><p>The prioritizer policy has default mode additive and default prioritizers <code>Steady</code> and <code>Balance</code>.</p>
<p>In the above example, the prioritizers actually come into effect are <code>Steady</code>, <code>Balance</code> and <code>ResourceAllocatableMemory</code>.</p>
<p>And the end of this section has more description about the prioritizer policy mode and default prioritizers.</p>
</li>
<li>
<p>Select a cluster with the largest allocatable CPU and memory, and make placement sensitive to resource changes.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: cluster.open-cluster-management.io/v1beta1
<span style="color:#66d9ef">kind</span>: Placement
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: placement1
  <span style="color:#66d9ef">namespace</span>: ns1
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">numberOfClusters</span>: <span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">prioritizerPolicy</span>:
    <span style="color:#66d9ef">configurations</span>:
      - <span style="color:#66d9ef">scoreCoordinate</span>:
          <span style="color:#66d9ef">builtIn</span>: ResourceAllocatableCPU
        <span style="color:#66d9ef">weight</span>: <span style="color:#ae81ff">2</span>
      - <span style="color:#66d9ef">scoreCoordinate</span>:
          <span style="color:#66d9ef">builtIn</span>: ResourceAllocatableMemory
        <span style="color:#66d9ef">weight</span>: <span style="color:#ae81ff">2</span>
</code></pre></div><p>The prioritizer policy has default mode additive and default prioritizers <code>Steady</code> and <code>Balance</code>, and their default
weight is 1.</p>
<p>In the above example, the prioritizers actually come into effect are <code>Steady</code> with weight 1, <code>Balance</code> with weight 1,
<code>ResourceAllocatableCPU</code> with weight 2 and <code>ResourceAllocatableMemory</code> with weight 2. The cluster score will be a
combination of the 4 prioritizers score. Since <code>ResourceAllocatableCPU</code> and <code>ResourceAllocatableMemory</code> have higher
weight, they will be weighted more in the results, and make placement sensitive to resource changes.</p>
<p>And the end of this section has more description about the prioritizer weight and how the final score is calculated.</p>
</li>
<li>
<p>Select two clusters with the largest addon score CPU ratio, and pin the placement decisions.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: cluster.open-cluster-management.io/v1beta1
<span style="color:#66d9ef">kind</span>: Placement
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: placement1
  <span style="color:#66d9ef">namespace</span>: ns1
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">numberOfClusters</span>: <span style="color:#ae81ff">2</span>
  <span style="color:#66d9ef">prioritizerPolicy</span>:
    <span style="color:#66d9ef">mode</span>: Exact
    <span style="color:#66d9ef">configurations</span>:
      - <span style="color:#66d9ef">scoreCoordinate</span>:
          <span style="color:#66d9ef">builtIn</span>: Steady
        <span style="color:#66d9ef">weight</span>: <span style="color:#ae81ff">3</span>
      - <span style="color:#66d9ef">scoreCoordinate</span>:
          <span style="color:#66d9ef">type</span>: AddOn
          <span style="color:#66d9ef">addOn</span>:
            <span style="color:#66d9ef">resourceName</span>: default
            <span style="color:#66d9ef">scoreName</span>: cpuratio
</code></pre></div><p>In the above example, explicitly define the mode as exact. The prioritizers actually come into effect are <code>Steady</code> with
weight 3 and addon score cpuratio with weight 1. Go into the <a href="#extensible-scheduling">Extensible scheduling</a> section
to learn more about addon score.</p>
</li>
</ul>
<p>In <code>prioritizerPolicy</code> section, it includes the following fields:</p>
<ul>
<li><code>mode</code> is either <code>Exact</code>, <code>Additive</code> or <code>&quot;&quot;</code>, where <code>&quot;&quot;</code> is <code>Additive</code> by default.
<ul>
<li>In <code>Additive</code> mode, any prioritizer not explicitly enumerated is enabled
in its default <code>Configurations</code>, in which <code>Steady</code> and <code>Balance</code> prioritizers have
the weight of 1 while other prioritizers have the weight of 0. <code>Additive</code>
doesn&rsquo;t require configuring all prioritizers. The default <code>Configurations</code> may
change in the future, and additional prioritization will happen.</li>
<li>In <code>Exact</code> mode, any prioritizer not explicitly enumerated is weighted as
zero. <code>Exact</code> requires knowing the full set of prioritizers you want, but
avoids behavior changes between releases.</li>
</ul>
</li>
<li><code>configurations</code> represents the configuration of prioritizers.
<ul>
<li><code>scoreCoordinate</code> represents the configuration of the prioritizer and
score source.
<ul>
<li><code>type</code> defines the type of the prioritizer score.
Type is either <code>BuiltIn</code>, <code>AddOn</code> or &ldquo;&quot;, where &quot;&rdquo; is <code>BuiltIn</code> by default.
When the type is <code>BuiltIn</code>, a <code>BuiltIn</code> prioritizer name must be specified.
When the type is <code>AddOn</code>, need to configure the score source in <code>AddOn</code>.
<ul>
<li><code>builtIn</code> defines the name of a <code>BuiltIn</code> prioritizer. Below are the
valid <code>BuiltIn</code> prioritizer names.
<ul>
<li><code>Balance</code>: balance the decisions among the clusters.</li>
<li><code>Steady</code>: ensure the existing decision is stabilized.</li>
<li><code>ResourceAllocatableCPU</code>: sort clusters based on the allocatable CPU.</li>
<li><code>ResourceAllocatableMemory</code>: sort clusters based on the allocatable memory.</li>
</ul>
</li>
<li><code>addOn</code> defines the resource name and score name.
<code>AddOnPlacementScore</code> is introduced to describe addon scores, go into
the <a href="#extensible-scheduling">Extensible scheduling</a> section to learn
more about it.
<ul>
<li><code>resourceName</code> defines the resource name of the
<code>AddOnPlacementScore</code>. The placement prioritizer selects
<code>AddOnPlacementScore</code> CR by this name.</li>
<li><code>scoreName</code> defines the score name inside <code>AddOnPlacementScore</code>.
<code>AddOnPlacementScore</code> contains a list of score name and score value,
<code>scoreName</code> specifies the score to be used by the prioritizer.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>weight</code> defines the weight of the prioritizer. The value must be ranged in
[-10,10].
Each prioritizer will calculate an integer score of a cluster in the range
of [-100, 100]. The final score of a cluster will be sum(weight *
prioritizer_score).
A higher weight indicates that the prioritizer weights more in the cluster
selection, while 0 weight indicates that the prioritizer is disabled. A
negative weight indicates wanting to select the last ones.</li>
</ul>
</li>
</ul>
<h4 id="extensible-scheduling">Extensible scheduling</h4>
<p>In placement resource based scheduling, in some cases the prioritizer needs
extra data (more than the default value provided by ManagedCluster) to calculate
the score of the managed cluster. For example, schedule the clusters based on
cpu or memory usage data of the clusters fetched from a monitoring system.</p>
<p>So we provide a new API <code>AddOnPlacementScore</code> to support a more extensible way
to schedule based on customized scores.</p>
<ul>
<li>As a user, as mentioned in the above section, can specify the score in
placement yaml to select clusters.</li>
<li>As a score provider, a 3rd party controller could run on either hub or managed
cluster, to maintain the lifecycle of <code>AddOnPlacementScore</code> and update score
into it.</li>
</ul>
<p><a href="https://open-cluster-management.io/scenarios/extend-multicluster-scheduling-capabilities/">Extend the multi-cluster scheduling capabilities with placement</a>
introduces how to implement a customized score provider.</p>
<p>Refer to the
<a href="https://github.com/open-cluster-management-io/enhancements/blob/main/enhancements/sig-architecture/32-extensiblescheduling/32-extensiblescheduling.md">enhancements</a>
to learn more.</p>
<h2 id="placementdecisions">PlacementDecisions</h2>
<p>A slice of <code>PlacementDecision</code> will be created by placement controller in the
same namespace, each with a label of
<code>cluster.open-cluster-management.io/placement={placement name}</code>.
<code>PlacementDecision</code> contains the results of the cluster selection as seen in the
following examples.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: cluster.open-cluster-management.io/v1beta1
<span style="color:#66d9ef">kind</span>: PlacementDecision
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">labels</span>:
    <span style="color:#66d9ef">cluster.open-cluster-management.io/placement</span>: placement1
  <span style="color:#66d9ef">name</span>: placement1-decision<span style="color:#ae81ff">-1</span>
  <span style="color:#66d9ef">namespace</span>: default
<span style="color:#66d9ef">status</span>:
  <span style="color:#66d9ef">decisions</span>:
    - <span style="color:#66d9ef">clusterName</span>: cluster1
    - <span style="color:#66d9ef">clusterName</span>: cluster2
    - <span style="color:#66d9ef">clusterName</span>: cluster3
</code></pre></div><p>The <code>status.decisions</code> lists the top N clusters with the highest score and ordered
by names. The <code>status.decisions</code> changes over time, the scheduling result update
based on what endpoints exist.</p>
<p>The scheduling result in the <code>PlacementDecision</code> API is designed to
be paginated with its page index as the name&rsquo;s suffix to avoid &ldquo;too large
object&rdquo; issue from the underlying Kubernetes API framework.</p>
<p><code>PlacementDecision</code> can be consumed by another operand to decide how the
workload should be placed in multiple clusters.</p>
<h3 id="decision-strategy">Decision strategy</h3>
<p>The <code>decisionStrategy</code> section of <code>Placement</code> can be used to divide the created
<code>PlacementDecision</code> into groups and define the number of clusters per decision group.</p>
<p>Assume an environment has 310 clusters, 10 of which have the label prod-canary-west
and 10 have the label prod-canary-east. The following example demonstrates how to group
the clusters with the labels prod-canary-west and prod-canary-east into 2 groups, and
group the remaining clusters into groups with a maximum of 150 clusters each.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: cluster.open-cluster-management.io/v1beta1
<span style="color:#66d9ef">kind</span>: Placement
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: placement1
  <span style="color:#66d9ef">namespace</span>: default
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">clusterSets</span>:
    - global
  <span style="color:#66d9ef">decisionStrategy</span>:
    <span style="color:#66d9ef">groupStrategy</span>:
      <span style="color:#66d9ef">clustersPerDecisionGroup</span>: <span style="color:#ae81ff">150</span>
      <span style="color:#66d9ef">decisionGroups</span>:
      - <span style="color:#66d9ef">groupName</span>: prod-canary-west
        <span style="color:#66d9ef">groupClusterSelector</span>:
          <span style="color:#66d9ef">labelSelector</span>:
            <span style="color:#66d9ef">matchExpressions</span>:
              - <span style="color:#66d9ef">key</span>: prod-canary-west
                <span style="color:#66d9ef">operator</span>: Exists
      - <span style="color:#66d9ef">groupName</span>: prod-canary-east
        <span style="color:#66d9ef">groupClusterSelector</span>:
          <span style="color:#66d9ef">labelSelector</span>:
            <span style="color:#66d9ef">matchExpressions</span>:
              - <span style="color:#66d9ef">key</span>: prod-canary-east
                <span style="color:#66d9ef">operator</span>: Exists
</code></pre></div><p>The <code>decisionStrategy</code> section includes the following fields:</p>
<ul>
<li><code>decisionGroups</code>: Represents a list of predefined groups to put decision results.
Decision groups will be constructed based on the <code>decisionGroups</code> field at first.
The clusters not included in the <code>decisionGroups</code> will be divided to other decision
groups afterwards. Each decision group should not have the number of clusters
larger than the <code>clustersPerDecisionGroup</code>.
<ul>
<li><code>groupName</code>: Represents the name to be added as the value of label key <code>cluster.open-cluster-management.io/decision-group-name</code>
of created <code>PlacementDecisions</code>.</li>
<li><code>groupClusterSelector</code>: Defines the label selector to select clusters subset by label.</li>
</ul>
</li>
<li><code>clustersPerDecisionGroup</code>: A specific number or percentage of the total selected
clusters. The specific number will divide the placementDecisions to decisionGroups,
the max number of clusters in each group equal to that specific number.</li>
</ul>
<p>With this decision strategy defined, the placement status will list the group result,
including the decision group name and index, the cluster count, and the corresponding
<code>PlacementDecision</code> names.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">status</span>:
...
  <span style="color:#66d9ef">decisionGroups</span>:
  - <span style="color:#66d9ef">clusterCount</span>: <span style="color:#ae81ff">10</span>
    <span style="color:#66d9ef">decisionGroupIndex</span>: <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">decisionGroupName</span>: prod-canary-west
    <span style="color:#66d9ef">decisions</span>:
    - placement1-decision<span style="color:#ae81ff">-1</span>
  - <span style="color:#66d9ef">clusterCount</span>: <span style="color:#ae81ff">10</span>
    <span style="color:#66d9ef">decisionGroupIndex</span>: <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">decisionGroupName</span>: prod-canary-east
    <span style="color:#66d9ef">decisions</span>:
    - placement1-decision<span style="color:#ae81ff">-2</span>
  - <span style="color:#66d9ef">clusterCount</span>: <span style="color:#ae81ff">150</span>
    <span style="color:#66d9ef">decisionGroupIndex</span>: <span style="color:#ae81ff">2</span>
    <span style="color:#66d9ef">decisionGroupName</span>: <span style="color:#e6db74">&#34;&#34;</span>
    <span style="color:#66d9ef">decisions</span>:
    - placement1-decision<span style="color:#ae81ff">-3</span>
    - placement1-decision<span style="color:#ae81ff">-4</span>
  - <span style="color:#66d9ef">clusterCount</span>: <span style="color:#ae81ff">140</span>
    <span style="color:#66d9ef">decisionGroupIndex</span>: <span style="color:#ae81ff">3</span>
    <span style="color:#66d9ef">decisionGroupName</span>: <span style="color:#e6db74">&#34;&#34;</span>
    <span style="color:#66d9ef">decisions</span>:
    - placement1-decision<span style="color:#ae81ff">-5</span>
    - placement1-decision<span style="color:#ae81ff">-6</span>
  <span style="color:#66d9ef">numberOfSelectedClusters</span>: <span style="color:#ae81ff">310</span>
</code></pre></div><p>The <code>PlacementDecision</code> will have labels <code>cluster.open-cluster-management.io/decision-group-name</code>
and <code>cluster.open-cluster-management.io/decision-group-index</code> to indicate which group name
and group index it belongs to.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: cluster.open-cluster-management.io/v1beta1
<span style="color:#66d9ef">kind</span>: PlacementDecision
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">labels</span>:
    <span style="color:#66d9ef">cluster.open-cluster-management.io/placement</span>: placement1
    <span style="color:#66d9ef">cluster.open-cluster-management.io/decision-group-index</span>: <span style="color:#e6db74">&#34;0&#34;</span>
    <span style="color:#66d9ef">cluster.open-cluster-management.io/decision-group-name</span>: prod-canary-west
  <span style="color:#66d9ef">name</span>: placement1-decision<span style="color:#ae81ff">-1</span>
  <span style="color:#66d9ef">namespace</span>: default
...
</code></pre></div><h3 id="rollout-strategy">Rollout Strategy</h3>
<p>Rollout Strategy <a href="https://github.com/open-cluster-management-io/api/blob/main/cluster/v1alpha1/types_rolloutstrategy.go">API</a> facilitate the use of placement decision strategy with OCM workload applier APIs such as Policy, <a href="https://open-cluster-management.io/concepts/addon/#add-on-rollout-strategy">Addon</a> and <a href="https://open-cluster-management.io/concepts/manifestworkreplicaset/">ManifestWorkReplicaSet</a> to apply workloads.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">    <span style="color:#66d9ef">placements</span>:
    - <span style="color:#66d9ef">name</span>: placement-example
      <span style="color:#66d9ef">rolloutStrategy</span>:
        <span style="color:#66d9ef">type</span>: Progressive
        <span style="color:#66d9ef">progressive</span>:
          <span style="color:#66d9ef">mandatoryDecisionGroups</span>:
          - <span style="color:#66d9ef">groupName</span>: <span style="color:#e6db74">&#34;prod-canary-west&#34;</span>
          - <span style="color:#66d9ef">groupName</span>: <span style="color:#e6db74">&#34;prod-canary-east&#34;</span>
          <span style="color:#66d9ef">maxConcurrency</span>: <span style="color:#ae81ff">25</span>%
          <span style="color:#66d9ef">minSuccessTime</span>: 5m
          <span style="color:#66d9ef">progressDeadline</span>: 10m
          <span style="color:#66d9ef">maxFailures</span>: <span style="color:#ae81ff">2</span>
</code></pre></div><p>The Rollout Strategy API provides three rollout types;</p>
<ol>
<li><strong>All</strong>: means apply the workload to all clusters in the decision groups at once.</li>
<li><strong>Progressive</strong>: means apply the workload to the selected clusters progressively per cluster. The workload will not be applied to the next cluster unless one of the current applied clusters reach the successful state and haven&rsquo;t breached the MaxFailures configuration.</li>
<li><strong>ProgressivePerGroup</strong>: means apply the workload to decisionGroup clusters progressively per group. The workload will not be applied to the next decisionGroup unless all clusters in the current group reach the successful state and haven&rsquo;t breached the MaxFailures configuration.</li>
</ol>
<p>The RollOut Strategy API also provides rollOut config to fine-tune the workload apply progress based on the use-case requirements;</p>
<ol>
<li><strong>MinSuccessTime</strong>: defined in seconds/minutes/hours for how long workload applier controller will wait from the beginning of the rollout to proceed with the next rollout, assuming a successful state had been reached and MaxFailures hasn&rsquo;t been breached. Default is 0 meaning the workload applier proceeds immediately after a successful state is reached.</li>
<li><strong>ProgressDeadline</strong>: defined in seconds/minutes/hours for how long workload applier controller will wait until the workload reaches a successful state in the spoke cluster.
If the workload does not reach a successful state after ProgressDeadline, the controller will stop waiting and workload will be treated as &ldquo;timeout&rdquo; and be counted into MaxFailures. Once the MaxFailures is breached, the rollout will stop. Default value is &ldquo;None&rdquo;, meaning the workload applier will wait for a successful state indefinitely.</li>
<li><strong>MaxFailures</strong>: defined as the maximum percentage of or number of clusters that can fail in order to proceed with the rollout. Fail means the cluster has a failed status or timeout status (does not reach successful status after ProgressDeadline). Once the MaxFailures is breached, the rollout will stop. Default is 0 means that no failures are tolerated.</li>
<li><strong>MaxConcurrency</strong>: is the max number of clusters to deploy workload concurrently. The MaxConcurrency can be defined only in case rollout type is progressive.</li>
<li><strong>MandatoryDecisionGroups</strong>: is a list of decision groups to apply the workload first. If mandatoryDecisionGroups not defined the decision group index is considered to apply the workload in groups by order. The MandatoryDecisionGroups can be defined only in case rollout type is progressive or progressivePerGroup.</li>
</ol>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>If no <code>PlacementDecision</code> generated after you creating <code>Placement</code>, you can run below commands to troubleshoot.</p>
<h3 id="check-the-placement-conditions">Check the <code>Placement</code> conditions</h3>
<p>For example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl describe placement &lt;placement-name&gt; 
Name:         demo-placement
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
API Version:  cluster.open-cluster-management.io/v1beta1
Kind:         Placement
...
Status:
  Conditions:
    Last Transition Time:       2022-09-30T07:39:45Z
    Message:                    Placement configurations check pass
    Reason:                     Succeedconfigured
    Status:                     False
    Type:                       PlacementMisconfigured
    Last Transition Time:       2022-09-30T07:39:45Z
    Message:                    No valid ManagedClusterSetBindings found in placement namespace
    Reason:                     NoManagedClusterSetBindings
    Status:                     False
    Type:                       PlacementSatisfied
  Number Of Selected Clusters:  <span style="color:#ae81ff">0</span>
...
</code></pre></div><p>The Placement has 2 types of condition, <code>PlacementMisconfigured</code> and <code>PlacementSatisfied</code>.</p>
<ul>
<li>If the condition <code>PlacementMisconfigured</code> is true, means your placement has configuration errors, the message tells you more details about the failure.</li>
<li>If the condition <code>PlacementSatisfied</code> is false, means no <code>ManagedCluster</code> satisfy this placement, the message tells you more details about the failure.
In this example, it is because no <code>ManagedClusterSetBindings</code> found in placement namespace.</li>
</ul>
<h3 id="check-the-placement-events">Check the <code>Placement</code> events</h3>
<p>For example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl describe placement &lt;placement-name&gt; 
Name:         demo-placement
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
API Version:  cluster.open-cluster-management.io/v1beta1
Kind:         Placement
...
Events:
  Type    Reason          Age   From                 Message
  ----    ------          ----  ----                 -------
  Normal  DecisionCreate  2m10s   placementController  Decision demo-placement-decision-1 is created with placement demo-placement in namespace default
  Normal  DecisionUpdate  2m10s   placementController  Decision demo-placement-decision-1 is updated with placement demo-placement in namespace default
  Normal  ScoreUpdate     2m10s   placementController  cluster1:0 cluster2:100 cluster3:200
  Normal  DecisionUpdate  3s      placementController  Decision demo-placement-decision-1 is updated with placement demo-placement in namespace default
  Normal  ScoreUpdate     3s      placementController  cluster1:200 cluster2:145 cluster3:189 cluster4:200
</code></pre></div><p>The placement controller will give a score to each filtered <code>ManagedCluster</code> and generate an event for it. When the cluster score
changes, a new event will generate. You can check the score of each cluster in the <code>Placment</code> events, to know why some clusters with lower score are not selected.</p>
<h3 id="debug">Debug</h3>
<p>If you want to know more defails of how clusters are selected in each step, can following below step to access the debug endpoint.</p>
<p>Create clusterrole &ldquo;debugger&rdquo; to access debug path and bind this to anonymous user.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl create clusterrole <span style="color:#e6db74">&#34;debugger&#34;</span> --verb<span style="color:#f92672">=</span>get --non-resource-url<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/debug/*&#34;</span>
kubectl create clusterrolebinding debugger --clusterrole<span style="color:#f92672">=</span>debugger --user<span style="color:#f92672">=</span>system:anonymous
</code></pre></div><p>Export placement 8443 port to local.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl port-forward -n open-cluster-management-hub deploy/cluster-manager-placement-controller 8443:8443
</code></pre></div><p>Curl below url to debug one specific placement.</p>
<pre><code>curl -k  https://127.0.0.1:8443/debug/placements/&lt;namespace&gt;/&lt;name&gt;
</code></pre><p>For example, the environment has a <code>Placement</code> named placement1 in default namespace, which selects 2 <code>ManagedClusters</code>, the output would be like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -k  https://127.0.0.1:8443/debug/placements/default/placement1
<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;filteredPiplieResults&#34;</span>:<span style="color:#f92672">[{</span><span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Predicate&#34;</span>,<span style="color:#e6db74">&#34;filteredClusters&#34;</span>:<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;cluster1&#34;</span>,<span style="color:#e6db74">&#34;cluster2&#34;</span><span style="color:#f92672">]}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Predicate,TaintToleration&#34;</span>,<span style="color:#e6db74">&#34;filteredClusters&#34;</span>:<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;cluster1&#34;</span>,<span style="color:#e6db74">&#34;cluster2&#34;</span><span style="color:#f92672">]}]</span>,<span style="color:#e6db74">&#34;prioritizeResults&#34;</span>:<span style="color:#f92672">[{</span><span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Balance&#34;</span>,<span style="color:#e6db74">&#34;weight&#34;</span>:1,<span style="color:#e6db74">&#34;scores&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;cluster1&#34;</span>:100,<span style="color:#e6db74">&#34;cluster2&#34;</span>:100<span style="color:#f92672">}}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Steady&#34;</span>,<span style="color:#e6db74">&#34;weight&#34;</span>:1,<span style="color:#e6db74">&#34;scores&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;cluster1&#34;</span>:100,<span style="color:#e6db74">&#34;cluster2&#34;</span>:100<span style="color:#f92672">}}]}</span>
</code></pre></div><h2 id="future-work">Future work</h2>
<p>In addition to selecting cluster by predicates, we are still working on other
advanced features including</p>
<ul>
<li><a href="https://github.com/open-cluster-management-io/community/issues/49">Various workload spread
policies</a>.</li>
</ul>

</div>
<script type="text/javascript" src="/clipboard-copy.js"></script>
</div>
        </div>
        <div class="row"><nav class="ocm navbar navbar-expand-lg navbar-dark py-3">
  <div class="container-fluid flex-wrap flex-md-nowrap">
    <div class="text-light">&copy; 2024 Open Cluster Management Authors. The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href="https://www.linuxfoundation.org/trademark-usage/" target="_blank" style="color: #f8f9fa;">Trademark Usage</a></div>
  </div>
</nav>
<script type="text/javascript" src="/lang.js"></script>
</div>
    </div>
</body>
</html>
