<!DOCTYPE html>
<html><head>
  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"/>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css"/>
  <link rel="stylesheet" href="/main.css"/>
  <link rel="shortcut icon" type="image/svg" href="/ocm.svg">
  <title>Open Cluster Management</title>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1PXKZXT157"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1PXKZXT157');
  </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">




<input id="current-lang" type="hidden" value="en">

<header class="navbar navbar-expand-md navbar-dark bd-navbar">
  <nav class="navbar navbar-expand-lg navbar-dark py-3 fixed-top">
    <div class="container-fluid flex-wrap flex-md-nowrap">
      <a href="/" class="navbar-brand">
        <img src="/ocm.svg" alt="" width="30" height="24" class="align-text-top">
        Open Cluster Management
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navmenu">
        <ul class="navbar-nav ms-auto ">
          <li class="nav-item pe-2">
            <a href="/community" class="nav-link text-light">Community</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/contribute" class="nav-link text-light">Contribute</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/concepts" class="nav-link text-light">Document</a>
          </li>
          <li class="nav-item dropdown pe-2">
            
            <a class="nav-link dropdown-toggle text-light" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">English</a>
            

            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              
              <li><a class="dropdown-item" href="#" id="to-zh">中文</a></li>
              
            </ul>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://www.youtube.com/c/OpenClusterManagement" target="_blank">
                <i class="bi bi-youtube"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://github.com/open-cluster-management-io" target="_blank">
              <i class="bi bi-github"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://kubernetes.slack.com/channels/open-cluster-mgmt" target="_blank">
              <i class="bi bi-slack"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>
</div>
        <div class="row subject-padding">
            <div class="col-2 col-md-3 padding-none sidebar-bgc">




<div class="sidebar-toggle sidebar-toggle-sm">
    <button type="button" id="sidebarToggle" class="btn btn-info">
        <i class="bi bi-list"></i>
    </button>
</div>
<nav id="sidebar" class="sidebar-hide-sm">
    <ul class="components">
        <li id="concepts">
            <a class="navlink" href="/concepts">Concepts</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/concepts/architecture">Architecture</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/clusterclaim">ClusterClaim</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/managedcluster">ManagedCluster</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/manifestwork">ManifestWork</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/managedclusterset">ManagedClusterSet</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/placement">Placement</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/addon">Add-ons</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/policy">Policy</a>
                </li>
            </ul>
        </li>
        <li id="getting-started">
            <a class="navlink" href="/getting-started">Getting Started</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/getting-started/quick-start">Quick Start</a>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/core">Core Components</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/getting-started/core/cluster-manager">Cluster Manager</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/core/register-cluster">Klusterlet Agent</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/integration">Add-ons and Integrations</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/getting-started/integration/app-lifecycle">Application lifecycle management</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/cluster-proxy">Cluster proxy</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/policy-framework">Policy framework</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/policy-controllers">Policy controllers</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/managed-serviceaccount">Managed service account</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/administration">Administration</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/getting-started/administration/upgrading">Upgrading</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </li>
        <li id="developer-guides">
            <a class="navlink" href="/developer-guides">Developer Guides</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/developer-guides/addon">Add-on Developer Guide</a>
                </li>
                <li>
                    <a class="navlink" href="/developer-guides/vscode-extension">VScode Extension</a>
                </li>
            </ul>
        </li>
        <li id="scenarios">
            <a class="navlink" href="/scenarios">Scenarios</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/scenarios/deploy-kubernetes-resources">Deploy Kubernetes Resources</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/distribute-workload-with-placement">Distribute Workload With Placement</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/extend-multicluster-scheduling-capabilities">Extend Multicluster Scheduling Capabilities</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/extending-managed-clusters">Extend Managed Clusters</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/integration-with-argocd">Integration with Argo CD</a>
                </li>                
                <li>
                    <a class="navlink" href="/scenarios/pushing-kube-api-requests">Pushing Kube API Requests to the Managed Clusters</a>
                </li>
            </ul>
        </li>
        <li id="community">
            <a class="navlink" href="/community">Community</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/community/releases">Releases</a>
                </li>
                <li >
                    <a class="navlink" href="/community/roadmap">Roadmap</a>
                </li>
            </ul>
        </li>
        <li id="contribute">
            <a class="navlink" href="/contribute">Contribute</a>
        </li>
        <li id="blog">
            <a class="navlink" href="/blog">Blog</a>
        </li>
        <li style="padding-top: 10px; border-top: 2px solid #448a78;">
            <a class="navlink resource" href="https://github.com/open-cluster-management-io" target="_blank"><i class="bi bi-github"></i><span style="padding-left: 10px;">GitHub</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://kubernetes.slack.com/channels/open-cluster-mgmt" target="_blank"><i class="bi bi-slack"></i><span style="padding-left: 10px;">Slack</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://www.youtube.com/c/OpenClusterManagement" target="_blank"><i class="bi bi-youtube"></i><span style="padding-left: 10px;">YouTube</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://groups.google.com/g/open-cluster-management" target="_blank"><i class="bi bi-envelope-fill"></i><span style="padding-left: 10px;">Mailing group</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://calendar.google.com/calendar/u/0/embed?src=openclustermanagement@gmail.com" target="_blank"><i class="bi bi-calendar-event-fill"></i><span style="padding-left: 10px;">Community meetings</span></a>
        </li>
    </ul>
</nav>
<script type="text/javascript" src="/sidebar.js"></script>
</div>
            <div class="col-10 col-md-9 padding-none">
<div id="content">
    <h1>Architecture</h1>
    <p>This page is an overview of open cluster management.</p>
<!-- spellchecker-disable -->



  <div class="gdoc-toc gdoc-toc__level--6"><nav id="TableOfContents"><ul>
        <li><a href="#overview">Overview</a>
          <ul>
            <li><a href="#hub-spoke-architecture">&ldquo;Hub-spoke&rdquo; architecture</a></li>
            <li><a href="#modularity-and-extensibility">Modularity and extensibility</a></li>
          </ul>
        </li>
        <li><a href="#concepts">Concepts</a>
          <ul>
            <li><a href="#cluster-registering-double-opt-in-handshaking">Cluster registering: &ldquo;double opt-in handshaking&rdquo;</a></li>
            <li><a href="#cluster-registration-security-model">Cluster registration security model</a></li>
            <li><a href="#cluster-namespace">Cluster namespace</a></li>
            <li><a href="#addons">Addons</a></li>
          </ul>
        </li>
        <li><a href="#building-blocks">Building blocks</a>
          <ul>
            <li><a href="#registration">Registration</a></li>
            <li><a href="#work">Work</a></li>
            <li><a href="#placement">Placement</a></li>
            <li><a href="#application-lifecycle">Application lifecycle</a></li>
            <li><a href="#governance-and-risk">Governance and risk</a></li>
            <li><a href="#registration-operator">Registration operator</a></li>
          </ul>
        </li>
      </ul></nav><hr></div>


<!-- spellchecker-enable -->
<h2 id="overview">Overview</h2>
<p><strong>Open Cluster Management</strong> (OCM) is a powerful, modular, extensible platform
for Kubernetes multi-cluster orchestration. Learning from the past failing
lesson of building Kubernetes federation systems in the Kubernetes community,
in OCM we will be jumping out of the legacy centric, imperative architecture of
<a href="https://github.com/kubernetes-sigs/kubefed">Kubefed v2</a> and embracing the
&ldquo;hub-agent&rdquo; architecture which is identical to the original pattern of
&ldquo;hub-kubelet&rdquo; from Kubernetes. Hence, intuitively in OCM our multi-cluster
control plane is modeled as a &ldquo;Hub&rdquo; and on the other hand each of the clusters
being managed by the &ldquo;Hub&rdquo; will be a &ldquo;Klusterlet&rdquo; which is obviously inspired
from the original name of &ldquo;kubelet&rdquo;. Here&rsquo;s a more detailed clarification of
the two models we will be frequently using throughout the world of OCM:</p>
<ul>
<li>
<p><strong>Hub Cluster</strong>: Indicating the cluster that runs the multi-cluster control
plane of OCM. Generally the hub cluster is supposed to be a light-weight
Kubernetes cluster hosting merely a few fundamental controllers and services.</p>
</li>
<li>
<p><strong>Klusterlet</strong>: Indicating the clusters that being managed by the hub
cluster. Klusterlet might also be called &ldquo;managed cluster&rdquo; or &ldquo;spoke cluster&rdquo;. The
klusterlet is supposed to actively <strong>pulling</strong> the latest prescriptions from
the hub cluster and consistently reconciles the physical Kubernetes cluster
to the expected state.</p>
</li>
</ul>
<h3 id="hub-spoke-architecture">&ldquo;Hub-spoke&rdquo; architecture</h3>
<p>Benefiting from the merit of <a href="https://en.wikipedia.org/wiki/Spoke%E2%80%93hub_distribution_paradigm">&ldquo;hub-spoke&rdquo;</a> architecture, in abstraction we
are de-coupling most of the multi-cluster operations generally into
(1) computation/decision and (2) execution, and the actual execution against
the target cluster will be completely off-loaded into the managed cluster. The
hub cluster won&rsquo;t directly request against the real clusters, instead it
just persists its prescriptions declaratively for each cluster, and the
klusterlet will be actively pulling the prescriptions from the hub and doing
the execution. Hence, the burden of the hub cluster will be greatly relieved
because the hub cluster doesn&rsquo;t need to either deal with flooding events from
the managed clusters or be buried in sending requests against the clusters.
Imagine in a world where there&rsquo;s no kubelet in Kubernetes and its control plane
is directly operating the container daemons, it will be extremely hard for a
centric controller to manage a cluster of 5k+ nodes. Likewise, that&rsquo;s how OCM
trying to breach the bottleneck of scalability, by dividing and offloading the
execution into separated agents. So it&rsquo;s always feasible for a hub cluster to
accept and manage thousand-ish clusters.</p>
<p>Each klusterlet will be working independently and autonomously, so they have
a weak dependency to the availability of the hub cluster. If the hub goes down
(e.g. during maintenance or network partition) the klusterlet or other OCM
agents working in the managed cluster are supposed to keep actively managing
the hosting cluster until it re-connects. Additionally if the hub cluster and
the managed clusters are owned by different admins, it will be easier for the
admin of the managed cluster to police the prescriptions from the hub control
plane because the klusterlet is running as a &ldquo;white-box&rdquo; as a pod instance in
the managed cluster. Upon any accident, the klusterlet admin can quickly cut
off the connection with the hub cluster without shutting the whole multi-cluster
control plane down.</p>
<div style="text-align: center; padding: 20px;">
    <img src="https://github.com/open-cluster-management-io/OCM/raw/main/assets/ocm-arch.png" alt="Architecture diagram" style="margin: 0 auto; width: 50%">
</div>
<p>The &ldquo;hub-agent&rdquo; architecture also minimized the requirements in the network
for registering a new cluster to the hub. Any cluster that can reach the
endpoint of the hub cluster will be able to be managed, even a random KinD
sandbox cluster on your laptop. That is because the prescriptions are
effectively <strong>pulled</strong> from the hub instead of <strong>pushing</strong>. In addition to
that, OCM also provides a <a href="https://open-cluster-management.io/concepts/addon/">addon</a>
named <a href="https://open-cluster-management.io/getting-started/integration/cluster-proxy/">&ldquo;cluster-proxy&rdquo;</a>
which automatically manages a reverse proxy tunnel for proactive access to the
managed clusters by leveraging on the Kubernetes&rsquo; subproject <a href="https://kubernetes.io/docs/tasks/extend-kubernetes/setup-konnectivity/">konnectivity</a>.</p>
<h3 id="modularity-and-extensibility">Modularity and extensibility</h3>
<p>Not only OCM will bring you a fluent user-experience of managing a number of
clusters on ease, but also it will be equally friendly to further customization
or second-time development. Every functionality working in OCM is expected to
be freely-pluggable by modularizing the atomic capability into separated
building blocks, except for the mandatory core module named <a href="https://github.com/open-cluster-management-io/registration">registration</a>
which is responsible for controlling the lifecycle of a managed controller
and exporting the elementary <code>ManagedCluster</code> model.</p>
<p>Another good example surfacing our modularity will be the <a href="https://open-cluster-management.io/concepts/placement/">placement</a>,
a standalone module focusing at dynamically selecting the proper list of
the managed clusters from the user&rsquo;s prescription. You can build any advanced
multi-cluster orchestration on the top of placement, e.g. multi-cluster
workload re-balancing, multi-cluster helm charts replication, etc. On the
other hand if you&rsquo;re not satisfied by the current capacities from our placement
module, you can quickly opt-out and replace it with your customized ones, and
reach out to our community so that we can converge in the future if possible.</p>
<hr>
<h2 id="concepts">Concepts</h2>
<h3 id="cluster-registering-double-opt-in-handshaking">Cluster registering: &ldquo;double opt-in handshaking&rdquo;</h3>
<p>Practically the hub cluster and the managed cluster can be owned/maintained
by different admins, so in OCM we clearly separated the roles and make the
cluster registration require approval from the both sides defending from unwelcome
requests. In terms of terminating the registration, the hub admin can kick
out a registered cluster by denying the rotation of hub cluster&rsquo;s certificate,
on the other hand from the perspective of a managed cluster&rsquo;s admin, he can
either brutally deleting the agent instances or revoking the granted RBAC
permissions for the agents. Note that the hub controller will be automatically
preparing environment for the newly registered cluster and cleaning up neatly
upon kicking a managed cluster.</p>
<div style="text-align: center; padding: 20px;">
   <img src="/double-optin-registration.png" alt="Double opt-in handshaking" style="margin: 0 auto; width: 60%">
</div>
<h3 id="cluster-registration-security-model">Cluster registration security model</h3>
<div style="text-align: center; padding: 20px;">
   <img src="/security-model.png" alt="Security model" style="margin: 0 auto; width: 60%">
</div>
<p>The worker cluster admin can list and read any managed cluster’s CSR,
but those CSR cannot be used to impersonate due to the fact that CSR only
contains the certificate. The client authentication requires both the key and certificate.
The key is stored in each managed cluster, and it will not be transmitted across the network.</p>
<p>The worker cluster admin cannot approve his or her own cluster registration by default.
Two separate RBAC rules are needed to approve a cluster registration.
The permission to approve the CSR and the permission to accept the managed cluster.
Only the cluster admin on hub has both permissions and can accept the cluster registration request.
The second accept permission is gated by a webhook.</p>
<h3 id="cluster-namespace">Cluster namespace</h3>
<p>Kubernetes has a native soft multi-tenancy isolation in the granularity of
its namespace resources, so in OCM, for each of the managed cluster we will
be provisioning a dedicated namespace for the managed cluster and grants
sufficient RBAC permissions so that the klusterlet can persist some data
in the hub cluster. This dedicated namespace is the &ldquo;cluster namespace&rdquo; which
is majorly for saving the prescriptions from the hub. e.g. we can create
<code>ManifestWork</code> in a cluster namespace in order to deploy some resources towards
the corresponding cluster. Meanwhile, the cluster namespace can also be used
to save the uploaded stats from the klusterlet e.g. the healthiness of an
addon, etc.</p>
<h3 id="addons">Addons</h3>
<p>Addon is a general concept for the optional, pluggable customization built over
the extensibility from OCM. It can be a controller in the hub cluster, or just
a customized agent in the managed cluster, or even the both collaborating
in peers. The addons are expected to implement the <code>ClusterManagementAddon</code> or
<code>ManagedClusterAddOn</code> API of which a detailed elaboration can be found <a href="https://open-cluster-management.io/concepts/addon/">here</a>.</p>
<hr>
<h2 id="building-blocks">Building blocks</h2>
<p>The following is a list of commonly-used modules/subprojects that you might
be interested in the journey of OCM:</p>
<h3 id="registration">Registration</h3>
<p>The core module of OCM manages the lifecycle of the managed clusters. The
registration controller in the hub cluster can be intuitively compared to a
broker that represents and manages the hub cluster in terms of cluster
registration, while the registration agent working in the managed cluster
is another broker that represents the managed cluster. After a successful
registration, the registration controller and agent will also be consistently
probing each other&rsquo;s healthiness. i.e. the cluster heartbeats.</p>
<h3 id="work">Work</h3>
<p>The module for dispatching resources from the hub cluster to the managed
clusters, which can be easily done by writing a <code>ManifestWork</code> resource into
a cluster namespace. See more details about the API <a href="https://open-cluster-management.io/concepts/manifestwork/">here</a>.</p>
<h3 id="placement">Placement</h3>
<p>Building custom advanced topology across the clusters by either grouping
clusters via the labels or the cluster-claims. The placement module is
completely decoupled from the execution, the output from placement will
be merely a list of names of the matched clusters in the <code>PlacementDecision</code>
API, so the consumer controller of the decision output can reactively
discovery the topology or availability change from the managed clusters by
simply list-watching the decision API.</p>
<h3 id="application-lifecycle">Application lifecycle</h3>
<p>The <em>application lifecycle</em> defines the processes that are used to manage
application resources on your managed clusters. A multi-cluster application
uses a Kubernetes specification, but with additional automation of the
deployment and lifecycle management of resources to individual clusters. A
multi-cluster application allows you to deploy resources on multiple clusters,
while maintaining easy-to-reconcile service routes, as well as full control
of Kubernetes resource updates for all aspects of the application.</p>
<h3 id="governance-and-risk">Governance and risk</h3>
<p><em>Governance and risk</em> is the term used to define the processes that are used
to manage security and compliance from the hub cluster. Ensure the security
of your cluster with the extensible policy framework. After you configure a hub
cluster and a managed cluster, you can create, modify and delete policies on
the hub and apply policies to the managed clusters.</p>
<h3 id="registration-operator">Registration operator</h3>
<p>Automating the installation and upgrading of a few built-in modules in OCM. You
can either deploy the operator standalone or delegate the registration operator
to the operator lifecycle framework.</p>

</div>
<script type="text/javascript" src="/clipboard-copy.js"></script>
</div>
        </div>
        <div class="row"><nav class="ocm navbar navbar-expand-lg navbar-dark py-3">
  <div class="container-fluid flex-wrap flex-md-nowrap">
    <div class="text-light">&copy; 2021 Open Cluster Management Authors. The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href="https://www.linuxfoundation.org/trademark-usage/" target="_blank" style="color: #f8f9fa;">Trademark Usage</a></div>
  </div>
</nav>
<script type="text/javascript" src="/lang.js"></script>
</div>
    </div>
</body>
</html>
