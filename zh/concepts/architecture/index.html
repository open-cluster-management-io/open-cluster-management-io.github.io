<!DOCTYPE html>
<html><head>
  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"/>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css"/>
  <link rel="stylesheet" href="/main.css"/>
  <link rel="shortcut icon" type="image/svg" href="/ocm.svg">
  <title>Open Cluster Management</title>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1PXKZXT157"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1PXKZXT157');
  </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">



    


<input id="current-lang" type="hidden" value="zh">

<header class="navbar navbar-expand-md navbar-dark bd-navbar">
  <nav class="navbar navbar-expand-lg navbar-dark py-3 fixed-top">
    <div class="container-fluid flex-wrap flex-md-nowrap">
      <a href="/zh/" class="navbar-brand">
        <img src="/ocm.svg" alt="" width="30" height="24" class="align-text-top">
        Open Cluster Management
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navmenu">
        <ul class="navbar-nav ms-auto ">
          <li class="nav-item pe-2">
            <a href="/zh/community" class="nav-link text-light">社区</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/zh/contribute" class="nav-link text-light">贡献</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/zh/concepts" class="nav-link text-light">文档</a>
          </li>
          <li class="nav-item dropdown pe-2">
            
            <a class="nav-link dropdown-toggle text-light" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">中文</a>
            

            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              
              <li><a class="dropdown-item" href="#" id="to-en">English</a></li>
              
            </ul>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://www.youtube.com/channel/UC7xxOh2jBM5Jfwt3fsBzOZw" target="_blank">
                <i class="bi bi-youtube"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://github.com/open-cluster-management-io" target="_blank">
              <i class="bi bi-github"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://kubernetes.slack.com/?redir=%2Farchives%2FC01GE7YSUUF" target="_blank">
              <i class="bi bi-slack"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>
</div>
        <div class="row subject-padding">
            <div class="col-2 col-md-3 padding-none sidebar-bgc">



    


<div class="sidebar-toggle sidebar-toggle-sm">
    <button type="button" id="sidebarToggle" class="btn btn-info">
        <i class="bi bi-list"></i>
    </button>
</div>
<nav id="sidebar" class="sidebar-hide-sm">
    <ul class="components">
        <li id="concepts">
            <a class="navlink" href="/zh/concepts">概念</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/zh/concepts/architecture">架构</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/managedcluster">托管集群</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/manifestwork">资源下发</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/managedclusterset">托管集群分组</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/placement">匹配路由</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/addon">自定义插件</a>
                </li>
            </ul>
        </li>
        <li id="getting-started">
            <a class="navlink" href="/zh/getting-started">安装</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/zh/getting-started/quick-start">快速开始</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/getting-started/core">核心组件</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/zh/getting-started/core/cluster-manager">中枢控制器</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/core/register-cluster">集群代理控制器</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/zh/getting-started/integration">插件和集成</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/app-lifecycle">应用生命周期管理</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/cluster-proxy">多集群网络隧道</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/policy-framework">Policy框架</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/policy-controllers">Policy控制器</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/managed-serviceaccount">托管多集群ServiceAccount</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/zh/getting-started/administration">运维管理</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/zh/getting-started/administration/upgrading">升级版本</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </li>
        <li id="scenarios">
            <a class="navlink" href="/zh/scenarios">应用场景</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/zh/scenarios/deploy-kubernetes-resources">部署Kubernetes资源</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/extending-managed-clusters">扩展集群模型</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/pushing-kube-api-requests">向托管集群推送Kube API请求</a>
                </li>
            </ul>
        </li>
        <li id="community">
            <a class="navlink" href="/zh/community">社区</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/zh/community/releases">发行版本</a>
                </li>
                <li >
                    <a class="navlink" href="/zh/community/roadmap">社区规划</a>
                </li>
            </ul>
        </li>
        <li id="contribute">
            <a class="navlink" href="/zh/contribute">贡献</a>
        </li>
        <li id="blog">
            <a class="navlink" href="/zh/blog">博客</a>
        </li>
        <li style="padding-top: 10px; border-top: 2px solid #448a78;">
            <a class="navlink resource" href="https://github.com/open-cluster-management-io" target="_blank"><i class="bi bi-github"></i><span style="padding-left: 10px;">GitHub</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://kubernetes.slack.com/archives/C01GE7YSUUF" target="_blank"><i class="bi bi-slack"></i><span style="padding-left: 10px;">Slack</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://www.youtube.com/channel/UC7xxOh2jBM5Jfwt3fsBzOZw" target="_blank"><i class="bi bi-youtube"></i><span style="padding-left: 10px;">YouTube</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://groups.google.com/g/open-cluster-management" target="_blank"><i class="bi bi-envelope-fill"></i><span style="padding-left: 10px;">Mailing group</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://calendar.google.com/calendar/u/0/embed?src=openclustermanagement@gmail.com" target="_blank"><i class="bi bi-calendar-event-fill"></i><span style="padding-left: 10px;">Community meetings</span></a>
        </li>
    </ul>
</nav>
<script type="text/javascript" src="/sidebar.js"></script>
</div>
            <div class="col-10 col-md-9 padding-none">
<div id="content">
    <h1>架构</h1>
    <p>本页是open cluster management的概览。</p>
<!-- spellchecker-disable -->



  <div class="gdoc-toc gdoc-toc__level--6"><nav id="TableOfContents"><ul>
        <li><a href="#概览">概览</a>
          <ul>
            <li><a href="#hub-agent-架构">hub-agent” 架构</a></li>
            <li><a href="#模块化和可扩展性">模块化和可扩展性</a></li>
          </ul>
        </li>
        <li><a href="#概念">概念</a>
          <ul>
            <li><a href="#集群注册-双重确认握手">集群注册: “双重确认握手”</a></li>
            <li><a href="#集群命名空间">集群命名空间</a></li>
            <li><a href="#插件">插件</a></li>
          </ul>
        </li>
        <li><a href="#构建块">构建块</a>
          <ul>
            <li><a href="#registration">Registration</a></li>
            <li><a href="#work">Work</a></li>
            <li><a href="#placement">Placement</a></li>
            <li><a href="#application-lifecycle">Application lifecycle</a></li>
            <li><a href="#governance-and-risk">Governance and risk</a></li>
            <li><a href="#registration-operator">Registration operator</a></li>
          </ul>
        </li>
      </ul></nav><hr></div>


<!-- spellchecker-enable -->
<h2 id="概览">概览</h2>
<p><strong>Open Cluster Management</strong> (OCM) 是用于Kubernetes多集群编排的一个功能强大，模块化，可扩展的平台。
通过吸取过去在Kubernetes社区构建联邦系统的失败教训，在OCM中，我们将跳出过去<a href="https://github.com/kubernetes-sigs/kubefed">Kubefed v2</a>那种中心化，命令式的架构，并拥抱与Kubernetes中“hub-kubelet”原始模式一致的“hub-agent”架构。
因此在OCM中，我们的多集群控制平面，被直观的建模为“Hub”, 而相对的，每一个被“Hub”管理的集群则为“Klusterlet”，这个名字也明显是受到了“kubelet”的启发。
以下是对于两个模型更加详细的解释，我们将在OCM的世界中频繁的使用这两个模型：</p>
<ul>
<li>
<p><strong>Hub Cluster</strong>: 表示运行着OCM多集群控制平面的集群。通常hub cluster应该是一个轻量级的Kubernetes集群，仅仅托管着一些基础的控制器和服务。</p>
</li>
<li>
<p><strong>Klusterlet</strong>: 表示由hub cluster管理着的集群，也被称为“managed cluster”或“spoke cluster”。klusterlet应该主动的从hub cluster <strong>拉取</strong> 最新的处方，并持续将物理的Kubernetes集群调和到预期状态。</p>
</li>
</ul>
<h3 id="hub-agent-架构">hub-agent” 架构</h3>
<p>受益于“hub-agent”架构的优点，在抽象层面，我们将大部分的多集群操作解耦为（1）计算/决策和（2）执行, 且对目标集群的实际执行，将会完全的卸入managed cluster中。
hub不会直接的请求实际集群，而是声明式的维护每一个集群的处方，klusterlet则会主动从hub出拉取处方并执行。
hub cluster的负担将会大大减轻，因为hub cluster既不需要处理来自managed cluster的事件洪流，也不需要被发送大量的请求到各个cluster。
试想，如果Kubernetes中没有kubelet，而是由控制平面直接操作容器守护进程，那么对于一个中心化的控制器，管理一个超过5000节点的集群，将会极其困难。
同理，这也是OCM试图突破可扩展性瓶颈的方式，即将“执行”拆分卸入各个单独的代理中，从而让hub cluster可以接受和管理数千个集群。</p>
<p>每一个klusterlet都将独立自主的工作，所以它们对hub cluster的可用性具有弱依赖。
如果一个hub下线（例如：正在维持中或者网络分区中），klusterlet或其他的OCM在managed cluster中的代理，都应该继续积极管理托管集群，直到与恢复后的hub成功重新连接。
另外，如果hub cluster和managed cluster由不同的管理员所有，那么managed cluster的管理员将更容易从hub的控制平面来管理处方，因为klusterlet在managed cluster上以pod实例的方式，作为“白盒”运行。
如果发生任何意外，klusterlet的管理员只需快速的切断与hub cluster的连接，而无需关闭整个多集群控制平面。</p>
<div style="text-align: center; padding: 20px;">
    <img src="https://github.com/open-cluster-management-io/community/raw/main/assets/ocm-arch.png" alt="Architecture diagram" style="margin: 0 auto; width: 50%">
</div>
<p>这种“hub-agent”的架构，还最小化了注册新集群到hub时，对于网络的要求。
任何集群，只要可以连接到hub cluster的端点，都可以被管理，甚至是一个在你笔记本上的随机KinD沙盒集群。
这是因为处方是从hub上 <strong>拉下来</strong> 而非 <strong>推上去</strong> 的。
除此之外，OCM还提供了一个名为<a href="https://open-cluster-management.io/getting-started/integration/cluster-proxy/">&ldquo;cluster-proxy&rdquo;</a>的<a href="https://open-cluster-management.io/concepts/addon/">addon</a>，它可以自动管理一个反向代理隧道，以利用Kubernetes的子项目<a href="https://kubernetes.io/docs/tasks/extend-kubernetes/setup-konnectivity/">konnectivity</a>来主动访问managed cluster。</p>
<h3 id="模块化和可扩展性">模块化和可扩展性</h3>
<p>OCM不仅会给您带来流畅的用户体验，让您轻松管理多个集群，而且对进一步定制或二次开发同样友好。
OCM中每一个功能，都可以通过将原子能力模块化到单独的构建块中，来实现自由拔插，除了了一个名为<a href="https://github.com/open-cluster-management-io/registration">registration</a>的强制性核心模块，此模块负责控制managed控制器的生命周期，并导出基本的<code>ManagedCluster</code>模型。</p>
<p>另一个展示我们模块化能力的好例子是<a href="https://open-cluster-management.io/concepts/placement/">placement</a>，该独立模块专注于从动态的从用户的处方中，选择合适的managed cluster列表。
你可以在placement的基础上，构建任何高级的多集群编排方案，比如：多集群工作负载再平衡，多集群helm图表副本等。
另外，如果您对我们placement模块当前的能力不满意，您同样可以快速切出并使用您自己的定制来替换它，同时联系我们的社区，以便我们在未来可能的情况下进行融合。</p>
<hr>
<h2 id="概念">概念</h2>
<h3 id="集群注册-双重确认握手">集群注册: “双重确认握手”</h3>
<p>事实上，hub cluster和managed cluster可以为不同的管理员所有并维护，所以在OCM中，我们清楚的分离了这两种角色，并使集群注册需要双方的批准，以防一些不受欢迎的请求。
在中止注册方面，hub管理员可以通过拒绝集群证书的轮换来踢出已注册的集群，而从managed cluster管理员的角度来看，他可以通过暴力删除代理实例或撤销代理的RBAC授权的方式，来中止注册。请注意，hub控制器将自动为新注册的集群准备环境，并在踢出managed cluster时自动清理环境。</p>
<div style="text-align: center; padding: 20px;">
   <img src="/double-optin-registration.png" alt="Clusterset" style="margin: 0 auto; width: 60%">
</div>
<h3 id="集群命名空间">集群命名空间</h3>
<p>Kubernetes具有原生的，命名空间粒度的多租户软隔离，所以在OCM中，对于每一个managed cluster，我们将提供一个专用的命令空间，并授予足够的RBAC权限，以便klusterlet可以在hub cluster上保存一些数据。
这个专门的命名空间即“集群命名空间”，其主要用于保存来自hub的处方。比如，我们可以在“集群命名空间”内创建<code>ManifestWork</code>，从而向对应集群部署资源。
同时，集群命名空间也可以用于保存从klusterlet上传的统计信息，例如插件的健康信息等。</p>
<h3 id="插件">插件</h3>
<p>插件是一个通用概念，用于在OCM的可扩展性基础上，构建可选的，可插入的定制化。
它可以是一个hub cluster上的控制器，或者只是managed cluster上的一个定制的代理，甚至或者是两者的结合。
插件应该实现<code>ClusterManagementAddon</code>和<code>ManagedClusterAddon</code>的API，详细说明见<a href="https://open-cluster-management.io/concepts/addon/">此处</a>.</p>
<hr>
<h2 id="构建块">构建块</h2>
<p>以下是你在OCM之旅中，可能会感兴趣的常用模块和子项目列表：</p>
<h3 id="registration">Registration</h3>
<p>这是OCM管理managed cluster生命周期的核心模块。hub cluster中的注册控制器（registration controller）可以直观的看作为一个代表和管理hub cluster上集群注册的broker，而在managed cluster上运行的注册代理则是另一个代表managed cluster的broker。
在一次成功的注册后，注册控制器和代理将会持续的探查对方的健康状态，即集群心跳。</p>
<h3 id="work">Work</h3>
<p>此模块可以通过将一个<code>ManifestWork</code>的资源写入集群命名空间，非常方便的把资源从hub cluster调度到managed cluster上。更多API细节见<a href="https://open-cluster-management.io/concepts/manifestwork/">此处</a>。</p>
<h3 id="placement">Placement</h3>
<p>此模块通过用标签（labels）进行集群分组，或通过集群声明（cluster-claims）的方式，进行跨集群构建自定义高级拓扑。
placement模块和执行是完全解耦的，placement的输出结果仅为<code>PlacementDecision</code>API中匹配的集群名字列表，因此该决策输出的消费者控制器（consumer controller），可以通过简单的查看决策API，来发现拓扑或发现manaegd cluster上的可用变化。</p>
<h3 id="application-lifecycle">Application lifecycle</h3>
<p><strong>应用生命周期（application lifecycle）</strong> 定义了用于管理你的managed cluster上应用资源的过程。
一个多集群应用依然使用Kubernetes规范，但同时具有应用额外的自动化及对各个集群上资源生命周期的管理。
多集群应用允许你在多个集群部署资源，同时维护着易于协调的服务路由，以及对应用各个方面Kubernetes资源更新的完全控制。</p>
<h3 id="governance-and-risk">Governance and risk</h3>
<p><strong>治理和风险（governance and risk）</strong> 是一个术语，用于定义从hub cluster上管理安全性和合规性的过程。其使用可扩展的策略（policy）框架来确保集群的安全性。在你配置hub cluster和managed cluster之后，你可以创建，修改，和删除hub上的策略，也可以将策略应用到managed cluster上。</p>
<h3 id="registration-operator">Registration operator</h3>
<p>此模块可以自动安装和升级OCM中的一些内置模块。你可以单独部署operator，也可以将registration operator委托给opertor生命周期的框架。</p>

</div>
<script type="text/javascript" src="/clipboard-copy.js"></script>
</div>
        </div>
        <div class="row"><nav class="ocm navbar navbar-expand-lg navbar-dark py-3">
  <div class="container-fluid flex-wrap flex-md-nowrap">
    <div class="text-light">&copy; 2021 Open Cluster Management Authors. The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href="https://www.linuxfoundation.org/trademark-usage/" target="_blank" style="color: #f8f9fa;">Trademark Usage</a></div>
  </div>
</nav>
<script type="text/javascript" src="/lang.js"></script>
</div>
    </div>
</body>
</html>
