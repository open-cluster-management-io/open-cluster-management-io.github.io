<!DOCTYPE html>
<html lang="zh"><head>
  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"/>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css"/>
  <link rel="stylesheet" href="/main.css"/>
  <link rel="shortcut icon" type="image/svg" href="/ocm.svg">
  <title>Open Cluster Management</title>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1PXKZXT157"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1PXKZXT157');
  </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">



    


<input id="current-lang" type="hidden" value="zh">

<header class="navbar navbar-expand-lg navbar-dark bd-navbar">
  <nav class="navbar navbar-expand-lg navbar-dark py-3 fixed-top">
    <div class="container-fluid flex-wrap flex-lg-nowrap">
      <a href="/zh/" class="navbar-brand">
        <img src="/ocm.svg" alt="" width="30" height="24" class="align-text-top">
        <span>Open Cluster Management</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navmenu">
        <ul class="navbar-nav ms-auto ">
          <li class="nav-item pe-2">
            <a href="/zh/community" class="nav-link text-light">社区</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/zh/contribute" class="nav-link text-light">贡献</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/zh/concepts" class="nav-link text-light">文档</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/zh/blog" class="nav-link text-light">博客</a>
          </li>
          <li class="nav-item dropdown pe-2">
            
            <a class="nav-link dropdown-toggle text-light" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">中文</a>
            

            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              
              <li><a class="dropdown-item" href="#" id="to-en">English</a></li>
              
            </ul>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://www.youtube.com/c/OpenClusterManagement" target="_blank" aria-label="youtube">
                <i class="bi bi-youtube"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://github.com/open-cluster-management-io" target="_blank" aria-label="github">
              <i class="bi bi-github"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://kubernetes.slack.com/channels/open-cluster-mgmt" target="_blank" aria-label="slack">
              <i class="bi bi-slack"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>
</div>
        <div class="row subject-padding">
            <div class="col-lg-2 col-md-3 padding-none sidebar-bgc">



    


<div class="sidebar-toggle sidebar-toggle-sm">
    <button type="button" id="sidebarToggle" class="btn btn-info">
        <i class="bi bi-list"></i>
    </button>
</div>
<nav id="sidebar" class="sidebar-hide-sm">
    <ul class="components">
        <li id="concepts">
            <a class="navlink" href="/zh/concepts">概念</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/zh/concepts/architecture">架构</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/clusterclaim">集群声明</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/managedcluster">托管集群</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/managedclusterset">托管集群分组</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/placement">匹配路由</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/manifestwork">资源下发</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/manifestworkreplicaset">资源下发组</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/addon">自定义插件</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/policy">Policy</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/multicluster-controlplane">多集群控制面</a>
                </li>
            </ul>
        </li>
        <li id="getting-started">
            <a class="navlink" href="/zh/getting-started">安装</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/zh/getting-started/quick-start">快速开始</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/getting-started/installation">部署</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/zh/getting-started/installation/start-the-control-plane">启动控制面</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/installation/register-a-cluster">注册一个集群</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/zh/getting-started/integration">插件和集成</a>
                    <ul class="collapse ">
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/app-lifecycle">应用生命周期管理</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/cluster-proxy">多集群网络隧道</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/policy-framework">Policy框架</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/policy-controllers">Policy控制器</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/managed-serviceaccount">托管多集群ServiceAccount</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/zh/getting-started/administration">运维管理</a>
                    <ul class="collapse ">
                        <li>
                            <a class="navlink" href="/zh/getting-started/administration/upgrading">升级版本</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/administration/monitoring">监控</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </li>
        <li id="developer-guides">
            <a class="navlink" href="/zh/developer-guides">开发指南</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/zh/developer-guides/addon">Add-on 开发指南</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/developer-guides/vscode-extension">VScode插件</a>
                </li>
            </ul>
        </li>
        <li id="scenarios">
            <a class="navlink" href="/zh/scenarios">应用场景</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/zh/scenarios/deploy-kubernetes-resources">部署Kubernetes资源</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/distribute-workload-with-placement">通过placement分发工作负载</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/migrate-workload-with-placement">通过placement迁移工作负载</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/extend-multicluster-scheduling-capabilities">扩展多集群调度能力</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/extending-managed-clusters">扩展集群模型</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/integration-with-argocd">集成Argo CD</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/manage-cluster-with-multiple-hubs">使用多个hub管理同一集群</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/pushing-kube-api-requests">向托管集群推送Kube API请求</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/register-cluster-through-proxy">通过代理服务器注册集群</a>
                </li>
            </ul>
        </li>
        <li id="community">
            <a class="navlink" href="/zh/community">社区</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/zh/community/releases">发行版本</a>
                </li>
                <li >
                    <a class="navlink" href="/zh/community/roadmap">社区规划</a>
                </li>
            </ul>
        </li>
        <li id="contribute">
            <a class="navlink" href="/zh/contribute">贡献</a>
        </li>
        <li id="blog">
            <a class="navlink" href="/zh/blog">博客</a>
        </li>
        <li style="padding-top: 10px; border-top: 2px solid #448a78;">
            <a class="navlink resource" href="https://github.com/open-cluster-management-io" target="_blank"><i class="bi bi-github"></i><span style="padding-left: 10px;">GitHub</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://kubernetes.slack.com/channels/open-cluster-mgmt" target="_blank"><i class="bi bi-slack"></i><span style="padding-left: 10px;">Slack</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://www.youtube.com/c/OpenClusterManagement" target="_blank"><i class="bi bi-youtube"></i><span style="padding-left: 10px;">YouTube</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://groups.google.com/g/open-cluster-management" target="_blank"><i class="bi bi-envelope-fill"></i><span style="padding-left: 10px;">Mailing group</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://calendar.google.com/calendar/u/0/embed?src=openclustermanagement@gmail.com" target="_blank"><i class="bi bi-calendar-event-fill"></i><span style="padding-left: 10px;">Community meetings</span></a>
        </li>
    </ul>
</nav>
<script type="text/javascript" src="/sidebar.js"></script>
</div>
            <div class="col-lg-10 col-md-9 padding-none">
<div id="content">
    <h1>以GitOps方式应对多集群工具链的升级挑战</h1>
    <p>2023 年 10 月 27 日 <a href="https://github.com/haoqing0110">郝青</a></p>



  <div class="gdoc-toc gdoc-toc__level--6"><nav id="TableOfContents"><ul>
        <li><a href="#多集群环境下工具链的升级挑战">多集群环境下工具链的升级挑战</a></li>
        <li><a href="#add-on-插件">add-on 插件</a></li>
        <li><a href="#placement-decision-strategy">Placement Decision Strategy</a></li>
        <li><a href="#以-gitops-方式简化升级">以 GitOps 方式简化升级</a></li>
        <li><a href="#三种升级策略">三种升级策略</a></li>
        <li><a href="#小结">小结</a></li>
        <li><a href="#未来计划">未来计划</a></li>
      </ul></nav><hr></div>


<h2 id="多集群环境下工具链的升级挑战">多集群环境下工具链的升级挑战</h2>
<p>OCM（open-cluster-management）是一个专注于 Kubernetes 应用跨多集群和多云的管理平台，提供了集群的注册，应用和负载的分发，调度等基础功能。Add-on 插件是 OCM 提供的一种基于基础组件的扩展机制，可以让 Kubernetes 生态的应用很容易迁移到 OCM 平台上，拥有跨多集群多云的编排和调度的能力。如 Istio，Prometheus，Submarine 可以通过 Add-on 的方式扩展至多集群。在多集群环境中，如何优雅、平滑地升级整个工具链（比如 Istio、Prometheus 和其他工具）是我们在多集群管理中遇到的挑战，工具链的升级失败可能会导致数千个用户工作负载无法访问。因此，找到一种简单、安全的跨集群升级解决方案变得非常重要。</p>
<p>本文我们将介绍 Open Cluster Management(OCM)如何将工具链升级视为配置文件的变更，使用户能够利用 Kustomize 或 GitOps 实现跨集群的无缝滚动/金丝雀升级。</p>
<p>在正式开始前，首先介绍几个 OCM 中的概念。</p>
<h2 id="add-on-插件">add-on 插件</h2>
<p>在 OCM 平台上，add-on 插件可以实现在不同托管集群（Spoke）上应用不同的配置，也可以实现从控制面（Hub）获取数据到 Spoke 集群上等功能。比如：你可以使用<a href="https://github.com/open-cluster-management-io/managed-serviceaccount">managed-serviceaccount</a>
插件在 Spoke 集群上将指定的 ServiceaCount 信息返回给 Hub 集群，可以使用<a href="https://github.com/open-cluster-management-io/cluster-proxy">cluster-proxy</a>插件建立一个从 spoke 到 hub 的反向代理通道。</p>
<p>现阶段 OCM 社区已经有的一些 add-on：</p>
<ul>
<li><a href="https://github.com/open-cluster-management-io/multicluster-mesh">Multicluster Mesh Addon</a> 可用于管理（发现、部署和联合）OCM 中跨多个集群的服务网格。</li>
<li><a href="https://github.com/stolostron/submariner-addon">Submarine Addon</a> 让<a href="https://github.com/submariner-io/submariner">Submarine</a>
和 OCM 方便集成，在 hub cluster 上部署 Submariner Broker，在 managed cluster 上部署所需的 Submariner 组件, 为托管集群提供跨集群的 Pod 和 Service 网络互相访问的能力。</li>
<li><a href="https://github.com/open-cluster-management-io/addon-contrib/tree/main/open-telemetry-addon">Open-telemetry add-on</a> 自动在 hub cluster 和 managed cluster 上
安装 otelCollector，并在 hub cluster 上自动安装 jaeger-all-in-one 以处理和存储 traces。</li>
<li><a href="https://open-cluster-management.io/zh/getting-started/integration/app-lifecycle/">Application lifecycle management</a>
实现多集群或多云环境中的应用程序生命周期管理。add-on 插件提供了一套通过 Subscriptions 订阅 channel，将 github 仓库，Helm release 或者对象存储仓库的应用分发到指定 Spoke 集群上的机制。</li>
<li><a href="https://open-cluster-management.io/getting-started/integration/policy-framework/">Policy framework</a>和<a href="https://open-cluster-management.io/getting-started/integration/policy-controllers/">Policy controllers</a> add-on 插件可以让 Hub 集群管理员很轻松为 Spoke 集群部署安全相关的 policy 策略。</li>
<li><a href="https://open-cluster-management.io/getting-started/integration/managed-serviceaccount/">Managed service account</a> add-on 插件可以让 Hub 集群管理员很容易管理 Spoke 集群上 serviceaccount。</li>
<li><a href="https://open-cluster-management.io/getting-started/integration/cluster-proxy/">Cluster proxy</a> add-on 插件通过反向代理通道提供了 Hub 和 Spoke 集群之间 L4 网络连接。</li>
</ul>
<p><strong>更多关于 add-on 插件的介绍可以参考<a href="https://open-cluster-management.io/zh/blog/addon-introduction/">详解 OCM add-on 插件</a>。</strong></p>
<p>OCM 提供了两种方式帮助开发者开发自己的 add-on：</p>
<ul>
<li>Hard 模式：使用<a href="https://github.com/open-cluster-management-io/addon-framework">addon-framework</a>的内置机制，可根据<a href="https://open-cluster-management.io/developer-guides/addon/">Add-on 开发指南</a>来开发 add-on 插件的 addon manager 和 addon agent。</li>
<li>Easy 模式：OCM 提供了一个新的插件开发模型，可使用<a href="https://open-cluster-management.io/developer-guides/addon/#build-an-addon-with-addon-template">AddOnTemplate</a>来构建 add-on。在此模型中开发者无需开发 addon manager，只需准备 addon agent 的 image 和 AddOnTemplate，AddOnTemplate 描述了如何部署 addon agent 以及如何注册 addon。</li>
</ul>
<p>如下是一个样例 add-on 的 ClusterManagementAddOn 和 AddOnTemplate。AddOnTemplate 被视为 add-on 一个配置文件，定义在 supportedConfigs 中。AddOnTemplate 资源中则包含了部署 add-on 所需的 manifest 以及 add-on 的注册方式。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: addon.open-cluster-management.io/v1alpha1
<span style="color:#66d9ef">kind</span>: ClusterManagementAddOn
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: hello-template
  <span style="color:#66d9ef">annotations</span>:
    <span style="color:#66d9ef">addon.open-cluster-management.io/lifecycle</span>: <span style="color:#e6db74">&#34;addon-manager&#34;</span>
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">addOnMeta</span>:
    <span style="color:#66d9ef">description</span>: hello-template is a addon built with addon template
    <span style="color:#66d9ef">displayName</span>: hello-template
  <span style="color:#66d9ef">supportedConfigs</span>: <span style="color:#75715e"># declare it is a template type addon</span>
  - <span style="color:#66d9ef">group</span>: addon.open-cluster-management.io
    <span style="color:#66d9ef">resource</span>: addontemplates
    <span style="color:#66d9ef">defaultConfig</span>:
      <span style="color:#66d9ef">name</span>: hello-template
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: addon.open-cluster-management.io/v1alpha1
<span style="color:#66d9ef">kind</span>: AddOnTemplate
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: hello-template
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">addonName</span>: hello-template
  <span style="color:#66d9ef">agentSpec</span>: <span style="color:#75715e"># required</span>
      <span style="color:#66d9ef">workload</span>:
        <span style="color:#66d9ef">manifests</span>:
          - <span style="color:#66d9ef">kind</span>: Deployment
            <span style="color:#66d9ef">metadata</span>:
              <span style="color:#66d9ef">name</span>: hello-template-agent
              <span style="color:#66d9ef">namespace</span>: open-cluster-management-agent-addon
...
          - <span style="color:#66d9ef">kind</span>: ServiceAccount
            <span style="color:#66d9ef">metadata</span>:
              <span style="color:#66d9ef">name</span>: hello-template-agent-sa
              <span style="color:#66d9ef">namespace</span>: open-cluster-management-agent-addon
          - <span style="color:#66d9ef">kind</span>: ClusterRoleBinding
             <span style="color:#66d9ef">metadata</span>:
               <span style="color:#66d9ef">name</span>: hello-template-agent
...
  <span style="color:#66d9ef">registration</span>: <span style="color:#75715e"># optional</span>
    ...
</code></pre></div><h2 id="placement-decision-strategy">Placement Decision Strategy</h2>
<p>Placement API 用于在一个或多个托管集群组(ManagedClusterSet)中选择一组托管群集(ManagedCluster)，以便将工作负载部署到这些群集上。</p>
<p><strong>更多关于 Placement API 的介绍可以参考<a href="https://open-cluster-management.io/concepts/placement/">Placement 文档</a>。</strong></p>
<p>Placement 调度过程的“输入”和“输出”被解耦为两个独立的 Kubernetes API: Placement 和 PlacementDecision。</p>
<ul>
<li>Placement 提供了通过标签选择器<code>labelSelector</code>或声明选择器<code>claimSelector</code>过滤集群，同时也提供了一些内置的优选器<code>prioritizer</code>，可对过滤后的集群进行打分排序和优先选择。</li>
<li>Placement 的调度结果会放在<code>PlacementDecision</code>中, <code>status.decisions</code>列出得分最高的前 N 个集群并按名称排序，且调度结果会随着集群的变化而动态变化。Placement 中的<code>decisionStrategy</code>部分可以用来将创建的<code>PlacementDecision</code>划分为多个组，并定义每个决策组中的集群数量。<code>PlacementDecision</code>支持分页显示，每个 resource 做多支持放置 100 个集群的名称。</li>
</ul>
<p>如下是一个 Placement 和<code>decisionStrategy</code>的例子。假设 global 集群组中有 300 个托管集群(ManagedCluster)，其中 10 个集群有标签 canary。下面的例子描述了将拥有 canary 标签的集群分为一组，并将剩下的集群以每组最多 150 个集群来进行分组。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: cluster.open-cluster-management.io/v1beta1
<span style="color:#66d9ef">kind</span>: Placement
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: aws-placement
  <span style="color:#66d9ef">namespace</span>: default
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">clusterSets</span>:
    - global
  <span style="color:#66d9ef">decisionStrategy</span>:
    <span style="color:#66d9ef">groupStrategy</span>:
      <span style="color:#66d9ef">clustersPerDecisionGroup</span>: <span style="color:#ae81ff">150</span>
      <span style="color:#66d9ef">decisionGroups</span>:
      - <span style="color:#66d9ef">groupName</span>: canary
        <span style="color:#66d9ef">groupClusterSelector</span>:
          <span style="color:#66d9ef">labelSelector</span>:
            <span style="color:#66d9ef">matchExpressions</span>:
              - <span style="color:#66d9ef">key</span>: canary
                <span style="color:#66d9ef">operator</span>: Exists

</code></pre></div><p>分组的结果将显示在 Placement 的 status 中。其中 canary 组有 10 个集群，结果放在 aws-placement-decision-1 中。其他的默认分组只有 group index，每组分别有 150 个和 140 个集群。由于一个 PlacementDecsion 只支持 100 个集群，因此每组的结果放入两个 PlacementDecision 中。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">status</span>:
...
  <span style="color:#66d9ef">decisionGroups</span>:
  - <span style="color:#66d9ef">clusterCount</span>: <span style="color:#ae81ff">10</span>
    <span style="color:#66d9ef">decisionGroupIndex</span>: <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">decisionGroupName</span>: canary
    <span style="color:#66d9ef">decisions</span>:
    - aws-placement-decision<span style="color:#ae81ff">-1</span>
  - <span style="color:#66d9ef">clusterCount</span>: <span style="color:#ae81ff">150</span>
    <span style="color:#66d9ef">decisionGroupIndex</span>: <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">decisionGroupName</span>: <span style="color:#e6db74">&#34;&#34;</span>
    <span style="color:#66d9ef">decisions</span>:
    - aws-placement-decision<span style="color:#ae81ff">-2</span>
    - aws-placement-decision<span style="color:#ae81ff">-3</span>
  - <span style="color:#66d9ef">clusterCount</span>: <span style="color:#ae81ff">140</span>
    <span style="color:#66d9ef">decisionGroupIndex</span>: <span style="color:#ae81ff">2</span>
    <span style="color:#66d9ef">decisionGroupName</span>: <span style="color:#e6db74">&#34;&#34;</span>
    <span style="color:#66d9ef">decisions</span>:
    - placement1-decision<span style="color:#ae81ff">-3</span>
    - placement1-decision<span style="color:#ae81ff">-4</span>
  <span style="color:#66d9ef">numberOfSelectedClusters</span>: <span style="color:#ae81ff">300</span>
</code></pre></div><p>以 canary 组为例，它的 PlacementDecision 如下所示，其中的标签 cluster.open-cluster-management.io/decision-group-index 代表了所属组的 index，cluster.open-cluster-management.io/decision-group-name 代表了所属组的名称，cluster.open-cluster-management.io/placement 代表了所属于的 Placement。使用者可以通过标签选择器来灵活获取调度结果。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: cluster.open-cluster-management.io/v1beta1
<span style="color:#66d9ef">kind</span>: PlacementDecision
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">labels</span>:
    <span style="color:#66d9ef">cluster.open-cluster-management.io/decision-group-index</span>: <span style="color:#e6db74">&#34;0&#34;</span>
    <span style="color:#66d9ef">cluster.open-cluster-management.io/decision-group-name</span>: canary
    <span style="color:#66d9ef">cluster.open-cluster-management.io/placement</span>: aws-placement
  <span style="color:#66d9ef">name</span>: aws-placement-decision<span style="color:#ae81ff">-1</span>
  <span style="color:#66d9ef">namespace</span>: default
<span style="color:#66d9ef">status</span>:
  <span style="color:#66d9ef">decisions</span>:
  - <span style="color:#66d9ef">clusterName</span>: cluster1
    <span style="color:#66d9ef">reason</span>: <span style="color:#e6db74">&#34;&#34;</span>
...
  - <span style="color:#66d9ef">clusterName</span>: cluster10
    <span style="color:#66d9ef">reason</span>: <span style="color:#e6db74">&#34;&#34;</span>
</code></pre></div><h2 id="以-gitops-方式简化升级">以 GitOps 方式简化升级</h2>
<p>以上简单介绍了 add-on template 和 placement decision strategy 的概念。</p>
<p>在 OCM 中，我们将 add-on 的升级视为其配置文件的升级，这里的配置可以是 AddOnTemplate，也可以是其他自定义的配置文件 AddOnDeploymentConfig。一次 add-on 的升级等同于一次配置文件的更新，这使得用户能够利用 Kustomize 或 GitOps 来进行无缝的跨集群滚动/金丝雀升级。RolloutStrategy 定义了升级策略，支持全部升级(All)，按集群渐进升级(Progressive Per Cluster)和按集群组渐进升级(Progressive Per Group)，并可定义一组 MandatoryDecisionGroups 来优先尝试新配置。</p>
<p>依照 GitOps 的四个原则，我们来看看 OCM 如何支持以 GitOps 的方式应对多集群环境下的升级挑战。</p>
<ul>
<li>声明式</li>
</ul>
<p>在<code>ClusterManagementAddOn</code>中可以声明 add-on 所使用的配置文件。配置文件可在全局的<code>supportedConfigs</code>中声明，该配置文件会应用到所有的<code>ManagedClusterAddOn</code>实例上。也可在<code>installStrategy</code>下不同的 placements 中声明，每个 Placement 所选择集群的<code>ManagedClusterAddOn</code>将拥有相同的配置文件，placements 中声明的配置会覆盖全局配置。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: addon.open-cluster-management.io/v1alpha1
<span style="color:#66d9ef">kind</span>: ClusterManagementAddOn
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: managed-serviceaccount
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">supportedConfigs</span>:
  - <span style="color:#66d9ef">defaultConfig</span>:
      <span style="color:#66d9ef">name</span>: managed-serviceaccount<span style="color:#ae81ff">-0.4.0</span>
    <span style="color:#66d9ef">group</span>: addon.open-cluster-management.io
    <span style="color:#66d9ef">resource</span>: addontemplates
  <span style="color:#66d9ef">installStrategy</span>:
    <span style="color:#66d9ef">placements</span>:
    - <span style="color:#66d9ef">name</span>: aws-placement
      <span style="color:#66d9ef">namespace</span>: default
      <span style="color:#66d9ef">configs</span>:
      - <span style="color:#66d9ef">group</span>: addon.open-cluster-management.io
        <span style="color:#66d9ef">resource</span>: addondeploymentconfigs
        <span style="color:#66d9ef">name</span>: managed-serviceaccount-addon-deploy-config
      <span style="color:#66d9ef">rolloutStrategy</span>:
        <span style="color:#66d9ef">type</span>: Progressive
        <span style="color:#66d9ef">progressive</span>:
          <span style="color:#66d9ef">mandatoryDecisionGroups</span>:
          - <span style="color:#66d9ef">groupName</span>: <span style="color:#e6db74">&#34;canary&#34;</span>
          <span style="color:#66d9ef">maxConcurrency</span>: <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">type</span>: Placements
</code></pre></div><ul>
<li>版本控制</li>
</ul>
<p>add-on 配置文件名称或 spec 内容的变化会被认为是一个配置更改，会触发 add-on 的一次升级。用户可以利用 Kustomize 或 GitOps 来控制配置文件升级。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: addon.open-cluster-management.io/v1alpha1
<span style="color:#66d9ef">kind</span>: AddOnTemplate
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: managed-serviceaccount<span style="color:#ae81ff">-0.4.0</span>
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">agentSpec</span>: <span style="color:#75715e"># required</span>
      <span style="color:#66d9ef">workload</span>:
        <span style="color:#66d9ef">manifests</span>:
          - <span style="color:#66d9ef">kind</span>: Deployment
            <span style="color:#66d9ef">metadata</span>:
              <span style="color:#66d9ef">name</span>: managed-serviceaccount-addon-agent
              <span style="color:#66d9ef">namespace</span>: open-cluster-management-agent-addon
...
          - <span style="color:#66d9ef">kind</span>: ServiceAccount
            <span style="color:#66d9ef">metadata</span>:
              <span style="color:#66d9ef">name</span>: managed-serviceaccount
              <span style="color:#66d9ef">namespace</span>: open-cluster-management-agent-addon
…
  <span style="color:#66d9ef">registration</span>: <span style="color:#75715e"># optional</span>
</code></pre></div><ul>
<li>自动化</li>
</ul>
<p>OCM 在 open-cluster-management-hub 命名空间下的组件 addon-manager-controller 是一个更通用的 addon manager，它会 watch 以下两种类型的 add-on 并负责维护此类 add-on 的生命周期，包括安装与升级。当配置文件的名称或者 spec 内容变化时，此组件会按照 rolloutStrategy 所定义的升级策略来升级 add-on。</p>
<ul>
<li>Hard 模式：使用最新<a href="https://github.com/open-cluster-management-io/addon-framework">addon-framework</a>开发的 add-on，需要删除代码中的<code>WithInstallStrategy()</code>方法并在<code>ClusterManagementAddOn</code>添加 annotation <code>addon.open-cluster-management.io/lifecycle: &quot;addon-manager&quot;</code>。详细内容参考<a href="https://open-cluster-management.io/developer-guides/addon/#managing-the-add-on-agent-lifecycle-by-addon-manager">Add-on 开发指南</a>。</li>
<li>Easy 模式：使用 AddOnTemplate 模式开发的 add-on。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">✗ kubectl get deploy -n open-cluster-management-hub
NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE
cluster-manager-addon-manager-controller   1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           10h
cluster-manager-placement-controller       1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           10h
cluster-manager-registration-controller    1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           10h
cluster-manager-registration-webhook       1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           10h
cluster-manager-work-webhook               1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           10h
</code></pre></div><ul>
<li>持续协调</li>
</ul>
<p>Add-on 配置文件的 spec hash 会被记录在<code>ClusterManagementAddOn</code>以及<code>ManagedClusterAddOn</code>的 status 中，当 spec hash 变化时，addon-manager-controller 会根据 rolloutStrategy 定义的升级策略持续更新 add-on，直至 lastAppliedConfig，lastKnownGoodConfig 和 desiredConfig 相一致。如下例子中，由于 lastAppliedConfig 与 desiredConfig 不匹配，add-on 状态显示为升级中。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: addon.open-cluster-management.io/v1alpha1
<span style="color:#66d9ef">kind</span>: ClusterManagementAddOn
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: managed-serviceaccount
…
  <span style="color:#66d9ef">status</span>:
    <span style="color:#66d9ef">installProgressions</span>:
    - <span style="color:#66d9ef">conditions</span>:
      - <span style="color:#66d9ef">lastTransitionTime</span>: <span style="color:#e6db74">&#34;2023-09-21T06:53:59Z&#34;</span>
        <span style="color:#66d9ef">message</span>: <span style="color:#ae81ff">1</span>/<span style="color:#ae81ff">3</span> upgrading, <span style="color:#ae81ff">0</span> timeout.
        <span style="color:#66d9ef">reason</span>: Upgrading
        <span style="color:#66d9ef">status</span>: <span style="color:#e6db74">&#34;False&#34;</span>
        <span style="color:#66d9ef">type</span>: Progressing
      <span style="color:#66d9ef">configReferences</span>:
       - <span style="color:#66d9ef">desiredConfig</span>:
          <span style="color:#66d9ef">name</span>: managed-serviceaccount<span style="color:#ae81ff">-0.4.1</span>
          <span style="color:#66d9ef">specHash</span>: dcf88f5b11bd191ed2f886675f967684da8b5bcbe6902458f672277d469e2044
        <span style="color:#66d9ef">group</span>: addon.open-cluster-management.io
        <span style="color:#66d9ef">lastAppliedConfig</span>:
          <span style="color:#66d9ef">name</span>: managed-serviceaccount<span style="color:#ae81ff">-0.4.0</span>
          <span style="color:#66d9ef">specHash</span>: 1f7874ac272f3e4266f89a250d8a76f0ac1c6a4d63d18e7dcbad9068523cf187
        <span style="color:#66d9ef">lastKnownGoodConfig</span>:
          <span style="color:#66d9ef">name</span>: managed-serviceaccount<span style="color:#ae81ff">-0.4.0</span>
          <span style="color:#66d9ef">specHash</span>: 1f7874ac272f3e4266f89a250d8a76f0ac1c6a4d63d18e7dcbad9068523cf187
        <span style="color:#66d9ef">resource</span>: addontemplates
      <span style="color:#66d9ef">name</span>: aws-placementl
      <span style="color:#66d9ef">namespace</span>: default
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: addon.open-cluster-management.io/v1alpha1
<span style="color:#66d9ef">kind</span>: ManagedClusterAddOn
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: managed-serviceaccount
  <span style="color:#66d9ef">namespace</span>: cluster1
…
<span style="color:#66d9ef">status</span>:
  <span style="color:#66d9ef">conditions</span>:
  - <span style="color:#66d9ef">lastTransitionTime</span>: <span style="color:#e6db74">&#34;2023-09-21T06:53:42Z&#34;</span>
    <span style="color:#66d9ef">message</span>: upgrading.
    <span style="color:#66d9ef">reason</span>: Upgrading
    <span style="color:#66d9ef">status</span>: <span style="color:#e6db74">&#34;False&#34;</span>
    <span style="color:#66d9ef">type</span>: Progressing
  <span style="color:#66d9ef">configReferences</span>:
  - <span style="color:#66d9ef">desiredConfig</span>:
      <span style="color:#66d9ef">name</span>: managed-serviceaccount<span style="color:#ae81ff">-0.4.1</span>
      <span style="color:#66d9ef">specHash</span>: dcf88f5b11bd191ed2f886675f967684da8b5bcbe6902458f672277d469e2044
    <span style="color:#66d9ef">group</span>: addon.open-cluster-management.io
    <span style="color:#66d9ef">lastAppliedConfig</span>:
      <span style="color:#66d9ef">name</span>: managed-serviceaccount<span style="color:#ae81ff">-0.4.0</span>
      <span style="color:#66d9ef">specHash</span>: dcf88f5b11bd191ed2f886675f967684da8b5bcbe6902458f672277d469e2044
    <span style="color:#66d9ef">lastObservedGeneration</span>: <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">name</span>: managed-serviceaccount<span style="color:#ae81ff">-0.4.1</span>
    <span style="color:#66d9ef">resource</span>: addontemplates
</code></pre></div><h2 id="三种升级策略">三种升级策略</h2>
<p>ClusterManagementAddOn 的<code>rolloutStrategy</code>字段定义了升级的策略，目前 OCM 支持三种类型的升级策略。</p>
<ul>
<li>全部升级(All)</li>
</ul>
<p>默认的升级类型是 All，意味着新的配置文件会立刻应用于所有的集群。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: addon.open-cluster-management.io/v1alpha1
<span style="color:#66d9ef">kind</span>: ClusterManagementAddOn
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: managed-serviceaccount
  <span style="color:#66d9ef">annotations</span>:
    <span style="color:#66d9ef">addon.open-cluster-management.io/lifecycle</span>: <span style="color:#e6db74">&#34;addon-manager&#34;</span>
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">supportedConfigs</span>:
...
  <span style="color:#66d9ef">installStrategy</span>:
    <span style="color:#66d9ef">placements</span>:
    - <span style="color:#66d9ef">name</span>: aws-placement
      <span style="color:#66d9ef">namespace</span>: default
      <span style="color:#66d9ef">rolloutStrategy</span>:
        <span style="color:#66d9ef">type</span>: All
    <span style="color:#66d9ef">type</span>: Placement
</code></pre></div><ul>
<li>按集群渐进升级(Progressive Per Cluster)</li>
</ul>
<p>Progressive 意味着将新的配置文件依次部署在所选择的每个集群，只有当前集群升级成功后新的配置文件才会应用到下个集群。前面我们介绍了 Placement Decision Group 的概念，MandatoryDecisionGroups 中可以指定一个或多个 Decision Group。如果定义了 MandatoryDecisionGroups，则优先将新的配置文件部署到这些集群组。 MaxConcurrency 定义了同时部署的最大集群数量。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: addon.open-cluster-management.io/v1alpha1
<span style="color:#66d9ef">kind</span>: ClusterManagementAddOn
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: managed-serviceaccount
  <span style="color:#66d9ef">annotations</span>:
    <span style="color:#66d9ef">addon.open-cluster-management.io/lifecycle</span>: <span style="color:#e6db74">&#34;addon-manager&#34;</span>
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">supportedConfigs</span>:
...
  <span style="color:#66d9ef">installStrategy</span>:
    <span style="color:#66d9ef">placements</span>:
    - <span style="color:#66d9ef">name</span>: aws-placement
      <span style="color:#66d9ef">namespace</span>: default
      <span style="color:#66d9ef">rolloutStrategy</span>:
        <span style="color:#66d9ef">type</span>: Progressive
        <span style="color:#66d9ef">progressive</span>:
          <span style="color:#66d9ef">mandatoryDecisionGroups</span>:
          - <span style="color:#66d9ef">groupName</span>: <span style="color:#e6db74">&#34;canary&#34;</span>
          <span style="color:#66d9ef">maxConcurrency</span>: <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">type</span>: Placements
</code></pre></div><ul>
<li>按集群组渐进升级(Progressive Per Group)</li>
</ul>
<p>ProgressivePerGroup 意味着将新的配置文件依次部署在所选择的每个集群组，只有当前集群组升级成功后新的配置文件才会应用到下个集群组。如果定义了 MandatoryDecisionGroups，则优先将新的配置文件部署到这些集群组。如果没有 mandatoryDecisionGroups，则按照集群组的 index 顺序依次升级。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: addon.open-cluster-management.io/v1alpha1
<span style="color:#66d9ef">kind</span>: ClusterManagementAddOn
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: managed-serviceaccount
  <span style="color:#66d9ef">annotations</span>:
    <span style="color:#66d9ef">addon.open-cluster-management.io/lifecycle</span>: <span style="color:#e6db74">&#34;addon-manager&#34;</span>
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">supportedConfigs</span>:
...
  <span style="color:#66d9ef">installStrategy</span>:
    <span style="color:#66d9ef">placements</span>:
    - <span style="color:#66d9ef">name</span>: aws-placement
      <span style="color:#66d9ef">namespace</span>: default
      <span style="color:#66d9ef">rolloutStrategy</span>:
        <span style="color:#66d9ef">type</span>: ProgressivePerGroup
        <span style="color:#66d9ef">progressivePerGroup</span>:
          <span style="color:#66d9ef">mandatoryDecisionGroups</span>:
          - <span style="color:#66d9ef">groupName</span>: <span style="color:#e6db74">&#34;canary&#34;</span>
    <span style="color:#66d9ef">type</span>: Placements
</code></pre></div><p>依照 GitOps 的四个原则，和 OCM 的三种升级策略，使用者可以利用 Kustomize 或 GitOps 实现跨集群的无缝滚动/金丝雀升级。值得注意的是，installStrategy 下支持多个 Placement 的定义，使用者可以基于此实现更多高级的升级策略。如下面的例子，可以同时定义两个 Placement 分别选择 aws 与 gcp 上的集群，使得同一个 add-on 在不同的集群中使用不同的配置文件和升级策略。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: addon.open-cluster-management.io/v1alpha1
<span style="color:#66d9ef">kind</span>: ClusterManagementAddOn
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: managed-serviceaccount
  <span style="color:#66d9ef">annotations</span>:
    <span style="color:#66d9ef">addon.open-cluster-management.io/lifecycle</span>: <span style="color:#e6db74">&#34;addon-manager&#34;</span>
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">supportedConfigs</span>:
...
  <span style="color:#66d9ef">installStrategy</span>:
    <span style="color:#66d9ef">placements</span>:
    - <span style="color:#66d9ef">name</span>: aws-placement
      <span style="color:#66d9ef">namespace</span>: default
      <span style="color:#66d9ef">configs</span>:
      - <span style="color:#66d9ef">group</span>: addon.open-cluster-management.io
        <span style="color:#66d9ef">resource</span>: addondeploymentconfigs
        <span style="color:#66d9ef">name</span>: managed-serviceaccount-addon-deploy-config-aws
      <span style="color:#66d9ef">rolloutStrategy</span>:
        <span style="color:#66d9ef">type</span>: ProgressivePerGroup
        <span style="color:#66d9ef">progressivePerGroup</span>:
          <span style="color:#66d9ef">mandatoryDecisionGroups</span>:
          - <span style="color:#66d9ef">groupName</span>: <span style="color:#e6db74">&#34;canary&#34;</span>
    <span style="color:#66d9ef">type</span>: Placements
    - <span style="color:#66d9ef">name</span>: gcp-placement
      <span style="color:#66d9ef">namespace</span>: default
      <span style="color:#66d9ef">configs</span>:
      - <span style="color:#66d9ef">group</span>: addon.open-cluster-management.io
        <span style="color:#66d9ef">resource</span>: addondeploymentconfigs
        <span style="color:#66d9ef">name</span>: managed-serviceaccount-addon-deploy-config-gcp
      <span style="color:#66d9ef">rolloutStrategy</span>:
        <span style="color:#66d9ef">type</span>: ProgressivePerGroup
        <span style="color:#66d9ef">progressivePerGroup</span>:
          <span style="color:#66d9ef">mandatoryDecisionGroups</span>:
          - <span style="color:#66d9ef">groupName</span>: <span style="color:#e6db74">&#34;canary&#34;</span>
    <span style="color:#66d9ef">type</span>: Placements
</code></pre></div><h2 id="小结">小结</h2>
<p>本文详细介绍了如何使用 Open Cluster Management 以 GitOps 方式应对多集群环境下工具链的升级挑战。OCM 提供了基于 Kubernetes 的跨多集群和多云的管理平台，通过 Add-on 插件和 Placement API，使得用户能够优雅、平滑地升级整个工具链。同时，OCM 将 add-on 升级视为配置文件的变更，使得用户能够利用 Kustomize 或 GitOps 实现跨集群的无缝滚动/金丝雀升级。此外，OCM 还提供了多种升级策略，包括全部升级(All)，按集群渐进升级(Progressive Per Cluster)和按集群组渐进升级(Progressive Per Group)，以满足不同的升级需求。</p>
<h2 id="未来计划">未来计划</h2>
<p>在社区中，我们正在计划实现<a href="(https://github.com/open-cluster-management-io/api/pull/281)">RolloutConfig</a>以提供更细粒度的 rollout 配置，比如 MinSuccessTime, ProgressDeadline, MaxFailures，使得用户可以定义在失败情况下的升级行为，这将为多集群下的升级提供更多的可操作空间。</p>

</div>
<script type="text/javascript" src="/clipboard-copy.js"></script>
</div>
        </div>
        <div class="row"><nav class="ocm navbar navbar-expand-lg navbar-dark py-3">
  <div class="container-fluid flex-wrap flex-md-nowrap">
    <div class="text-light">&copy; 2024 Open Cluster Management Authors. The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href="https://www.linuxfoundation.org/trademark-usage/" target="_blank" style="color: #f8f9fa;">Trademark Usage</a></div>
  </div>
</nav>
<script type="text/javascript" src="/lang.js"></script>
</div>
    </div>
</body>
</html>
